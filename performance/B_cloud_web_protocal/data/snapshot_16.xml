<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="16">
  <HTTPTask id="64" hostname="www.bc_demo1.com" path="/js/core/gt_table.js" url="http://www.bc_demo1.com:4900/js/core/gt_table.js" ip="127.0.0.1" port="4900" connectionId="16" origin="Primary" frame="1" startTime="9325989" endTime="9326036">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Accept" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>emgtY24=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovL3d3dy5iY19kZW1vMS5jb206NDkwMC9uYXYuaHRtbA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKGNvbXBhdGlibGU7IE1TSUUgOS4wOyBXaW5kb3dzIE5UIDYuMDsgVHJpZGVudC81LjAp</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>d3d3LmJjX2RlbW8xLmNvbTo0OTAw</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9qcy9jb3JlL2d0X3RhYmxlLmpzIEhUVFAvMS4xDQpBY2NlcHQ6ICovKg0KQWNjZXB0LUxhbmd1YWdlOiB6aC1jbg0KUmVmZXJlcjogaHR0cDovL3d3dy5iY19kZW1vMS5jb206NDkwMC9uYXYuaHRtbA0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlDQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoY29tcGF0aWJsZTsgTVNJRSA5LjA7IFdpbmRvd3MgTlQgNi4wOyBUcmlkZW50LzUuMCkNCkhvc3Q6IHd3dy5iY19kZW1vMS5jb206NDkwMA0KQ29ubmVjdGlvbjogS2VlcC1BbGl2ZQ0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLUNveW90ZS8xLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Vy8iODQ2NzYtMTMzOTcyMzYwNzE2MiI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAxNSBKdW4gMjAxMiAwMToyNjo0NyBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ODQ2NzY=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAxNSBKdW4gMjAxMiAwMTo1Mjo0NCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IEFwYWNoZS1Db3lvdGUvMS4xDQpFVGFnOiBXLyI4NDY3Ni0xMzM5NzIzNjA3MTYyIg0KTGFzdC1Nb2RpZmllZDogRnJpLCAxNSBKdW4gMjAxMiAwMToyNjo0NyBHTVQNCkNvbnRlbnQtVHlwZTogdGV4dC9qYXZhc2NyaXB0DQpDb250ZW50LUxlbmd0aDogODQ2NzYNCkRhdGU6IEZyaSwgMTUgSnVuIDIwMTIgMDE6NTI6NDQgR01UDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>DQovKioNCiAqIOatpOaWh+S7tuWMheaLrOS6huWSjOihqOagvOebuOWFs+eahOaJgOacieaTjeS9nO+8jCDmraTmlofku7bkvp3otZbkuo4gZ3RfYmFzZS5qc+OAgg0KICogQGF1dGhvIGFsYmVydA0KICogQHNpbmNlIDAuMQ0KICovDQoNCi8qKg0KICog5ZKM6KGo5qC855u45YWz55qE5pON5L2cDQogKi8NCmZ1bmN0aW9uIEdUYWJsZSh0YWJsZURvbSkgew0KDQogICAgLy8g6KGo5qC85ZSv5LiA55qE57yW56CBDQogICAgdGhpcy5fX2lkID0gSWRHZW5lcmF0b3IuZ2V0SWQoKTsNCgkNCiAgICAvLyDooajmoLznmoRkb20g5a+56LGhDQogICAgdGhpcy50YWJsZURvbSA9IF9jcmVhdGVKUXVlcnkodGFibGVEb20pOw0KDQogICAgLy8g6KGo5qC86YWN572uDQogICAgdmFyIHRhYmxlQ29uZmlnOw0KDQogICAgLy8g6L+H5ruk44CB5o6S5bqP5ZKM57+76aG15Y+C5pWwDQogICAgdmFyIGZzcFBhcmFtZXRlciA9IG5ldyBGc3BQYXJhbWV0ZXIoKTsNCg0KICAgIC8vIOaJgOacieeahOihjOiusOW9lQ0KICAgIHRoaXMucm93cyA9IG5ldyBBcnJheSgpOw0KDQogICAgLy8g5YiX5qih5Z6L5a6e5L6LDQogICAgdGhpcy50YWJsZUNvbHVtbk1vZGVsID0gbnVsbDsNCg0KICAgIC8vIOihqOmAieaLqeaooeWei+WunuS+iw0KICAgIHRoaXMuc2VsZWN0aW9uTW9kZWwgICA9IG5ldyBTZWxlY3Rpb25Nb2RlbCgpOw0KDQogICAgLy8g6YCa55So55qE6KGM6YCJ5oup5LqL5Lu2DQogICAgdGhpcy5yb3dTZWxlY3Rpb25MaXN0ZW5lciA9IG5ldyBDb21tb25Sb3dTZWxlY3Rpb25MaXN0ZW5lcih0aGlzLnNlbGVjdGlvbk1vZGVsKTsNCg0KICAgIC8vIOihjOebkeWQrOWZqA0KICAgIHRoaXMucm93TGlzdGVuZXJzICAgICA9IFt0aGlzLnJvd1NlbGVjdGlvbkxpc3RlbmVyXTsNCiAgICANCiAgICB0aGlzLmRlY29yYXRlID0gZnVuY3Rpb24gKF90YWJsZUNvbmZpZywgX3Jvd3MpIHsNCiAgICAgICAgaWYgKF90YWJsZUNvbmZpZyA9PSBudWxsKSB7DQogICAgICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoIuihqOagvOmFjee9ruWvueixoeS4jeiDveS4uuepuuOAgiIpOw0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgaW5zdGFuY2Ugb2YgVGFibGVDb25maWcgY2FuIG5vdCBiZSBudWxsLiIpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMudGFibGVDb25maWcgPSBfdGFibGVDb25maWc7DQogICAgICAgIGlmIChfcm93cyAhPSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLnJvd3MgPSBfcm93czsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMucm93cyA9IFtdOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8g6LWL5YC8DQogICAgICAgIHRoaXMucm93UmVuZGVyZXIgPSBfdGFibGVDb25maWcucm93UmVuZGVyZXIgfHwgdGhpcy5yb3dSZW5kZXJlcjsNCiAgICAgICAgaWYgKF90YWJsZUNvbmZpZy5zZWxlY3Rpb25Nb2RlICE9IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uTW9kZShfdGFibGVDb25maWcuc2VsZWN0aW9uTW9kZSk7DQogICAgICAgIH0NCiAgICAgICAgDQoNCiAgICAgICAgLy9UT0RPOiDmuIXpmaTlt7LmnInmlbDmja7vvIjov5nkupvmlbDmja7mnInlj6/og73mmK/mvJTnpLrmlbDmja7vvIkNCiAgICAgICAgdmFyIGNvbHVtbkluZm9zID0gX3RhYmxlQ29uZmlnLmdldENvbHVtbkluZm9zKCk7DQogICAgICAgIHRoaXMudGFibGVDb2x1bW5Nb2RlbCA9IG5ldyBUYWJsZUNvbHVtbk1vZGVsKGNvbHVtbkluZm9zKTsNCg0KDQogICAgICAgIC8vIOWIm+W7uuihqOagvOaehOmAoOWZqOWunuS+iw0KICAgICAgICB0aGlzLnRhYmxlQnVpbGRlciA9IG5ldyBUYWJsZUJ1aWxkZXIodGhpcywgdGhpcy50YWJsZURvbSwgX3RhYmxlQ29uZmlnLCB0aGlzLnJvd3MpOw0KICAgICAgICB0aGlzLnRhYmxlQnVpbGRlci5yb3dSZW5kZXJlciAgICA9IHRoaXMucm93UmVuZGVyZXI7DQoJCXRoaXMuc2VsZWN0aW9uTW9kZWwubW9kZSAgICAgICAgID0gX3RhYmxlQ29uZmlnLnNlbGVjdGlvbk1vZGU7DQogICAgICAgIHRoaXMudGFibGVCdWlsZGVyLnNlbGVjdGlvbk1vZGVsID0gdGhpcy5zZWxlY3Rpb25Nb2RlbDsNCiAgICAgICAgdGhpcy50YWJsZUJ1aWxkZXIucm93TGlzdGVuZXJzICAgPSB0aGlzLnJvd0xpc3RlbmVyczsNCiAgICAgICAgdGhpcy50YWJsZUJ1aWxkZXIuYnVpbGQoKTsNCiAgICB9Ow0KDQogICAgLyoqDQoJKiBGSVhNRToNCiAgICAgKiDliqDovb3mjIflrprnmoTpobXmlbDmja7jgIINCiAgICAgKi8NCiAgICB0aGlzLnR1cm5Ub1BhZ2UgPSBmdW5jdGlvbihwYWdlTm8pIHsNCiAgICAgICAgdmFyIHJvd0luZGV4ID0gdGhpcy5mc3BQYXJhbWV0ZXIucGFnaW5hdGlvbi5yb3dzUGVyUGFnZSAqIHBhZ2VObzsNCiAgICAgICAgdGhpcy5mc3BQYXJhbWV0ZXIuc2V0U3RhcnRJbmRleChyb3dJbmRleCk7DQoJICAgIHZhciByb3dzID0gdGhpcy50YWJsZUNvbmZpZy5fbG9hZERhdGEoKTsNCiAgICAgICAgdGhpcy5yZWxvYWQocm93cyk7DQogICAgfTsNCgkNCgkgLyoqDQogICAgICog5Yqg6L295oyH5a6a55qE6aG15pWw5o2u44CCDQoJICpGSVhNRToNCiAgICAgKi8NCiAgICB0aGlzLnJlZnJlc2ggPSBmdW5jdGlvbigpIHsNCgkgICAgdmFyIHJvd3MgPSB0aGlzLnRhYmxlQ29uZmlnLl9sb2FkRGF0YSgpOw0KICAgICAgICB0aGlzLnJlbG9hZChyb3dzKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICog6L+U5Zue5b2T5YmN6KGo55qE57uR5a6a57G744CCDQogICAgICovDQogICAgdGhpcy5nZXRCaW5kaW5nQ2xhc3MgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGlmICh0aGlzLnRhYmxlQ29uZmlnICE9IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhYmxlQ29uZmlnLmNsYXNzTmFtZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9Ow0KDQogICAgLyoqIOWcqOW9k+WJjeaVsOaNruS5i+WQju+8jOi/veWKoOihjOiusOW9lSAqLw0KICAgIHRoaXMubG9hZCA9IGZ1bmN0aW9uKF9yb3dzKSB7DQogICAgICAgIGlmIChfcm93cyA9PSBudWxsKSB7DQogICAgICAgICAgICAvLyB0aHJvdyBuZXcgInBhcmFtZXRlciBjYW4gbm90IGJlIG51bGwuIjsNCiAgICAgICAgICAgIF9yb3dzID0gW107DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEoX3Jvd3MgaW5zdGFuY2VvZiBBcnJheSkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyAicGFyYW1ldGVyIGlzIG5vdCBhIEFycmF5LiI7DQogICAgICAgIH0NCiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IF9yb3dzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgcm93ID0gX3Jvd3NbaV07DQogICAgICAgICAgICBpZiAocm93ICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aGlzLnJvd3MucHVzaChyb3cpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRoaXMudGFibGVCdWlsZGVyLnJvd3MgPSB0aGlzLnJvd3M7DQogICAgICAgIHRoaXMudGFibGVCdWlsZGVyLmJ1aWxkQm9keSgpOw0KDQogICAgfQ0KDQogICAgLyoqIOWIoOmZpOaJgOacieihjOS5i+WQju+8jOi/veWKoOihjOiusOW9lSAqLw0KICAgIHRoaXMucmVsb2FkID0gZnVuY3Rpb24gKF9yb3dzKSB7DQogICAgICAgIHRoaXMuY2xlYXIoKTsNCiAgICAgICAgdGhpcy5sb2FkKF9yb3dzKTsNCiAgICB9DQoNCiAgICAvKiog5Yig6Zmk5omA5pyJ6KGMICovDQogICAgdGhpcy5jbGVhciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5yb3dzID0gbmV3IEFycmF5KCk7DQogICAgICAgIHRoaXMudGFibGVCdWlsZGVyLmRlbGV0ZUFsbCgpOw0KICAgIH0NCg0KICAgIC8qKiDlnKjmjIflrprkvY3nva7ov73liqDooYzorrDlvZUgKi8NCiAgICB0aGlzLmluc2VydEF0ID0gZnVuY3Rpb24oX3Jvdywgcm93SW5kZXgpIHsNCiAgICAgICAgLy8g5qCh6aqM6LaK55WMDQogICAgICAgIGlmIChfcm93ID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnJvd3Muc3BsaWNlKHJvd0luZGV4LCAwLCBfcm93KTsNCiAgICB9Ow0KDQogICAgLyoqIOWcqOaJgOacieiusOW9leS5i+WQjui/veWKoOihjOiusOW9lSAqLw0KICAgIHRoaXMuYXBwZW5kUm93ID0gZnVuY3Rpb24oX3Jvdykgew0KICAgICAgICBpZiAoX3JvdyAhPSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLnJvd3MucHVzaChfcm93KTsNCiAgICAgICAgICAgIHRoaXMudGFibGVCdWlsZGVyLmFwcGVuZFJvdyhfcm93KTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiDmoKHpqozooYzntKLlvJXmmK/lkKbotornlYzjgIINCiAgICAgKi8NCiAgICB0aGlzLnZhbGlkYXRlUm93SW5kZXggPSBmdW5jdGlvbiAocm93SW5kZXgpIHsNCiAgICAgICAgaWYgKHJvd0luZGV4ID09IG51bGwgfHwgaXNOYU4ocm93SW5kZXgpKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInJvdyBpbmRleCBjYW4gbm90IGJlIG51bGwgYW5kIG11c3QgYmUgYSBudW1iZXIuIik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHJvd0luZGV4IDwgMCB8fCByb3dJbmRleCA+PSB0aGlzLnJvd3MubGVuZ3RoKSB7DQogICAgICAgICAgICB0aHJvdyAib3V0IG9mIHJvdyBpbmRleCBlcnJvciI7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKiog5Yig6Zmk5omA5pyJ6YCJ5Lit55qE6KGMICovDQogICAgdGhpcy5nZXRSb3dBdCA9IGZ1bmN0aW9uIChyb3dJbmRleCkgew0KICAgICAgICB0aGlzLnZhbGlkYXRlUm93SW5kZXgocm93SW5kZXgpOw0KICAgICAgICByZXR1cm4gdGhpcy5yb3dzW3Jvd0luZGV4XTsNCiAgICB9DQoNCiAgICAvKiog5Yig6Zmk5omA5pyJ6YCJ5Lit55qE6KGMICovDQogICAgdGhpcy5kZWxldGVSb3cgPSBmdW5jdGlvbiAocm93SW5kZXgpIHsNCiAgICAgICAgdGhpcy52YWxpZGF0ZVJvd0luZGV4KHJvd0luZGV4KTsNCiAgICAgICAgdGhpcy5yb3dzLnNwbGljZShyb3dJbmRleCwgMSk7DQogICAgICAgIHRoaXMudGFibGVCdWlsZGVyLmRlbGV0ZVJvdyhyb3dJbmRleCk7DQogICAgfQ0KDQogICAgLyoqIOabtOaWsOaJgOaciemAieS4reeahOihjCAqLw0KICAgIHRoaXMudXBkYXRlUm93ID0gZnVuY3Rpb24gKHJvd0luZGV4LCByb3cpIHsNCiAgICAgICAgdGhpcy52YWxpZGF0ZVJvd0luZGV4KHJvd0luZGV4KTsNCiAgICAgICAgdGhpcy5yb3dzLnNwbGljZShyb3dJbmRleCwgMSwgcm93KTsNCiAgICAgICAgdGhpcy50YWJsZUJ1aWxkZXIudXBkYXRlUm93KHJvd0luZGV4LCByb3cpOw0KICAgIH0NCg0KICAgIC8qKiDov5Tlm57lvZPliY3ooajnmoTooYzmlbAgKi8NCiAgICB0aGlzLmdldFJvd0NvdW50ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5yb3dzLmxlbmd0aDsNCiAgICB9DQoNCiAgICAvKiog6L+U5Zue5b2T5YmN6KGo55qE5YiX5pWwICovDQogICAgdGhpcy5nZXRDb2x1bW5Db3VudCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy50YWJsZUNvbHVtbk1vZGVsLmdldENvbHVtbkNvdW50KCk7DQogICAgfQ0KICAgIC8vDQogICAgLyoqIOiuvue9ruafkOS4quaMh+WumuWNleWFg+agvOeahOWAvCAqLw0KICAgIHRoaXMuc2V0VmFsdWVBdCA9IGZ1bmN0aW9uIChyb3dJbmRleCwgY29sSW5kZXgsIHZhbHVlKSB7DQogICAgICAgIHZhciBuYW1lID0gdGhpcy50YWJsZUNvbHVtbk1vZGVsLmdldFByb3BlcnR5TmFtZShjb2xJbmRleCk7DQogICAgICAgIHZhciByb3cgPSB0aGlzLmdldFJvd0F0KHJvd0luZGV4KTsNCiAgICAgICAgcm93W25hbWVdID0gdmFsdWU7DQogICAgfQ0KDQogICAgLyoqIOi/lOWbnuaMh+WumuafkOS4quaMh+WumuWNleWFg+agvOeahOWAvCAqLw0KICAgIHRoaXMuZ2V0VmFsdWVBdCA9IGZ1bmN0aW9uIChyb3dJbmRleCwgY29sSW5kZXgpIHsNCiAgICAgICAgdmFyIG5hbWUgPSB0aGlzLnRhYmxlQ29sdW1uTW9kZWwuZ2V0UHJvcGVydHlOYW1lKGNvbEluZGV4KTsNCiAgICAgICAgdmFyIHJvdyA9IHRoaXMuZ2V0Um93QXQocm93SW5kZXgpOw0KICAgICAgICByZXR1cm4gcm93W25hbWVdOw0KICAgIH0NCg0KICAgIC8qKiDov5Tlm57nrKzkuIDkuKror7vliLDnmoTpgInkuK3ooYws5aaC5p6c5rKh5pyJ6YCJ5Lit6KGM77yM5YiZ6L+U5ZueIG51bGzjgIIgKi8NCiAgICB0aGlzLmdldFNlbGVjdGVkUm93ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgc2VsZWN0ZWRSb3cgPSB0aGlzLnNlbGVjdGlvbk1vZGVsLmdldFNlbGVjdGVkUm93KCk7DQogICAgICAgIGlmIChzZWxlY3RlZFJvdyA8IDApIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLmdldFJvd0F0KHNlbGVjdGVkUm93KTsNCiAgICB9DQoNCiAgICAvKiog6L+U5Zue56ys5LiA5Liq6K+75Yiw55qE6YCJ5Lit6KGMLOWmguaenOayoeaciemAieS4reihjO+8jOWImei/lOWbniBudWxs44CCICovDQogICAgdGhpcy5nZXRTZWxlY3RlZFJvd3MgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBzZWxlY3RlZFJvd0luZGllcyA9IHRoaXMuc2VsZWN0aW9uTW9kZWwuZ2V0U2VsZWN0ZWRSb3dzKCk7DQogICAgICAgIGlmIChzZWxlY3RlZFJvd0luZGllcyA9PSBudWxsIHx8IHNlbGVjdGVkUm93SW5kaWVzLmxlbmd0aCA9PTApIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIHZhciBzZWxlY3RlZFJvd3MgPSBbXTsNCiAgICAgICAgZm9yKHZhciByb3cgPSAwOyByb3cgPCBzZWxlY3RlZFJvd0luZGllcy5sZW5ndGg7IHJvdysrKSB7DQogICAgICAgICAgICBzZWxlY3RlZFJvd3MucHVzaCh0aGlzLmdldFJvd0F0KHJvdykpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzZWxlY3RlZFJvd3M7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog6L+U5Zue56ys5LiA5Liq6K+75Yiw55qE6YCJ5Lit6KGM55qE6KGM5Y+3LOWmguaenOayoeaciemAieS4reihjO+8jOWImei/lOWbniAtMeOAgg0KICAgICAqDQogICAgICovDQogICAgdGhpcy5nZXRTZWxlY3RlZFJvd051bSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgc2VsZWN0ZWRSb3cgPSB0aGlzLnNlbGVjdGlvbk1vZGVsLmdldFNlbGVjdGVkUm93KCk7DQogICAgICAgIGlmIChzZWxlY3RlZFJvdyA8IDApIHsNCiAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2VsZWN0ZWRSb3c7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog6L+U5Zue56ys5LiA5Liq6K+75Yiw55qE6YCJ5Lit6KGM55qE6KGM5Y+3LOWmguaenOayoeaciemAieS4reihjO+8jOWImei/lOWbniAtMeOAgg0KICAgICAqLw0KICAgIHRoaXMuZ2V0U2VsZWN0ZWRSb3dOdW1zID0gZnVuY3Rpb24oKXsNCiAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbk1vZGVsLmdldFNlbGVjdGVkUm93cygpOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIOabtOaWsOmAieS4reeahOihjO+8jOWmguaenOmAieS4reWkmuihjO+8jOWImemAieaLqeesrOS4gOS4qumAieS4reihjO+8iOWPr+iDveW4puaciemaj+acuuaAp++8ie+8jA0KICAgICAqIOWboOatpOW7uuiuruWPquWcqOWNlemAieeahOaDheWGteS4i+S9v+eUqOatpOaWueazleOAgg0KICAgICAqIEByb3cg5pu05paw5ZCO55qE6KGM77yM5aaC5p6c5Y+C5pWw5Li656m65oiW6ICF5b2T5YmN5rKh5pyJ6YCJ5Lit55qE6KGM77yM5YiZ5LiN6L+b6KGM5Lu75L2V5aSE55CG44CCDQogICAgICovDQogICAgdGhpcy51cGRhdGVTZWxlY3RlZFJvdyA9IGZ1bmN0aW9uIChyb3cpew0KICAgICAgICB2YXIgc2VsZWN0ZWRSb3cgPSB0aGlzLmdldFNlbGVjdGVkUm93KCk7DQogICAgICAgIGlmIChyb3cgPT0gbnVsbCB8fCBzZWxlY3RlZFJvdyA8IDApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnVwZGF0ZVJvdyhzZWxlY3RlZFJvdywgcm93KTsNCiAgICB9DQoNCiAgICAvLyBzZXRDb2x1bW5SZW5kZXJlcihjb2x1bW5OYW1lLCByZW5kZXJlcikgLyoqIOiuvue9ruWIl+eahOWRiOeOsOWZqCAqLw0KDQogICAgLyoqDQogICAgICog6YCJ5Lit5oyH5a6a55qE6KGMDQogICAgICovDQogICAgdGhpcy5zZXRTZWxlY3RlZFJvdyA9IGZ1bmN0aW9uIChyb3dJbmRleCkgew0KICAgICAgICB0aGlzLnZhbGlkYXRlUm93SW5kZXgocm93SW5kZXgpOw0KICAgICAgICB0aGlzLnNlbGVjdGlvbk1vZGVsLnNldFNlbGVjdGVkUm93KHJvd0luZGV4KTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiDorr7nva7oh6rlrprkuYnnmoTooYzlkYjnjrDlmajjgIINCiAgICAgKi8NCiAgICB0aGlzLnNldFJvd1JlbmRlcmVyID0gZnVuY3Rpb24gKHJvd1JlbmRlcmVyKSB7DQogICAgICAgIHRoaXMucm93UmVuZGVyZXIgPSByb3dSZW5kZXJlcjsNCiAgICB9DQoNCiAgICB0aGlzLnNldFNlbGVjdGlvbk1vZGUgPSBmdW5jdGlvbiAobW9kZSkgew0KICAgICAgICAvL1RPRE86IOajgOmqjOaooeW8j+aYr+WQpuWtmOWcqA0KICAgICAgICBpZiAoU2VsZWN0aW9uTW9kZVttb2RlXSA9PSBudWxsKSB7DQoNCiAgICAgICAgfQ0KICAgICAgICBpZiAobW9kZSA9PSBudWxsKSB7DQogICAgICAgICAgICBtb2RlID0gU2VsZWN0aW9uTW9kZS5TSU5HTEU7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5zZWxlY3Rpb25Nb2RlbC5tb2RlID0gbW9kZTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiDnm5HlkKzpgInmi6nnmoTooYzmmK/lkKblj5HnlJ/kuoblj5jljJbjgILms6jmhI/vvJrkuIDkuKrpgInmi6nliqjkvZzlj6/og73lvJXotbfkuKTkuKrkuovku7bvvIzkuIDkuKrmmK/ooqvpgInkuK3ooYzlj5bmtojkuobpgInmi6nnirbmgIHvvJsNCiAgICAgKiDlhbbkuozmmK/mnKrooqvpgInkuK3nmoTooYzooqvpgInkuK3jgIINCiAgICAgKi8NCiAgICB0aGlzLmFkZFJvd1NlbGVjdGlvbkxpc3RlbmVyID0gZnVuY3Rpb24gKHNlbGVjdGlvbkxpc3RlbmVyKSB7DQogICAgICAgIGlmIChzZWxlY3Rpb25MaXN0ZW5lciAhPSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLnJvd1NlbGVjdGlvbkxpc3RlbmVyLmFkZExpc3RlbmVyIChzZWxlY3Rpb25MaXN0ZW5lcik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiDnm5HlkKzooYzmmK/lkKbooqvngrnlh7vnmoTkuovku7bjgIINCiAgICAgKi8NCiAgICB0aGlzLmFkZFJvd0NsaWNrZWRMaXN0ZW5lciA9IGZ1bmN0aW9uIChyb3dDbGlja2VkTGlzdGVuZXIpIHsNCiAgICAgICAgaWYgKHJvd0NsaWNrZWRMaXN0ZW5lciAhPSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLnJvd0xpc3RlbmVycy5wdXNoKHJvd0NsaWNrZWRMaXN0ZW5lcik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiDnm5HlkKzooYzmmK/lkKbooqvlj4zlh7vnmoTkuovku7bjgIINCiAgICAgKi8NCiAgICB0aGlzLmFkZFJvd0RvdWJsZUNsaWNrTGlzdGVuZXIgPSBmdW5jdGlvbiAocm93RG91YmxlQ2xpY2tlZExpc3RlbmVyKSB7DQoNCiAgICB9DQoNCn0NCg0KLyoqDQogKiDpgJrnlKjnmoTooYzpgInmi6nnm5HlkKzlmajvvIzpgJrov4fmraTnm5HlkKzlmajlsIbooYzngrnlh7vkuovku7bovazmjaLkuLrooYzpgInmi6nkuovku7bjgIINCiAqIEBwYXJhbSBzZWxlY3Rpb25Nb2RlbCDpgInmi6nmqKHlnosNCiAqLw0KZnVuY3Rpb24gQ29tbW9uUm93U2VsZWN0aW9uTGlzdGVuZXIgKHNlbGVjdGlvbk1vZGVsKSB7DQogICAgLy8g6KGM55uR5ZCs5Zmo5ZSv5LiA55qE57yW56CBDQogICAgdGhpcy5fX2lkID0gSWRHZW5lcmF0b3IuZ2V0SWQoKTsNCg0KICAgIHRoaXMuc2VsZWN0aW9uTW9kZWwgPSBzZWxlY3Rpb25Nb2RlbDsNCiAgICB0aGlzLnJvd1NlbGVjdGlvbkxpc3RlbmVycyA9IFtdOw0KDQogICAgdGhpcy5vbkNsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgIHZhciByb3dJbmRleCAgPSBldmVudFsncm93SW5kZXgnXTsgLy8g6KKr6YCJ5Lit55qE6KGM5Y+3DQogICAgICAgIGlmIChyb3dJbmRleCA9PSBudWxsKSB7DQogICAgICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoIuWPguaVsOmUmeivr++8jOihjOWPt+S4jeiDveS4uuepuuOAgiIpOw0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgcGFyYW1ldGVyW3Jvd0luZGV4XSBjYW4gbm90IGJlIG51bGwuIik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoZXZlbnQuc2VsZWN0aW9uQ2hhbmdlZCkgew0KICAgICAgICAgICAgdmFyIHJzZSA9IG5ldyBSb3dTZWxlY3Rpb25FdmVudChldmVudC5zb3VyY2UsIHJvd0luZGV4KTsNCiAgICAgICAgICAgIHRoaXMuZmlyZShyc2UpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQoNCmpRdWVyeS5leHRlbmQoQ29tbW9uUm93U2VsZWN0aW9uTGlzdGVuZXIucHJvdG90eXBlLCBPYnNlcnZhYmxlLnByb3RvdHlwZSk7DQoNCmZ1bmN0aW9uIFJvd1NlbGVjdGlvbkV2ZW50IChzb3VyY2UsIHJvd0luZGV4KSB7DQogICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7DQogICAgdGhpcy5uYW1lID0gJ1Jvd1NlbGVjdGlvbic7DQogICAgdGhpcy5yb3dJbmRleCA9IHJvd0luZGV4OyAgLy8g6KKr6YCJ5Lit55qE6KGM5Y+3DQp9DQoNCmZ1bmN0aW9uIFRhYmxlRXZlbnQgKHRhYmxlSWQpIHsNCiAgICB0aGlzLnRhYmxlSWQgPSB0YWJsZUlkOw0KDQogICAgLyoqDQogICAgICog5LqL5Lu25YiG5rS+5aSE55CG5Ye95pWw44CC5q+P5qyh54K55Ye76KGo5pe277yM6YO95bCG6YCa6L+H5q2k5YiG5Y+R5Zmo6L+b6KGM5aSE55CGDQogICAgICovDQogICAgdGhpcy5ldmVudERpc3BhdGNoID0gZnVuY3Rpb24gKHNvdXJjZSkgew0KDQogICAgICAgIGpRdWVyeS5lYWNoKHRoaXMubGlzdGVuZXJzLCBmdW5jdGlvbihpLCBsaXN0ZW5lcikgew0KICAgICAgICAgICAgdmFyIG1ldGhvZCA9IHNvdXJjZS5uYW1lOw0KICAgICAgICAgICAgaWYgKGxpc3RlbmVyW21ldGhvZF0gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGxpc3RlbmVyW21ldGhvZF0oc291cmNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KfQ0KDQovLyDlrp7njrAgR1RhYmxlIOeahOS6i+S7tuebkeWQrOaOpeWPow0KalF1ZXJ5LmV4dGVuZChUYWJsZUV2ZW50LnByb3RvdHlwZSwgT2JzZXJ2YWJsZS5wcm90b3R5cGUpOw0KDQoNCi8qKg0KICog6KGo5qC855qE5p6E5bu65Ye95pWw77yM55So5q2k5Ye95pWw5Y+v5p6E6YCg6KGo5qC85a+56LGhDQogKiBAdGFibGVEb20g6KGo5qC855qEIERPTSDlr7nosaHvvIzkuI3og73kuLrnqbrjgIINCiAqIEBjb2x1bW5zICDooajmoLznmoTliJfkv6Hmga/vvIzlj6/kuLrnqbrjgIINCiAqIEByb3dzICAgICAg6KGM5pWw5o2u77yM5Y+v5Li656m644CCDQogKi8NCmZ1bmN0aW9uIFRhYmxlQnVpbGRlciAoZ1RhYmxlLCB0YWJsZURvbSwgdGFibGVDb25maWcsIHJvd3MpIHsNCiAgICB0aGlzLmdUYWJsZSAgICAgICA9IGdUYWJsZTsNCiAgICB0aGlzLnRhYmxlRG9tICAgICA9IHRhYmxlRG9tOw0KICAgIHRoaXMudGFibGVDb25maWcgID0gdGFibGVDb25maWc7DQogICAgdGhpcy5jb2x1bW5JbmZvcyAgPSB0YWJsZUNvbmZpZy5nZXRDb2x1bW5JbmZvcygpOw0KICAgIHRoaXMucm93cyAgICAgICAgID0gcm93czsNCiAgICB0aGlzLnNob3dIZWFkZXIgICA9IHRhYmxlQ29uZmlnLnNob3dIZWFkZXI7ICAvLyDmmK/lkKbmmL7npLrlpLTkv6Hmga8NCiAgICB0aGlzLnJvd1JlbmRlcmVyICAgID0gbnVsbDsgICAgIC8vIOihjOWRiOeOsOWZqO+8iOeUqOS6jue8lui+keaVtOihjOiusOW9le+8iQ0KICAgIHRoaXMuaGVhZGVyUmVuZGVyZXIgPSBudWxsOyAgIC8vVE9ETzog5aS05ZGI546w5ZmoDQogICAgdGhpcy5zZWxlY3Rpb25Nb2RlbCA9IG5ldyBTZWxlY3Rpb25Nb2RlbCgpOyAgLy8g6YCJ5oup5qih5Z6LDQogICAgdGhpcy5yb3dQcm9jZXNzb3IgICA9IG51bGw7ICAgLy8g6KGM5Zue6LCD5Ye95pWw77yM5Zyo6KGM5p6E5bu65LmL5ZCO6LCD55So5q2k5Ye95pWwDQogICAgdGhpcy5yb3dMaXN0ZW5lcnMgICA9IFtdOyAgICAgLy8g6KGM55uR5ZCs5ZmoDQogICAgdGhpcy5yb3dJZHMgICAgICAgICA9IFtdOyAgICAgLy8g5omA5pyJ55qE6KGM5a+55bqU55qESUQNCiAgICB0aGlzLmhlYWRlckF0dHJzICAgID0gdGFibGVDb25maWcuaGVhZGVyQXR0cnM7ICAgICAvLyDooajlpLTlsZ7mgKcNCiAgICB0aGlzLnRyQXR0cnMgICAgICAgID0ge307ICAgICAgLy8g5pWw5o2u6KGM55qE5bGe5oCnDQogICAgLy8g6YCJ5oup5aS055qE5bGe5oCnDQogICAgdGhpcy5zZWxlY3Rpb25IZWFkZXJBdHRycyA9IHRhYmxlQ29uZmlnLnNlbGVjdGlvbkhlYWRlckF0dHJzOw0KICAgIHRoaXMucm93T3Zlckxpc3RlbmVycyAgID0gW107ICAvLyDooYznm5HlkKzlmagNCiAgICB0aGlzLnJvd092ZXJMaXN0ZW5lcnMucHVzaChuZXcgUm93T3ZlclByb2Nlc3Nvcih0YWJsZURvbSwgdGFibGVDb25maWcsIHRhYmxlQ29uZmlnLnNob3J0Q3V0Q29uZmlnKSk7DQogICAgLy8gdGhpcy50ZEF0dHJzICAgICAgICA9DQoNCiAgICAvKioNCiAgICAgKiDlrprkuYnooajmoLznmoTmoLflvI8NCiAgICAgKi8NCiAgICB0aGlzLnN0eWxlcyA9IHsnb2RkUm93JyA6ICd0YWJsZU9sZFJvdycsDQogICAgICAgICAgICAgICAgICAgJ2V2ZW5Sb3cnIDogJ3RhYmxlRXZlblJvdycsDQogICAgICAgICAgICAgICAgICAgJ3JvbGxpbmdSb3cnIDogJ3RhYmxlUm9sbGluZ1Jvdyd9Ow0KfQ0KDQovKioNCiAqIFRPRE86IOWvueaVsOaNrui/m+ihjOaTjeS9nOaXtuimgeinpuWPkeihjOmAieaLqeS6i+S7tuOAgg0KICovDQpqUXVlcnkuZXh0ZW5kKFRhYmxlQnVpbGRlci5wcm90b3R5cGUsIHsNCg0KICAgIC8vIHJvd1NlbGVjdG9yUHJlZml4IDogJ19zZWxlY3Rvcl8nLCAgLy8g6KGM6YCJ5oup5o6n5Lu277yI5aSN6YCJ5qGG5oiW6ICF5Y2V6YCJ5qGG55qE5YmN57yA77yJDQoNCiAgICBidWlsZCA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgLy8g5p6E5bu65LmL5YmN5Yig6Zmk5omA5pyJ5pWw5o2uDQogICAgICAgIHRoaXMudGFibGVEb20uZW1wdHkoKTsNCg0KICAgICAgICBpZiAodGhpcy5zaG93SGVhZGVyKSB7DQogICAgICAgICAgICB0aGlzLmJ1aWxkSGVhZGVycyh0aGlzLmNvbHVtbkluZm9zKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmJ1aWxkQm9keSgpOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDmnoTlu7rliJflpLTkv6Hmga8NCiAgICAgKi8NCiAgICBidWlsZEhlYWRlcnMgOiBmdW5jdGlvbiAoY29sdW1uSW5mb3MpIHsNCiAgICAgICAgaWYgKGNvbHVtbkluZm9zID09IG51bGwgfHwgIShjb2x1bW5JbmZvcyBpbnN0YW5jZW9mIEFycmF5KQ0KICAgICAgICAgICAgfHwgY29sdW1uSW5mb3MubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfSAgICAgICANCg0KICAgICAgIC8vIOaehOW7unRoZWFkDQogICAgICAgdmFyIHRoZWFkID0galF1ZXJ5KCI8dGhlYWQ+PC90aGVhZD4iKS5hcHBlbmRUbyh0aGlzLnRhYmxlRG9tKTsNCiAgICAgICB2YXIgdGggPSBqUXVlcnkoIjx0cj48L3RyPiIpLmFwcGVuZFRvKHRoZWFkKTsNCg0KICAgICAgIGlmICh0aGlzLmhlYWRlckF0dHJzICE9IG51bGwpIHsNCiAgICAgICAgICAgalF1ZXJ5LmVhY2godGhpcy5oZWFkZXJBdHRycywgZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7DQogICAgICAgICAgICAgICB0aC5hdHRyKG5hbWUsIHZhbHVlKTsNCiAgICAgICAgICAgfSk7DQogICAgICAgfQ0KDQogICAgICAgLy8g5p6E5bu66YCJ5oup6KGMDQogICAgICAgaWYgKHRoaXMuaXNDcmVhdGVTZWxlY3Rpb25IZWFkZXIoKSkgew0KICAgICAgICAgICB2YXIgc2VsZWN0aW9uSGVhZGVyID0galF1ZXJ5KCI8dGQ+IC0tKi0tIDwvdGQ+Iik7DQogICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbkhlYWRlckF0dHJzICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgIGpRdWVyeS5lYWNoKHRoaXMuc2VsZWN0aW9uSGVhZGVyQXR0cnMsIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbkhlYWRlci5hdHRyKG5hbWUsIHZhbHVlKTsNCiAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRoLmFwcGVuZChzZWxlY3Rpb25IZWFkZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8g5Yib5bu65aS05ZGI546w5ZmoKEhlYWRlclJlbmRlcmVyKQ0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbHVtbkluZm9zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgdGFibGVDb2x1bW5JbmZvID0gY29sdW1uSW5mb3NbaV07DQogICAgICAgICAgICB2YXIgdGQgPSBqUXVlcnkoIjx0ZD4iICsgdGFibGVDb2x1bW5JbmZvLnRpdGxlICsgIjwvdGQ+IikuYXR0cigibmFtZSIsIHRhYmxlQ29sdW1uSW5mby5wcm9wZXJ0eU5hbWUpOw0KDQogICAgICAgICAgICAvLyDor7vlj5blsZ7mgKfkv6Hmga8NCiAgICAgICAgICAgIHRkLmF0dHIoJ3N0eWxlJywgdGFibGVDb2x1bW5JbmZvWydzdHlsZSddKTsNCiAgICAgICAgICAgIHRkLmF0dHIoJ2NsYXNzTmFtZScsIHRhYmxlQ29sdW1uSW5mb1snY2xhc3NOYW1lJ10pOw0KICAgICAgICAgICAgaWYgKHRoaXMuaGVhZGVyUmVuZGVyZXIgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHZhciByZW5kZXJlciA9IHRoaXMuaGVhZGVyUmVuZGVyZXIuZ2V0UmVuZGVyZXIodGRbMF0sIGNvbHVtbkluZm9zKTsNCiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXIgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICB0ZC52YWwocmVuZGVyZXIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoLmFwcGVuZCh0ZCk7DQogICAgICAgIH0NCiAgICB9LA0KDQoNCiAgICAvKioNCiAgICAgKiDliKTmlq3mmK/lkKbmnoTlu7rpgInmi6nlpLTjgILlhbbop4TliJnmmK/pgInmi6nmqKHlnovkuI3kuLrnqbrvvIzkuJTlj6/ku6XpgInmi6nvvIzkuJTmmL7npLrpgInmi6nlpLTvvIzlvIDlp4vmnoTlu7rkuYvjgIINCiAgICAgKi8NCiAgICBpc0NyZWF0ZVNlbGVjdGlvbkhlYWRlciA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuICh0aGlzLnNlbGVjdGlvbk1vZGVsICE9IG51bGwgJiYgdGhpcy5zZWxlY3Rpb25Nb2RlbC5tb2RlICE9IFNlbGVjdGlvbk1vZGUuTk9ORQ0KICAgICAgICAgICAgJiYgdGhpcy5zZWxlY3Rpb25Nb2RlbC5zaG93U2VsZWN0aW9uSGVhZGVyKTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5piv5ZCm5YWB6K646KGM6YCJ5oup77yI5Y2z6Kem5Y+R6KGM6YCJ5oup5LqL5Lu277yJ77yM6YCJ5oup5qih5Z6L5LiN5Li656m677yM5LiU5Y+v5Lul6YCJ5oup77yM6L+U5ZueIHRydWXjgIINCiAgICAgKi8NCiAgICBpc0FsbG93Um93U2VsZWN0aW9uIDogZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gKHRoaXMuc2VsZWN0aW9uTW9kZWwgIT0gbnVsbA0KICAgICAgICAgICAgJiYgdGhpcy5zZWxlY3Rpb25Nb2RlbC5tb2RlICE9IFNlbGVjdGlvbk1vZGUuTk9ORSk7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOaehOW7uuihqOS9k+S/oeaBr+OAgg0KICAgICAqLw0KICAgIGJ1aWxkQm9keSA6IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgdGJvZHkgPSB0aGlzLnRhYmxlRG9tLmNoaWxkcmVuKCJ0Ym9keSIpOw0KICAgICAgICBpZiAodGJvZHkubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgIHRib2R5ID0galF1ZXJ5KCI8dGJvZHkvPiIpOw0KICAgICAgICAgICAgdGhpcy50YWJsZURvbS5hcHBlbmQodGJvZHkpOw0KICAgICAgICB9DQogICAgICAgIGZvcih2YXIgcm93SW5kZXggPSAwOyByb3dJbmRleCA8IHRoaXMucm93cy5sZW5ndGg7IHJvd0luZGV4KyspIHsNCiAgICAgICAgICAgIHZhciByb3cgPSB0aGlzLnJvd3Nbcm93SW5kZXhdOw0KICAgICAgICAgICAgdmFyIHRyID0gdGhpcy5jcmVhdGVSb3cocm93LCByb3dJbmRleCk7DQogICAgICAgICAgICB0Ym9keS5hcHBlbmQodHIpOw0KICAgICAgICB9DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOWIm+W7uuS4gOihjOiusOW9lQ0KICAgICAqLw0KICAgIGNyZWF0ZVJvdyA6IGZ1bmN0aW9uIChyb3csIHJvd0luZGV4KSB7DQogICAgICAgIHZhciBpZCA9ICd0cl8nICsgSWRHZW5lcmF0b3IuZ2V0SWQoKTsgIC8vIOavj+ihjOiusOW9lemDveacieS4gOS4quiHquWKqOS6p+eUn+eahElEDQogICAgICAgIHRoaXMucm93SWRzLnNwbGljZShyb3dJbmRleCwgMCwgaWQpOw0KICAgICAgICB2YXIgdHIgPSBqUXVlcnkoIjx0ciAvPiIpLmF0dHIoImlkIiwgaWQpOw0KDQogICAgICAgIC8vIOiuvuWumuWlh+aVsOWSjOWBtuaVsOihjA0KICAgICAgICBpZiAoISF0aGlzLnRhYmxlQ29uZmlnLnNob3daZWJyYUJnKSB7DQogICAgICAgICAgICB2YXIgZXZlblJvdyA9IFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgndGFibGUuZXZlblJvdy5jbGFzc05hbWUnLCAnZXZlblJvdycpOw0KICAgICAgICAgICAgdmFyIG9kZFJvdyAgPSBTeXN0ZW1Db25maWd1cmF0aW9uLnJlYWQoJ3RhYmxlLm9kZFJvdy5jbGFzc05hbWUnLCAgJ29kZFJvdycpOw0KICAgICAgICAgICAgaWYgKChyb3dJbmRleCArIDEpICUgMiA9PSAwKSB7DQogICAgICAgICAgICAgICAgdHIuYWRkQ2xhc3MoZXZlblJvdyk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHRyLmFkZENsYXNzKG9kZFJvdyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KDQogICAgICAgIC8vIOazqOWGjOihjOmAieaLqeS6i+S7tg0KICAgICAgICBpZiAodGhpcy5pc0FsbG93Um93U2VsZWN0aW9uKCkpIHsNCiAgICAgICAgICAgIHRyLmRhdGEoJ19yb3dMaXN0ZW5lcnMnLCB0aGlzLnJvd0xpc3RlbmVycyk7DQogICAgICAgICAgICB0ci5iaW5kKCJjbGljayIsIHtzZWxlY3Rpb25Nb2RlbCA6IHRoaXMuc2VsZWN0aW9uTW9kZWwsIHJvd0lkcyA6IHRoaXMucm93SWRzfSwNCiAgICAgICAgICAgICAgICB0aGlzLnJvd0NsaWNrZWQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8g5rOo5YaM6byg5qCH6L+b5YWl5ZKM6YCA5Ye66KGM5LqL5Lu2DQogICAgICAgIGlmICh0cnVlKSB7DQogICAgICAgICAgICB2YXIgcGFyYW1zID0ge3Jvd0luZGV4IDogcm93SW5kZXgsIHJvdyA6IHJvdywgcm93T3Zlckxpc3RlbmVycyA6IHRoaXMucm93T3Zlckxpc3RlbmVyc307DQogICAgICAgICAgICB0ci5iaW5kKCJtb3VzZW91dCIsIHBhcmFtcywgdGhpcy5tb3VzZU91dCk7DQogICAgICAgICAgICB0ci5iaW5kKCJtb3VzZW92ZXIiLCBwYXJhbXMsIHRoaXMubW91c2VPdmVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIOaehOW7uumAieaLqeihjA0KICAgICAgICBpZiAodGhpcy5pc0NyZWF0ZVNlbGVjdGlvbkhlYWRlcigpKSB7DQogICAgICAgICAgICB2YXIgX21vZGUgPSB0aGlzLnNlbGVjdGlvbk1vZGVsLm1vZGU7DQoJCQl2YXIgcm93SGVhZGVyOw0KCQkJaWYgKF9tb2RlID09IFNlbGVjdGlvbk1vZGUuTVVMVEkgfHwgX21vZGUgPT0gU2VsZWN0aW9uTW9kZS5UT0dHTEUpIHsNCiAgICAgICAgICAgICAgICByb3dIZWFkZXIgPSBqUXVlcnkoIjx0ZD4gPGlucHV0IHR5cGU9J2NoZWNrYm94JyBpZD0iICsgJ19zZWxlY3Rvcl8nICsgaWQgKyAiICAvPiA8L3RkPiIpOw0KCQkJfSBlbHNlIHsNCgkJCSAgICByb3dIZWFkZXIgPSBqUXVlcnkoIjx0ZD4gPGlucHV0IHR5cGU9J3JhZGlvJyBpZD0iICsgJ19zZWxlY3Rvcl8nICsgaWQgKyAiICAvPiA8L3RkPiIpOw0KCQkJfQ0KICAgICAgICAgICAgdHIuYXBwZW5kKHJvd0hlYWRlcik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoaXMucm93UmVuZGVyZXIgIT0gbnVsbCkgew0KICAgICAgICAgICAgLy8g6Ieq5a6a5LmJ6KGM5p6E5bu65ZmoDQogICAgICAgICAgICB2YXIgX3RkID0galF1ZXJ5KCI8dGQ+ICIgKyB0aGlzLnJvd1JlbmRlcmVyLmdldFJvdyhyb3csIHJvd0luZGV4KSArICIgPC90ZD4iKTsNCiAgICAgICAgICAgIHRyLmFwcGVuZChfdGQpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8g6Ieq5Yqo5p6E5bu66KGMDQogICAgICAgICAgICBmb3IgKHZhciBjb2xJbmRleCA9IDA7IGNvbEluZGV4IDwgdGhpcy5jb2x1bW5JbmZvcy5sZW5ndGg7IGNvbEluZGV4KyspIHsNCiAgICAgICAgICAgICAgICB2YXIgdGNpID0gdGhpcy5jb2x1bW5JbmZvc1tjb2xJbmRleF07DQogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gIHJvd1t0Y2kucHJvcGVydHlOYW1lXTsNCiAgICAgICAgICAgICAgICB2YXIgcmVuZGVyZXIgPSB0aGlzLl9nZXRSZW5kZXJlcih0Y2kpOw0KICAgICAgICAgICAgICAgIHZhciByZW5kZXJWYWx1ZSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIGlmIChyZW5kZXJlciAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHJlbmRlclZhbHVlID0gcmVuZGVyZXIuZ2V0UmVuZGVyZXJDb21wb25lbnQodGhpcy5nVGFibGUsDQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSwgcm93SW5kZXgsIGNvbEluZGV4KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdmFyIHRkID0gbnVsbDsNCiAgICAgICAgICAgICAgICBpZiAocmVuZGVyVmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICB0ZCA9IGpRdWVyeSgiPHRkPiZuYnNwOzwvdGQ+Iik7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmVuZGVyVmFsdWUgIT09ICdvYmplY3QnKSB7DQogICAgICAgICAgICAgICAgICAgIHRkID0galF1ZXJ5KCI8dGQ+IiArIHJlbmRlclZhbHVlICsgIjwvdGQ+Iik7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGQgPSBqUXVlcnkoIjx0ZD48L3RkPiIpOw0KICAgICAgICAgICAgICAgICAgICB0ZC5hcHBlbmQocmVuZGVyVmFsdWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB2YXIgZGF0YUNvbHVtbkF0dHJzID0gdGNpWydkYXRhQ29sdW1uQXR0cnMnXTsNCiAgICAgICAgICAgICAgICAvLyBNZXNzYWdlQm94LmRlYnVnKCdkYXRhQ29sdW1uQXR0cnMnLCBkYXRhQ29sdW1uQXR0cnMpOw0KICAgICAgICAgICAgICAgIGlmIChkYXRhQ29sdW1uQXR0cnMgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZWFjaChkYXRhQ29sdW1uQXR0cnMsIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGQuYXR0cihuYW1lLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0ci5hcHBlbmQodGQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8g5aSE55CG6KGM5Zue6LCDDQogICAgICAgIGlmICh0aGlzLnJvd1Byb2Nlc3NvciAhPSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLnJvd1Byb2Nlc3Nvci5wcm9jZXNzKHRyLCByb3csIHJvd0luZGV4KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB0cjsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5Y+W5b6X5YiX55qE5ZGI546w5Zmo5a6e5L6LDQogICAgICovDQogICAgX2dldFJlbmRlcmVyIDogZnVuY3Rpb24gKHRjaSkgew0KICAgICAgICB2YXIgcmVuZGVyZXIgPSBudWxsOw0KICAgICAgICB2YXIgY3VzdG9taXplZFJlbmRlcmVycyA9IHRoaXMudGFibGVDb25maWcucmVuZGVyZXJzOyAvLyDoh6rlrprkuYnnmoTlkYjnjrDlmagNCiAgICAgICAgaWYgKGN1c3RvbWl6ZWRSZW5kZXJlcnMgIT0gbnVsbCAmJiBjdXN0b21pemVkUmVuZGVyZXJzW3RjaS5wcm9wZXJ0eU5hbWVdICE9IG51bGwpIHsNCiAgICAgICAgICAgIHJlbmRlcmVyID0gY3VzdG9taXplZFJlbmRlcmVyc1t0Y2kucHJvcGVydHlOYW1lXTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJlbmRlcmVyID0gQ2VsbFJlbmRlcmVyRmFjdG9yeS5nZXRDZWxsUmVuZGVyZXIodGNpKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZW5kZXJlcjsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5Zyo6KGM5bC+6L+95Yqg5LiA6KGM6K6w5b2VDQogICAgICovDQogICAgYXBwZW5kUm93IDogZnVuY3Rpb24gKHJvdykgew0KICAgICAgICBpZiAocm93ICE9IG51bGwpIHsNCiAgICAgICAgICAgIHZhciByb3dJbmRleCA9IHRoaXMuZ2V0Um93Q291bnQoKSAtIDE7ICAvLyDms6jmhI/vvIzmlbDmja7lt7Lnu4/lop7liqDliLDmqKHlnovkuYvkuK0NCiAgICAgICAgICAgIHRoaXMuaW5zZXJ0Um93QXQocm93SW5kZXgsIHJvdyk7DQogICAgICAgIH0NCiAgICB9LA0KDQogICAgLyoqDQogICAgICog6L+U5Zue5b2T5YmN55qE6KGM5pWwDQogICAgICovDQogICAgZ2V0Um93Q291bnQgOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvd3MgPT0gbnVsbCA/IDAgOiB0aGlzLnJvd3MubGVuZ3RoOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDmm7TmlrDmjIflrprnmoTooYzorrDlvZXmlbDmja7kv6Hmga8NCiAgICAgKi8NCiAgICB1cGRhdGVSb3cgOiBmdW5jdGlvbiAocm93SW5kZXgsIHJvdykgew0KICAgICAgICB0aGlzLmRlbGV0ZVJvdyhyb3dJbmRleCk7DQogICAgICAgIHRoaXMuaW5zZXJ0Um93QXQocm93SW5kZXgsIHJvdywgdHJ1ZSk7DQogICAgICAgIC8vIOmHjeaWsOe7mOWItuiiq+mAieS4reeahOihjA0KICAgICAgICBUYWJsZUJ1aWxkZXJIZWxwZXIucGFpbnRTZWxlY3Rvcih0aGlzLnJvd0lkcywgdGhpcy5zZWxlY3Rpb25Nb2RlbCk7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOWcqOaMh+WumueahOS9jee9ruaPkuWFpeS4gOadoeihjOaVsOaNruOAgg0KICAgICAqLw0KICAgIGluc2VydFJvd0F0IDogZnVuY3Rpb24gKHJvd0luZGV4LCByb3csIGF1dG9TZWxlY3Rpb24pIHsNCiAgICAgICAgdmFyIHRyID0gdGhpcy5jcmVhdGVSb3cocm93LCByb3dJbmRleCk7DQogICAgICAgIHZhciB0Ym9keSA9IHRoaXMudGFibGVEb20uY2hpbGRyZW4oInRib2R5Iik7DQogICAgICAgIGlmIChyb3dJbmRleCA9PSAwKSB7DQogICAgICAgICAgICAvLyBUT0RPOiDlpoLmnpxCb2R55Li656m677yM6Ieq5Yqo5Yib5bu65LiA5LiqDQogICAgICAgICAgICAvLyDlnKjnrKzkuIDooYzov73liqDorrDlvZUNCiAgICAgICAgICAgdGJvZHkucHJlcGVuZCh0cik7DQogICAgICAgIH0gZWxzZSBpZiAocm93SW5kZXggPj0gdGJvZHkuY2hpbGRyZW4oInRyIikubGVuZ3RoKSB7DQogICAgICAgICAgIHRib2R5LmFwcGVuZCh0cik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgIHZhciBwcmV2Um93ID0gdGJvZHkuY2hpbGRyZW4oInRyIilbcm93SW5kZXggLSAxXTsNCiAgICAgICAgICAgdHIuaW5zZXJ0QWZ0ZXIoalF1ZXJ5KHByZXZSb3cpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChhdXRvU2VsZWN0aW9uID09IG51bGwgfHwgYXV0b1NlbGVjdGlvbikgew0KICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25Nb2RlbC5zZXRTZWxlY3RlZFJvdyhyb3dJbmRleCk7DQoNCiAgICAgICAgICAgIC8vIOmHjeaWsOe7mOWItuiiq+mAieS4reeahOihjA0KICAgICAgICAgICAgVGFibGVCdWlsZGVySGVscGVyLnBhaW50U2VsZWN0b3IodGhpcy5yb3dJZHMsIHRoaXMuc2VsZWN0aW9uTW9kZWwpOw0KICAgICAgICB9DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOWIoOmZpOaMh+WumueahOihjOiusOW9leaVsOaNruS/oeaBr+OAgg0KICAgICAqLw0KICAgIGRlbGV0ZVJvdyA6IGZ1bmN0aW9uIChyb3dJbmRleCkgew0KICAgICAgICAgdmFyIHRyID0gdGhpcy50YWJsZURvbS5jaGlsZHJlbigidGJvZHkiKS5jaGlsZHJlbigidHIiKVtyb3dJbmRleF07DQogICAgICAgICBqUXVlcnkodHIpLnJlbW92ZSgpOw0KICAgICAgICAgLy8g5Yig6ZmkSUTnmoTntKLlvJXlj4rpgInmi6nmqKHlnovnmoTmlbDmja4NCiAgICAgICAgIHRoaXMucm93SWRzLnNwbGljZShyb3dJbmRleCwgMSk7DQogICAgICAgICB0aGlzLnNlbGVjdGlvbk1vZGVsLmRlc2VsZWN0Um93KHJvd0luZGV4KTsNCg0KICAgICAgICAgLy8gVE9ETzog6YeN5paw57uY5Yi25aWH5pWw5ZKM5YG25pWw6KGMDQoNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5Yig6Zmk5omA5pyJ55qE6KGM6K6w5b2V5pWw5o2u44CCDQogICAgICovDQogICAgZGVsZXRlQWxsIDogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgdGJvZHkgPSB0aGlzLnRhYmxlRG9tLmNoaWxkcmVuKCJ0Ym9keSIpOw0KICAgICAgICBpZiAodGJvZHkubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgdGJvZHkuY2hpbGRyZW4oJ3RyJykucmVtb3ZlKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5zZWxlY3Rpb25Nb2RlbC5kZXNlbGVjdEFsbCgpOw0KICAgICAgICB0aGlzLnJvd0lkcyA9IFtdOw0KDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOatpOaWueazleeUqOadpeWkhOeQhuihjOeCueWHu+S6i+S7tg0KICAgICAqLw0KICAgIHJvd0NsaWNrZWQgOiBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgdmFyIHJvd0xpc3RlbmVycyA9ICBqUXVlcnkodGhpcykuZGF0YSgnX3Jvd0xpc3RlbmVycycpOw0KICAgICAgICAvLyBNZXNzYWdlQm94LmRlYnVnKCdyb3dMaXN0ZW5lcnM9Jywgcm93TGlzdGVuZXJzKTsNCiAgICAgICAgdmFyIHRyID0galF1ZXJ5KHRoaXMpWzBdOw0KDQogICAgICAgIHZhciByb3dJZHMgPSBldmVudC5kYXRhLnJvd0lkczsNCiAgICAgICAgdmFyIHJvd0luZGV4ID0gcm93SWRzLmluZGV4T2YodHIuaWQpOw0KICAgICAgICAvL2FsZXJ0KCdyb3dJbmRleD0nICsgcm93SW5kZXgpOw0KICAgICAgICB2YXIgc2VsZWN0aW9uTW9kZWwgID0gZXZlbnQuZGF0YS5zZWxlY3Rpb25Nb2RlbDsNCg0KICAgICAgICAvLyBUT0RPOiDooajmoLzlj5jljJbliY3nmoTkuovku7blpITnkIYNCg0KICAgICAgICB2YXIgcHJldlNlbGVjdGVkICAgICA9IHNlbGVjdGlvbk1vZGVsLmlzUm93U2VsZWN0ZWQocm93SW5kZXgpOyAgLy8g5LmL5YmN5piv5ZCm6KKr6YCJ5LitDQogICAgICAgIHZhciBzZWxlY3Rpb25DaGFuZ2VkID0gc2VsZWN0aW9uTW9kZWwuc2V0U2VsZWN0ZWRSb3cocm93SW5kZXgpICE9IHByZXZTZWxlY3RlZDsNCg0KICAgICAgICAgLy8g6YeN5paw57uY5Yi26KKr6YCJ5Lit55qE6KGMDQogICAgICAgIFRhYmxlQnVpbGRlckhlbHBlci5wYWludFNlbGVjdG9yKHJvd0lkcywgc2VsZWN0aW9uTW9kZWwpOw0KDQogICAgICAgIGpRdWVyeS5lYWNoKHJvd0xpc3RlbmVycywgZnVuY3Rpb24oaSwgcm93TGlzdGVuZXIpIHsNCiAgICAgICAgICAgIHZhciByY0V2ZW50ID0gbmV3IFJvd0NsaWNrRXZlbnQodHIpOw0KICAgICAgICAgICAgcmNFdmVudC5zZWxlY3Rpb25DaGFuZ2VkID0gc2VsZWN0aW9uQ2hhbmdlZDsNCiAgICAgICAgICAgIHJjRXZlbnRbJ3Jvd0luZGV4J10gPSByb3dJbmRleDsgLy8g6KKr6YCJ5oup55qE6KGMDQogICAgICAgICAgICByY0V2ZW50Wydtb3VzZUV2ZW50J10gPSBldmVudDsgIC8vIOm8oOagh+eahOWOn+Wni+S6i+S7tg0KICAgICAgICAgICAgcm93TGlzdGVuZXJbJ29uQ2xpY2snXShyY0V2ZW50KTsNCiAgICAgICAgfSk7DQogICAgfSwNCiAgICANCiAgICAvKioNCiAgICAgKiDmraTmlrnms5XnlKjmnaXlpITnkIbooYzngrnlh7vkuovku7YNCiAgICAgKi8NCiAgICBtb3VzZU92ZXIgOiBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgdmFyIHRyID0gdGhpczsNCiAgICAgICAgdmFyIHJvd0luZGV4ID0gZXZlbnQuZGF0YS5yb3dJbmRleDsNCiAgICAgICAgdmFyIHJvdyAgICAgID0gZXZlbnQuZGF0YS5yb3c7DQogICAgICAgIHZhciByb3dPdmVyTGlzdGVuZXJzID0gIGV2ZW50LmRhdGEucm93T3Zlckxpc3RlbmVyczsNCiAgICAgICAgalF1ZXJ5LmVhY2gocm93T3Zlckxpc3RlbmVycywgZnVuY3Rpb24oaSwgcm93T3Zlckxpc3RlbmVyKSB7DQogICAgICAgICAgICB2YXIgcm9FdmVudCA9IG5ldyBSb3dPdmVyRXZlbnQodHIpOw0KICAgICAgICAgICAgcm9FdmVudFsncm93SW5kZXgnXSAgID0gcm93SW5kZXg7IC8vIOiiq+mAieaLqeeahOihjOS9jee9rg0KICAgICAgICAgICAgcm9FdmVudFsncm93J10gICAgICAgID0gcm93OyAgICAgIC8vIOiiq+mAieaLqeeahOihjOe0ouW8lQ0KICAgICAgICAgICAgcm9FdmVudFsnbW91c2VFdmVudCddID0gZXZlbnQ7ICAvLyDpvKDmoIfnmoTljp/lp4vkuovku7YNCiAgICAgICAgICAgIGlmIChyb3dPdmVyTGlzdGVuZXJbJ29uTW91c2VPdmVyJ10gPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncm93T3Zlckxpc3RlbmVyIG11c3QgaGF2ZSBmdW5jdGlvbiB3aGljaCBuYW1lZCBvbk1vdXNlT3Zlci4nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJvd092ZXJMaXN0ZW5lci5vbk1vdXNlT3Zlcihyb0V2ZW50KTsNCiAgICAgICAgfSk7ICAgICAgICANCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5q2k5pa55rOV55So5p2l5aSE55CG6KGM54K55Ye75LqL5Lu2DQogICAgICovDQogICAgbW91c2VPdXQgOiBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgdmFyIHRyID0gdGhpczsNCiAgICAgICAgdmFyIHJvd0luZGV4ID0gZXZlbnQuZGF0YS5yb3dJbmRleDsNCiAgICAgICAgdmFyIHJvdyAgICAgID0gZXZlbnQuZGF0YS5yb3c7DQogICAgICAgIHZhciByb3dPdmVyTGlzdGVuZXJzID0gIGV2ZW50LmRhdGEucm93T3Zlckxpc3RlbmVyczsNCiAgICAgICAgalF1ZXJ5LmVhY2gocm93T3Zlckxpc3RlbmVycywgZnVuY3Rpb24oaSwgcm93T3Zlckxpc3RlbmVyKSB7DQogICAgICAgICAgICB2YXIgcm9FdmVudCA9IG5ldyBSb3dPdmVyRXZlbnQodHIpOw0KICAgICAgICAgICAgcm9FdmVudFsncm93SW5kZXgnXSA9IHJvd0luZGV4OyAvLyDooqvpgInmi6nnmoTooYzkvY3nva4NCiAgICAgICAgICAgIHJvRXZlbnRbJ3JvdyddICAgICAgPSByb3c7ICAgICAgLy8g6KKr6YCJ5oup55qE6KGM57Si5byVDQogICAgICAgICAgICByb0V2ZW50Wydtb3VzZUV2ZW50J10gPSBldmVudDsgIC8vIOm8oOagh+eahOWOn+Wni+S6i+S7tg0KICAgICAgICAgICAgaWYgKHJvd092ZXJMaXN0ZW5lclsnb25Nb3VzZU91dCddID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Jvd092ZXJMaXN0ZW5lciBtdXN0IGhhdmUgZnVuY3Rpb24gd2hpY2ggbmFtZWQgb25Nb3VzZU91dC4nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJvd092ZXJMaXN0ZW5lclsnb25Nb3VzZU91dCddKHJvRXZlbnQpOw0KICAgICAgICB9KTsNCiAgICB9DQp9KTsNCg0KLyoqDQogKiDnu5jliLbooYzliY3nq6/nmoTpgInmi6nlmagNCiAqLw0KdmFyIFRhYmxlQnVpbGRlckhlbHBlciA9IHsNCiAgICAgcGFpbnRTZWxlY3RvciA6IGZ1bmN0aW9uIChyb3dJZHMsIHNlbGVjdGlvbk1vZGVsKSB7DQogICAgICAgIGZvciAodmFyIF9yb3dJbmRleCA9IDA7IF9yb3dJbmRleCA8IHJvd0lkcy5sZW5ndGg7IF9yb3dJbmRleCsrKSB7DQogICAgICAgICAgICB2YXIgcm93SWQgPSByb3dJZHNbX3Jvd0luZGV4XTsNCiAgICAgICAgICAgIHZhciBpbnB1dElkID0gJ19zZWxlY3Rvcl8nICsgcm93SWQ7DQogICAgICAgICAgICB2YXIgaW5wdXQgPSBqUXVlcnkoIiMiICsgaW5wdXRJZCk7DQogICAgICAgICAgICAvLyDmnKrlj5HnjrDmraTlr7nosaHvvIwNCiAgICAgICAgICAgIGlmIChpbnB1dC5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgICAgIC8vIHRocm93IG5ldyBFcnJvcigi5pyq5Y+R546wSUTkuLpbIiArIGlucHV0SWQgKyAiXeeahOWvueixoeOAgiIpOw0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciAoIlRoZSBpbnN0YW5jZSB3aGljaCdzIElEIG5hbWVkIFsiICsgaW5wdXRJZCArICJdIGNhbiBub3QgYmUgZm91bmQuIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc2VsZWN0aW9uTW9kZWwuaXNSb3dTZWxlY3RlZChfcm93SW5kZXgpKSB7DQogICAgICAgICAgICAgICAgaW5wdXQuYXR0cignY2hlY2tlZCcsICdjaGVja2VkJyk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlucHV0LnJlbW92ZUF0dHIoJ2NoZWNrZWQnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLyoqDQogKiDooYzngrnlh7vkuovku7bvvIzmr4/mrKHooYzngrnlh7vpg73kvJrop6blj5HmraTkuovku7bjgILmraTkuovku7bnu6fmib/oh6rigJxFdmVudOKAneWvueixoQ0KICogQHBhcmFtIHNvdXJjZSDooYzvvIjigJx0cuKAne+8ieWunuS+iw0KICovDQpmdW5jdGlvbiBSb3dDbGlja0V2ZW50KHNvdXJjZSkgew0KICAgIHRoaXMuc291cmNlICAgPSBzb3VyY2U7ICAgLy8g6KGM77yI4oCcdHLigJ3vvInlrp7kvosNCiAgICB0aGlzLm5hbWUgICAgID0gJ0NsaWNrJzsgIC8vIOaXtumXtOeahOWQjeensA0KICAgIHRoaXMucm93SW5kZXggPSAtMTsgIC8vIOiiq+eCueWHu+eahOihjOWPtw0KfQ0KLyoqDQogKg0KICovDQpqUXVlcnkuZXh0ZW5kKFJvd0NsaWNrRXZlbnQucHJvdG90eXBlLCBFdmVudC5wcm90b3R5cGUpOw0KDQovKioNCiAqIOW9k+m8oOagh+a7kei/h+ihjOaXtuS6p+eUn+eahOS6i+S7tuOAguatpOS6i+S7tue7p+aJv+iHquKAnEV2ZW504oCd5a+56LGhDQogKiBAcGFyYW0gc291cmNlIOihjO+8iOKAnHRy4oCd77yJ5a6e5L6LDQogKi8NCmZ1bmN0aW9uIFJvd092ZXJFdmVudChzb3VyY2UpIHsNCiAgICB0aGlzLnNvdXJjZSAgID0gc291cmNlOyAgICAgLy8g6KGM77yI4oCcdHLigJ3vvInlrp7kvosNCiAgICB0aGlzLm5hbWUgICAgID0gJ1Jvd092ZXInOyAgLy8g5pe26Ze055qE5ZCN56ewDQogICAgdGhpcy5yb3dJbmRleCA9IC0xOyAgICAgICAgIC8vIOW9k+WJjee7j+i/h+eahOihjOWPtw0KfQ0KDQoNCi8qKg0KICog6buY6K6k55qE6KGM5aSE55CG5Ye95pWwDQogKi8NCmZ1bmN0aW9uIFJvd092ZXJQcm9jZXNzb3IgKHRhYmxlRG9tLCB0YWJsZUNvbmZpZywgc2hvcnRDdXRDb25maWcpIHsNCiAgICB0aGlzLnRhYmxlRG9tID0galF1ZXJ5KHRhYmxlRG9tKTsNCiAgICB0aGlzLnJvd0luZGV4ID0gLTE7DQogICAgdGhpcy5zaG9ydEN1dENvbmZpZyA9IHNob3J0Q3V0Q29uZmlnOw0KICAgIHRoaXMucHJldlNvdXJjZSA9IG51bGw7DQogICAgdGhpcy5maXhlZExlZnQgID0gLTE7ICAgLy8g55So5oi35ouW5Yqo5ZCO55qE5pyA5ZCO5L2N572uDQogICAgdGhpcy5yb3dCZ0NvbG9yID0gbnVsbDsgIC8vIOWkh+S7veeahOihjOiDjOaZr+iJsg0KICAgIHRoaXMudGFibGVDb25maWcgPSB0YWJsZUNvbmZpZzsNCiAgICB0aGlzLnJvbGxvdmVyQmdjb2xvciA9IHRhYmxlQ29uZmlnWydyb2xsb3ZlckJnY29sb3InXTsgIC8vIOm8oOagh+a7kei/h+aXtueahOihjOiDjOaZr+iJsg0KDQogICAgLyoqDQogICAgICog55So5LqO6ZqU56a755So5oi355qE55u05o6l5pON5L2c77yM57uf5LiA6K6+572u5pWw5o2uDQogICAgICovDQogICAgdGhpcy5jbGlja0hhbmRsZSA9IGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICB2YXIgcm93T3ZlclByb2Nlc3NvciA9IGV2ZW50LmRhdGEucm93T3ZlclByb2Nlc3NvcjsNCiAgICAgICAgdmFyIGFjdGlvbiAgICAgICAgICAgPSBldmVudC5kYXRhLmFjdGlvbjsNCg0KICAgICAgICAvLyDnlKjmiLfoh6rlrprkuYnnmoTliqjkvZwNCiAgICAgICAgYWN0aW9uKHJvd092ZXJQcm9jZXNzb3Iucm9FdmVudCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICog5p6E5bu655So5oi355qE5b+r5o235pa55byP77yM56iL5bqP5ZGY5Y+v5Lul5a6a5LmJ5b+r5o236I+c5Y2V55qE5qC35byP77yM5Y+C5pWw5ZCN56ew5Li677yaDQogICAgICovDQogICAgdGhpcy5jcmVhdGVTaG9ydEN1dHMgPSBmdW5jdGlvbiAoX3Nob3J0Q3V0cykgew0KICAgICAgICAvLyBzaG9ydEN1dHMg5b+F6aG75piv5pWw57uEDQogICAgICAgIGlmIChfc2hvcnRDdXRzID09IG51bGwgfHwgX3Nob3J0Q3V0cy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHNob3J0Q3V0c0NvbXAgPSBqUXVlcnkoIjxkaXYgaWQ9J19zaG9ydEN1dHNfJyAvPjwvZGl2PiIpOw0KICAgICAgICANCiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IF9zaG9ydEN1dHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBzYyA9IF9zaG9ydEN1dHNbaV07DQogICAgICAgICAgICB2YXIgYnRuID0galF1ZXJ5KCI8aW1nIGlkPSdfc2hvcnRDdXRzXyIgKyBJZEdlbmVyYXRvci5nZXRJZCgpICsgIic+PC9pbWc+Iik7DQogICAgICAgICAgICBidG4uYXR0cih7c3JjOiBzYy5pY29uLCBhbHQ6IHNjLm5hbWUsIHRpdGxlIDogc2MubmFtZSwgaGVpZ2h0IDogMjAsIHdpZHRoOjIwfSk7DQogICAgICAgICAgICBpZiAoc2MuYWN0aW9uID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoJ+W/q+aNt+mUrueahOWKqOS9nOS4jeiDveS4uuepuuOAgicpOw0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGFjdGlvblsnICsgc2MubmFtZSArICddIG9mIHNob3J0IGN1dCBjYW4gbm90IGJlIG51bGwnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJ0bi5iaW5kKCdjbGljaycsIHtyb3dPdmVyUHJvY2Vzc29yIDogdGhpcywgYWN0aW9uIDogc2MuYWN0aW9ufSwgdGhpcy5jbGlja0hhbmRsZSk7DQogICAgICAgICAgICBzaG9ydEN1dHNDb21wLmFwcGVuZChidG4pOw0KICAgICAgICB9DQogICAgICAgIHNob3J0Q3V0c0NvbXAuY3NzKHtwb3NpdGlvbjogJ2Fic29sdXRlJ30pOw0KDQogICAgICAgIGlmICh0aGlzLnNob3J0Q3V0Q29uZmlnLmNsYXNzTmFtZSAhPSBudWxsKSB7DQogICAgICAgICAgICBzaG9ydEN1dHNDb21wLmFkZENsYXNzKHRoaXMuc2hvcnRDdXRDb25maWcuY2xhc3NOYW1lKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIOagh+WHhueahOm7mOiupOeahOagh+ivhg0KICAgICAgICAgICAgc2hvcnRDdXRzQ29tcC5jc3Moew0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQgOiAnI2ZmMDAwMCcsICAvLycjZTllZmY4JywNCiAgICAgICAgICAgICAgICAvL29wYWNpdHkgOiAwLjUsDQogICAgICAgICAgICAgICAgLy93aWR0aCAgOiAxMDAsDQogICAgICAgICAgICAgICAgaGVpZ2h0IDogMjAsDQogICAgICAgICAgICAgICAgZGlzcGxheSA6ICdub25lJywNCiAgICAgICAgICAgICAgICAnei1pbmRleCc6MTAwDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vTWVzc2FnZUJveC5kZWJ1ZygnaHRtbD0nLCBzaG9ydEN1dHNDb21wLnRleHQoKSk7DQoNCiAgICAgICAgc2hvcnRDdXRzQ29tcC5pbnNlcnRBZnRlcih0aGlzLnRhYmxlRG9tKTsNCg0KICAgICAgICB2YXIgX3Jvd092ZXJQcm9jZXNzb3IgPSB0aGlzOw0KICAgICAgICBzaG9ydEN1dHNDb21wLmRyYWdnYWJsZSh7IHN0b3A6IGZ1bmN0aW9uKGV2ZW50LCB1aSkgew0KICAgICAgICAgICAgICAgIC8vIOiusOW9leacgOWQjuWbuuWumueahOWAvA0KICAgICAgICAgICAgICAgIF9yb3dPdmVyUHJvY2Vzc29yLmZpeGVkTGVmdCA9IGV2ZW50LmNsaWVudFg7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gc2hvcnRDdXRzQ29tcDsNCiAgICB9DQoNCiAgICAvLyBNZXNzYWdlQm94LmRlYnVnKCdzaG9ydEN1dENvbmZpZz0nLCBzaG9ydEN1dENvbmZpZyk7DQogICAgLy8g5byA5aeL5p6E5bu65b+r5o235pa55byPDQogICAgaWYgKHNob3J0Q3V0Q29uZmlnICE9IG51bGwpIHsNCiAgICAgICAgdGhpcy5zaG9ydEN1dHMgPSB0aGlzLmNyZWF0ZVNob3J0Q3V0cyhzaG9ydEN1dENvbmZpZy5zaG9ydEN1dHMpOw0KICAgIH0gICAgDQoNCiAgICB0aGlzLm9uTW91c2VPdXQgPSBmdW5jdGlvbiAocm9FdmVudCkgew0KICAgICAgICBpZiAodGhpcy5zaG9ydEN1dHMgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHZhciBtb3VzZUV2ZW50ID0gcm9FdmVudFsnbW91c2VFdmVudCddOyAgLy8g6byg5qCH55qE5Y6f5aeL5LqL5Lu2DQoNCiAgICAgICAgLy8g6byg5qCH5Zyo5b+r5o236I+c5Y2V5Yy65Z+f5YaFDQogICAgICAgIGlmIChVdGlscy5pc01vdXNlT3Zlcihtb3VzZUV2ZW50LCB0aGlzLnNob3J0Q3V0cykpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLyDpvKDmoIfku43nhLblnKjmraTooYzlhoUNCiAgICAgICAgaWYgKFV0aWxzLmlzTW91c2VPdmVyKG1vdXNlRXZlbnQsIHRoaXMucHJldlNvdXJjZSkpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgdGhpcy5yb3dJbmRleCA9IC0xOw0KICAgICAgICAvLyBNZXNzYWdlQm94LmRlYnVnKCdvbk1vdXNlT3V0IHBvc2knLCBwb3NpKTsNCiAgICAgICAgdGhpcy5zaG9ydEN1dHMuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTsNCg0KICAgICAgICAvLyDorr7nva7ljp/mnInnmoTog4zmma/oibINCiAgICAgICAgaWYgKHRoaXMucm9sbG92ZXJCZ2NvbG9yKSB7DQogICAgICAgICAgICBqUXVlcnkodGhpcy5wcmV2U291cmNlKS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCB0aGlzLnJvd0JnQ29sb3IpOw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIHRoaXMub25Nb3VzZU92ZXIgPSBmdW5jdGlvbiAocm9FdmVudCkgew0KICAgICAgICBpZiAodGhpcy5zaG9ydEN1dHMgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyDpgb/lhY3ph43lpI3mk43kvZwNCiAgICAgICAgdmFyIF9yb3dJbmRleCA9IHJvRXZlbnQucm93SW5kZXg7DQogICAgICAgIC8vIE1lc3NhZ2VCb3guZGVidWcoJ29uTW91c2VPdmVyIF9yb3dJbmRleCcgKyBfcm93SW5kZXggKyAiOyB0aGlzLnJvd0luZGV4PSIgKyB0aGlzLnJvd0luZGV4KTsNCiAgICAgICAgaWYgKF9yb3dJbmRleCA9PSB0aGlzLnJvd0luZGV4KSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLyDpu5jorqTlsIbmmL7npLrmnaHmmL7npLrlnKjliJfooajnmoTlt6bkvqcNCiAgICAgICAgLy8gVE9ETzog5Lul5ZCO5Y+v5Lul6K6+572u5pi+56S65qih5byPDQogICAgICAgIGlmKHRoaXMuZml4ZWRMZWZ0IDwgMCkgew0KICAgICAgICAgICAgdGhpcy5maXhlZExlZnQgPSB0aGlzLnRhYmxlRG9tLnBvc2l0aW9uKCkubGVmdA0KICAgICAgICAgICAgICAgICsgdGhpcy50YWJsZURvbS53aWR0aCgpIC0gdGhpcy5zaG9ydEN1dHMud2lkdGgoKSAtIDEwOyAgLy8gMTAg5Li65Y+z5L6n55qE6KGl5YWF56m66Ze0DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyDlv6vmjbfoj5zljZXlnKjpvKDmoIfnmoTlj7PkvqfmmL7npLoNCiAgICAgICAgICAgIC8vIHRoaXMuZml4ZWRMZWZ0ID4gLTEgPyB0aGlzLmZpeGVkTGVmdCA6IG1vdXNlRXZlbnQuY2xpZW50WCArIDEwMA0KICAgICAgICB9DQoNCiAgICAgICAgdGhpcy5yb0V2ZW50ICA9IHJvRXZlbnQ7DQogICAgICAgIHRoaXMucm93SW5kZXggPSBfcm93SW5kZXg7DQogICAgICAgIHZhciBzb3VyY2UgPSByb0V2ZW50LnNvdXJjZTsNCiAgICAgICAgdGhpcy5wcmV2U291cmNlID0gc291cmNlOw0KICAgICAgICB2YXIgX3NvdXJjZSA9IGpRdWVyeShzb3VyY2UpOw0KICAgICAgICB2YXIgcG9zaSA9IF9zb3VyY2UucG9zaXRpb24oKTsNCiAgICAgICAgdGhpcy5zaG9ydEN1dHMuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7DQogICAgICAgIHRoaXMuc2hvcnRDdXRzLmNzcygndG9wJywgcG9zaS50b3AgKyAzKTsNCiAgICAgICAgdGhpcy5zaG9ydEN1dHMuY3NzKCdsZWZ0JywgdGhpcy5maXhlZExlZnQpOyAgLy8g5b+r5o236I+c5Y2V6Led56a76byg5qCH55qE5L2N572uDQogICAgICAgIA0KICAgICAgIHRoaXMuc2hvcnRDdXRzLmRyYWdnYWJsZSgnb3B0aW9uJywgJ2NvbnRhaW5tZW50JywgW3Bvc2kubGVmdCwgcG9zaS50b3AsDQogICAgICAgICAgICAgICAgcG9zaS5sZWZ0ICsgX3NvdXJjZS53aWR0aCgpIC0gdGhpcy5zaG9ydEN1dHMud2lkdGgoKSwgDQogICAgICAgICAgICAgICAgcG9zaS50b3AgKyBfc291cmNlLmhlaWdodCgpIC0gdGhpcy5zaG9ydEN1dHMuaGVpZ2h0KCldKTsNCg0KICAgICAgICAvLyDorr7nva7nrq3lpLTmu5Hov4fml7bnmoTooYznmoTpopzoibINCiAgICAgICAgaWYgKHRoaXMucm9sbG92ZXJCZ2NvbG9yKSB7DQogICAgICAgICAgICB0aGlzLnJvd0JnQ29sb3IgPSBfc291cmNlLmNzcygnYmFja2dyb3VuZC1jb2xvcicpOw0KICAgICAgICAgICAgX3NvdXJjZS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCB0aGlzLnJvbGxvdmVyQmdjb2xvcik7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8qKg0KICog5a6a5LmJ5b+r5o235pON5L2c6I+c5Y2V55qE57G7DQogKi8NCmZ1bmN0aW9uIFNob3J0Q3V0IChuYW1lLCBpY29uLCBhY3Rpb24pIHsNCiAgICB0aGlzLm5hbWUgICA9IG5hbWU7ICAgIC8vIOWKqOS9nA0KICAgIHRoaXMuYWN0aW9uID0gYWN0aW9uOyAgLy8g5omn6KGM55qE5pa55rOVDQogICAgdGhpcy5pY29uICAgPSBpY29uOyAgICAvLyDliqjkvZznmoTlm77moIcNCn0NCg0KLyoqDQogKg0KICovDQpqUXVlcnkuZXh0ZW5kKFJvd092ZXJFdmVudC5wcm90b3R5cGUsIEV2ZW50LnByb3RvdHlwZSk7DQoNCg0KZnVuY3Rpb24gVGFibGVDb2x1bW5Nb2RlbCAoY29sdW1uSW5mb3MpIHsNCiAgICAvKioNCiAgICAgKiDlj6/op4HliJfpm4blkIgNCiAgICAgKi8NCiAgICB0aGlzLnZpc2libGVDb2x1bW5JbmZvcyA9IGNvbHVtbkluZm9zOw0KDQogICAgLy8NCiAgICAvLyB0aGlzLnNob3dDb2x1bW4ocHJvcGVydHlOYW1lKTsNCiAgICAvLyB0aGlzLmhpZGVDb2x1bW4ocHJvcGVydHlOYW1lKTsNCiAgICAvLyB0aGlzLnNldENvbHVtblJlbmRlcmVyKCk7DQogICAgLy8gdGhpcy5pc0VkaXRhYmxlKCkNCiAgICB0aGlzLmdldENvbHVtbkNvdW50ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgY291bnQgPSAwOw0KICAgICAgICBpZiAodGhpcy52aXNpYmxlQ29sdW1uSW5mb3MgIT0gbnVsbCkgew0KICAgICAgICAgICAgY291bnQgPSB0aGlzLnZpc2libGVDb2x1bW5JbmZvcy5sZW5ndGg7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGNvdW50Ow0KICAgIH0NCg0KICAgIHRoaXMudmFsaWRhdGVDb2xJbmRleCA9IGZ1bmN0aW9uKGNvbEluZGV4KSB7DQogICAgICAgIGlmIChjb2xJbmRleCA8IDAgfHwgY29sSW5kZXggPj0gdGhpcy5nZXRDb2x1bW5Db3VudCgpKSB7DQogICAgICAgICAgICB0aHJvdyAib3V0IG9mIGNvbHVtbiBpbmRleCI7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KDQogICAgdGhpcy5nZXRDb2x1bW5JbmZvcyA9IGZ1bmN0aW9uKCkgew0KICAgICAgICByZXR1cm4gdGhpcy52aXNpYmxlQ29sdW1uSW5mb3M7DQogICAgfQ0KDQogICAgdGhpcy5nZXRDb2x1bW5JbmZvID0gZnVuY3Rpb24gKGNvbEluZGV4KSB7DQogICAgICAgIHRoaXMudmFsaWRhdGVDb2xJbmRleChjb2xJbmRleCk7DQogICAgICAgIHJldHVybiB0aGlzLnZpc2libGVDb2x1bW5JbmZvc1tjb2xJbmRleF07DQogICAgfQ0KDQogICAgdGhpcy5nZXRQcm9wZXJ0eU5hbWUgPSBmdW5jdGlvbiAoY29sSW5kZXgpIHsNCiAgICAgICAgdmFyIGNvbHVtbkluZm8gPSB0aGlzLmdldENvbHVtbkluZm8oY29sSW5kZXgpOw0KICAgICAgICByZXR1cm4gY29sdW1uSW5mb1sicHJvcGVydHlOYW1lIl07DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBUYWJsZUV2ZW50ICgpIHsNCg0KfQ0KDQpmdW5jdGlvbiBUYWJsZVNlbGVjdGlvbkV2ZW50KCkgew0KDQp9DQoNCi8qKg0KICog6KGo55qE6YCJ5oup5qih5byP77yM5YyF5ous77ya5Y2V6YCJ77yI6buY6K6k5pa55byP77yJ77yM5aSa6YCJ77yM5L2/55So5byA5YWz6YCJ5oup5qih5byP77yI5aSa6YCJ77yJ77yM5LiN5Y+v6YCJ5oupDQogKi8NCnZhciBTZWxlY3Rpb25Nb2RlID0gew0KICAgIFNJTkdMRSA6ICdTSU5HTEUnLCAgLy8g5Y2V6YCJ77yI6buY6K6k5pa55byP77yJDQogICAgTVVMVEkgIDogJ01VTFRJJywgICAvLyDlpJrpgIkNCiAgICAvL1RPR0dMRSA6ICdUT0dHTEUnLCAgLy8g5L2/55So5byA5YWz6YCJ5oup5qih5byP77yI5aSa6YCJ77yJDQogICAgTk9ORSAgIDogJ05PTkUnICAgICAvLyDkuI3lj6/pgInmi6kNCn0NCg0KLyoqDQogKiDooajnmoTpgInmi6nmqKHlnovvvIzorrDlvZXkuobooajlt7Lnu4/ooqvpgInmi6nnmoTooYzvvIzooajnmoTpgInmi6nmqKHlvI/nmoTnrYnkv6Hmga8NCiAqLw0KZnVuY3Rpb24gU2VsZWN0aW9uTW9kZWwgKCkgew0KICAgIC8vIOaYr+WQpuaYvuekuumAieaLqeWktO+8jOm7mOiupOS4uuaYvuekug0KICAgIHRoaXMuc2hvd1NlbGVjdGlvbkhlYWRlciA9IHRydWU7DQoNCiAgICAvLyDmmK/lkKblhYHorrjlhajpgInjgIHlhajkuI3pgIkNCg0KICAgIC8vIOmAieaLqeaooeW8jw0KICAgIHRoaXMubW9kZSA9IFNlbGVjdGlvbk1vZGUuU0lOR0xFOw0KDQogICAgLy8g5bey57uP6KKr6YCJ5Lit55qE6KGMDQogICAgdGhpcy5zZWxlY3RlZEluZGljZXMgPSBbXTsNCn0NCg0KU2VsZWN0aW9uTW9kZWwucHJvdG90eXBlID0gew0KDQogICAgLyoqDQogICAgICog6K6+572u6YCJ5Lit55qE6KGM77yM5b2T55So5oi354K55Ye7KOmAieaLqSnkuobooajmoLznmoTooYzml7bvvIzmiJbogIXosIPnlKjmraTmlrnms5Xorr7nva7ooYzml7bvvIzljbPorr7lrprkuLrmraTooYzjgIINCiAgICAgKiDlhbfkvZPmraTooYzmnIDnu4jmmK/lkKbooqvpgInkuK3vvIzpnIDopoHmoLnmja7lhbbigJzmqKHlvI/igJ3ov5vooYzlpITnkIbjgILlpoLmnpzmmK/ljZXpgInlkozlpJrpgInvvIzliJnmraTooYzlv4XlpIfpgInkuK3vvJsNCiAgICAgKiDlpoLmnpzmmK/igJzlvIDlhbPigJ3mqKHlvI/vvIzkuJTlvZPliY3mnKrlv4XpgInkuK3vvIzliJnlsIbmraTooYzorr7nva7kuLrpgInkuK3nirbmgIHjgILlhbbku5bmg4XlhrXvvIzmraTooYzorr7nva7kuLrmnKrpgInkuK3jgIINCiAgICAgKg0KICAgICAqLw0KICAgIHNldFNlbGVjdGVkUm93IDogZnVuY3Rpb24gKHJvd051bSkgew0KICAgICAgICB2YXIgc2VsZWN0ZWQgPSBmYWxzZTsNCiAgICAgICAgaWYgKHRoaXMubW9kZSA9PSBTZWxlY3Rpb25Nb2RlLlNJTkdMRSkgew0KICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJbmRpY2VzID0gW107DQogICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGljZXMucHVzaChyb3dOdW0pOw0KICAgICAgICAgICAgIHNlbGVjdGVkID0gdHJ1ZTsNCiAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5tb2RlID09IFNlbGVjdGlvbk1vZGUuTVVMVEkpIHsNCiAgICAgICAgLy8gICAgIGlmICghdGhpcy5pc1Jvd1NlbGVjdGVkKHJvd051bSkpIHsNCiAgICAgICAgLy8gICAgICAgICB0aGlzLnNlbGVjdGVkSW5kaWNlcy5wdXNoKHJvd051bSk7DQogICAgICAgIC8vICAgICAgICAgc2VsZWN0ZWQgPSB0cnVlOw0KICAgICAgICAvLyAgICAgfQ0KICAgICAgICAvLyB9IGVsc2UgaWYgKHRoaXMubW9kZSA9PSBTZWxlY3Rpb25Nb2RlLlRPR0dMRSkgew0KICAgICAgICAgICAgIGlmICh0aGlzLmlzUm93U2VsZWN0ZWQocm93TnVtKSkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmRlc2VsZWN0Um93KHJvd051bSk7DQogICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGljZXMucHVzaChyb3dOdW0pOw0KICAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IHRydWU7DQogICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEluZGljZXMgPSBbXTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2VsZWN0ZWQ7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOi/lOWbnumAieS4reeahOihjO+8jOWmguaenOaYr+WkmumAie+8jOWImeWPqui/lOWbnuesrOS4gOihjOOAguWmguaenOaciemAieS4reeahOihjO+8jOi/lOWbnuihjOWPt++8jOWQpuWImei/lOWbniDigJwtMeKAneOAgg0KICAgICAqIEByZXR1cm4g6YCJ5Lit55qE6KGM5Y+35oiW6ICF4oCcLTHigJ3jgIINCiAgICAgKi8NCiAgICBnZXRTZWxlY3RlZFJvdyA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICBpZiAodGhpcy5zZWxlY3RlZEluZGljZXMubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkSW5kaWNlc1swXTsNCiAgICAgICB9DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOi/lOWbnuaJgOaciemAieS4reeahOihjOOAgg0KICAgICAqLw0KICAgIGdldFNlbGVjdGVkUm93cyA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZEluZGljZXM7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOWIpOaWreaMh+WumueahOihjOaYr+WQpuiiq+mAieS4reOAgg0KICAgICAqLw0KICAgIGlzUm93U2VsZWN0ZWQgOiBmdW5jdGlvbiAocm93TnVtKSB7DQogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdGVkSW5kaWNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKHJvd051bSA9PSB0aGlzLnNlbGVjdGVkSW5kaWNlc1tpXSkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5Y+W5raI5omA5pyJ6YCJ5Lit6KGM44CCDQogICAgICovDQogICAgZGVzZWxlY3RSb3cgOiBmdW5jdGlvbiAocm93TnVtKSB7DQogICAgICAgIHZhciBfaW5kaWNlcyA9IFtdOw0KICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RlZEluZGljZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmIChyb3dOdW0gIT0gdGhpcy5zZWxlY3RlZEluZGljZXNbaV0pIHsNCiAgICAgICAgICAgICAgICBfaW5kaWNlcy5wdXNoKHRoaXMuc2VsZWN0ZWRJbmRpY2VzW2ldKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnNlbGVjdGVkSW5kaWNlcyA9IF9pbmRpY2VzOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDlj5bmtojmiYDmnInpgInkuK3nmoTooYzjgIINCiAgICAgKi8NCiAgICBkZXNlbGVjdEFsbCA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5zZWxlY3RlZEluZGljZXMgPSBbXTsNCiAgICB9DQp9DQoNCnZhciBUYWJsZUNvbmZpZyA9IGZ1bmN0aW9uIChjbGFzc05hbWUsIGZ1bGwpIHsNCiAgICBpZiAoY2xhc3NOYW1lID09IG51bGwgfHwgY2xhc3NOYW1lID09ICcnKSB7DQogICAgICAgIC8vIHRocm93IG5ldyBFcnJvcigi6KKr57uR5a6a55qE57G75ZCN56ew5LiN6IO95Li656m644CCIik7DQogICAgICAgIHRocm93IG5ldyBFcnJvciAoJ1RoZSBiaW5kaW5nIGNsYXNzIGNhbiBub3QgYmUgbnVsbC4nKTsNCiAgICB9DQoNCiAgICAvLyDpnIDopoHlpI3liLbnmoTlsZ7mgKfnmoTlgLwNCiAgICB0aGlzLkFUVFJfTkFNRVMgPSBbJ3N0eWxlJywgJ2NsYXNzJ107DQoNCg0KICAgIHRoaXMuY2xhc3NOYW1lID0gQ2xhc3NMb2FkZXIuZ2V0RnVsbE5hbWUoY2xhc3NOYW1lLCBmdWxsKTsNCg0KICAgIC8vIOaYr+WQpuaYvuekuuihqOWktO+8jOm7mOiupOS4uuaYvuekuuOAgg0KICAgIHRoaXMuc2hvd0hlYWRlciA9IHRydWU7DQoNCiAgICAvLyDph4fnlKjkvZXnp43mlrnlvI/liJvlu7rooajlpLQo5qC55o2u5qCH5rOo5L+h5oGv6L+b6KGM5Yib5bu677yM5oiW6ICF5piv5LuO6KGo5qC85qih5p2/5L+h5oGv5byA5aeL5Yib5bu6KQ0KICAgIHRoaXMuaGVhZGVyQ3JlYXRvciA9ICdhbm5vJzsgIC8vYW5ubyB8IHRlbXBsYXRlIHwgYXV0bw0KDQogICAgLy8g5YiX5L+h5oGv6ZuG5ZCIDQogICAgdGhpcy5jb2x1bW5JbmZvcyA9IG51bGw7DQoNCiAgICAvLyDmlbDmja7lsZ7mgKfvvIzov5nkupvlgLzlsIbovpPlh7rliLDooajkvZPnmoR0cuS4rQ0KICAgIHRoaXMuZGF0YUF0dHJpYnV0ZXMgPSB7fTsNCg0KICAgIC8vIOWIoOmZpOWQjuiHquWKqOmAieaLqeW9k+WJjeihjOeahOS4i+S4gOihjOaVsOaNrg0KICAgIHRoaXMuYXV0b1NlbGVjdGlvbkFmdGVyUm93RGVsZXRlZCA9IHRydWU7DQoNCiAgICAvLyDlop7liqDlkI7oh6rliqjpgInmi6nmlrDlop7liqDnmoTooYwNCiAgICB0aGlzLmF1dG9TZWxlY3Rpb25BZnRlclJvd0FkZGVkID0gdHJ1ZTsNCg0KDQogICAgLy8gVE9ETzog56iL5bqP5ZGY5Y+v5Lul6Ieq5a6a5LmJ5q+P6aG155qE6KGM5pWwLCDlpoLmnpzmraTlgLzlsI/kuo7nrYnkuo4w77yM6KGo56S66YeH55So57O757uf5a6a5LmJDQogICAgdGhpcy5yb3dzUGVyUGFnZSA9IC0xOw0KDQogICAgLy8g6KGM5ZGI546w5ZmoDQogICAgdGhpcy5yb3dSZW5kZXJlciAgID0gbnVsbDsNCg0KICAgIC8vIOmAieaLqeaooeW8j++8jOm7mOiupOS4uuWNlemAiQ0KICAgIHRoaXMuc2VsZWN0aW9uTW9kZSA9IFNlbGVjdGlvbk1vZGUuU0lOR0xFOw0KDQogICAgLy8g6KGo5aS05bGe5oCn77yI6L+Z5Lqb5YC85bCG6L6T5Ye65Yiw6KGo5aS055qEdHLkuK3vvIkNCiAgICB0aGlzLmhlYWRlckF0dHJzICAgID0ge307DQoNCiAgICAvLyDpgInmi6nlpLTnmoTlsZ7mgKfvvIjov5nkupvlgLzlsIbovpPlh7rliLDpgInmi6nnsbvnmoTmoIfpopjooYznmoR0ZOS4re+8iQ0KICAgIHRoaXMuc2VsZWN0aW9uSGVhZGVyQXR0cnMgPSB7fTsNCg0KICAgIC8vIOaYr+WQpuaYvuekuuaWkemprOadoQ0KICAgIHRoaXMuc2hvd1plYnJhQmcgPSB0cnVlOw0KDQogICAgLy8g5b+r5o236ZSu55u45YWz55qE5Y+C5pWw77yM5YyF5ZCr55qE5bGe5oCn5pyJ77yaU2hvcnRDdXRzLCBzaG93DQogICAgdGhpcy5zaG9ydEN1dENvbmZpZyAgPSB7fTsNCn0NCg0KalF1ZXJ5LmV4dGVuZChUYWJsZUNvbmZpZy5wcm90b3R5cGUsIHsNCg0KICAgIC8vIOi/lOWbnuaJgOacieeahOWIl+S/oeaBrw0KICAgIGdldENvbHVtbkluZm9zIDogZnVuY3Rpb24gKCkgew0KICAgICAgICBpZiAodGhpcy5jb2x1bW5JbmZvcyAhPSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5jb2x1bW5JbmZvczsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmNvbHVtbkluZm9zID0gdGhpcy5jcmVhdGVDb2x1bW5zRnJvbUFubm90YXRpb24oKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuY29sdW1uSW5mb3M7DQogICAgfSwNCg0KCS8qKg0KCSAgKiDku47lt7LmnInmqKHmnb/kuK3mnoTlu7rliJfkv6Hmga/jgIINCgkgICovDQoJY3JlYXRlQ29sdW1uc0Zyb21UZW1wbGF0ZSA6IGZ1bmN0aW9uICh0YWJsZURvbSkgew0KICAgICAgICB0aGlzLmhlYWRlckNyZWF0b3IgPSAndGVtcGxhdGUnOyAgLy8g6K6+5a6a5aS055qE5Yib5bu65pa55byPDQogICAgICAgIHZhciBoZWFkZXJSb3cgPSB0aGlzLmdldEhlYWRlcnModGFibGVEb20pOw0KICAgICAgICANCiAgICAgICAgLy8g6K+75Y+W6KGo5aS055qE5bGe5oCnDQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5BVFRSX05BTUVTLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgYXR0ck5hbWUgPSB0aGlzLkFUVFJfTkFNRVNbaV07DQogICAgICAgICAgICB0aGlzLmhlYWRlckF0dHJzW2F0dHJOYW1lXSA9IGpRdWVyeShoZWFkZXJSb3cpLmF0dHIoYXR0ck5hbWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygndGhpcy5oZWFkZXJBdHRycz0nLCB0aGlzLmhlYWRlckF0dHJzKTsNCiAgICAgICAgDQoNCiAgICAgICAgdmFyIHRkcyA9IGpRdWVyeShoZWFkZXJSb3cpLmNoaWxkcmVuKCd0ZCcpOw0KICAgICAgICBpZiAodGRzLmxlbmd0aCA8PSAwKSB7DQogICAgICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoIuihjOagh+etvu+8iHRy77yJ5Lit5pyq5a6a5LmJ5Lu75L2VIHRkIOagh+etvuOAgiIpOw0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGVyZSBhcmUgbm90IHRkIHRhZ3MgaW4gdGhlIHRyIHRhZy4iKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBjbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZTsNCiAgICAgICAgdmFyIHRoaXNDb2x1bW5JbmZvcyA9IFtdOw0KDQogICAgICAgIC8vIOS7juacjeWKoeerr+ivu+WPluWIl+S/oeaBrw0KICAgICAgICB2YXIgcmVxID0gbmV3IFJlcXVlc3QoImNvbS54dC5ndC5odG1sLnNlcnZpY2UuVGFibGVTZXJ2aWNlIiwgImdldENvbHVtbkluZm9zIiwgY2xhc3NOYW1lKTsNCiAgICAgICAgdmFyIF9jb2x1bW5JbmZvcyA9IFNlcnZpY2VJbnZva2VyLmludm9rZShyZXEpOw0KCQlpZihfY29sdW1uSW5mb3MgPT0gbnVsbCB8fCBfY29sdW1uSW5mb3MubGVuZ3RoID09IDApIHsNCgkJICAgIC8vIHRocm93IG5ldyBFcnJvcigi57G7WyIgKyBjbGFzc05hbWUgKyAiXeacquWumuS5ieS7u+S9leWxnuaAp+S/oeaBr+OAgiIpOw0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgY2xhc3NbIiArIGNsYXNzTmFtZSArICJdIGRvZXMgbm90IGRlZmluZSBhbnkgcHJvcGVydGllcy4iKTsNCgkJfQ0KICAgICAgICANCiAgICAgICAgdmFyIGNvbHVtbk1hcCA9IHt9OyAgLy8g5Li76ZSu5piv77ya5ZCN56ew77yM6ZSu5YC85pivY29sdW1uSW5mb+WvueixoeOAgg0KICAgICAgICBqUXVlcnkuZWFjaChfY29sdW1uSW5mb3MsIGZ1bmN0aW9uKGosIGNvbHVtbkluZm8pIHsNCiAgICAgICAgICAgIC8vYWxlcnQoImNvbHVtbkluZm9bJ3Byb3BlcnR5TmFtZSddPSIgKyBjb2x1bW5JbmZvWydwcm9wZXJ0eU5hbWUnXSk7DQogICAgICAgICAgICBjb2x1bW5NYXBbY29sdW1uSW5mb1sncHJvcGVydHlOYW1lJ11dID0gY29sdW1uSW5mbzsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8g5Y+W5b6X5qih5p2/5YiX55qE5bGe5oCnDQogICAgICAgIHZhciBjb2x1bW5zQXR0cnMgPSB0aGlzLmdldFJvd1RlbXBsYXRlKHRhYmxlRG9tKTsNCiAgICAgICAgDQogICAgICAgIHZhciBBVFRSX05BTUVTID0gdGhpcy5BVFRSX05BTUVTOw0KICAgICAgICBqUXVlcnkuZWFjaCh0ZHMsIGZ1bmN0aW9uKGksIHRkKSB7DQogICAgICAgICAgICB2YXIgX3RkID0galF1ZXJ5KHRkKTsNCiAgICAgICAgICAgIHZhciBuYW1lID0gX3RkLmF0dHIoJ25hbWUnKTsNCiAgICAgICAgICAgIGlmIChuYW1lID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoIuWktOagh+etvuW/hemhu+WumuS5ieKAnG5hbWXigJ3lsZ7mgKfjgIIiKTsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSB0ZCB0YWcgbXVzdCBkZWZpbmUgdGhlIGF0dHJpYnV0ZSBuYW1lZCAnbmFtZSciKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBfY29sdW1uSW5mbyA9IGNvbHVtbk1hcFtuYW1lXTsNCiAgICAgICAgICAgIGlmIChfY29sdW1uSW5mbyA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCLlsZ7mgKdbIiArIG5hbWUgKyAiXeWcqOexu1siICsgY2xhc3NOYW1lICsgIl3kuK3kuI3lrZjlnKjjgIIiKTsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBhdHRyaWJ1dGUgWyIgKyBuYW1lICsgIl0gZG9lcyBub3QgZXhpc3QgaW4gY2xhc3NbIiArIGNsYXNzTmFtZSArICJdLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgX2NvbHVtbkluZm9bJ3RpdGxlJ10gPSBfdGQudGV4dCgpOw0KICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IEFUVFJfTkFNRVMubGVuZ3RoOyBfaSsrKSB7DQogICAgICAgICAgICAgICAgdmFyIGF0dHJOYW1lID0gQVRUUl9OQU1FU1tfaV07DQogICAgICAgICAgICAgICAgX2NvbHVtbkluZm9bYXR0ck5hbWVdID0gX3RkLmF0dHIoYXR0ck5hbWUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyDliJfnmoTmlbDmja7lsZ7mgKcNCiAgICAgICAgICAgIF9jb2x1bW5JbmZvWydkYXRhQ29sdW1uQXR0cnMnXSA9IGNvbHVtbnNBdHRyc1tpXTsNCiAgICAgICAgICAgIC8vIE1lc3NhZ2VCb3guZGVidWcoJ19jb2x1bW5JbmZvW2RhdGFDb2x1bW5BdHRyc10nLCBfY29sdW1uSW5mb1snZGF0YUNvbHVtbkF0dHJzJ10pOw0KDQogICAgICAgICAgICB0aGlzQ29sdW1uSW5mb3MucHVzaChfY29sdW1uSW5mbyk7DQogICAgICAgIH0pOw0KICAgICAgICAvLyBNZXNzYWdlQm94LmRlYnVnKCd0aGlzQ29sdW1uSW5mb3MnLCB0aGlzQ29sdW1uSW5mb3MpOw0KICAgICAgICANCiAgICAgICAgdGhpcy5jb2x1bW5JbmZvcyA9IHRoaXNDb2x1bW5JbmZvczsNCiAgICAgICAgcmV0dXJuIHRoaXMuY29sdW1uSW5mb3M7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOmAmui/h+agh+azqOWIm+W7uuWIl+S/oeaBr+OAgg0KICAgICAqLw0KICAgIGNyZWF0ZUNvbHVtbnNGcm9tQW5ub3RhdGlvbiA6IGZ1bmN0aW9uKGluY2x1ZGVDb2x1bW5zLCBleGNsdWRlQ29sdW1ucykgew0KICAgICAgICB0aGlzLmhlYWRlckNyZWF0b3IgPSAnYW5ubyc7ICAvLyDorr7lrprlpLTnmoTliJvlu7rmlrnlvI8NCg0KICAgICAgICB2YXIgY2xhc3NOYW1lID0gdGhpcy5jbGFzc05hbWU7DQoNCiAgICAgICAgLy8g5LuO5pyN5Yqh56uv6K+75Y+W5YiX5L+h5oGvDQogICAgICAgIHZhciByZXEgPSBuZXcgUmVxdWVzdCgiY29tLnh0Lmd0Lmh0bWwuc2VydmljZS5UYWJsZVNlcnZpY2UiLCAiZ2V0QW5ub3RhdGVkQ29sdW1uSW5mb3MiLCBjbGFzc05hbWUpOw0KICAgICAgICB2YXIgX2NvbHVtbkluZm9zID0gU2VydmljZUludm9rZXIuaW52b2tlKHJlcSk7DQoNCiAgICAgICAgdmFyIHRoaXNDb2x1bW5JbmZvcyA9IFtdOw0KICAgICAgICAvLyDlpoLmnpzmmI7noa7lrprkuYnpnIDopoHmmL7npLrnmoTliJfvvIzliJnmjInnhafmraTpobrluo/mmL7npLrmiYDmnInnmoTliJfjgILms6jmhI/vvJrmjpLpmaTliJfkuI3nlJ/mlYgNCiAgICAgICAgaWYgKGluY2x1ZGVDb2x1bW5zICE9IG51bGwpIHsNCiAgICAgICAgICAgIHZhciBjb2x1bW5NYXAgPSB7fTsgIC8vIOS4u+mUruaYr++8muWQjeensO+8jOmUruWAvOaYr2NvbHVtbkluZm/lr7nosaHjgIINCiAgICAgICAgICAgIGpRdWVyeS5lYWNoKF9jb2x1bW5JbmZvcywgZnVuY3Rpb24oaiwgY29sdW1uSW5mbykgew0KICAgICAgICAgICAgICAgIC8vYWxlcnQoImNvbHVtbkluZm9bJ3Byb3BlcnR5TmFtZSddPSIgKyBjb2x1bW5JbmZvWydwcm9wZXJ0eU5hbWUnXSk7DQogICAgICAgICAgICAgICAgY29sdW1uTWFwW2NvbHVtbkluZm9bJ3Byb3BlcnR5TmFtZSddXSA9IGNvbHVtbkluZm87DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgalF1ZXJ5LmVhY2goaW5jbHVkZUNvbHVtbnMsIGZ1bmN0aW9uIChpLCBjb2x1bW5OYW1lKSB7DQogICAgICAgICAgICAgICAgdmFyIF9jb2x1bW5JbmZvID0gY29sdW1uTWFwW2NvbHVtbk5hbWVdOw0KICAgICAgICAgICAgICAgIGlmIChfY29sdW1uSW5mbyA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGFsZXJ0KCLlsZ7mgKdbIiArIGNvbHVtbk5hbWUgKyAiXeWcqOexu1siICsgY2xhc3NOYW1lICsgIl3kuK3kuI3lrZjlnKjjgIIiKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCLlsZ7mgKdbIiArIGNvbHVtbk5hbWUgKyAiXeWcqOexu1siICsgY2xhc3NOYW1lICsgIl3kuK3kuI3lrZjlnKjjgIIiKTsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgYXR0cmlidXRlIFsiICsgY29sdW1uTmFtZSArICJdIGRvZXMgbm90IGV4aXN0IGluIGNsYXNzWyIgKyBjbGFzc05hbWUgKyAiXS4iKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpc0NvbHVtbkluZm9zLnB1c2goX2NvbHVtbkluZm8pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSBpZiAoZXhjbHVkZUNvbHVtbnMgIT0gbnVsbCkgew0KICAgICAgICAgICAgLy8g5aaC5p6c5a6a5LmJ5LqG5o6S6Zmk5YiXDQogICAgICAgICAgICBqUXVlcnkuZWFjaChfY29sdW1uSW5mb3MsIGZ1bmN0aW9uKGosIGNvbHVtbkluZm8pIHsNCiAgICAgICAgICAgICAgICBpZiAoalF1ZXJ5LmluQXJyYXkoZXhjbHVkZUNvbHVtbnMsIGNvbHVtbkluZm9bJ3Byb3BlcnR5TmFtZSddKSA8IDApIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpc0NvbHVtbkluZm9zLnB1c2goY29sdW1uSW5mbyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzQ29sdW1uSW5mb3MgPSBfY29sdW1uSW5mb3M7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5jb2x1bW5JbmZvcyA9IHRoaXNDb2x1bW5JbmZvczsNCiAgICAgICAgcmV0dXJuIHRoaXMuY29sdW1uSW5mb3M7DQogICAgfSwNCg0KDQogICAgLyoqDQogICAgICog5Zyo6KGo5qih5p2/55qE5Z+656GA5LiK5p6E5bu66KGo5aS044CC5Yib5bu655qE6KeE5YiZ5piv77yaDQogICAgICogMS4g6aaW5YWI5Y+W5aS05qCH562+6YeM55qE56ys5LiA6KGM4oCcdHLigJ3vvJsNCiAgICAgKiAyLiDlpoLmnpzmnKrlj5bliLDvvIznhLblkI7lsJ3or5XooajmoIfnrb7ph4znmoTnrKzkuIDooYzigJx0cuKAne+8mw0KICAgICAqIDMuIOacgOWQjuWPluWwneivleS9k++8iHRib2R577yJ5qCH562+6YeM55qE56ys5LiA6KGM4oCcdHLigJ3jgIINCiAgICAgKiA0LiDkuIrov7Dlh6Dnp43mlrnlvI/pg73msqHlj5bliLDlpLTmlbDmja7nmoTmg4XlhrXkuIvvvIzliJnmipvlh7rlvILluLjjgIINCiAgICAgKi8NCiAgICBnZXRIZWFkZXJzIDogZnVuY3Rpb24odGFibGVEb20pIHsNCiAgICAgICAgaWYgKHRhYmxlRG9tID09IG51bGwpIHsNCiAgICAgICAgICAgIC8vIHRocm93IG5ldyBFcnJvcign6KGo5qih5Z6L5LiN6IO95Li656m644CCJyk7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IgKCdUaGUgcGFyYW10ZXIgY2FuIG5vdCBiZSBudWxsLicpOw0KICAgICAgICB9DQogICAgCS8vIOmmluWFiOWPluWktOagh+etvumHjOeahOesrOS4gOihjOKAnHRy4oCdDQogICAgCXZhciBoZWFkZXJSb3cgPSBudWxsOw0KICAgIAlpZiAoalF1ZXJ5KHRhYmxlRG9tKS5jaGlsZHJlbigndGhlYWQnKS5sZW5ndGggPiAwKSB7DQoJICAgICAgICB2YXIgdGhlYWQgPSBqUXVlcnkodGFibGVEb20pLmNoaWxkcmVuKCd0aGVhZCcpWzBdOw0KCQkJaWYgKGpRdWVyeSh0aGVhZCkuY2hpbGRyZW4oJ3RyJykubGVuZ3RoID09IDApIHsNCgkJCSAgICAvLyB0aHJvdyBuZXcgRXJyb3IoIuWktOagh+etvih0aGVhZCnph4zmnKrlrprkuYnooYwodHIp5qCH562+44CCIik7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGVyZSBhcmUgYW55IHRyIHRhZyBpbiB0aGVhZC4iKTsNCgkJCX0NCgkJCWhlYWRlclJvdyA9IGpRdWVyeSh0aGVhZCkuY2hpbGRyZW4oJ3RyJylbMF07DQoJCX0NCg0KCQkvLyDnhLblkI7lsJ3or5XooajmoIfnrb7ph4znmoTnrKzkuIDooYzigJx0cuKAnQ0KICAgIAloZWFkZXJSb3cgPSBoZWFkZXJSb3cgfHwgalF1ZXJ5KHRhYmxlRG9tKS5jaGlsZHJlbigndHInKS5sZW5ndGggPiAwID8galF1ZXJ5KHRhYmxlRG9tKS5jaGlsZHJlbigndHInKVswXSA6IG51bGw7DQoNCgkJaWYgKGhlYWRlclJvdyA9PSBudWxsKSB7DQogICAgICAgIAkvLyDmnIDlkI7lj5blsJ3or5XkvZPvvIh0Ym9kee+8ieagh+etvumHjOeahOesrOS4gOihjOKAnHRy4oCdDQoJCQl2YXIgdGJvZHkgPSBqUXVlcnkodGFibGVEb20pLmNoaWxkcmVuKCd0Ym9keScpLmxlbmd0aCA+IDAgPyBqUXVlcnkodGFibGVEb20pLmNoaWxkcmVuKCd0Ym9keScpWzBdIDogbnVsbDsNCgkJCWlmICh0Ym9keSAhPSBudWxsKSB7DQogICAgICAgICAgICAJaGVhZGVyUm93ID0galF1ZXJ5KHRib2R5KS5jaGlsZHJlbigndHInKS5sZW5ndGggPiAwID8galF1ZXJ5KHRib2R5KS5jaGlsZHJlbigndHInKVswXSA6IG51bGw7DQoJCQl9DQoJCX0NCg0KICAgICAgICBpZiAoaGVhZGVyUm93ID09IG51bGwpIHsNCiAgICAgICAgCS8vIHRocm93IG5ldyBFcnJvcigi6KGo6YeM5pyq5YyF5ZCr6KGM5pWw5o2u44CCIik7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSB0YWJsZSBtdXN0IGNvbnRhaW4gaGVhZGVyLiIpOw0KICAgIAl9DQogICAgICAgIA0KCQlyZXR1cm4gaGVhZGVyUm93Ow0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDlnKjooajmqKHmnb/nmoTln7rnoYDkuIrmnoTlu7rooYzmlbDmja7jgILmn6Xmib7op4TliJnmmK/nmoTop4TliJnmmK/vvJoNCiAgICAgKiAxLiDpppblhYjmn6Xmib5JROS4uuKAnHJvd1RlbXBsYXRl4oCd55qEIHRy77yM5qCH562+77yM54S25ZCO6K+75Y+W5YW25Lit55qE5q+P5LiA6KGM77ybDQogICAgICogMi4g5aaC5p6c5pyq5Y+W5Yiw77yM54S25ZCO5bCd6K+V5L2T77yIdGJvZHnvvInmoIfnrb7ph4znmoTnrKzkuIDooYzigJx0cuKAnTsNCiAgICAgKiAzLiDmnIDlkI7lsJ3or5XooajmoIfnrb7ph4znmoTnrKzkuozooYzigJx0cuKAne+8m+OAgg0KICAgICAqIDQuIOS4iui/sOWHoOenjeaWueW8j+mDveayoeWPluWIsOWktOaVsOaNrueahOaDheWGteS4i++8jOWImei/lOWbnuepuuOAgg0KICAgICAqIEByZXR1cm4g5YiX5bGe5oCn55qE5pWw57uEDQogICAgICovDQogICAgZ2V0Um93VGVtcGxhdGUgOiBmdW5jdGlvbih0YWJsZURvbSkgew0KICAgICAgICBpZiAodGFibGVEb20gPT0gbnVsbCkgew0KICAgICAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCfooajmqKHlnovkuI3og73kuLrnqbrjgIInKTsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHBhcmFtZXRlciBjYW4gbm90IGJlIG51bGwuJyk7DQogICAgICAgIH0NCiAgICAJLy8g6aaW5YWI5p+l5om+5ZCN56ew5Li64oCccm93VGVtcGxhdGXigJ3nmoQgdHLvvIzmoIfnrb4NCiAgICAJdmFyIHRlbXBsYXRlUm93ID0gbnVsbDsNCiAgICAgICAgaWYgKGpRdWVyeSgnI3Jvd1RlbXBsYXRlJykubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgdGVtcGxhdGVSb3cgPSBqUXVlcnkoJyNyb3dUZW1wbGF0ZScpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHRlbXBsYXRlUm93ID09IG51bGwpIHsNCiAgICAgICAgCS8vIOacgOWQjuWPluWwneivleS9k++8iHRib2R577yJ5qCH562+6YeM55qE56ys5LiA6KGM4oCcdHLigJ0s5aaC5p6c5rKh5pyJ4oCcdGJvZHnigJ3kvr/nrb7vvIzliJnlj5bnrKzkuozooYwNCgkJCXZhciB0Ym9keSA9IGpRdWVyeSh0YWJsZURvbSkuY2hpbGRyZW4oJ3Rib2R5JykubGVuZ3RoID4gMCA/IGpRdWVyeSh0YWJsZURvbSkuY2hpbGRyZW4oJ3Rib2R5JykgOiBudWxsOw0KCQkJaWYgKHRib2R5ICE9IG51bGwpIHsNCiAgICAgICAgICAgIAl0ZW1wbGF0ZVJvdyA9IHRib2R5LmNoaWxkcmVuKCd0cicpLmxlbmd0aCA+IDAgPyBqUXVlcnkodGJvZHkpLmNoaWxkcmVuKCd0cicpWzBdIDogbnVsbDsNCgkJCX0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGVtcGxhdGVSb3cgPSBqUXVlcnkodGFibGVEb20pLmNoaWxkcmVuKCd0cicpLmxlbmd0aCA+IDEgPyBqUXVlcnkodGJvZHkpLmNoaWxkcmVuKCd0cicpWzFdIDogbnVsbDsNCiAgICAgICAgICAgIH0NCgkJfQ0KDQogICAgICAgIC8vIOaYr+WQpuacieWktOaWh+S7tg0KICAgICAgICAvLyB2YXIgaGFzSGVhZCAgPSAoalF1ZXJ5KHRhYmxlRG9tKS5jaGlsZHJlbigndGhlYWQnKS5sZW5ndGggPiAwKTsNCiAgICAgICAgdmFyIGNvbHVtbnNBdHRycyA9IFtdOw0KICAgICAgICBpZiAodGVtcGxhdGVSb3cgIT0gbnVsbCkgew0KICAgICAgICAgICAgalF1ZXJ5LmVhY2goalF1ZXJ5KHRlbXBsYXRlUm93KS5jaGlsZHJlbigndGQnKSwgZnVuY3Rpb24gKGluZGV4LCBfdGQpIHsNCiAgICAgICAgICAgICAgICB2YXIgYXR0cnMgPSB7fTsNCiAgICAgICAgICAgICAgICBhdHRyc1snc3R5bGUnXSAgICAgPSBqUXVlcnkoX3RkKS5hdHRyKCdzdHlsZScpOw0KICAgICAgICAgICAgICAgIGF0dHJzWydjbGFzc05hbWUnXSA9IGpRdWVyeShfdGQpLmF0dHIoJ2NsYXNzJyk7DQogICAgICAgICAgICAgICAgY29sdW1uc0F0dHJzW2luZGV4XSA9IGF0dHJzOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygnY29sdW1uc0F0dHJzJywgY29sdW1uc0F0dHJzKTsNCgkJcmV0dXJuIGNvbHVtbnNBdHRyczsNCiAgICB9DQp9KTsNCg0KLyoqDQogKiDnlKjkuIDkuKrnroDljJbnmoTmlrnms5XliJvlu7rkuIDkuKoi5qih5p2/6KGoIueahOmFjee9ruaWh+S7tg0KICovDQp2YXIgVGVtcGxhdGVUYWJsZUNvbmZpZyA9IHsNCiAgICAvKioNCiAgICAgKiDliJvlu7rkuIDkuKrpu5jorqTnmoTmqKHmnb/phY3nva4NCiAgICAgKi8NCiAgICBjcmVhdGUgOiBmdW5jdGlvbiAoY2xhc3NOYW1lLCBmdWxsLCBwcm9jZXNzKSB7DQogICAgICAgICB2YXIgdGFibGVDb25maWcgPSBuZXcgVGFibGVDb25maWcoY2xhc3NOYW1lLCBmdWxsKTsNCiAgICAgICAgIHRhYmxlQ29uZmlnLnNob3dIZWFkZXIgICAgPSBmYWxzZTsgICAgICAgICAgICAgICAvLyDkuI3opoHmmL7npLrooajlpLQNCiAgICAgICAgIHRhYmxlQ29uZmlnLnNlbGVjdGlvbk1vZGUgPSBTZWxlY3Rpb25Nb2RlLk5PTkU7ICAvLyDkuI3opoHooYzpgInmi6kNCiAgICAgICAgIHRhYmxlQ29uZmlnLnNob3daZWJyYUJnICAgPSBmYWxzZTsgICAgICAgICAgICAgICAvLyDkuI3mmL7npLrmlpHpqazmnaENCiAgICAgICAgIHRhYmxlQ29uZmlnLnJvd1JlbmRlcmVyICAgPSBuZXcgVGVtcGxhdGVSb3dSZW5kZXJlcigndGVtcGxhdGUnLCBwcm9jZXNzKTsgLy8g5Yib5bu65qih5p2/57yW6L6R5ZmoDQogICAgICAgICByZXR1cm4gdGFibGVDb25maWc7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBUYWJsZU1vZGVsKCkgew0KDQp9DQoNCnZhciBUYWJsZUNlbGxSZW5kZXJlciA9IGZ1bmN0aW9uICgpIHsNCg0KICAgIC8qKg0KICAgICAqIOi/lOWbnuihqOagvOWRiOeOsOWZqOaOp+S7tuOAgg0KICAgICAqLw0KICAgIHRoaXMuZ2V0UmVuZGVyZXJDb21wb25lbnQgPSBmdW5jdGlvbih0YWJsZSwgdmFsdWUsIHJvd0luZGV4LCBjb2xJbmRleCkgew0KDQogICAgfQ0KfQ0KDQovKioNCiAqIOepuuaVsOaNrueahOihqOekuuOAgg0KICovDQpUYWJsZUNlbGxSZW5kZXJlci5OVUxMX1ZBTFVFX1RFWFQgPSAnJm5ic3A7JzsNCg0KDQoNCmZ1bmN0aW9uIERlZmF1bHRDZWxsUmVuZGVyZXIoKSB7DQogICAgLyoqDQogICAgICog6L+U5Zue5ZGI546w5Zmo5L2/55So55qE5o6n5Lu2DQogICAgICovDQp9DQoNCi8qKg0KICog6L+U5Zue5ZGI546w5Zmo5L2/55So55qE5o6n5Lu2DQogKiBAcGFyYW0gdGFibGUgR1RhYmxlIOWunuS+iw0KICogQHBhcmFtIHZhbHVlIOW9k+WJjeihqOeahOWNleWFg+agvOeahOWunuS+iw0KICogQHBhcmFtIHJvd0luZGV4IOW9k+WJjeWAvOaJgOWcqOeahOihjA0KICogQHBhcmFtIGNvbEluZGV4IOW9k+WJjeWAvOaJgOWcqOeahOWIlw0KICovDQpEZWZhdWx0Q2VsbFJlbmRlcmVyLnByb3RvdHlwZS5nZXRSZW5kZXJlckNvbXBvbmVudCA9IGZ1bmN0aW9uICh0YWJsZSwgdmFsdWUsIHJvd0luZGV4LCBjb2xJbmRleCkgew0KICAgIHZhciB0ZXh0ID0gVGFibGVDZWxsUmVuZGVyZXIuTlVMTF9WQUxVRV9URVhUOw0KICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7DQogICAgICAgIHRleHQgKz0gdmFsdWU7DQogICAgfQ0KICAgIHJldHVybiB0ZXh0Ow0KfQ0KDQpmdW5jdGlvbiBEYXRlQ2VsbFJlbmRlcmVyKCkgew0KICAgIC8qKg0KICAgICAqIOi/lOWbnuWRiOeOsOWZqOS9v+eUqOeahOaOp+S7tg0KICAgICAqLw0KfQ0KDQovKioNCiAqIOi/lOWbnuWRiOeOsOWZqOS9v+eUqOeahOaOp+S7tg0KICovDQpEYXRlQ2VsbFJlbmRlcmVyLnByb3RvdHlwZS5nZXRSZW5kZXJlckNvbXBvbmVudCA9IGZ1bmN0aW9uICh0YWJsZSwgdmFsdWUsIHJvd0luZGV4LCBjb2xJbmRleCkgew0KICAgIHZhciB0ZXh0ID0gVGFibGVDZWxsUmVuZGVyZXIuTlVMTF9WQUxVRV9URVhUOw0KICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiB0ZXh0Ow0KICAgIH0NCiAgICB2YXIgZGF0ZSA9IG51bGw7DQogICAgaWYgKCFpc05hTih2YWx1ZSkpIHsNCiAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKCk7DQogICAgICAgIGRhdGUuc2V0VGltZSh2YWx1ZSk7DQogICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHsNCiAgICAgICAgZGF0ZSA9IHZhbHVlOw0KICAgIH0gDQogICAgaWYgKGRhdGUgIT0gbnVsbCkgew0KICAgICAgICB2YXIgZGF0ZVBhdHRlcm4gPSBTeXN0ZW1Db25maWd1cmF0aW9uLnJlYWQoJ2Zvcm1hdC5kYXRlJywgJ3l5eXktTU0tZGQnKTsNCiAgICAgICAgdGV4dCA9IERhdGVGb3JtYXQuZm9ybWF0KGRhdGUsIGRhdGVQYXR0ZXJuKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0ZXh0ICs9IHZhbHVlOw0KICAgIH0NCiAgICByZXR1cm4gdGV4dDsNCn0NCg0KLyoqDQogKiDnlKjkuo7lpITnkIbmnprkuL7nsbvlnovnmoTlkYjnjrDlmagNCiAqLw0KZnVuY3Rpb24gRW51bVJlbmRlcmVyKCkgew0KfQ0KDQovKioNCiAqIOi/lOWbnuWRiOeOsOWZqOS9v+eUqOeahOaOp+S7tg0KICovDQpFbnVtUmVuZGVyZXIucHJvdG90eXBlLmdldFJlbmRlcmVyQ29tcG9uZW50ID0gZnVuY3Rpb24gKHRhYmxlLCB2YWx1ZSwgcm93SW5kZXgsIGNvbEluZGV4KSB7DQogICAgdmFyIHRleHQgPSBUYWJsZUNlbGxSZW5kZXJlci5OVUxMX1ZBTFVFX1RFWFQ7DQogICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIHRleHQ7DQogICAgfQ0KICAgIHRleHQgPSB2YWx1ZS50aXRsZSB8fCB2YWx1ZS5uYW1lOw0KICAgIHJldHVybiB0ZXh0Ow0KfQ0KDQovKioNCiAqIOaVtOaVsOWRiOeOsOWZqA0KICovDQpmdW5jdGlvbiBJbnRDZWxsUmVuZGVyZXIoKSB7DQogICAgLyoqDQogICAgICog6L+U5Zue5ZGI546w5Zmo5L2/55So55qE5o6n5Lu2DQogICAgICovDQp9DQoNCi8qKg0KICog6L+U5Zue5ZGI546w5Zmo5L2/55So55qE5o6n5Lu2DQogKi8NCkludENlbGxSZW5kZXJlci5wcm90b3R5cGUuZ2V0UmVuZGVyZXJDb21wb25lbnQgPSBmdW5jdGlvbiAodGFibGUsIHZhbHVlLCByb3dJbmRleCwgY29sSW5kZXgpIHsNCiAgICB2YXIgdGV4dCA9IFRhYmxlQ2VsbFJlbmRlcmVyLk5VTExfVkFMVUVfVEVYVDsNCiAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gdGV4dDsNCiAgICB9DQogICAgaWYgKGlzTmFOKHZhbHVlKSkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IgKCJUaGUgdmFsdWUgWyIgKyB2YWx1ZSArICJdIG11c3QgYmUgYSBudW1iZXIuIik7DQogICAgfQ0KICAgIC8vIOaYr+WQpuS4uuiHquWKqOi9rOaNog0KICAgIC8vIHZhciBfdmFsdWUgPSB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gcGFyc2VJbnQodmFsdWUpIDogdmFsdWU7DQogICAgdmFyIGZvcm1hdCA9IFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgnZm9ybWF0LmludCcsICcjLCMjIycpDQogICAgaWYgKGZvcm1hdCAhPSBudWxsICYmIGZvcm1hdCAhPSAnJykgew0KICAgICAgICB0ZXh0ID0gTnVtYmVyRm9ybWF0LmZvcm1hdCh2YWx1ZSwgZm9ybWF0KTsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0ZXh0ICs9IHZhbHVlOw0KICAgIH0NCiAgICByZXR1cm4gdGV4dDsNCn0NCg0KLyoqDQogKiDmta7ngrnmlbDlkYjnjrDlmagNCiAqLw0KZnVuY3Rpb24gRG91YmxlQ2VsbFJlbmRlcmVyKCkgew0KICAgIC8qKg0KICAgICAqIOi/lOWbnuWRiOeOsOWZqOS9v+eUqOeahOaOp+S7tg0KICAgICAqLw0KfQ0KDQovKioNCiAqIOi/lOWbnuWRiOeOsOWZqOS9v+eUqOeahOaOp+S7tg0KICovDQpEb3VibGVDZWxsUmVuZGVyZXIucHJvdG90eXBlLmdldFJlbmRlcmVyQ29tcG9uZW50ID0gZnVuY3Rpb24gKHRhYmxlLCB2YWx1ZSwgcm93SW5kZXgsIGNvbEluZGV4KSB7DQogICAgdmFyIHRleHQgPSBUYWJsZUNlbGxSZW5kZXJlci5OVUxMX1ZBTFVFX1RFWFQ7DQogICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIHRleHQ7DQogICAgfQ0KICAgIGlmIChpc05hTih2YWx1ZSkpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yICgiVGhlIHZhbHVlIFsiICsgdmFsdWUgKyAiXSBtdXN0IGJlIGEgbnVtYmVyLiIpOw0KICAgIH0NCiAgICAvLyDmmK/lkKbkuLroh6rliqjovazmjaINCiAgICAvLyB2YXIgX3ZhbHVlID0gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHBhcnNlRmxvYXQodmFsdWUpIDogdmFsdWU7DQogICAgdmFyIGZvcm1hdCA9IFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgnZm9ybWF0LmZsb2F0JywgJyMsIyMjLjAwJykNCiAgICBpZiAoZm9ybWF0ICE9IG51bGwgJiYgZm9ybWF0ICE9ICcnKSB7DQogICAgICAgIHRleHQgPSBOdW1iZXJGb3JtYXQuZm9ybWF0KHZhbHVlLCBmb3JtYXQpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHRleHQgKz0gdmFsdWU7DQogICAgfQ0KICAgIHJldHVybiB0ZXh0Ow0KfQ0KDQovKioNCiAqIOS/rumlsCBib29sZWFuIOexu+Wei+eahOWRiOeOsOWZqOOAgg0KICovDQpmdW5jdGlvbiBCb29sZWFuQ2VsbFJlbmRlcmVyKCkgew0KDQp9DQoNCi8qKg0KICog6L+U5Zue5ZGI546w5Zmo5L2/55So55qE5o6n5Lu2DQogKi8NCkJvb2xlYW5DZWxsUmVuZGVyZXIucHJvdG90eXBlLmdldFJlbmRlcmVyQ29tcG9uZW50ID0gZnVuY3Rpb24gKHRhYmxlLCB2YWx1ZSwgcm93SW5kZXgsIGNvbEluZGV4KSB7DQogICAgdmFyIHRleHQgPSAiPGlucHV0IHR5cGU9J2NoZWNrYm94JyB2YWx1ZT0nJyAiOw0KICAgIGlmICh2YWx1ZSAhPSBudWxsICYmIHZhbHVlKSB7DQogICAgICAgIHRleHQgKz0gImNoZWNrZWQ9J3RydWUnIjsNCiAgICB9DQoNCiAgICB0ZXh0ICs9ICJvbmNsaWNrPSdyZXR1cm4gZmFsc2U7JyAvPiI7DQogICAgcmV0dXJuIHRleHQ7DQp9DQoNCi8qKg0KICog5L+u6aWw4oCc5a2X5YW44oCd57G75Z6L55qE5ZGI546w5Zmo44CCDQogKi8NCmZ1bmN0aW9uIERpY3Rpb25hcnlDZWxsUmVuZGVyZXIoZGljTmFtZSkgew0KICAgIGlmIChkaWNOYW1lID09IG51bGwgfHwgZGljTmFtZSA9PSAnJykgew0KICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoIuWtl+WFuOWQjeensOS4jeiDveS4uuepuuOAgiIpOw0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IgKCJUaGUgbmFtZSBvZiBkaWN0aW9uYXJ5IGNhbiBub3QgYmUgbnVsbC4iKTsNCiAgICB9DQogICAgdGhpcy5kaWMgPSBEaWN0aW9uYXJ5U2VydmljZS5nZXREaWN0aW9uYXJ5KGRpY05hbWUpOw0KfQ0KDQovKioNCiAqIOi/lOWbnuKAnOWtl+WFuOKAneS9v+eUqOeahOaOp+S7tg0KICovDQpEaWN0aW9uYXJ5Q2VsbFJlbmRlcmVyLnByb3RvdHlwZS5nZXRSZW5kZXJlckNvbXBvbmVudCA9IGZ1bmN0aW9uICh0YWJsZSwgdmFsdWUsIHJvd0luZGV4LCBjb2xJbmRleCkgew0KICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgIHJldHVybiBUYWJsZUNlbGxSZW5kZXJlci5OVUxMX1ZBTFVFX1RFWFQ7DQogICAgfQ0KICAgIHJldHVybiBEaWNVdGlscy5nZXRUaXRsZSh0aGlzLmRpYywgdmFsdWUpOw0KfQ0KDQovKioNCiAqIOS/rumlsOWbvueJh+exu+Wei+eahOWRiOeOsOWZqOOAgg0KICogQHBhcmFtIHNlcnZpY2Ug5bGe5oCn5ZCN56ewDQogKiBAcGFyYW0gaW1nQ29uZmlnIOWbvueJh+eahOebuOWFs+WxnuaApw0KICovDQpmdW5jdGlvbiBJbWFnZUNlbGxSZW5kZXJlcihzZXJ2aWNlLCBtZXRob2ROYW1lLCBwYXJhbXMsIGltZ0F0dHJzKSB7DQogICAgaWYgKHNlcnZpY2UgPT0gbnVsbCB8fCBtZXRob2ROYW1lID09IG51bGwpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgcGFyYW1ldGVycyBzZXJ2aWNlIGFuZCBtZXRob2QgbmFtZSBjYW4gbm90IGJlIG51bGwuIik7DQogICAgfQ0KICAgIHRoaXMuc2VydmljZSAgICA9IHNlcnZpY2U7DQogICAgdGhpcy5tZXRob2ROYW1lID0gbWV0aG9kTmFtZTsNCiAgICB0aGlzLnBhcmFtcyAgICAgPSBwYXJhbXM7DQogICAgdGhpcy5pbWdBdHRycyAgICA9IGltZ0F0dHJzOw0KfQ0KDQovKioNCiAqIOi/lOWbnuWRiOeOsOWZqOS9v+eUqOeahOaOp+S7tg0KICovDQpJbWFnZUNlbGxSZW5kZXJlci5wcm90b3R5cGUuZ2V0UmVuZGVyZXJDb21wb25lbnQgPSBmdW5jdGlvbiAodGFibGUsIHZhbHVlLCByb3dJbmRleCwgY29sSW5kZXgpIHsNCiAgICB2YXIgaW1hZ2VJZCA9ICdpbWdfJyArIElkR2VuZXJhdG9yLmdldElkKCk7DQogICAgdmFyIHJvdyA9IHRhYmxlLmdldFJvd0F0KHJvd0luZGV4KTsNCiAgICB2YXIgcGFyYW1zID0gdGhpcy5wYXJhbXMgfHwgW3Jvd107DQogICAgdmFyIHVybCA9IEltYWdlSGVscGVyLmdldEltYWdlVXJsKHRoaXMuc2VydmljZSwgdGhpcy5tZXRob2ROYW1lLCBwYXJhbXMpOw0KICAgIHZhciBpbWcgPSBqUXVlcnkoIjxpbWcgaWQ9IiArIGltYWdlSWQgKyAiIHNyYz0nIiArIHVybCArICInIHdpZHRoPScxMDAlJyBoZWlnaHQ9JzEwMCUnIGFsdD0n5Zu+54mH6ZSZ6K+vJyAgLz4iKTsNCiAgICAvLyBGRiDlnKjlm77lg4/liqDovb3plJnor6/ml7bkuI3og73op6blj5Fsb2Fk5pa55rOVDQogICAgalF1ZXJ5LmVhY2godGhpcy5pbWdBdHRycywgZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7DQogICAgICAgIGltZy5hdHRyKG5hbWUsIHZhbHVlKTsNCiAgICB9KTsNCiAgICByZXR1cm4gaW1nOw0KfQ0KDQovKioNCiAqIOihqOagvOWRiOeOsOWZqOW3peWOgu+8jOeUqOS6juagueaNruihqOagvOWxnuaAp+ehruWumuihqOagvOWRiOeOsOWZqOeahOexu+Wei+OAgg0KICovDQp2YXIgQ2VsbFJlbmRlcmVyRmFjdG9yeSA9IHsNCiAgICBmYWN0b3JpZXMgOiB7DQogICAgICAgICJqYXZhLnV0aWwuRGF0ZSIgICAgOiBuZXcgRGF0ZUNlbGxSZW5kZXJlcigpLA0KICAgICAgICAiamF2YS51dGlsLkNhbGVuZGFyIiA6IG5ldyBEYXRlQ2VsbFJlbmRlcmVyKCksDQogICAgICAgICJqYXZhLnNxbC5EYXRlIiAgICAgOiBuZXcgRGF0ZUNlbGxSZW5kZXJlcigpLA0KICAgICAgICAiamF2YS5sYW5nLkJvb2xlYW4iIDogbmV3IEJvb2xlYW5DZWxsUmVuZGVyZXIoKSwNCiAgICAgICAgImJvb2xlYW4iICAgICAgICAgICA6IG5ldyBCb29sZWFuQ2VsbFJlbmRlcmVyKCksDQogICAgICAgICJqYXZhLmxhbmcuSW50ZWdlciIgOiBuZXcgSW50Q2VsbFJlbmRlcmVyKCksDQogICAgICAgICJpbnQiICAgICAgICAgICAgICAgOiBuZXcgSW50Q2VsbFJlbmRlcmVyKCksDQogICAgICAgICJqYXZhLmxhbmcuTG9uZyIgICAgOiBuZXcgSW50Q2VsbFJlbmRlcmVyKCksDQogICAgICAgICJsb25nIiAgICAgICAgICAgICAgOiBuZXcgSW50Q2VsbFJlbmRlcmVyKCksDQogICAgICAgICJqYXZhLmxhbmcuRW51bSIgICAgOiBuZXcgRW51bVJlbmRlcmVyKCksDQogICAgICAgICJqYXZhLmxhbmcuRG91YmxlIiAgOiBuZXcgRG91YmxlQ2VsbFJlbmRlcmVyKCksDQogICAgICAgICJkb3VibGUiICAgICAgICAgICAgOiBuZXcgRG91YmxlQ2VsbFJlbmRlcmVyKCksDQogICAgICAgICJqYXZhLmxhbmcuRmxvYXQiICAgOiBuZXcgRG91YmxlQ2VsbFJlbmRlcmVyKCksDQogICAgICAgICJmbG9hdCIgICAgICAgICAgICAgOiBuZXcgRG91YmxlQ2VsbFJlbmRlcmVyKCksDQogICAgICAgICJqYXZhLmxhbmcuU3RyaW5nIiAgOiBuZXcgRGVmYXVsdENlbGxSZW5kZXJlcigpDQogICAgfSwNCg0KICAgIGdldENlbGxSZW5kZXJlciA6IGZ1bmN0aW9uKHRhYmxlQ29sdW1uSW5mbykgew0KICAgICAgICB2YXIgcHJvcGVydHlDbGFzc05hbWUgPSB0YWJsZUNvbHVtbkluZm8ucHJvcGVydHlDbGFzc05hbWU7DQogICAgICAgIGlmICh0YWJsZUNvbHVtbkluZm8uZGljdGlvbmFyeUluZm8gIT0gbnVsbCkgew0KICAgICAgICAgICAgdmFyIGRpID0gdGFibGVDb2x1bW5JbmZvLmRpY3Rpb25hcnlJbmZvOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5Q2VsbFJlbmRlcmVyKGRpLm5hbWUpOw0KICAgICAgICB9IGVsc2UgaWYgKHRhYmxlQ29sdW1uSW5mby5lbnVtVHlwZSkgew0KICAgICAgICAgICAgLy8g5aaC5p6c5bGe5oCn57G75Z6L5Li65p6a5Li+57G75Z6LDQogICAgICAgICAgICByZXR1cm4gdGhpcy5mYWN0b3JpZXNbJ2phdmEubGFuZy5FbnVtJ10gfHwgbmV3IERlZmF1bHRDZWxsUmVuZGVyZXIoKTsNCiAgICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eUNsYXNzTmFtZSA9PSBudWxsIHx8IHRoaXMuZmFjdG9yaWVzW3Byb3BlcnR5Q2xhc3NOYW1lXSA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IERlZmF1bHRDZWxsUmVuZGVyZXIoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmZhY3Rvcmllc1twcm9wZXJ0eUNsYXNzTmFtZV07DQogICAgICAgIH0NCiAgICB9DQp9DQoNCg0KdmFyIFBhZ2luYXRpb24gPSBmdW5jdGlvbiAoc3RhcnRJbmRleCwgdG90YWxDb3VudCwgcm93c1BlclBhZ2UpIHsNCiAgICB0aGlzLnN0YXJ0SW5kZXggID0gc3RhcnRJbmRleDsNCiAgICB0aGlzLnRvdGFsQ291bnQgID0gdG90YWxDb3VudDsNCiAgICB0aGlzLnJvd3NQZXJQYWdlID0gKHJvd3NQZXJQYWdlID09IG51bGwgPyAyMCA6IHJvd3NQZXJQYWdlKTsNCn0NCg0KUGFnaW5hdGlvbi5wcm90b3R5cGUgPSB7DQogICAgbmV4dFBhZ2UgOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIC8vIE1lc3NhZ2VCb3guZGVidWcoJ3RoaXMudG90YWxDb3VudD0nICsgdGhpcy50b3RhbENvdW50KTsNCiAgICAgICAgaWYgKHRoaXMuaGFzTmV4dFBhZ2UoKSkgew0KICAgICAgICAgICAgdGhpcy5zdGFydEluZGV4ICs9IHRoaXMucm93c1BlclBhZ2U7DQogICAgICAgIH0NCiAgICB9LA0KICAgIA0KICAgIGhhc05leHRQYWdlIDogZnVuY3Rpb24oKSB7DQogICAgICAgIC8vIOaXoOazleehruWumuaAu+ihjOaVsOaXtu+8jOaAu+aYr+iupOS4uuacieS4i+S4gOmhtQ0KICAgICAgICBpZiAodGhpcy50b3RhbENvdW50IDwgMCkgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICgodGhpcy5zdGFydEluZGV4ICsgdGhpcy5yb3dzUGVyUGFnZSkgPCB0aGlzLnRvdGFsQ291bnQpOw0KICAgIH0sDQoNCiAgICBwcmV2UGFnZSA6IGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAodGhpcy5oYXNQcmV2UGFnZSgpKSB7DQogICAgICAgICAgICB0aGlzLnN0YXJ0SW5kZXggLT0gdGhpcy5yb3dzUGVyUGFnZTsNCiAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0SW5kZXggPCAwKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zdGFydEluZGV4ID0gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0sDQoNCiAgICBoYXNQcmV2UGFnZSA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgcmV0dXJuICh0aGlzLnRvdGFsQ291bnQgPT0gLTEgfHwgdGhpcy5zdGFydEluZGV4ID4gMCk7DQogICAgfSwNCg0KICAgIGZpcnN0UGFnZSA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgdGhpcy5zdGFydEluZGV4ID0gMDsNCiAgICB9LA0KDQogICAgaGFzRmlyc3RQYWdlIDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiAodGhpcy5zdGFydEluZGV4ID4gMCk7DQogICAgfSwNCg0KICAgIGhhc0xhc3RQYWdlIDogZnVuY3Rpb24oKSB7DQogICAgICAgIHJldHVybiAodGhpcy50b3RhbENvdW50ICE9IC0xICYmICh0aGlzLnN0YXJ0SW5kZXggKyB0aGlzLnJvd3NQZXJQYWdlKSA8IHRoaXMudG90YWxDb3VudCk7DQogICAgfSwNCg0KICAgIGxhc3RQYWdlIDogZnVuY3Rpb24oKSB7DQoJCXZhciBtb2QgPSB0aGlzLnRvdGFsQ291bnQgJSB0aGlzLnJvd3NQZXJQYWdlOw0KCQlyZXR1cm4gKG1vZCA9PSAwID8gIHRoaXMudG90YWxDb3VudCAtICB0aGlzLnJvd3NQZXJQYWdlOiAgdGhpcy50b3RhbENvdW50IC0gbW9kKTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog6LCD5pW05Yiw5oyH5a6a6aG144CCDQogICAgICovDQogICAgdHVyblRvUGFnZSA6IGZ1bmN0aW9uKHBhZ2VJbmRleCkgew0KICAgICAgICBpZiAocGFnZUluZGV4IDwgMCB8fCBwYWdlSW5kZXggPj0gdGhpcy5nZXRQYWdlQ291bnQoKSkgew0KICAgICAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCLpobXmlbBbIiArIHBhZ2VJbmRleCArICJd6LaK55WMWyIgKyAwICsgJywnICsgdGhpcy5nZXRQYWdlQ291bnQoKSArICJdIik7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBwYWdlIG5vIFsiICsgcGFnZUluZGV4ICsgIl0gaXMgb3V0IG9mIGluZGV4WyIgKyAwICsgJywnICsgdGhpcy5nZXRQYWdlQ291bnQoKSArICJdIik7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5zdGFydEluZGV4ID0gcGFnZUluZGV4ICogdGhpcy5yb3dzUGVyUGFnZTsNCiAgICB9LA0KICAgIA0KICAgIC8qKg0KICAgICAqIOi/lOWbnuaAu+mhteaVsO+8jOWmguaenOiusOW9leaVsOS4uiAw77yM6L+Z6L+U5ZueMO+8m+WmguaenOiusOW9leaVsOS4uuKAnOacquefpeKAne+8jOWImei/lOWbnuKAnC0x4oCdLA0KICAgICAqIOWFtuS7luaDheWGteagueaNruW9k+WJjeeahOaAu+aVsOeul+WHuuS4remhteaVsOOAgg0KICAgICAqLw0KICAgIGdldFBhZ2VDb3VudCA6IGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAodGhpcy50b3RhbENvdW50IDw9IDApIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQ291bnQ7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHRvdGFsUGFnZXMgPSAgTWF0aC5mbG9vcih0aGlzLnRvdGFsQ291bnQgLyAgdGhpcy5yb3dzUGVyUGFnZSk7DQoJCXZhciBtb2QgPSAgdGhpcy50b3RhbENvdW50ICUgIHRoaXMucm93c1BlclBhZ2U7DQoJCXJldHVybiAobW9kID09IDAgPyB0b3RhbFBhZ2VzIDogdG90YWxQYWdlcyArIDEpOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDlvpfliLDlvZPliY3nmoTpobXlj7cNCiAgICAgKi8NCiAgICBnZXRDdXJyZW50UGFnZUluZGV4IDogZnVuY3Rpb24oKSB7DQogICAgICAgIGlmICh0aGlzLnN0YXJ0SW5kZXggPD0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHBhZ2VJbmRleCA9ICBNYXRoLmZsb29yKHRoaXMudG90YWxDb3VudCAvICB0aGlzLnN0YXJ0SW5kZXgpOw0KICAgICAgICByZXR1cm4gKHBhZ2VJbmRleCk7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOWwhuWIhumhteWPguaVsOiuvue9ruS4uuWIneWni+eKtuaAgeOAgg0KICAgICAqLw0KICAgIHJlc2V0IDogZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnRvdGFsQ291bnQgPSAtMTsNCiAgICAgICAgdGhpcy5zdGFydEluZGV4ID0gMDsNCiAgICB9DQogICAgDQp9DQoNCnZhciBGaWx0ZXJUeXBlID0gew0KICAgIEVRVUFMUyAgICAgICAgICAgIDogIkVRVUFMUyIsDQogICAgU1RBUlRTX1dJVEggICAgICAgOiAiU1RBUlRTX1dJVEgiLA0KICAgIEVORFNfV0lUSCAgICAgICAgIDogIkVORFNfV0lUSCIsDQogICAgQkVUV0VFTiAgICAgICAgICA6ICJCRVRXRUVOIiwNCiAgICBJTiAgICAgICAgICAgICAgIDogIklOIiwNCiAgICBDT05UQUlOUyAgICAgICAgICA6ICJDT05UQUlOUyIsDQogICAgTEVTU19USEFOICAgICAgICA6ICJMRVNTX1RIQU4iLA0KICAgIEdSRUFUX1RIQU4gICAgICAgOiAiR1JFQVRfVEhBTiIsDQogICAgTEVTU19FUVVBTF9USEFOICA6ICJMRVNTX0VRVUFMX1RIQU4iLA0KICAgIEdSRUFUX0VRVUFMX1RIQU4gOiAiR1JFQVRfRVFVQUxfVEhBTiIsDQogICAgSVNfTlVMTCAgICAgICAgICA6ICJJU19OVUxMIiwNCiAgICBJU19FTVBUWSAgICAgICAgIDogIklTX0VNUFRZIiwNCiAgICBDVVNUT01JWkVEICAgICAgIDogIkNVU1RPTUlaRUQiDQp9DQoNCmZ1bmN0aW9uIFNpbXBsZUZpbHRlckl0ZW0gKG5hbWUsIHR5cGUpIHsNCiAgICB0aGlzLm5hbWUgPSBuYW1lOw0KICAgIHRoaXMudHlwZSA9IHR5cGU7DQogICAgLy8gdGhpcy5ub3QgID0gZmFsc2U7DQogICAgdGhpcy52YWx1ZXMgPSBuZXcgQXJyYXkoKTsNCn0NCg0KZnVuY3Rpb24gRmlsdGVyR3JvdXAgKCkgew0KICAgIHRoaXMuZmlsdGVySXRlbXMgPSBuZXcgQXJyYXkoKTsNCn0NCg0KZnVuY3Rpb24gRnNwUGFyYW1ldGVyICgpIHsNCiAgICB0aGlzLnBhZ2luYXRpb24gPSBuZXcgUGFnaW5hdGlvbigwLCAtMSk7DQogICAgLy8gc29ydHMNCiAgICAvLw0KICAgIHRoaXMuZmlsdGVyR3JvdXAgPSBuZXcgRmlsdGVyR3JvdXAoKTsNCg0KICAgIHRoaXMuc2V0U3RhcnRJbmRleCA9IGZ1bmN0aW9uKHN0YXJ0SW5kZXgpIHsNCiAgICAgICAgdGhpcy5wYWdpbmF0aW9uLnN0YXJ0SW5kZXggPSBzdGFydEluZGV4Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqICDph43mlrDorr7nva7mn6Xor6Lnu4TvvIzljbPmuIXnqbrnjrDlnKjlt7LmnInnmoTmiYDmnInmn6Xor6LpgInpobkNCiAgICAgKi8NCiAgICB0aGlzLnJlc2V0RmlsdGVyR3JvdXAgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuZmlsdGVyR3JvdXAgPSBuZXcgRmlsdGVyR3JvdXAoKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiAg6K6+572u6L+H5ruk5p2h5Lu2DQogKi8NCiAgICB0aGlzLnNldEZpbHRlckl0ZW0gPSBmdW5jdGlvbiAobmFtZSwgZmlsdGVyVHlwZSwgdmFsdWUpIHsNCiAgICAgICAgLy8g5YmU6Zmk6YeN5aSN55qE6L+H5rukDQogICAgICAgIGpRdWVyeS5lYWNoKHRoaXMuZmlsdGVyR3JvdXAuZmlsdGVySXRlbXMsIGZ1bmN0aW9uKGluZGV4LCBmaWx0ZXJJdGVtKSB7DQogICAgICAgICAgICBpZiAobmFtZSA9PSBmaWx0ZXJJdGVtLm5hbWUgJiYgZmlsdGVyVHlwZSA9PSBmaWx0ZXJJdGVtLnR5cGUpIHsNCiAgICAgICAgICAgICAgICAvLyBUT0RPOiDlnKjosIPor5XnmoTmqKHlvI/kuIvov5DooYzopoHmipvlh7rlvILluLgNCiAgICAgICAgICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoIui/h+a7pOadoeS7tuWQjeensFsiICsgbmFtZSArICJd57G75Z6LWyIgKyBmaWx0ZXJUeXBlICsgIl3lt7Lnu4/lrZjlnKjjgIIiKTsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBuYW1lIG9mIGZpbHRlciBpdGVtWyIgKyBuYW1lICsgIl0gYW5kIHR5cGUgWyIgKyBmaWx0ZXJUeXBlICsgIl0gZXhpc3RlZC4iKTsNCiAgICAgICAgICAgICAgICAvLyByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgc2ZpID0gbmV3IFNpbXBsZUZpbHRlckl0ZW0obmFtZSwgZmlsdGVyVHlwZSk7DQogICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgc2ZpLnZhbHVlcy5wdXNoKHZhbHVlW2ldKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNmaS52YWx1ZXMucHVzaCh2YWx1ZSk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5maWx0ZXJHcm91cC5maWx0ZXJJdGVtcy5wdXNoKHNmaSk7DQogICAgfQ0KDQogICAvKioNCiAgICAqIOa4heepuuaJgOacieeahOi/h+a7pOadoeS7tg0KICAgICovDQogICAgdGhpcy5jbGVhckZpbHRlckl0ZW0gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuZmlsdGVyR3JvdXAuZmlsdGVySXRlbXMgPSBbXTsNCiAgICB9DQp9DQoNCi8qKg0KICog5a6a5LmJ6KGo6KGM6K6w5b2V55qE5ZGI546w5Zmo44CCDQogKi8NCmZ1bmN0aW9uIFJvd1JlbmRlcmVyICgpIHsNCiAgICAvKioNCiAgICAgKiDov5Tlm57lvZPliY3ooYznmoTlrZfnrKbkuLINCiAgICAgKi8NCiAgICB0aGlzLmdldFJvdyA9IGZ1bmN0aW9uIChyb3csIHJvd0luZGV4KXt9Ow0KfQ0KDQovKioNCiAqIOS9v+eUqOaooeadv+aWueW8j+WIm+W7uuihjOiusOW9lQ0KICogQHBhcmFtIGlkIOaooeadv+aJgOWcqOeahOS9jee9rg0KICogQHBhcmFtIHByb2Nlc3Mg5YC85aSE55CG5Ye95pWwLCDlhbbmjqXlj6PlvaLlvI/kuLrvvJogcHJvY2Vzcyhyb3csIHJvd0luZGV4LCB2YXJOYW1lLCB2YWx1ZSksDQogKiDov5Tlm57kuIDkuKrlvoXmmL7npLrnmoTlrZfnrKbkuLLjgIINCiAqLw0KZnVuY3Rpb24gVGVtcGxhdGVSb3dSZW5kZXJlciAoaWQsIHByb2Nlc3MpIHsNCiAgICB0aGlzLmlkID0gaWQ7DQogICAgdGhpcy5wcm9jZXNzID0gcHJvY2VzczsNCg0KICAgIC8vIOWPmOmHj+eahOWMuemFjeaooeW8jw0KICAgIHRoaXMudmFyUGF0dGVybiA9IC9cJFx7KFthLXpBLVpfXVx3KilcfS9nOw0KfQ0KDQpqUXVlcnkuZXh0ZW5kKFRlbXBsYXRlUm93UmVuZGVyZXIucHJvdG90eXBlLCB7DQogICAgLyoqDQogICAgICog6L+U5Zue5b2T5YmN6KGM55qE5a2X56ym5LiyDQogICAgICovDQogICAgZ2V0Um93IDogZnVuY3Rpb24gKHJvdywgcm93SW5kZXgpIHsNCiAgICAgICAgdmFyIHRleHQgPSBqUXVlcnkoIiMiICsgdGhpcy5pZCkuaHRtbCgpOw0KICAgICAgICAvLyDlrp7mlr3lj4LmlbDmm7/mjaINCiAgICAgICAgdmFyIG1hdGNoZXMgPSB0ZXh0Lm1hdGNoKHRoaXMudmFyUGF0dGVybik7DQogICAgICAgIGlmIChtYXRjaGVzID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiB0ZXh0Ow0KICAgICAgICB9DQogICAgICAgIHZhciByZXN1bHRTdHIgPSB0ZXh0Ow0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hdGNoZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciB2YXJOYW1lID0gbWF0Y2hlc1tpXS5zdWJzdHJpbmcoMiwgbWF0Y2hlc1tpXS5sZW5ndGggLSAxKTsNCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHJvd1t2YXJOYW1lXTsNCiAgICAgICAgICAgIGlmICh0aGlzLnByb2Nlc3MgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5wcm9jZXNzKHJvdywgcm93SW5kZXgsIHZhck5hbWUsIHZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJlc3VsdFN0ciA9IHJlc3VsdFN0ci5yZXBsYWNlKG1hdGNoZXNbaV0sIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzdWx0U3RyOw0KICAgIH0NCn0pOw0KDQovKioNCiAqIOeUqOS6juWwgeijheihqOagvOebuOWFs+eahOaTjeS9nOexu+OAgg0KICovDQp2YXIgVGFibGVVdGlscyA9IGZ1bmN0aW9uICh0YWJsZURvbSwgdGFibGVDb25maWcsIHNlcnZpY2VDbGFzcywgcGFyYW1zKSB7DQogICAgaWYgKHRhYmxlRG9tID09IG51bGwgfHwgdGFibGVDb25maWcgPT0gbnVsbCB8fCBzZXJ2aWNlQ2xhc3MgPT0gbnVsbCkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBhcmFtZXRlcnMgdGFibGVEb20oMSksIHRhYmxlQ29uZmlnKDIpIGFuZCBzZXJ2aWNlQ2xhc3MoMykgY2FuIG5vdCBiZSBudWxsLiIpOw0KICAgIH0NCiAgICB0aGlzLnRhYmxlRG9tICAgICA9IHRhYmxlRG9tOyAgICAvLyBfY3JlYXRlSlF1ZXJ5KHRhYmxlRG9tKTsgIC8vIOihqOaooeWeiw0KICAgIHRoaXMudGFibGVDb25maWcgID0gdGFibGVDb25maWc7ICAgICAgICAgICAgICAgIC8vIOihqOmFjee9rg0KICAgIHRoaXMuc2VydmljZUNsYXNzID0gc2VydmljZUNsYXNzOyAgICAgICAgICAgICAgIC8vIOacjeWKoeexuw0KICAgIHRoaXMubWV0aG9kTmFtZSAgID0gJ2xpc3QnOyAgICAgICAgICAgICAgICAgICAgIC8vIOafpeivouaVsOaNrueahOaWueazleWQjeensO+8jOm7mOiupOS4uu+8mmxpc3QNCiAgICB0aGlzLnRhYmxlICAgICAgICA9IG5ldyBHVGFibGUodGhpcy50YWJsZURvbSk7ICAvLyDooajlrp7kvosNCiAgICB0aGlzLnNlcnZpY2UgICAgICA9IG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAvLyDmnI3liqHlrp7kvosNCg0KICAgIC8vIOivu+WPluWPguaVsA0KICAgIGlmIChwYXJhbXMgIT0gbnVsbCkgew0KICAgICAgICB0aGlzLm1ldGhvZE5hbWUgICAgID0gcGFyYW1zWydtZXRob2ROYW1lJ10gfHwgdGhpcy5tZXRob2ROYW1lOyAgLy8g5p+l6K+i5pWw5o2u55qE5pa55rOVDQogICAgICAgIHRoaXMubWV0aG9kUGFyYW1zICAgPSBwYXJhbXNbJ21ldGhvZFBhcmFtcyddOyAgICAgICAgICAvLyDmn6Xor6Lmlrnms5XnmoTlj4LmlbDvvIjkuI3pnIDopoHljIXmi6zov4fmu6Tlj4LmlbDvvIkNCiAgICAgICAgdGhpcy5xdWVyeSAgICAgICAgICA9IHBhcmFtc1sncXVlcnknXTsgICAgICAgICAgICAgICAgIC8vIOiHquWKqOe7keWumuafpeivou+8jOWPguaVsOWAvOaYr+S4gOS4qk1hcO+8jOWMheaLrO+8muWMuuWfn0lE77yM5p+l6K+i5Zue6LCD55qE5Yqo5L2c562J562JDQogICAgICAgIHRoaXMucGFnaW5hdGlvbkNvbmZpZyA9IHBhcmFtc1sncGFnaW5hdGlvbiddOyAgICAgICAgICAvLyDliIbpobXnm7jlhbPlj4LmlbANCiAgICAgICAgdGhpcy5hY3Rpb25zQ29uZmlnICAgID0gcGFyYW1zWydhY3Rpb25zQ29uZmlnJ107ICAgICAgIC8vIOWkhOeQhuWSjOihqOebuOWFs+eahOaTjeS9nA0KICAgICB9DQp9DQoNCi8qKg0KICAgICAqIOWIm+W7uuWvueivneahhuOAgg0KICAgICAqLw0KICAgIFRhYmxlVXRpbHMuX2NyZWF0ZURpYWxvZyA9IGZ1bmN0aW9uIChkaWFsb2dJZCwgcGFyYW1zKSB7DQogICAgICAgIHZhciBkaWFsb2cgPSB3aW5kb3dbZGlhbG9nSWRdOw0KICAgICAgICBpZiAoZGlhbG9nID09IG51bGwpIHsNCiAgICAgICAgICAgIGRpYWxvZyA9IGpRdWVyeSgiPGRpdiBpZD0nIiArIGRpYWxvZ0lkICsgIic+PC9kaXY+Iik7DQogICAgICAgICAgICAvLyDliJ3mrKHliJ3lp4vljJbpobXpnaLml7bkvb/nlKggVVJMIOS8oOmAkuWPguaVsA0KICAgICAgICAgICAgLy8gdXJsID0gUGFyYW1ldGVySGVscGVyLmFwcGVuZCh1cmwsIHBhcmFtcyk7DQogICAgICAgICAgICBkaWFsb2cubG9hZChwYXJhbXMuZWRpdEZvcm0sIHt9LCBmdW5jdGlvbigpIHt9KTsNCiAgICAgICAgICAgIHZhciB0YWJsZSA9IHBhcmFtcy50YWJsZTsNCiAgICAgICAgICAgIHZhciBjYW5jZWxDbGlja2VkID0gcGFyYW1zLmNhbmNlbENsaWNrZWQ7DQogICAgICAgICAgICB2YXIgb2tDbGlja2VkID0gcGFyYW1zLm9rQ2xpY2tlZDsNCiAgICAgICAgICAgIHZhciBfZWRpdGluZ1Jvd0luZGV4ID0gcGFyYW1zWydlZGl0aW5nUm93SW5kZXgnXTsNCiAgICAgICAgICAgIHZhciBfZWRpdGluZ1JvdyAgICAgID0gcGFyYW1zWydlZGl0aW5nUm93J107DQogICAgICAgICAgICBkaWFsb2cuZGlhbG9nKHsNCiAgICAgICAgCSAgICBhdXRvT3BlbjogZmFsc2UsDQoJICAgICAgICAgICAgd2lkdGg6IDYwMCwNCiAgICAgICAgICAgICAgICB0aXRsZTogJ+aVsOaNrue8lui+kScsDQoJICAgICAgICAgICAgbW9kYWw6IHRydWUsDQoJICAgICAgICAgICAgYnV0dG9uczogew0KCQkJICAgICAgICAi5Y+W5raIIjogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FuY2VsQ2xpY2tlZCA9PSBudWxsIHx8IGNhbmNlbENsaWNrZWQoX2VkaXRpbmdSb3csIHRhYmxlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOa4hemZpOatpOWPguaVsA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSB3aW5kb3cuX19lZGl0aW5nUGFyYW1zOw0KCQkJCSAgICAgICAgICAgIGRpYWxvZy5kaWFsb2coImNsb3NlIik7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoJCQkgICAgICAgIH0sDQoNCgkJCSAgICAgICAgIuehruWumiI6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldCA9IG9rQ2xpY2tlZChwYXJhbXMuc2VydmljZSwgX2VkaXRpbmdSb3csIF9lZGl0aW5nUm93SW5kZXgsIHBhcmFtcyk7ICAvLyDmm7TmlrDnmoTov5Tlm57nu5PmnpwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDmuIXpmaTmraTlj4LmlbANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWxldGUgd2luZG93Ll9fZWRpdGluZ1BhcmFtczsNCgkJCQkgICAgICAgICAgICBkaWFsb2cuZGlhbG9nKCJjbG9zZSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KCQkJICAgICAgICB9DQoJICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGRpYWxvZy5iaW5kKCdkaWFsb2dvcGVuJywgZnVuY3Rpb24oZXZlbnQsIHVpKSB7DQogICAgICAgICAgICAgICAgLy8g5YaN5qyh6LCD55So6aG16Z2i5pe277yM5L2/55So5pa55rOV5o6l5Y+j5Lyg6YCS5Y+C5pWwDQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mb3JtUmVlbnRyeSkgew0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZm9ybVJlZW50cnkod2luZG93Ll9fZWRpdGluZ1BhcmFtcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB3aW5kb3dbZGlhbG9nSWRdID0gZGlhbG9nOw0KICAgICAgICB9DQogICAgICAgIHdpbmRvdy5fX2VkaXRpbmdQYXJhbXMgPSBwYXJhbXM7DQogICAgICAgIHJldHVybiBkaWFsb2c7DQogICAgfTsNCg0KVGFibGVVdGlscy5wcm90b3R5cGUgPSB7DQoNCiAgICAvLyDoh6rliqjoo4Xovb3ooajnmoTmk43kvZwNCiAgICBhdXRvTG9hZCA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgDQogICAgICAgIC8vIOS7juacjeWKoeWZqOivu+WPluaVsOaNrg0KICAgICAgICB0aGlzLnNlcnZpY2UgPSBTZXJ2aWNlRmFjdG9yeS5nZXRTZXJ2aWNlKHRoaXMuc2VydmljZUNsYXNzKTsNCiAgICAgICAgDQogICAgICAgIHZhciBkYXRhID0gdGhpcy5fbG9hZERhdGEoKTsNCg0KICAgICAgICAvLyDoo4Xovb3ooagNCiAgICAgICAgdGhpcy50YWJsZS5kZWNvcmF0ZSh0aGlzLnRhYmxlQ29uZmlnLCBkYXRhKTsNCg0KICAgICAgICAvLyDnu5Hlrprmn6Xor6Lmk43kvZwNCiAgICAgICAgdGhpcy5iaW5kUXVlcnkoKTsNCg0KICAgICAgICB0aGlzLmJ1aWxkUGFnaW5hdGlvbigpOw0KDQogICAgICAgIHRoaXMuaGFuZGxlQWN0aW9ucygpOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHRoaXMudGFibGU7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOmAmui/h+acjeWKoeWZqOijhei9veaVsOaNrg0KICAgICAqLw0KICAgIF9sb2FkRGF0YSA6IGZ1bmN0aW9uICgpIHsNCgkgICAgLy9NZXNzYWdlQm94LmRlYnVnKCdtZXRob2RQYXJhbXM9JywgdGhpcy5tZXRob2RQYXJhbXMpOw0KICAgICAgICB2YXIgZGF0YSA9IHRoaXMuc2VydmljZVt0aGlzLm1ldGhvZE5hbWVdLmFwcGx5KHRoaXMuc2VydmljZSwgdGhpcy5tZXRob2RQYXJhbXMgfHwgW10pOw0KDQogICAgICAgIC8vIOWwhuacjeWKoeWZqOWPguaVsOi1i+WAvOS4uuacrOWcsOWPguaVsA0KICAgICAgICBpZiAodGhpcy50YWJsZS5mc3BQYXJhbWV0ZXIgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhpcy50YWJsZS5mc3BQYXJhbWV0ZXIgPSBuZXcgRnNwUGFyYW1ldGVyKCk7DQogICAgICAgIH0NCiAgICAgICAgVXRpbHMudmFsdWVDb3B5KHRoaXMuc2VydmljZS5mc3BQYXJhbWV0ZXIsIHRoaXMudGFibGUuZnNwUGFyYW1ldGVyKTsNCiAgICAgICAgdGhpcy5fc2V0UGFnaW5hdGlvbkJ1dHRvblN0YXRlKHRoaXMudGFibGUuZnNwUGFyYW1ldGVyLnBhZ2luYXRpb24pOw0KICAgICAgICByZXR1cm4gZGF0YTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5Yi35paw5b2T5YmN5pWw5o2uDQogICAgICovDQogICAgcmVmcmVzaCA6IGZ1bmN0aW9uKCkgew0KICAgICAgICBVdGlscy52YWx1ZUNvcHkodGhpcy5zZXJ2aWNlLmZzcFBhcmFtZXRlciwgdGhpcy50YWJsZS5mc3BQYXJhbWV0ZXIpOw0KCXZhciBkYXRhID0gdGhpcy5fbG9hZERhdGEoKTsNCgl0aGlzLnRhYmxlLnJlbG9hZChkYXRhKTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5bCG6KGo5ZKM5p+l6K+i6aG16L+b6KGM57uR5a6a44CCDQogICAgICovDQogICAgYmluZFF1ZXJ5IDogZnVuY3Rpb24gKCkgew0KICAgICAgICBpZiAoIXRoaXMucXVlcnkpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgdmFyIHF1ZXJ5RG9tID0gX2NyZWF0ZUpRdWVyeSh0aGlzLnF1ZXJ5Wydkb20nXSk7DQogICAgICAgIGlmIChxdWVyeURvbSA9PSBudWxsKSB7DQogICAgICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IgKCLmn6Xor6LljLrln5/nmoREb23lr7nosaHkuI3og73kuLrnqbrjgIIiKTsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciAoIlRoZSBkb20gb2YgcXVlcnkgY2FuIG5vdCBiZSBudWxsLiIpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyDmn6Xor6LlpITnkIbkuovku7YNCiAgICAgICAgdmFyIHF1ZXJ5QWN0aW9uID0gZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgIC8qIGFsZXJ0KCdxdWVyeUFjdGlvbi4uLi4uLi4uLi4uLicpOyAqLw0KICAgICAgICAgICAgdmFyIHRhYmxlID0gZXZlbnQuZGF0YS50YWJsZTsNCiAgICAgICAgICAgIHZhciBjb21wcyA9IENvbnRyb2xVdGlscy5nZXROYW1lZENvbXAocXVlcnlEb20pOw0KICAgICAgICAgICAgLy8g5riF6Zmk6L+H5ruk5p2h5Lu277yM6YG/5YWN6YeN5aSNDQogICAgICAgICAgICB0YWJsZS5mc3BQYXJhbWV0ZXIuY2xlYXJGaWx0ZXJJdGVtKCk7DQogICAgICAgICAgICBmb3IgKHZhciBuYW1lIGluIGNvbXBzKSB7DQogICAgICAgICAgICAgICAgdmFyIGNvbXAgPSBqUXVlcnkoY29tcHNbbmFtZV0pOw0KICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJUeXBlID0gY29tcC5hdHRyKCdmaWx0ZXJUeXBlJyk7DQogICAgICAgICAgICAgICAgIC8vIGFsZXJ0KCJpbnB1dFsiICsgdGhpcy5uYW1lICsgIl07IHZhbHVlPSIgKyB0aGlzLnZhbHVlICsgIjtmaWx0ZXJUeXBlPSIgKyBmaWx0ZXJUeXBlKTsNCiAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gY29tcC52YWwoKTsNCgkgICAgICAgICAgICAgaWYgKG5hbWUgIT0gJycgJiYgdmFsdWUgIT0gbnVsbCAmJiB2YWx1ZSAhPSAnJyAmJiBmaWx0ZXJUeXBlICE9IG51bGwpIHsNCgkgICAgICAgICAgICAgICAgdGFibGUuZnNwUGFyYW1ldGVyLnNldEZpbHRlckl0ZW0obmFtZSwgZmlsdGVyVHlwZSwgdmFsdWUpOw0KCSAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgc2VydmljZSA9IGV2ZW50LmRhdGEuc2VydmljZTsNCiAgICAgICAgICAgIHNlcnZpY2UuZnNwUGFyYW1ldGVyID0gbnVsbDsNCiAgICAgICAgICAgIHRhYmxlLmZzcFBhcmFtZXRlci5wYWdpbmF0aW9uLnJlc2V0KCk7ICAvLyDph43nva7liIbpobXlj4LmlbANCiAgICAgICAgICAgIHNlcnZpY2Uuc2V0RnNwUGFyYW1ldGVyKHRhYmxlLmZzcFBhcmFtZXRlcik7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIOWKoOi9veaVsOaNrg0KICAgICAgICAgICAgdmFyIGRhdGEgPSBldmVudC5kYXRhLnRhYmxlVXRpbHMuX2xvYWREYXRhKHRhYmxlLCBzZXJ2aWNlKTsNCg0KICAgICAgICAgICAgdGFibGUucmVsb2FkKGRhdGEpOw0KDQogICAgICAgICAgICAvLyDmn6Xor6Llm57osIPlh73mlbANCiAgICAgICAgICAgIGlmIChldmVudC5kYXRhWydvblF1ZXJ5J10gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGV2ZW50LmRhdGFbJ29uUXVlcnknXSh0YWJsZSwgZGF0YSwgdGFibGUuZnNwUGFyYW1ldGVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBxdWVyeUJ0biA9IF9jcmVhdGVKUXVlcnkodGhpcy5xdWVyeVsnYnV0dG9uJ10pOyAgLy8g5p+l6K+i5oyJ6ZKu5a+56LGhDQogICAgICAgIGlmIChxdWVyeUJ0biAhPSBudWxsKSB7DQogICAgICAgICAgICBxdWVyeUJ0bi5iaW5kKCJjbGljayIsIHt0YWJsZSA6IHRoaXMudGFibGUsIA0KICAgICAgICAgICAgICAgIHNlcnZpY2UgOiB0aGlzLnNlcnZpY2UsIG9uUXVlcnkgOiB0aGlzLnF1ZXJ5WydvblF1ZXJ5J10sDQogICAgICAgICAgICAgICAgdGFibGVVdGlscyA6IHRoaXN9LCBxdWVyeUFjdGlvbik7DQogICAgICAgIH0NCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5Yib5bu65YiG6aG155u45YWz55qE5L+h5oGvDQogICAgICovDQogICAgYnVpbGRQYWdpbmF0aW9uIDogZnVuY3Rpb24gKCkgew0KICAgICAgICBpZiAodGhpcy5wYWdpbmF0aW9uQ29uZmlnID09IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMucGFnaW5hdGlvbkNvbmZpZyA9IHt9Ow0KICAgICAgICB9DQogICAgICAgIGlmICh0cnVlID09PSB0aGlzLnBhZ2luYXRpb25Db25maWdbJ2Rpc2FibGUnXSkgew0KICAgICAgICAgICAgLy8g5a6a5LmJ5LqGZGlzYWxiZeWxnuaAp+aXtu+8jOWIhumhteaJjeS4jei1t+S9nOeUqA0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGF1dG8gPSAodHJ1ZSA9PT0gdGhpcy5wYWdpbmF0aW9uQ29uZmlnWydhdXRvJ10pOyAgICAgICAgICAgICAgLy8g5piv5ZCm5qC55o2u5qih5p2/6Ieq5Yqo5Yib5bu65YiG6aG177yI5Zyo5oyH5a6a55qE5Yy65Z+f5Yqo5oCB55Sf5oiQ5oyJ6ZKu77yJDQogICAgICAgIA0KICAgICAgICAvLyDnv7vpobXlpITnkIblh73mlbANCiAgICAgICAgdmFyIHR1cm5QYWdlQWN0aW9uID0gZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICB2YXIgdGFibGUgPSBldmVudC5kYXRhLnRhYmxlOw0KICAgICAgICAgICAgdmFyIGFjdGlvbiA9IGV2ZW50LmRhdGEuYWN0aW9uOw0KICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGpRdWVyeSh0aGlzKS52YWwoKTsgICAgLy8g6Lez6L2s5Yiw5oyH5a6a6aG15pe25Lya5L2/55So5q2k5Y+C5pWwDQogICAgICAgICAgICB0YWJsZS5mc3BQYXJhbWV0ZXIucGFnaW5hdGlvblthY3Rpb25dKHBhcmFtcyk7DQoNCiAgICAgICAgICAgIC8vIOiuvuWumue/u+mhteeahOWAvA0KICAgICAgICAgICAgdmFyIHR1cm5QYWdlQ29tYm9Cb3ggPSBldmVudC5kYXRhLnR1cm5QYWdlQ29tYm9Cb3g7DQogICAgICAgICAgICBpZiAodHVyblBhZ2VDb21ib0JveCAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgalF1ZXJ5KHR1cm5QYWdlQ29tYm9Cb3gpLnZhbCh0YWJsZS5mc3BQYXJhbWV0ZXIucGFnaW5hdGlvbi5nZXRDdXJyZW50UGFnZUluZGV4KCkpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgc2VydmljZSA9IGV2ZW50LmRhdGEuc2VydmljZTsNCiAgICAgICAgICAgIC8vIFRPRE86IOmHjeaWsOWIm+W7uui/h+a7pOadoeS7tueahOWAvO+8iOWNs+WcqOeUqOaIt+aUueWPmOS6huWAvOS5i+WQju+8jOacqui/m+ihjOafpeivoueahOaDheWGteS4i++8iQ0KICAgICAgICAgICAgc2VydmljZS5zZXRGc3BQYXJhbWV0ZXIodGFibGUuZnNwUGFyYW1ldGVyKTsNCiAgICAgICAgICAgIHZhciBkYXRhID0gZXZlbnQuZGF0YS50YWJsZVV0aWxzLl9sb2FkRGF0YSh0YWJsZSwgc2VydmljZSk7DQoJICAgICAgICB0YWJsZS5yZWxvYWQoZGF0YSk7DQogICAgICAgIH0gLy8gZW5kIG9mIHR1cm5QYWdlQWN0aW9uDQoNCiAgICAgICAgaWYgKGF1dG8pIHsNCiAgICAgICAgICAgIC8vIFRPRE86IOiHquWKqOeUn+aIkOe/u+mhteaMiemSrj8NCiAgICAgICAgICAgIA0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8g5qC55o2u5bey5pyJ55qE57+76aG15oyJ6ZKu6L+b6KGM5aSE55CGDQogICAgICAgICAgICB2YXIgdHVyblBhZ2VDb21ib0JveCA9IHRoaXMucGFnaW5hdGlvbkNvbmZpZ1sndHVyblBhZ2UnXTsNCiAgICAgICAgICAgIGlmICh0dXJuUGFnZUNvbWJvQm94ICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aGlzLl9idWlsZFR1cm5QYWdlKHR1cm5QYWdlQ29tYm9Cb3gsIHRoaXMudGFibGUuZnNwUGFyYW1ldGVyLnBhZ2luYXRpb24sIHR1cm5QYWdlQWN0aW9uKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdmFyIG5leHRQYWdlICAgICAgID0gX2NyZWF0ZUpRdWVyeSh0aGlzLnBhZ2luYXRpb25Db25maWdbJ25leHRQYWdlJ10gIHx8ICcjbmV4dFBhZ2UnKTsNCiAgICAgICAgICAgIHZhciBwcmV2UGFnZSAgICAgICA9IF9jcmVhdGVKUXVlcnkodGhpcy5wYWdpbmF0aW9uQ29uZmlnWydwcmV2UGFnZSddICB8fCAnI3ByZXZQYWdlJyk7DQogICAgICAgICAgICB2YXIgZmlyc3RQYWdlICAgICAgPSBfY3JlYXRlSlF1ZXJ5KHRoaXMucGFnaW5hdGlvbkNvbmZpZ1snZmlyc3RQYWdlJ10gfHwgJyNmaXJzdFBhZ2UnKTsNCiAgICAgICAgICAgIHZhciBsYXN0UGFnZSAgICAgICA9IF9jcmVhdGVKUXVlcnkodGhpcy5wYWdpbmF0aW9uQ29uZmlnWydsYXN0UGFnZSddICB8fCAnI2xhc3RQYWdlJyk7DQogICAgICAgICAgICBuZXh0UGFnZS5iaW5kKCJjbGljayIsIHRoaXMuX2dldFBhZ2luYXRpb25QYXJhbXMoJ25leHRQYWdlJywgdHVyblBhZ2VDb21ib0JveCksIHR1cm5QYWdlQWN0aW9uKTsNCiAgICAgICAgICAgIHByZXZQYWdlLmJpbmQoImNsaWNrIiwgdGhpcy5fZ2V0UGFnaW5hdGlvblBhcmFtcygncHJldlBhZ2UnLCB0dXJuUGFnZUNvbWJvQm94KSwgdHVyblBhZ2VBY3Rpb24pOw0KICAgICAgICAgICAgZmlyc3RQYWdlLmJpbmQoImNsaWNrIix0aGlzLl9nZXRQYWdpbmF0aW9uUGFyYW1zKCdmaXJzdFBhZ2UnLCB0dXJuUGFnZUNvbWJvQm94KSx0dXJuUGFnZUFjdGlvbik7DQogICAgICAgICAgICBsYXN0UGFnZS5iaW5kKCJjbGljayIsIHRoaXMuX2dldFBhZ2luYXRpb25QYXJhbXMoJ2xhc3RQYWdlJywgdHVyblBhZ2VDb21ib0JveCksIHR1cm5QYWdlQWN0aW9uKTsgICAgICAgICAgICANCiAgICAgICAgfQ0KICAgIH0sDQogICAgDQogICAgLyoqDQogICAgICogVE9ETzog5Yib5bu65LiA5Liq4oCc6Lez6L2s5Yiw5oyH5a6a6aG14oCd55qE5LiL5ouJ5YiX6KGo5qGG44CC55So5oi35Y+v6Ieq5a6a5LmJ57+76aG16Z2i5p2/44CCDQogICAgICovDQogICAgX2J1aWxkVHVyblBhZ2UgOiBmdW5jdGlvbiAoY29tYm9Cb3gsIHBhZ2luYXRpb24sIHR1cm5QYWdlQWN0aW9uKSB7DQogICAgICAgIC8vIOihjOaVsOaYr+S7jjHlvIDlp4vorqHmlbDnmoQNCiAgICAgICAgdmFyIF9jb21ib0JveCA9IGpRdWVyeShjb21ib0JveCk7DQogICAgICAgIF9jb21ib0JveC5iaW5kKCdjaGFuZ2UnLCB0aGlzLl9nZXRQYWdpbmF0aW9uUGFyYW1zKCd0dXJuVG9QYWdlJyksIHR1cm5QYWdlQWN0aW9uKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYWdpbmF0aW9uLmdldFBhZ2VDb3VudCgpOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBvcHRpb24gPSBqUXVlcnkoIjxvcHRpb24+PC9vcHRpb24+Iik7DQogICAgICAgICAgICBvcHRpb24udmFsKGkpLnRleHQoaSArIDEpOw0KICAgICAgICAgICAgb3B0aW9uLmFwcGVuZFRvKF9jb21ib0JveCk7DQogICAgICAgIH0NCiAgICB9LA0KDQogICAgLyoqDQogICAgICog6L+U5Zue57+76aG155u45YWz55qE5Y+C5pWwKOaJgOacieaMiemSruWFrOeUqOeahOWPguaVsCkNCiAgICAgKi8NCiAgICBfZ2V0UGFnaW5hdGlvblBhcmFtcyA6IGZ1bmN0aW9uIChfYWN0aW9uLCB0dXJuUGFnZUNvbWJvQm94KSB7DQogICAgICAgIHZhciBwZ1BhcmFtcyA9IHt0YWJsZSA6IHRoaXMudGFibGUsIHNlcnZpY2UgOiB0aGlzLnNlcnZpY2UsIG1ldGhvZE5hbWUgOiB0aGlzLm1ldGhvZE5hbWUsDQogICAgICAgICAgICAgICAgbWV0aG9kUGFyYW1zIDogdGhpcy5tZXRob2RQYXJhbXMsIHRhYmxlVXRpbHM6IHRoaXMsIHR1cm5QYWdlQ29tYm9Cb3ggOiB0dXJuUGFnZUNvbWJvQm94LA0KICAgICAgICAgICAgICAgIGFjdGlvbiA6IF9hY3Rpb259Ow0KICAgICAgICByZXR1cm4gcGdQYXJhbXM7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOWkhOeQhuWSjOihqOeahOS4gOS6m+ebuOWFs+WKqOS9nA0KICAgICAqLw0KICAgIGhhbmRsZUFjdGlvbnMgOiBmdW5jdGlvbigpIHsNCiAgICAgICAgaWYgKCF0aGlzLmFjdGlvbnNDb25maWcpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgYWRkQnRuID0gX2NyZWF0ZUpRdWVyeSh0aGlzLmFjdGlvbnNDb25maWdbJ2FkZCddKTsNCiAgICAgICAgaWYgKGFkZEJ0bikgew0KICAgICAgICAgICAgdmFyIGVkaXRGb3JtICAgICA9IHRoaXMuYWN0aW9uc0NvbmZpZ1snZWRpdEZvcm0nXTsgICAgICAvLyDnlKjmiLflrprkuYnnmoTmm7TmlrDpobXpnaINCiAgICAgICAgICAgIGlmIChlZGl0Rm9ybSA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCLmnKrlrprkuYnnvJbovpHooajljZXlj4LmlbBbZWRpdEZvcm1d44CCIik7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgcGFyYW1ldGVyIFtlZGl0Rm9ybV0gaXMgdW5kZWZpbmVkLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyDlj6/ku6Xoh6rlrprkuYnkuIDkuKrliJ3lp4vljJYNCiAgICAgICAgICAgIHZhciBuZXdJbnN0YW5jZSA9IHRoaXMuYWN0aW9uc0NvbmZpZ1snbmV3SW5zdGFuY2UnXTsNCiAgICAgICAgICAgIHZhciBlZGl0aW5nUm93ICA9IG5ld0luc3RhbmNlID8gbmV3SW5zdGFuY2UoKSA6IHt9OyAgLy8g5Yid5aeL5YyW5LiA5Liq77yIVE9ETzog5Yid5aeL5YyWX19jbGFzc05hbWXvvIkNCiAgICAgICAgICAgIHZhciBhZGRBY3Rpb24gICA9IHRoaXMuYWN0aW9uc0NvbmZpZ1snYWRkQWN0aW9uJ107ICAgLy8g55So5oi35a6a5LmJ55qE5aKe5Yqg5pON5L2cDQogICAgICAgICAgICAvLyDnlKjmiLflj6/ku6XljZXni6zlrprkuYnnmoTlop7liqDpobXpnaLvvIzlpoLmnpzmnKrlrprkuYnvvIzliJnkvb/nlKjnvJbovpHpobXpnaINCiAgICAgICAgICAgIHZhciBlZGl0Rm9ybSAgICA9IHRoaXMuYWN0aW9uc0NvbmZpZ1snYWRkRm9ybSddIHx8IHRoaXMuYWN0aW9uc0NvbmZpZ1snZWRpdEZvcm0nXTsNCiAgICAgICAgICAgIGFkZEJ0bi5iaW5kKCJjbGljayIsDQogICAgICAgICAgICAgICAge3RhYmxlIDogdGhpcy50YWJsZSwgc2VydmljZSA6IHRoaXMuc2VydmljZSwgYWRkQWN0aW9uIDogYWRkQWN0aW9uLA0KICAgICAgICAgICAgICAgICBlZGl0Rm9ybSA6IGVkaXRGb3JtLCBlZGl0aW5nUm93IDogZWRpdGluZ1Jvd30sDQogICAgICAgICAgICAgICAgdGhpcy5hZGRSb3cpOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIHVwZGF0ZUJ0biA9IF9jcmVhdGVKUXVlcnkodGhpcy5hY3Rpb25zQ29uZmlnWyd1cGRhdGUnXSk7DQogICAgICAgIGlmICh1cGRhdGVCdG4pIHsNCiAgICAgICAgICAgIC8vIOS9v+eUqOWIoOmZpOeahOWinuWKoOWHveaVsA0KICAgICAgICAgICAgdmFyIHVwZGF0ZUFjdGlvbiA9IHRoaXMuYWN0aW9uc0NvbmZpZ1sndXBkYXRlQWN0aW9uJ107ICAvLyDnlKjmiLflrprkuYnnmoTmm7TmlrDmk43kvZwNCiAgICAgICAgICAgIHZhciBlZGl0Rm9ybSAgICAgPSB0aGlzLmFjdGlvbnNDb25maWdbJ2VkaXRGb3JtJ107ICAgICAgLy8g55So5oi35a6a5LmJ55qE5pu05paw6aG16Z2iDQogICAgICAgICAgICBpZiAoZWRpdEZvcm0gPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIC8vIHRocm93IG5ldyBFcnJvcigi5pyq5a6a5LmJ57yW6L6R6KGo5Y2V5Y+C5pWwW2VkaXRGb3JtXeOAgiIpOw0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlIHBhcmFtZXRlciBbZWRpdEZvcm1dIGlzIHVuZGVmaW5lZC4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVwZGF0ZUJ0bi5iaW5kKCJjbGljayIsIA0KICAgICAgICAgICAgICAgIHt0YWJsZSA6IHRoaXMudGFibGUsIHNlcnZpY2UgOiB0aGlzLnNlcnZpY2UsIHVwZGF0ZUFjdGlvbiA6IHVwZGF0ZUFjdGlvbiwNCiAgICAgICAgICAgICAgICAgZWRpdEZvcm0gOiBlZGl0Rm9ybX0sDQogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVSb3cpOw0KDQogICAgICAgICAgICAvLyDmm7TmlrDmjInpkq7ml7bnmoTlm57osIPlh73mlbANCiAgICAgICAgICAgIC8vIHZhciB1cGRhdGVCdG5DYWxsYmFjayA9IHRoaXMuYWN0aW9uc0NvbmZpZ1sndXBkYXRlQ2FsbGJhY2snXTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciByZW1vdmVCdG4gPSBfY3JlYXRlSlF1ZXJ5KHRoaXMuYWN0aW9uc0NvbmZpZ1sncmVtb3ZlJ10pOw0KICAgICAgICBpZiAocmVtb3ZlQnRuKSB7ICAgICAgICAgICAgDQogICAgICAgICAgICAvLyDkvb/nlKjliKDpmaTnmoTlop7liqDlh73mlbANCiAgICAgICAgICAgIHZhciByZW1vdmVBY3Rpb24gPSB0aGlzLmFjdGlvbnNDb25maWdbJ3JlbW92ZUFjdGlvbiddOyAgLy8g55So5oi35a6a5LmJ55qE5Yig6Zmk5pON5L2cDQogICAgICAgICAgICByZW1vdmVCdG4uYmluZCgiY2xpY2siLCB7dGFibGUgOiB0aGlzLnRhYmxlLCBzZXJ2aWNlIDogdGhpcy5zZXJ2aWNlLCByZW1vdmVBY3Rpb24gOiByZW1vdmVBY3Rpb259LA0KICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlUm93KTsNCiAgICAgICAgfQ0KICAgIH0sDQogICAgDQogICAgLyoqDQogICAgICog5aKe5Yqg5bm257yW6L6R5LiA6KGM6K6w5b2V44CCDQogICAgICovDQogICAgYWRkUm93IDogZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgIHZhciB0YWJsZSAgICAgID0gZXZlbnQuZGF0YS50YWJsZTsNCiAgICAgICAgdmFyIGVkaXRpbmdSb3cgPSBldmVudC5kYXRhLmVkaXRpbmdSb3c7DQogICAgICAgIHZhciBva0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VydmljZSwgZWRpdGluZ1Jvdykgew0KICAgICAgICAgICAgIHZhciByZXQgPSBmYWxzZTsgIC8vIOabtOaWsOeahOi/lOWbnue7k+aenA0KICAgICAgICAgICAgIGlmICh3aW5kb3cuYWRkQWN0aW9uICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgcmV0ID0gd2luZG93LmFkZEFjdGlvbihlZGl0aW5nUm93LCB0YWJsZSwgc2VydmljZSk7DQogICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgdmFyIGRhYSA9IG5ldyBEZWZhdWx0QWRkQWN0aW9uKHNlcnZpY2UpOw0KICAgICAgICAgICAgICAgICByZXQgPSBkYWEuYWRkQWN0aW9uKGVkaXRpbmdSb3csIHRhYmxlLCBzZXJ2aWNlKTsNCiAgICAgICAgICAgICB9DQogICAgICAgICAgICAgaWYgKHJldCkgew0KICAgICAgICAgICAgICAgICAgdGFibGUuYXBwZW5kUm93KGVkaXRpbmdSb3cpOw0KICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9Ow0KICAgICAgICB2YXIgcGFyYW1zID0ge29rQ2xpY2tlZCA6IG9rQ2xpY2tlZCwgYWN0aW9uIDogJ2FkZCcsIGJpbmRpbmdDbGFzcyA6IHRhYmxlLmdldEJpbmRpbmdDbGFzcygpLA0KICAgICAgICAgICAgZWRpdGluZ1JvdyA6IGVkaXRpbmdSb3d9Ow0KICAgICAgICBqUXVlcnkuZXh0ZW5kKHBhcmFtcywgZXZlbnQuZGF0YSk7DQogICAgICAgIHZhciBkaWFsb2cgPSBUYWJsZVV0aWxzLl9jcmVhdGVEaWFsb2coJ19fYXV0b19fZGlhbG9nX18nLCBwYXJhbXMpOw0KDQogICAgICAgIC8vIOW8ueWHuuS/ruaUueWvueivneahhg0KICAgICAgICBkaWFsb2cuZGlhbG9nKCdvcGVuJyk7DQogICAgfSwNCiAgICANCiAgICAvKioNCiAgICAgKiDliKDpmaTlpITnkIblh73mlbANCiAgICAgKi8NCiAgICByZW1vdmVSb3cgOiBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgdmFyIHRhYmxlID0gZXZlbnQuZGF0YS50YWJsZTsNCiAgICAgICAgdmFyIHJvd0luZGV4ID0gdGFibGUuZ2V0U2VsZWN0ZWRSb3dOdW0oKTsNCiAgICAgICAgaWYgKHJvd0luZGV4ID49IDApIHsNCgkgICAgICAgIHZhciBzZWxlY3RlZFJvdyA9IHRhYmxlLmdldFJvd0F0KHJvd0luZGV4KTsNCiAgICAgICAgICAgIHZhciBzZXJ2aWNlID0gZXZlbnQuZGF0YS5zZXJ2aWNlOw0KCSAgICAgICAgLy8g5Zyo5pyN5Yqh5Zmo56uv5Yig6Zmk5q2k6K6w5b2VDQogICAgICAgICAgICB2YXIgcmVtb3ZlQWN0aW9uID0gZXZlbnQuZGF0YVsncmVtb3ZlQWN0aW9uJ107DQogICAgICAgICAgICB2YXIgc3VjY2VzcyA9IGZhbHNlOw0KICAgICAgICAgICAgaWYgKCFjb25maXJtKCfnoa7orqTliKDpmaTmraTorrDlvZXvvJ8nKSkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChyZW1vdmVBY3Rpb24gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIC8vIOiwg+eUqOeUqOaIt+iHquWumuS5ieeahOWIoOmZpOaWueazlQ0KICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSByZW1vdmVBY3Rpb24odGFibGUsIHNlbGVjdGVkUm93LCBzZXJ2aWNlKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8g5L2/55So5qCH5YeG55qE5Yig6Zmk5pa55rOVDQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IHNlcnZpY2VbJ2RlbGV0ZSddKHNlbGVjdGVkUm93KTsNCiAgICAgICAgICAgIH0NCiAgICAJICAgIGlmIChzdWNjZXNzKSB7DQogICAgICAgICAgICAgICAgdGFibGUuZGVsZXRlUm93KHJvd0luZGV4KTsNCgkgICAgICAgICAgICBNZXNzYWdlQm94LmluZm9ybSgi5Yig6Zmk5oiQ5Yqf77yBIik7DQoJICAgICAgICB9IGVsc2Ugew0KCSAgICAgICAgICAgIE1lc3NhZ2VCb3guYWxlcnQoIuWIoOmZpOWksei0pe+8gSIpOw0KCSAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KCSAgICAgICAgTWVzc2FnZUJveC5hbGVydCgi6K+36YCJ5oup5b6F5Yig6Zmk55qE6K6w5b2V44CCIik7DQogICAgCX0NCiAgICB9LA0KDQogICAgdXBkYXRlUm93IDogZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgdmFyIHRhYmxlID0gZXZlbnQuZGF0YS50YWJsZTsNCiAgICAgICAgdmFyIGVkaXRpbmdSb3dJbmRleCA9IHRhYmxlLmdldFNlbGVjdGVkUm93TnVtKCk7DQoJICAgIGlmIChlZGl0aW5nUm93SW5kZXggPCAwKSB7DQoJICAgICAgICBNZXNzYWdlQm94LmFsZXJ0KCfor7fpgInmi6nlvoXkv67mlLnnmoTooYzjgIInKTsNCgkJICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBva0NsaWNrZWQgPSBmdW5jdGlvbiAoc2VydmljZSwgZWRpdGluZ1JvdywgZWRpdGluZ1Jvd0luZGV4KSB7DQogICAgICAgICAgICAgdmFyIHJldCA9IGZhbHNlOyAgLy8g5pu05paw55qE6L+U5Zue57uT5p6cDQogICAgICAgICAgICAgaWYgKHdpbmRvdy51cGRhdGVBY3Rpb24gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICByZXQgPSB3aW5kb3cudXBkYXRlQWN0aW9uKGVkaXRpbmdSb3csIHRhYmxlLCBzZXJ2aWNlKTsNCiAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICB2YXIgZHVhID0gbmV3IERlZmF1bHRVcGRhdGVBY3Rpb24oc2VydmljZSk7DQogICAgICAgICAgICAgICAgIHJldCA9IGR1YS51cGRhdGVBY3Rpb24oZWRpdGluZ1JvdywgdGFibGUsIHNlcnZpY2UpOw0KICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICBpZiAocmV0KSB7DQogICAgICAgICAgICAgICAgICB0YWJsZS51cGRhdGVSb3coZWRpdGluZ1Jvd0luZGV4LCBlZGl0aW5nUm93KTsNCiAgICAgICAgICAgICB9DQogICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfTsNCiAgICAgICAgdmFyIHBhcmFtcyA9IHtva0NsaWNrZWQgOiBva0NsaWNrZWQsIGFjdGlvbiA6ICd1cGRhdGUnLCBiaW5kaW5nQ2xhc3MgOiB0YWJsZS5nZXRCaW5kaW5nQ2xhc3MoKSwNCiAgICAgICAgICAgIGVkaXRpbmdSb3dJbmRleCA6IGVkaXRpbmdSb3dJbmRleCwgZWRpdGluZ1JvdyA6IHRhYmxlLmdldFJvd0F0KGVkaXRpbmdSb3dJbmRleCl9Ow0KICAgICAgICBqUXVlcnkuZXh0ZW5kKHBhcmFtcywgZXZlbnQuZGF0YSk7DQogICAgICAgIHZhciBkaWFsb2cgPSBUYWJsZVV0aWxzLl9jcmVhdGVEaWFsb2coJ19fYXV0b19fZGlhbG9nX18nLCBwYXJhbXMpOw0KDQogICAgICAgIC8vIOW8ueWHuuS/ruaUueWvueivneahhg0KICAgICAgICBkaWFsb2cuZGlhbG9nKCdvcGVuJyk7DQogICAgfSwNCiAgICANCg0KICAgIC8qKg0KICAgICAqIOagueaNrue/u+mhteWPguaVsOiuvue9rue/u+mhteaMiemSrueahOeKtuaAgQ0KICAgICAqLw0KICAgIF9zZXRQYWdpbmF0aW9uQnV0dG9uU3RhdGUgOiBmdW5jdGlvbiAocGFnaW5hdGlvbiwgcGFnaW5hdGlvbkNvbmZpZykgew0KICAgICAgICBpZiAocGFnaW5hdGlvbiA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKHBhZ2luYXRpb25Db25maWcgPT0gbnVsbCkgew0KICAgICAgICAgICAgcGFnaW5hdGlvbkNvbmZpZyA9IHt9Ow0KICAgICAgICB9DQogICAgICAgIHZhciBuZXh0UGFnZSAgPSBfY3JlYXRlSlF1ZXJ5KHBhZ2luYXRpb25Db25maWdbJ25leHRQYWdlJ10gIHx8ICcjbmV4dFBhZ2UnKTsNCiAgICAgICAgdmFyIHByZXZQYWdlICA9IF9jcmVhdGVKUXVlcnkocGFnaW5hdGlvbkNvbmZpZ1sncHJldlBhZ2UnXSAgfHwgJyNwcmV2UGFnZScpOw0KICAgICAgICB2YXIgZmlyc3RQYWdlID0gX2NyZWF0ZUpRdWVyeShwYWdpbmF0aW9uQ29uZmlnWydmaXJzdFBhZ2UnXSB8fCAnI2ZpcnN0UGFnZScpOw0KICAgICAgICB2YXIgbGFzdFBhZ2UgID0gX2NyZWF0ZUpRdWVyeShwYWdpbmF0aW9uQ29uZmlnWydsYXN0UGFnZSddICB8fCAnI2xhc3RQYWdlJyk7DQogICAgICAgIA0KICAgICAgICAvL1RPRE/vvJog5aaC5p6c5oyJ6ZKu5piv6ZO+5o6l55qE5pa55byP77yM6ZyA6KaB6ICD6JmR5YW25LuW5pa55rOVLOeUqOWFtuS7luaWueW8j+S/rumlsO+8iOaMh+WumkNTU++8iQ0KICAgICAgICBuZXh0UGFnZS5hdHRyKCdkaXNhYmxlZCcsIHBhZ2luYXRpb24uaGFzTmV4dFBhZ2UoKSAgID8gJycgOiAndHJ1ZScpOw0KICAgICAgICBwcmV2UGFnZS5hdHRyKCdkaXNhYmxlZCcsIHBhZ2luYXRpb24uaGFzUHJldlBhZ2UoKSAgID8gJycgOiAndHJ1ZScpOw0KICAgICAgICBmaXJzdFBhZ2UuYXR0cignZGlzYWJsZWQnLCBwYWdpbmF0aW9uLmhhc0ZpcnN0UGFnZSgpID8gJycgOiAndHJ1ZScpOw0KICAgICAgICBsYXN0UGFnZS5hdHRyKCdkaXNhYmxlZCcsIHBhZ2luYXRpb24uaGFzTGFzdFBhZ2UoKSAgID8gJycgOiAndHJ1ZScpOw0KICAgIH0NCn0NCg0KLyoqDQogKiDnvLrnnIHnmoTmm7TmlrDmlrnms5Xmk43kvZzvvIzkuLvopoHnmoTlip/og73mmK/osIPnlKjlkozoo4Xovb3mnI3liqHlr7nosaHnmoTigJx1cGRhdGXigJ3mlrnms5XvvIwNCiAqIOatpOaWueazleWPquiDveS9v+eUqOS4gOS4quWvueixoeS9nOS4uuWPguaVsC3ljbPlvZPliY3nmoTnvJbovpHooYzjgIINCiAqLw0KdmFyIERlZmF1bHRBZGRBY3Rpb24gPSBmdW5jdGlvbiAoX3NlcnZpY2UpIHsNCiAgICBpZiAoX3NlcnZpY2UgPT0gbnVsbCkgew0KICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoIuacjeWKoeexu+S4jeiDveS4uuepuuOAgiIpOw0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBzZXJ2aWNlIGNsYXNzIGNhbiBub3QgYmUgbnVsbC4iKTsNCiAgICB9DQogICAgdGhpcy5zZXJ2aWNlID0gX3NlcnZpY2U7DQogICAgdGhpcy5tZXRob2ROYW1lID0gJ2FkZCc7DQp9DQoNCmpRdWVyeS5leHRlbmQoRGVmYXVsdEFkZEFjdGlvbi5wcm90b3R5cGUsIHsNCiAgICBhZGRBY3Rpb24gOiBmdW5jdGlvbiAoZWRpdGluZ1JvdywgdGFibGUpIHsNCiAgICAgICAgLy8gcmV0dXJuIHRoaXMuc2VydmljZVt0aGlzLm1ldGhvZE5hbWVdKGVkaXRpbmdSb3cpOw0KICAgICAgICB0aGlzLnNlcnZpY2VbdGhpcy5tZXRob2ROYW1lXShlZGl0aW5nUm93KTsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KfSk7DQoNCi8qKg0KICog57y655yB55qE5pu05paw5pa55rOV5pON5L2c77yM5Li76KaB55qE5Yqf6IO95piv6LCD55So5ZKM6KOF6L295pyN5Yqh5a+56LGh55qE4oCcdXBkYXRl4oCd5pa55rOV77yMDQogKiDmraTmlrnms5Xlj6rog73kvb/nlKjkuIDkuKrlr7nosaHkvZzkuLrlj4LmlbAt5Y2z5b2T5YmN55qE57yW6L6R6KGM44CCDQogKi8NCnZhciBEZWZhdWx0VXBkYXRlQWN0aW9uID0gZnVuY3Rpb24gKF9zZXJ2aWNlKSB7DQogICAgaWYgKF9zZXJ2aWNlID09IG51bGwpIHsNCiAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCLmnI3liqHnsbvkuI3og73kuLrnqbrjgIIiKTsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgc2VydmljZSBjbGFzcyBjYW4gbm90IGJlIG51bGwuIik7DQogICAgfQ0KICAgIHRoaXMuc2VydmljZSA9IF9zZXJ2aWNlOw0KICAgIHRoaXMubWV0aG9kTmFtZSA9ICd1cGRhdGUnOw0KfQ0KDQpqUXVlcnkuZXh0ZW5kKERlZmF1bHRVcGRhdGVBY3Rpb24ucHJvdG90eXBlLCB7DQogICAgdXBkYXRlQWN0aW9uIDogZnVuY3Rpb24gKGVkaXRpbmdSb3csIHRhYmxlKSB7DQogICAgICAgIC8vIHJldHVybiB0aGlzLnNlcnZpY2VbdGhpcy5tZXRob2ROYW1lXShlZGl0aW5nUm93KTsNCiAgICAgICAgdGhpcy5zZXJ2aWNlW3RoaXMubWV0aG9kTmFtZV0oZWRpdGluZ1Jvdyk7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCn0pOw0KDQoNCi8qKg0KICog5ZKM6KGo5Y2V5ZGI546w5Zmo5LiA5Lqb55u45YWz55qE6L6F5YqpIEFQSeOAgg0KICovDQp2YXIgRm9ybUVkaXRvciA9IHsNCiAgICBnZXRQYXJhbXMgOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB3aW5kb3cuX19lZGl0aW5nUGFyYW1zOw0KICAgIH0sDQoNCiAgICBpbml0IDogZnVuY3Rpb24gKGZvcm0sIGNvbmZpZykgew0KICAgICAgICB2YXIgcGFyYW1zID0gdGhpcy5nZXRQYXJhbXMoKTsNCiAgICAgICAgQmluZFV0aWxzLmJpbmQoZm9ybSwgcGFyYW1zWydlZGl0aW5nUm93J10pOw0KICAgICAgICAvLyDnu5HlrprmoKHpqozlhbPns7sNCiAgICAgICAgdmFyIHZ1ID0gbmV3IFZhbGlkYXRvcigpOw0KICAgICAgICB2dS5iaW5kQ29udGFpbmVyKGZvcm0sIHBhcmFtc1snYmluZGluZ0NsYXNzJ10pOw0KICAgICAgICByZXR1cm4gdnU7DQogICAgfQ0KfQ0KDQovKioNCiAqIOeUqOS6jueugOWMluKAnOS4uy3lrZDooajigJ3nu5PmnoTnmoTmlbDmja7lpITnkIblvJXlhaXnmoTkuIDkuKrnroDljJbnsbvjgIINCiAqIEBwYXJhbSBtYXN0ZXJUYWJsZSDkuLvooajvvIhHVGFibGXlr7nosaHvvInvvIzkuI3og73kuLrnqbrjgIINCiAqIEBwYXJhbSBsb2FkIOaVsOaNruijhei9veaOpeWPo++8jOW9ouW8j+S4uu+8mmxvYWQoc2VsZWN0ZWRSb3cpLCDov5Tlm57lgLzkuLrvvJrmlbDmja7mlbDnu4QNCiAqLw0KZnVuY3Rpb24gTWFzdGVyRGV0YWlsVGFibGUobWFzdGVyVGFibGUsIGxvYWQpIHsNCiAgICBpZiAobWFzdGVyVGFibGUgPT0gbnVsbCkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBwYXJhbWV0ZXJbbWFzdGVyVGFibGVdIGNhbiBub3QgYmUgbnVsbC4iKTsNCiAgICB9DQogICAgdGhpcy5tYXN0ZXJUYWJsZSAgPSBtYXN0ZXJUYWJsZTsNCiAgICB0aGlzLmRldGFpbFRhYmxlcyA9IHt9Ow0KICAgIHRoaXMubWFzdGVyVGFibGUuYWRkUm93U2VsZWN0aW9uTGlzdGVuZXIobmV3IE1hc3RlckRldGFpbHNSb3dTZWxlY3Rpb24gKG1hc3RlclRhYmxlLCB0aGlzLmRldGFpbFRhYmxlcywgbG9hZCkpOw0KfQ0KDQpqUXVlcnkuZXh0ZW5kKE1hc3RlckRldGFpbFRhYmxlLnByb3RvdHlwZSwgew0KICAgIC8qKg0KICAgICAqIOe7meW9k+WJjeS4u+ihqOWinuWKoOS4gOS4quWtkOihqOOAgg0KICAgICAqIEBwYXJhbSBkZXRhaWxUYWJsZSDlrZDooajvvIhHVGFibGXlr7nosaHvvInvvIzkuI3og73kuLrnqbrjgIINCiAgICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lIOWSjOWtkOihqOWvueW6lOeahOS4u+ihqOeahOe7keWumuexu+eahOWxnuaAp+WQjeensO+8iOS7o+eggeWwhuWIpOaWrei/meS4quWxnuaAp+aYr+WQpuS4uuepuu+8jOS7peehruWumuaYr+WQpuWKoOi9ve+8ieOAgg0KICAgICAqLw0KICAgIGFkZENoaWxkIDogZnVuY3Rpb24ocHJvcGVydHlOYW1lLCBkZXRhaWxUYWJsZSkgew0KICAgICAgICB0aGlzLmRldGFpbFRhYmxlc1twcm9wZXJ0eU5hbWVdID0gZGV0YWlsVGFibGU7DQogICAgfQ0KfSk7DQoNCi8vIOagueaNruW9k+WJjeeahOmAieaLqeaDheWGte+8jOWIh+aNouebuOWFs+eahOS/oeaBrw0KZnVuY3Rpb24gTWFzdGVyRGV0YWlsc1Jvd1NlbGVjdGlvbihtYXN0ZXJUYWJsZSwgZGV0YWlsVGFibGVzLCBsb2FkKSB7DQogICAgdGhpcy5tYXN0ZXJUYWJsZSAgPSBtYXN0ZXJUYWJsZTsgICAvLyDkuLvooagNCiAgICB0aGlzLmRldGFpbFRhYmxlcyA9IGRldGFpbFRhYmxlczsgIC8vIOaJgOacieWtkOihqA0KICAgIHRoaXMubG9hZCAgICAgICAgID0gbG9hZDsNCiAgICANCiAgICB0aGlzLm9uUm93U2VsZWN0aW9uID0gZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgaWYgKHRoaXMuZGV0YWlsVGFibGVzID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KCSAgICB2YXIgc2VsZWN0ZWRSb3dJbmRleCA9IGV2ZW50LnJvd0luZGV4Ow0KCQlpZiAoc2VsZWN0ZWRSb3dJbmRleCA8IDAgKXsNCgkJCS8vIOa4heepuuWOn+acieWGheWuuQ0KICAgICAgICAgICAgalF1ZXJ5LmVhY2godGhpcy5kZXRhaWxUYWJsZXMsIGZ1bmN0aW9uKHByb3BlcnR5TmFtZSwgZGV0YWlsVGFibGUpIHsNCiAgICAgICAgICAgICAgICBkZXRhaWxUYWJsZS5jbGVhcigpOw0KICAgICAgICAgICAgfSk7DQoJCSAgICByZXR1cm47DQoJCX0NCgkJdmFyIHNlbGVjdGVkVXNlciA9IG1hc3RlclRhYmxlLmdldFJvd0F0KHNlbGVjdGVkUm93SW5kZXgpOw0KICAgICAgICB2YXIgbG9hZCA9IHRoaXMubG9hZDsNCgkJLy8g5a2Q6KGo5L+h5oGvDQogICAgICAgIGpRdWVyeS5lYWNoKHRoaXMuZGV0YWlsVGFibGVzLCBmdW5jdGlvbihwcm9wZXJ0eU5hbWUsIGRldGFpbFRhYmxlKSB7DQogICAgICAgICAgICBpZiAoc2VsZWN0ZWRVc2VyW3Byb3BlcnR5TmFtZV0gPT0gbnVsbCkgew0KCQkgICAgICAgIC8vIOeUqOaIt+WumuS5ieWKoOi9veaWueW8jw0KICAgICAgICAgICAgICAgIHZhciBkYXRhID0gbG9hZChwcm9wZXJ0eU5hbWUsIHNlbGVjdGVkVXNlcik7DQoJCQkgICAgc2VsZWN0ZWRVc2VyW3Byb3BlcnR5TmFtZV0gPSBkYXRhIHx8IFtdOw0KCQkgICAgfQ0KICAgICAgICAgICAgZGV0YWlsVGFibGUucmVsb2FkKHNlbGVjdGVkVXNlcltwcm9wZXJ0eU5hbWVdKTsNCiAgICAgICAgfSk7CQkNCgl9DQp9DQoNCg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>