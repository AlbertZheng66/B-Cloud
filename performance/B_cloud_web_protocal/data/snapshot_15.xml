<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="15">
  <HTTPTask id="60" hostname="www.bc_demo1.com" path="/js/core/gt_base.js" url="http://www.bc_demo1.com:4900/js/core/gt_base.js" ip="127.0.0.1" port="4900" connectionId="15" origin="Primary" frame="1" startTime="9321449" endTime="9321512">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Accept" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>emgtY24=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovL3d3dy5iY19kZW1vMS5jb206NDkwMC9uYXYuaHRtbA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKGNvbXBhdGlibGU7IE1TSUUgOS4wOyBXaW5kb3dzIE5UIDYuMDsgVHJpZGVudC81LjAp</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>d3d3LmJjX2RlbW8xLmNvbTo0OTAw</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9qcy9jb3JlL2d0X2Jhc2UuanMgSFRUUC8xLjENCkFjY2VwdDogKi8qDQpBY2NlcHQtTGFuZ3VhZ2U6IHpoLWNuDQpSZWZlcmVyOiBodHRwOi8vd3d3LmJjX2RlbW8xLmNvbTo0OTAwL25hdi5odG1sDQpBY2NlcHQtRW5jb2Rpbmc6IGd6aXAsIGRlZmxhdGUNClVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChjb21wYXRpYmxlOyBNU0lFIDkuMDsgV2luZG93cyBOVCA2LjA7IFRyaWRlbnQvNS4wKQ0KSG9zdDogd3d3LmJjX2RlbW8xLmNvbTo0OTAwDQpDb25uZWN0aW9uOiBLZWVwLUFsaXZlDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QXBhY2hlLUNveW90ZS8xLjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Vy8iMTE5OTc1LTEzMzk3MjM2MDcwOTgi</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAxNSBKdW4gMjAxMiAwMToyNjo0NyBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTE5OTc1</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAxNSBKdW4gMjAxMiAwMTo1Mjo0MCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IEFwYWNoZS1Db3lvdGUvMS4xDQpFVGFnOiBXLyIxMTk5NzUtMTMzOTcyMzYwNzA5OCINCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMTUgSnVuIDIwMTIgMDE6MjY6NDcgR01UDQpDb250ZW50LVR5cGU6IHRleHQvamF2YXNjcmlwdA0KQ29udGVudC1MZW5ndGg6IDExOTk3NQ0KRGF0ZTogRnJpLCAxNSBKdW4gMjAxMiAwMTo1Mjo0MCBHTVQNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>DQovKioNCiAqIOm7mOiupOaDheWGteS4i++8jElFIOa1j+iniOWZqOS4jeaUr+aMgWluZGV4T2blh73mlbDvvIzlnKjmraTnu5nlhbblop7liqDkuIDkuKrjgIINCiAqDQogKi8NCmlmKCFBcnJheS5pbmRleE9mKXsNCiAgICBBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uKG9iail7DQogICAgICAgIGZvcih2YXIgaSA9IDA7IGk8IHRoaXMubGVuZ3RoOyBpKyspew0KICAgICAgICAgICAgaWYodGhpc1tpXSA9PSBvYmopew0KICAgICAgICAgICAgICAgIHJldHVybiBpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiAtMTsNCiAgICB9DQp9DQoNCmlmICghU3RyaW5nLnN0YXJ0c1dpdGgpIHsNCiAgICBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGggPSBmdW5jdGlvbihvYmopew0KICAgICAgICBpZiAob2JqID09IG51bGwgfHwgKHR5cGVvZiBvYmogIT09ICdzdHJpbmcnKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmIChvYmoubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob2JqLmxlbmd0aCA+IHRoaXMubGVuZ3RoKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICh0aGlzLnN1YnN0cmluZygwLCBvYmoubGVuZ3RoKSA9PT0gb2JqKTsNCiAgICB9DQp9DQoNCnZhciBJbnRlcmZhY2UgPSBmdW5jdGlvbihuYW1lLCBtZXRob2RzKSB7DQogICAgaWYoYXJndW1lbnRzLmxlbmd0aCAhPSAyKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigiSW50ZXJmYWNlIGNvbnN0cnVjdG9yIGNhbGxlZCB3aXRoICIgKyBhcmd1bWVudHMubGVuZ3RoICsNCiAgICAgICAgICAgICJhcmd1bWVudHMsIGJ1dCBleHBlY3RlZCBleGFjdGx5IDIuIik7DQogICAgfQ0KICAgIHRoaXMubmFtZSA9IG5hbWU7DQogICAgdGhpcy5tZXRob2RzID0gW107DQogICAgZm9yKHZhciBpID0gMCwgbGVuID0gbWV0aG9kcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KICAgICAgICBpZih0eXBlb2YgbWV0aG9kc1tpXSAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW50ZXJmYWNlIGNvbnN0cnVjdG9yIGV4cGVjdHMgbWV0aG9kIG5hbWVzIHRvIGJlICINCiAgICAgICAgICAgICAgICArICJwYXNzZWQgaW4gYXMgYSBzdHJpbmcuIik7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5tZXRob2RzLnB1c2gobWV0aG9kc1tpXSk7DQogICAgfQ0KfTsNCg0KLy8gU3RhdGljIGNsYXNzIG1ldGhvZC4NCkludGVyZmFjZS5lbnN1cmVJbXBsZW1lbnRzID0gZnVuY3Rpb24ob2JqZWN0KSB7DQogICAgaWYoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJGdW5jdGlvbiBJbnRlcmZhY2UuZW5zdXJlSW1wbGVtZW50cyBjYWxsZWQgd2l0aCAiICsNCiAgICAgICAgICAgIGFyZ3VtZW50cy5sZW5ndGggKyAiIGFyZ3VtZW50cywgYnV0IGV4cGVjdGVkIGF0IGxlYXN0IDIuIik7DQogICAgfQ0KICAgIGZvcih2YXIgaSA9IDEsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KICAgICAgICB2YXIgX2ludGVyZmFjZSA9IGFyZ3VtZW50c1tpXTsNCiAgICAgICAgaWYoX2ludGVyZmFjZS5jb25zdHJ1Y3RvciAhPT0gSW50ZXJmYWNlKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkZ1bmN0aW9uIEludGVyZmFjZS5lbnN1cmVJbXBsZW1lbnRzIGV4cGVjdHMgYXJndW1lbnRzIg0KICAgICAgICAgICAgICAgICsgInR3byBhbmQgYWJvdmUgdG8gYmUgaW5zdGFuY2VzIG9mIEludGVyZmFjZS4iKTsNCiAgICAgICAgfQ0KICAgICAgICBmb3IodmFyIGogPSAwLCBtZXRob2RzTGVuID0gX2ludGVyZmFjZS5tZXRob2RzLmxlbmd0aDsgaiA8IG1ldGhvZHNMZW47IGorKykgew0KICAgICAgICAgICAgdmFyIG1ldGhvZCA9IF9pbnRlcmZhY2UubWV0aG9kc1tqXTsNCiAgICAgICAgICAgIGlmKCFvYmplY3RbbWV0aG9kXSB8fCB0eXBlb2Ygb2JqZWN0W21ldGhvZF0gIT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkZ1bmN0aW9uIEludGVyZmFjZS5lbnN1cmVJbXBsZW1lbnRzOiBvYmplY3QgIg0KICAgICAgICAgICAgICAgICAgICArICJkb2VzIG5vdCBpbXBsZW1lbnQgdGhlICIgKyBfaW50ZXJmYWNlLm5hbWUNCiAgICAgICAgICAgICAgICAgICAgKyAiIGludGVyZmFjZS4gTWV0aG9kICIgKyBtZXRob2QgKyAiIHdhcyBub3QgZm91bmQuIik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9Ow0KDQovKioNCiAqIOWumuS5ieS6huezu+e7n+eahOmFjee9ruWPguaVsCwgIl9zYyIg5piv5YW2566A5YaZ5b2i5byP44CCDQogKi8NCnZhciBTeXN0ZW1Db25maWd1cmF0aW9uID0gX3NjID0gew0KICAgIF9wYXJhbXMgOiB7DQogICAgICAgICJmb3JtYXQuZGF0ZSIgOiAneXl5eS1NTS1kZCcgIC8vIOeUqOS6jui/m+ihjOaXpeacn+agvOW8j+WMlueahOaooeW8jw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDor7vlj5bkuIDkuKrns7vnu5/lj4LmlbDvvIzlpoLmnpzlj4LmlbDkuLrlrprkuYnvvIzliJnov5Tlm57pu5jorqTnmoTns7vnu5/lj4LmlbDjgIINCiAgICAgKi8NCiAgICByZWFkIDogZnVuY3Rpb24gKG5hbWUsIGRlZmF1bHRWYWx1ZSkgew0KICAgICAgICBpZiAobmFtZSA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKHRoaXMuX3BhcmFtc1tuYW1lXSB8fCBkZWZhdWx0VmFsdWUpOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAqIOazqOWGjOS4gOS4quezu+e7n+WPguaVsOOAgg0KICAgICovDQogICAgcmVnaXN0ZXIgOiBmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHsNCiAgICAgICAgaWYgKG5hbWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgbmFtZSBvZiBwYXJhbWV0ZXIgY2FuIG5vdCBiZSBudWxsLiIpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuX3BhcmFtc1tuYW1lXSA9IHZhbHVlOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBUT0RPOiDku47mnI3liqHlmajnq6/liqDovb3ns7vnu5/lj4LmlbDjgIINCiAgICAgKi8NCiAgICBsb2FkIDogZnVuY3Rpb24gKCkgew0KDQogICAgfQ0KDQp9DQoNCg0KLyoqDQogKiDnsbvoo4Xovb3lmajvvIzpgJrov4fmraTmlrnms5Xlr7nnsbvov5vooYzoo4Xovb0NCiAqLw0KdmFyIENsYXNzTG9hZGVyID0gew0KDQogICAgYmFzZVBhY2thZ2UgOiAnJywgIC8vIOWmguaenOexu+WQjemHh+eUqOe8qeWGme+8jOatpOS9nOS4uuWfuuehgOexu+i3r+W+hA0KDQogICAgLyoqDQogICAgICog57G76KOF6L295pyN5YqhDQogICAgICovDQogICAgY2xhc3NMb2FkZXJTZXJ2aWNlIDogJ2NvbS54dC5ndC5odG1sLnNlcnZpY2UuQ2xhc3NTZXJ2aWNlJywNCg0KICAgIC8qKg0KICAgICAqIOexu+ijhei9veaWueazlQ0KICAgICAqLw0KICAgIGNsYXNzTG9hZGVyTWV0aG9kIDogJ2xvYWRDbGFzcycsDQoNCg0KICAgIC8qKg0KICAgICAqIOWcqOWuouaIt+err+e8k+WtmOeahOexu+S/oeaBr+OAgumUruWAvOS4uuexu+eahOWFqOensO+8jOWAvOS4uuWFtuexu+aPj+i/sOOAgg0KICAgICAqLw0KICAgIGNsYXNzUG9vbCA6IHt9LA0KDQogICAgLyoqDQogICAgICog6YCa6L+H57G75ZCN56ew6L+U5Zue5LiA5Liq57G75o+P6L+w5a+56LGh44CCDQogICAgICogQHBhcmFtIGNsYXNzTmFtZSDnsbvlkI3np7DvvIjlj6/og73mmK/lhajnp7DvvIzlj6/og73mmK/nvKnlhpnvvIzpu5jorqTmmK/nvKnlhpnvvInjgIINCiAgICAgKiBAcGFyYW0gZnVsbCDmjIfnpLogY2xhc3NOYW1lIOaYr+WQpuS4uuWFqOensO+8jOi/mOaYr+e8qeWGmeOAgg0KICAgICAqLw0KICAgIGdldENsYXNzIDogZnVuY3Rpb24gKGNsYXNzTmFtZSwgZnVsbCkgew0KICAgICAgICBpZiAoY2xhc3NOYW1lID09IG51bGwgfHwgY2xhc3NOYW1lID09ICcnKSB7DQogICAgICAgICAgICAvLyDmipvlh7rnsbvmnKrlj5HnjrDlvILluLgNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUGFyYW1ldGVyIGNsYXNzTmFtZSBjYW4gbm90IGJlIGVtcHR5LiIpOw0KICAgICAgICB9DQogICAgICAgIHZhciBmdWxsTmFtZSA9IHRoaXMuZ2V0RnVsbE5hbWUoY2xhc3NOYW1lLCBmdWxsKTsNCg0KICAgICAgICB2YXIgY2xhc3NEZXNjID0gdGhpcy5jbGFzc1Bvb2xbZnVsbE5hbWVdOw0KICAgICAgICBpZiAoY2xhc3NEZXNjID09IG51bGwpIHsNCiAgICAgICAgICAgIGNsYXNzRGVzYyA9IHRoaXMubG9hZENsYXNzKGZ1bGxOYW1lKTsNCiAgICAgICAgICAgIHRoaXMuY2xhc3NQb29sW2Z1bGxOYW1lXSA9IGNsYXNzRGVzYzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gY2xhc3NEZXNjOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDov5Tlm57nsbvnmoTmjIflrprmlrnms5XnmoTmj4/ov7Dkv6Hmga/jgIINCiAgICAgKiBAcGFyYW0gY2xhc3NOYW1lIOexu+WQjeensO+8jOS4jeiDveS4uuepug0KICAgICAqIEBwYXJhbSBtZXRob2ROYW1lIOaWueazleWQjeensO+8jOS4jeiDveS4uuepug0KICAgICAqIEBwYXJhbSBmdWxsICDnsbvlkI3np7DmmK/lkKbmmK/lhajnp7ANCiAgICAgKg0KICAgICAqLw0KICAgIGdldE1ldGhvZCA6IGZ1bmN0aW9uIChjbGFzc05hbWUsIG1ldGhvZE5hbWUsIGZ1bGwpIHsNCiAgICAgICAgdmFyIGNsYXNzRGVzYyA9IHRoaXMuZ2V0Q2xhc3MoY2xhc3NOYW1lLCBmdWxsKTsNCiAgICAgICAgaWYgKG1ldGhvZE5hbWUgPT0gbnVsbCB8fCBtZXRob2ROYW1lID09ICcnKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBhcmFtZXRlciBtZXRob2ROYW1lKDIpIGNhbiBub3QgYmUgbnVsbC4iKTsNCiAgICAgICAgfQ0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNsYXNzRGVzYy5tZXRob2RzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAobWV0aG9kTmFtZSA9PT0gY2xhc3NEZXNjLm1ldGhvZHNbaV0ubmFtZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBjbGFzc0Rlc2MubWV0aG9kc1tpXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNsYXNzIFsiICsgY2xhc3NOYW1lICsgIl0gZG9lcyBub3QgY29udGFpbiBtZXRob2RbIiArIG1ldGhvZE5hbWUgKyAiXSAiKTsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIOmAmui/h+exu+WQjeensOi/lOWbnuS4gOS4quexu+WFqOi3r+W+hOWQjeensO+8iOW6lOeUqOS4reWPr+iDvemHh+eUqOe8qeWGmeaWueW8j++8ieOAgg0KICAgICAqIEBwYXJhbSBjbGFzc05hbWUg57G75ZCN56ew77yI5Y+v6IO95piv5YWo56ew77yM5Y+v6IO95piv57yp5YaZ77yM6buY6K6k5piv57yp5YaZ77yJ44CCDQogICAgICogQHBhcmFtIGZ1bGwg5oyH56S6IGNsYXNzTmFtZSDmmK/lkKbkuLrlhajnp7DvvIzov5jmmK/nvKnlhpnjgIINCiAgICAgKi8NCiAgICBnZXRGdWxsTmFtZSA6IGZ1bmN0aW9uIChjbGFzc05hbWUsIGZ1bGwpIHsNCiAgICAgICAgdmFyIGZ1bGxOYW1lID0gY2xhc3NOYW1lOw0KICAgICAgICBpZiAoZnVsbCA9PSBudWxsKSB7DQogICAgICAgICAgICAvLyDoh6rooYzliKTmlq3mmK/lkKbmmK/lhajnp7ANCiAgICAgICAgICAgIGlmICh0aGlzLmJhc2VQYWNrYWdlICE9IG51bGwgJiYgIWNsYXNzTmFtZS5zdGFydHNXaXRoKHRoaXMuYmFzZVBhY2thZ2UpKSB7DQogICAgICAgICAgICAgICAgZnVsbE5hbWUgPSB0aGlzLmJhc2VQYWNrYWdlICsgY2xhc3NOYW1lOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYoIWZ1bGwpIHsNCiAgICAgICAgICAgIGZ1bGxOYW1lID0gdGhpcy5iYXNlUGFja2FnZSArIGNsYXNzTmFtZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZnVsbE5hbWU7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOS7juacjeWKoeWZqOijhei9veS4gOS4quexu+eahOaPj+i/sOS/oeaBr+OAgg0KICAgICAqLw0KICAgIGxvYWRDbGFzcyA6IGZ1bmN0aW9uIChjbGFzc05hbWUpIHsNCiAgICAgICAgaWYgKGNsYXNzTmFtZSA9PSBudWxsIHx8IGNsYXNzTmFtZSA9PSAnJykgew0KICAgICAgICAgICAgLy8g5oqb5Ye657G75pyq5Y+R546w5byC5bi4DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBhcmFtZXRlciBjbGFzc05hbWUgY2FuIG5vdCBiZSBlbXB0eS4iKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcmVxID0gbmV3IFJlcXVlc3QoKTsNCiAgICAgICAgcmVxLnR5cGUgPSAnY29tbW9uJzsgIC8vIOmHh+eUqOmAmueUqOeahOiwg+eUqOaWueW8jw0KICAgICAgICByZXEuc2VydmljZUNsYXNzTmFtZSA9IHRoaXMuY2xhc3NMb2FkZXJTZXJ2aWNlOw0KICAgICAgICByZXEubWV0aG9kTmFtZSAgICAgICA9IHRoaXMuY2xhc3NMb2FkZXJNZXRob2Q7DQogICAgICAgIHJlcS5wYXJhbXNbMF0gICAgICAgID0gY2xhc3NOYW1lOw0KICAgICAgICB2YXIgcmVzID0gU2VydmljZUludm9rZXIuaW52b2tlKHJlcSk7DQogICAgICAgIHJldHVybiByZXM7DQogICAgfQ0KfTsNCg0KLyoqDQogKiDnlKjkuo7liJvlu7rmnI3liqHnsbvnmoTlt6XljoLjgILmraTlt6XljoLlsIbkuqfnlJ/kuIDkuKrku6PnkIblip/og73vvIzlsIbpnIDopoHosIPnlKjnmoTmnI3liqHnsbvmmKDlsITkuLrmnI3liqHlmajosIPnlKjjgIINCiAqIOi/meagt+WkhOeQhuWPr+S7peS9v+W+l+WuouaIt+err+iwg+eUqOWSjOacjeWKoeWZqOerr+eahOiwg+eUqOeahOacuueQhuS/neaMgeS4gOiHtOOAgg0KICovDQp2YXIgU2VydmljZUZhY3RvcnkgPSB7DQogICAgZ2V0U2VydmljZSA6IGZ1bmN0aW9uKGNsYXNzTmFtZSwgZnVsbCkgew0KICAgICAgICB2YXIgY2xhc3NEZXNjID0gQ2xhc3NMb2FkZXIuZ2V0Q2xhc3MoY2xhc3NOYW1lLCBmdWxsKTsgIC8vIOW+l+WIsOexu+aPj+i/sO+8jOazqOaEj+atpOWkhOeahGNsYXNzTmFtZeWPr+iDveaYr+exu+WQjeensOeahOe8qeWGmQ0KICAgICAgICB2YXIgc2VydmljZSA9IG5ldyBTZXJ2aWNlTW9jayAoY2xhc3NEZXNjLmNsYXNzTmFtZSk7DQogICAgICAgIHZhciBtZXRob2RzID0gY2xhc3NEZXNjLm1ldGhvZHM7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWV0aG9kcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdmFyIG1ldGhvZERlc2MgPSBtZXRob2RzW2ldOw0KICAgICAgICAgICAgdmFyIG1ldGhvZE5hbWUgPSBtZXRob2REZXNjLm5hbWU7DQogICAgICAgICAgICBpZiAoQW5ub3RhdGlvbkhlbHBlci5nZXRBbm5vdGF0aW9uKG1ldGhvZERlc2MsICdMb2NhbE1ldGhvZCcpICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAvLyDosIPnlKjmnKzlnLDmlrnms5UNCiAgICAgICAgICAgICAgICB2YXIgbG9jYWxNZXRob2RJbmZvID0gbmV3IExvY2FsTWV0aG9kSW5mbyhtZXRob2ROYW1lKTsNCiAgICAgICAgICAgICAgICB2YXIgbG9jYWxNZXRob2QgPSBuZXcgSW52b2tlZE1ldGhvZCAoc2VydmljZSwgbG9jYWxNZXRob2RJbmZvKTsNCiAgICAgICAgICAgICAgICBzZXJ2aWNlW21ldGhvZE5hbWVdID0gbG9jYWxNZXRob2QuaW52b2tlTG9jYWxseTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8g6LCD55So6L+Q56iL5pa55rOV77yM5aKe5Yqg5LiA5Liq5Yqo5oCB5qih5ouf77yI5Luj55CG77yJ5pa55rOVDQogICAgICAgICAgICAgICAgdmFyIG1ldGhvZFByb3h5ID0gbmV3IE1ldGhvZFByb3h5KHNlcnZpY2UsIGNsYXNzRGVzYy5jbGFzc05hbWUsIG1ldGhvZERlc2MpOw0KICAgICAgICAgICAgICAgIHNlcnZpY2VbbWV0aG9kTmFtZV0gPSBtZXRob2RQcm94eS5kb0FjdGlvbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2VydmljZTsNCiAgICB9DQp9DQoNCi8qKg0KICog5pyN5Yqh5Zmo56uv55qE6K+35rGC5a+56LGh77yM5q2k5a+56LGh5bCG5YyF6KOF5omA5pyJ55qE5pyN5Yqh57G75Y+C5pWw44CB6LCD55So5pa55rOV5ZKM5pa55rOV5Y+C5pWw44CCDQogKi8NCmZ1bmN0aW9uIFJlcXVlc3Qoc2VydmljZUNsYXNzTmFtZSwgbWV0aG9kTmFtZSwgcGFyYW1zLCBpbnZva2VkTWV0aG9kcykgew0KDQogICAgLyoqDQogICAgICog5pyN5Yqh57G755qE5ZCN56ewDQogICAgICovDQogICAgdGhpcy5zZXJ2aWNlQ2xhc3NOYW1lID0gc2VydmljZUNsYXNzTmFtZTsNCg0KICAgIC8qKg0KICAgICAqIOiwg+eUqOeahOaWueazleWQjeensA0KICAgICAqLw0KICAgIHRoaXMubWV0aG9kTmFtZSA9IG1ldGhvZE5hbWU7DQoNCiAgICB0aGlzLmludm9rZWRNZXRob2RzID0gaW52b2tlZE1ldGhvZHM7DQoNCiAgICAvLyDosIPnlKjnmoTmnKzlnLDmnI3liqHlr7nosaHmnKzouqsNCiAgICB0aGlzLnNlcnZpY2VPYmplY3QgID0gbnVsbDsNCg0KICAgIC8vIOiwg+eUqOeahOexu+Wei++8jOWPr+WPluWAvO+8mmRvd25sb2Fk77yMY29tbW9u77yMc3VibWl0RmlsZXPvvIznlKjmiLflj6/ku6XmjIflrprph4fnlKjlk6rnp43osIPnlKjmlrnlvI/vvIzlpoLmnpzmnKrmjIflrprvvIwNCiAgICAvLyDns7vnu5/lsIboh6rliqjmtYvor5Xov5nnp43mlrnlvI/jgIINCiAgICB0aGlzLnR5cGUgICAgICAgICAgID0gbnVsbDsNCg0KICAgIC8qKg0KICAgICAqIOiwg+eUqOeahOaWueazleeahOWPguaVsOWAvA0KICAgICAqLw0KICAgIGlmIChwYXJhbXMgIT0gbnVsbCAmJiBwYXJhbXMgaW5zdGFuY2VvZiBBcnJheSkgew0KICAgICAgICB0aGlzLnBhcmFtcyA9IHBhcmFtczsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLnBhcmFtcyA9IFtdOw0KICAgICAgICBpZiAocGFyYW1zICE9IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMucGFyYW1zW3RoaXMucGFyYW1zLmxlbmd0aF0gPSBwYXJhbXM7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCnZhciBSZXNwb25zZSA9IHsNCg0KICAgIC8qKg0KICAgICAqIOi/lOWbnueahOWPguaVsA0KICAgICAqLw0KICAgIHJldHVyblZhbHVlIDogbnVsbCwNCg0KDQogICAgZXhjZXB0aW9uIDogbnVsbA0KDQp9DQoNCi8qKg0KICog55So5q2k57G75qih5ouf5omA5pyJ55qE5pyN5Yqh57G75Z+656GA57G744CCDQogKi8NCmZ1bmN0aW9uIFNlcnZpY2VNb2NrKGNsYXNzTmFtZSkgew0KICAgIHRoaXMuY2xhc3NOYW1lID0gY2xhc3NOYW1lOw0KDQogICAgdGhpcy5pbnZva2VkTWV0aG9kcyA9IG5ldyBBcnJheSgpOw0KDQp9DQoNCi8qKg0KICog6KKr6LCD55So55qE5pa55rOV5Y+K5YW25Y+C5pWw55qE5bCB6KOF57G744CCDQogKi8NCmZ1bmN0aW9uIExvY2FsTWV0aG9kSW5mbyhtZXRob2ROYW1lKSB7DQogICAgdGhpcy5sb2NhbE1ldGhvZE5hbWUgPSBtZXRob2ROYW1lOw0KICAgIHRoaXMubG9jYWxQYXJhbXMgPSBuZXcgQXJyYXkoKTsNCn0NCg0KZnVuY3Rpb24gSW52b2tlZE1ldGhvZCAoc2VydmljZSwgbG9jYWxNZXRob2RJbmZvKSB7DQogICAgdGhpcy5zZXJ2aWNlICAgICAgICAgPSBzZXJ2aWNlOw0KICAgIHRoaXMubG9jYWxNZXRob2RJbmZvID0gbG9jYWxNZXRob2RJbmZvOw0KDQogICAgdGhpcy5pbnZva2VMb2NhbGx5ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIC8vIFRPRE86IOi/m+ihjOexu+Wei+i9rOaNoi4uLg0KICAgICAgICAgICAgbG9jYWxNZXRob2RJbmZvLmxvY2FsUGFyYW1zW2ldID0gYXJndW1lbnRzW2ldOw0KICAgICAgICB9DQogICAgICAgIC8vIOWJlOmZpOmHjeWkjeeahOiwg+eUqOaWueazlQ0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2VydmljZS5pbnZva2VkTWV0aG9kcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdmFyIG1ldGhvZCA9IHNlcnZpY2UuaW52b2tlZE1ldGhvZHNbaV07DQogICAgICAgICAgICBpZiAobWV0aG9kLmxvY2FsTWV0aG9kTmFtZSA9PSBsb2NhbE1ldGhvZEluZm8ubG9jYWxNZXRob2ROYW1lKSB7DQogICAgICAgICAgICAgICAgc2VydmljZS5pbnZva2VkTWV0aG9kcy5zcGxpY2UoaSwgMSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgc2VydmljZS5pbnZva2VkTWV0aG9kcy5wdXNoKGxvY2FsTWV0aG9kSW5mbyk7DQogICAgfQ0KfQ0KDQovKioNCiAqIOaooeaLn+aWueazle+8iOS7o+eQhui/nOeoi+aWueazleeahOacrOWcsOaWueazle+8ieOAgg0KICovDQpmdW5jdGlvbiBNZXRob2RQcm94eSAoc2VydmljZSwgY2xhc3NOYW1lLCBtZXRob2REZXNjKSB7DQogICAgdGhpcy5jbGFzc05hbWUgPSBjbGFzc05hbWU7DQogICAgdGhpcy5tZXRob2REZXNjID0gbWV0aG9kRGVzYzsNCiAgICB0aGlzLnNlcnZpY2UgICAgPSBzZXJ2aWNlOw0KDQogICAgdGhpcy5kb0FjdGlvbiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIHJlcSA9IG5ldyBSZXF1ZXN0KCk7DQogICAgICAgIHJlcS5zZXJ2aWNlQ2xhc3NOYW1lID0gY2xhc3NOYW1lOw0KICAgICAgICByZXEuc2VydmljZU9iamVjdCAgICA9IHNlcnZpY2U7DQogICAgICAgIC8vIFRPRE86IOajgOafpeWPguaVsA0KICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICByZXEucGFyYW1zW2ldID0gYXJndW1lbnRzW2ldOw0KICAgICAgICB9DQogICAgICAgIHJlcS5tZXRob2ROYW1lID0gbWV0aG9kRGVzYy5uYW1lOw0KDQogICAgICAgIGlmIChzZXJ2aWNlLmludm9rZWRNZXRob2RzICE9IG51bGwgJiYgc2VydmljZS5pbnZva2VkTWV0aG9kcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICByZXEuaW52b2tlZE1ldGhvZHMgPSBzZXJ2aWNlLmludm9rZWRNZXRob2RzOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8g5aSE55CGIFNlcnZpY2Ug55qE5YaF572u5Ye95pWwDQogICAgICAgIHZhciByZXQgPSBTZXJ2aWNlSW52b2tlci5pbnZva2UocmVxLCBmdW5jdGlvbihyZXNwb25zZSkgew0KICAgICAgICAgICAgdmFyIHNlcnZpY2VPYmplY3QgPSByZXNwb25zZVsic2VydmljZU9iamVjdCJdOw0KICAgICAgICAgICAgalF1ZXJ5LmV4dGVuZCh0aGlzLnNlcnZpY2UsIHNlcnZpY2VPYmplY3QpOw0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcmV0Ow0KICAgIH0NCn0NCg0KLyoqDQogKiDmnI3liqHosIPnlKjnmoTkuK3lv4PlpITnkIbnsbvjgIINCiAqLw0KdmFyIFNlcnZpY2VJbnZva2VyID0gew0KDQogICAgLyoqDQogICAgICogYWN0aW9uDQogICAgICovDQogICAgYWN0aW9uIDogX19jb250ZXh0UGF0aF9fICsgJ2pzb25DbGllbnQuYWN0aW9uJywNCg0KICAgIC8qKg0KICAgICAqDQogICAgICovDQogICAgYmFzZVVybCA6IF9fY29udGV4dFBhdGhfXyArICdqc29uQ2xpZW50LmFjdGlvbj9qc29uVmFsdWU9JywNCg0KICAgIC8qKg0KICAgICAqIOato+W4uOeahOaDheWGteS4i+aYr+S4gOS4qlJlc3BvbnNl5a+56LGh77yM5byC5bi455qE5oOF5Ya15Y+v6IO95piv5LiA5LiqRXhjZXB0aW9u77yM5YW25LuW5oOF5Ya15Li65byC5bi444CCDQogICAgICovDQogICAgcmV0IDogbnVsbCwNCg0KICAgIC8qKg0KICAgICAqIOi/lOWbnuWAvOWxnuS6jua1ge+8iElucHV0U3RyZWFt77yJ57G75Z6L55qE5ZCN56ew44CCDQogICAgICovDQogICAgc3RyZWFtVHlwZXMgOiB7DQogICAgICAgICJqYXZhLmlvLklucHV0U3RyZWFtIiA6IHRydWUsDQogICAgICAgICJqYXZhLmlvLkJ5dGVBcnJheUlucHV0U3RyZWFtIiA6IHRydWUsDQogICAgICAgICJqYXZhLmlvLkZpbGVJbnB1dFN0cmVhbSIgOiB0cnVlLA0KICAgICAgICAiamF2YS5pby5GaWx0ZXJJbnB1dFN0cmVhbSIgOiB0cnVlLA0KICAgICAgICAiamF2YS5pby5PYmplY3RJbnB1dFN0cmVhbSIgOiB0cnVlLA0KICAgICAgICAiY29tLnh0Lmd0Lmp0LnByb2MucmVzdWx0LkRvd25sb2FkZWRGaWxlSW5mbyIgOiB0cnVlLA0KICAgICAgICAiamF2YS5pby5TdHJpbmdCdWZmZXJJbnB1dFN0cmVhbSIgOiB0cnVlDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOeUqOaIt+WPr+S7peWumuS5ieS4gOWumuaVsOmHj+eahOaLpuaIquWZqChpbnRlcmNlcHRvcinvvIzlnKjmnI3liqHosIPnlKjkuYvliY3lkozkuYvlkI7ov5vooYznm7jlupTnmoQNCiAgICAgKiDkuJrliqHlpITnkIbvvIzmr5TlpoLvvJrnmbvlvZXnlKjmiLfnmoTmoKHpqozvvIzoh6rliqjnmbvlvZXnrYnnrYnjgIINCiAgICAgKi8NCiAgICAvLyBvbkludm9rZXMgICA6IFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgnaW50ZXJjZXB0b3Iub25JbnZva2VzJyksICAgIC8vIOiwg+eUqOWJjeS9v+eUqOWkhOeQhuatpOWbnuiwg+WHveaVsA0KICAgIG9uQ29tcGxldGVzIDogU3lzdGVtQ29uZmlndXJhdGlvbi5yZWFkKCdpbnRlcmNlcHRvci5vbkNvbXBsZXRlcycpLCAgLy8g5pa55rOV6LCD55So5ZCO5Zue6LCD5q2k5Ye95pWw77yI55uu5YmN5Zyo5LiL6L295ZKM5a6M5oiQ5pe25LiN6LCD55So5q2k5Ye95pWw77yJDQogICAgLy8gb25FcnJvcnMgICAgOiBTeXN0ZW1Db25maWd1cmF0aW9uLnJlYWQoJ2ludGVyY2VwdG9yLm9uRXJyb3JzJyksICAgICAvLyDplJnor6/lj5HnlJ/ml7bnmoTlm57osIPlh73mlbAo5Li76KaB5Yqo5oCB6K+75Y+WKQ0KDQogICAgLy8g57G75Z6L6L2s5o2i5Ye95pWw77yI6buY6K6k55qE6L2s5o2i5Ye95pWw5Y+q5a+55pel5pyf57G75Z6L6L+b6KGM6L2s5o2i77yM5bCG5YW26L2s5o2i5Li6MTk3MC0wMS0wMeiHs+S7iueahOavq+enkuaVsO+8iQ0KICAgIGNvbnZlcnRlciA6ICBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgew0KICAgICAgICAvLyAgTWVzc2FnZUJveC5kZWJ1Zygia2V5PSIgKyBrZXkgKyAiOyB2YWx1ZT0iICsgdmFsdWUpOw0KICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZyh2YWx1ZS5nZXRUaW1lKCkpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHZhbHVlOw0KICAgICAgICB9DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOWvueWkluiwg+eUqOeahOaOpeWPo+OAgui/meS4quaOpeWPo+WwhuWIpOaWreaYr+WQpuacieaWh+S7tuS4iuS8oO+8jOi/mOaYr+aWh+S7tuS4i+i9veOAgeaIluiAheaYr+WPquaYr+mAmuW4uOeahA0KICAgICAqIOaWueazleiwg+eUqOOAguagueaNrui/meS6m+aDheWGte+8jOiwg+eUqOebuOW6lOeahOWkhOeQhuWHveaVsOOAgg0KICAgICAqLw0KICAgIGludm9rZSA6IGZ1bmN0aW9uIChyZXF1ZXN0LCByZXNQcm9jZXNzKSB7DQogICAgICAgIHZhciB1cGxvYWRlZEZpbGVzID0gW107DQogICAgICAgIHZhciByZXRWYWx1ZSA9IG51bGw7DQogICAgICAgIHZhciB0eXBlID0gcmVxdWVzdC50eXBlOw0KDQogICAgICAgIC8vIOWkhOeQhuaLpuaIquWZqOWHveaVsA0KICAgICAgICB2YXIgX29uSW52b2tlcyA9IFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgnaW50ZXJjZXB0b3Iub25JbnZva2VzJyk7DQogICAgICAgIGlmIChfb25JbnZva2VzICE9IG51bGwgJiYgX29uSW52b2tlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgX29uSW52b2tlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIHZhciBfYnJlYWsgPSBfb25JbnZva2VzW2ldKHJlcXVlc3QpOw0KICAgICAgICAgICAgICAgIC8vIOW8lei1t+S4reaWreWQjue7reaTjeS9nA0KICAgICAgICAgICAgICAgIGlmICghIV9icmVhaykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICh0eXBlID09PSAnZG93bmxvYWQnIHx8ICh0eXBlID09IG51bGwgJiYgdGhpcy5pc0Rvd25sb2FkKHJlcXVlc3QpKSkgew0KICAgICAgICAgICAgLy8g5LiL6L295pON5L2cDQogICAgICAgICAgICB0aGlzLmRvd25sb2FkKHJlcXVlc3QsIHJlc1Byb2Nlc3MpOw0KICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdzdWJtaXRGaWxlcycgfHwgKHR5cGUgPT0gbnVsbCAmJiB0aGlzLl9oYXNBdHRhY2htZW50KHJlcXVlc3QucGFyYW1zLCB1cGxvYWRlZEZpbGVzKSkpIHsNCiAgICAgICAgICAgIC8vIOW4puaciemZhOS7tueahOaPkOS6pOaTjeS9nA0KICAgICAgICAgICAgcmV0VmFsdWUgPSAgdGhpcy5pbnZva2VXaXRoQXR0YWNobWVudHMocmVxdWVzdCwgdXBsb2FkZWRGaWxlcywgcmVzUHJvY2Vzcyk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyDlhbbku5bpgJrnlKjosIPnlKjmlrnlvI8NCiAgICAgICAgICAgIHJldFZhbHVlID0gdGhpcy5faW52b2tlMChyZXF1ZXN0LCByZXNQcm9jZXNzKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmV0VmFsdWU7DQogICAgfSwNCg0KDQogICAgLyoqDQogICAgICog5ZCR5pyN5Yqh5Zmo56uv5Y+R6YCB5aSE55CG6K+35rGC77yM5q2k5Y+R6YCB6YeH55So5ZCM5q2l5pa55byP6L+b6KGM5aSE55CG44CCDQogICAgICogQHBhcmFtIHJlc1Byb2Nlc3Mg57uT5p6c5aSE55CG5Ye95pWwDQogICAgICogQHBhcmFtIHJlcXVlc3QgcmVxIOWvueixoe+8jOivt+axguWPguaVsOS4jeiDveS4uuepuuOAgg0KICAgICAqLw0KICAgIF9pbnZva2UwIDogZnVuY3Rpb24gKHJlcXVlc3QsIHJlc1Byb2Nlc3MpIHsNCiAgICAgICAgdmFyIF91cmwgPSB0aGlzLmNyZWF0ZVVSTCh0aGlzLmJhc2VVcmwsIHJlcXVlc3QpOw0KICAgICAgICBqUXVlcnkuYWpheCh7DQogICAgICAgICAgICB1cmw6IF91cmwsDQogICAgICAgICAgICB0eXBlOiAnUE9TVCcsDQogICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLA0KICAgICAgICAgICAgY2FjaGUgOiBmYWxzZSwNCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwNCiAgICAgICAgICAgIC8vIHRpbWVvdXQ6IDEwMDAsDQogICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24ocmVxdWVzdCwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRXJyb3IgbG9hZGluZyBKU09OIGRvY3VtZW50JywgZXJyb3JUaHJvd24gfHwgdGV4dFN0YXR1cyk7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oanNvblRleHQpIHsNCiAgICAgICAgICAgICAgICBTZXJ2aWNlSW52b2tlci5yZXNwb25zZSA9IGpzb25UZXh0Ow0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNvbXBsZXRlIDogZnVuY3Rpb24gKHJlcXVlc3QsIHRleHRTdGF0dXMpIHsNCiAgICAgICAgICAgIC8vIGFsZXJ0KCdjb21wbGV0ZSB0ZXh0U3RhdHVzPScgKyB0ZXh0U3RhdHVzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8NCiAgICAgICAgdmFyIHJldFZhbHVlID0gdGhpcy5wcm9jZXNzUmVzcG9uc2UocmVxdWVzdCwgdGhpcy5yZXNwb25zZSwgcmVzUHJvY2Vzcyk7DQoNCiAgICAgICAgLy8g5aSE55CG5oum5oiq5Zmo5Ye95pWwDQogICAgICAgIGlmICh0aGlzLm9uQ29tcGxldGVzICE9IG51bGwgJiYgdGhpcy5vbkNvbXBsZXRlcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5vbkNvbXBsZXRlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIHRoaXMub25Db21wbGV0ZXNbaV0ocmVxdWVzdCwgcmV0VmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygncmV0VmFsdWU9JywgcmV0VmFsdWUpOw0KDQogICAgICAgIHJldHVybiByZXRWYWx1ZTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5aSE55CG57uT5p6cDQogICAgICovDQogICAgcHJvY2Vzc1Jlc3BvbnNlIDogZnVuY3Rpb24gKHJlcXVlc3QsIHJlc3BvbnNlLCByZXNQcm9jZXNzKSB7DQogICAgICAgIGlmIChyZXNwb25zZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSByZXNwb25zZSBjYW4gbm90IGJlIG51bGwuIik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHJlc3BvbnNlWydfX2NsYXNzTmFtZSddICE9ICdjb20ueHQucHJveHkuZXZlbnQuUmVzcG9uc2UnKSB7DQogICAgICAgICAgICBTZXJ2aWNlSW52b2tlci5wcm9jZXNzU2VydmVyRXJyb3IocmVxdWVzdCwgcmVzcG9uc2UpOw0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICAvLyDlpoLmnpzlrprkuYnkuobnu5PmnpzlpITnkIblh73mlbDvvIzliJnlj6/ku6XlhYjooYzov5vooYzlpITnkIYNCiAgICAgICAgaWYgKHJlc1Byb2Nlc3MgIT0gbnVsbCkgew0KICAgICAgICAgICAgcmVzUHJvY2VzcyhyZXNwb25zZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBNZXNzYWdlQm94LmRlYnVnKCcxMTExMTExMTExMTExMTExPScsICJlcnJvciIpOw0KICAgICAgICAvLyDlpI3liLbmnKzlnLDlj5jph4/nmoTlgLzvvIjph4fnlKjlgLzlpI3liLbnmoTmlrnlvI/vvIzkuI3lpI3liLbmlrnms5XvvIkNCiAgICAgICAgaWYgKHJlcXVlc3QgIT0gbnVsbCAmJiByZXNwb25zZSAhPSBudWxsKSB7DQogICAgICAgICAgICBVdGlscy52YWx1ZUNvcHkocmVzcG9uc2Uuc2VydmljZU9iamVjdCwgcmVxdWVzdC5zZXJ2aWNlT2JqZWN0KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciByZXRWYWx1ZSA9IHJlc3BvbnNlLnJldHVyblZhbHVlOw0KDQogICAgICAgIC8vIOWvueWAvOi/m+ihjOi9rOaNog0KICAgICAgICByZXRWYWx1ZSA9IFNlcnZpY2VJbnZva2VyLnJlc3BvbnNlQ29udmVydChyZXRWYWx1ZSk7DQogICAgICAgIC8vIE1lc3NhZ2VCb3guZGVidWcoJ3JldFZhbHVlPScsIHJldFZhbHVlKTsNCg0KICAgICAgICByZXR1cm4gcmV0VmFsdWU7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOWkhOeQhuacjeWKoeWZqOerr+WPkeWbnueahOW8guW4uOS/oeaBrw0KICAgICAqLw0KICAgIHByb2Nlc3NTZXJ2ZXJFcnJvciA6IGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlKSB7DQogICAgICAgIC8vIOW8guW4uOWkhOeQhg0KICAgICAgICAvLyB2YXIgbXNnID0gIlRoZSBleGNlcHRpb24gd2FzIHRocm93biBieSB0aGUgc2VydmVyLiI7DQogICAgICAgIC8vIG1zZyArPSAnfHwnICsgcmVzcG9uc2VbJ3ZhbHVlJ107DQogICAgICAgIC8vIGFsZXJ0KCdKU09OLnN0cmluZ2lmeShyZXNwb25zZSk9JyArICBKU09OLnN0cmluZ2lmeShyZXNwb25zZSkpOw0KICAgICAgICB2YXIgZXJyb3IgPSBudWxsOw0KICAgICAgICBpZiAocmVzcG9uc2UpIHsNCiAgICAgICAgICAgIHZhciBjb2RlID0gRXJyb3JNYW5hZ2VyLnByZWZpeCArIElkR2VuZXJhdG9yLmdldElkKCk7DQogICAgICAgICAgICBFcnJvck1hbmFnZXIucmVnaXN0ZXIoY29kZSwgcmVzcG9uc2UpOw0KICAgICAgICAgICAgZXJyb3IgPSBuZXcgRXJyb3IoY29kZSk7DQogICAgICAgICAgICBlcnJvci5kZXNjcmlwdGlvbiA9IGNvZGU7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB2YXIgbXNnID0gIlRoZSBleGNlcHRpb24gd2FzIHRocm93biBieSB0aGUgc2VydmVyLiI7DQogICAgICAgICAgICBlcnJvciA9IG5ldyBFcnJvcihtc2cpOw0KICAgICAgICAgICAgZXJyb3IuZGVzY3JpcHRpb24gPSBtc2c7DQogICAgICAgIH0NCiAgICAgICAgDQoNCiAgICAgICAgdmFyIGNvbnN1bWVkID0gZmFsc2U7ICAvLyDlvILluLjmmK/lkKbooqvlpITnkIYNCiAgICAgICAgLy8g5Yqo5oCB5aSE55CG5byC5bi45o2V6I635Ye95pWwDQogICAgICAgIHZhciBfb25FcnJvcnMgPSBTeXN0ZW1Db25maWd1cmF0aW9uLnJlYWQoJ2ludGVyY2VwdG9yLm9uRXJyb3JzJyk7DQogICAgICAgIC8vIE1lc3NhZ2VCb3guZGVidWcoJ19vbkVycm9ycz0nLCBfb25FcnJvcnMpOw0KICAgICAgICBpZiAoX29uRXJyb3JzICE9IG51bGwgJiYgX29uRXJyb3JzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX29uRXJyb3JzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgY29uc3VtZWQgPSAhIV9vbkVycm9yc1tpXShlcnJvciwgcmVxdWVzdCwgcmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgIGlmIChjb25zdW1lZCkgew0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gYWxlcnQoJ3Byb2Nlc3NSZXNwb25zZT0nICsgZXJyb3Iuc3RhY2tUcmFjZSk7DQogICAgICAgIGVycm9yLmNvbnN1bWVkID0gY29uc3VtZWQ7ICAvLyDmoIfor4blh7rmraTplJnor6/lt7Lnu4/lpITnkIYNCiAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygncHJvY2Vzc1NlcnZlckVycm9yPScsIGVycm9yKTsNCiAgICAgICAgdGhyb3cgZXJyb3I7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOagueaNrue7meWumueahOivt+axguWIm+W7uuS4gOS4qlVSTO+8jOatpCBVUkwg56ym5ZCIanNvbuivt+axgueahOagh+WHhuOAgg0KICAgICAqLw0KICAgIGNyZWF0ZVVSTCA6IGZ1bmN0aW9uIChiYXNlVXJsLCByZXF1ZXN0KSB7DQogICAgICAgIGlmIChyZXF1ZXN0ID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUGFyYW1ldGVyKDIpIHJlcXVlc3QgY2FuIG5vdCBiZSBudWxsLiIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8g6L+b6KGM5Ye95pWw6L2s5o2iDQogICAgICAgIHJlcXVlc3QucGFyYW1zID0gdGhpcy5yZXF1ZXN0Q29udmVydChyZXF1ZXN0LnBhcmFtcyk7DQogICAgICAgIGlmIChyZXF1ZXN0LnBhcmFtcyA9PSBudWxsKSB7DQogICAgICAgICAgICByZXF1ZXN0LnBhcmFtcyA9IFtdOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gY29udmVydCByZXF1ZXN0IG9iamVjdCB0byBqc29uIHN0cmluZw0KICAgICAgICB2YXIgcmVxdWVzdEpTT05UZXh0ID0gSlNPTi5zdHJpbmdpZnkocmVxdWVzdCwgdGhpcy5jb252ZXJ0ZXIpOw0KDQogICAgICAgIC8vIG1ha2UgYSBzZXJ2aWNlIGNhbGwNCiAgICAgICAgLy8gVE9ETzog5aaC5p6cIFVSTCDov4fplb/lsIblr7zoh7Tor7fmsYLlpLHotKXvvIHvvIHvvIENCiAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygndGhpcy5iYXNlVXJsPScgKyB0aGlzLmJhc2VVcmwgKyByZXF1ZXN0SlNPTlRleHQpOw0KICAgICAgICBpZiAoYmFzZVVybCA9PSBudWxsKSB7DQogICAgICAgICAgICBiYXNlVXJsID0gdGhpcy5iYXNlVXJsOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBiYXNlVXJsICsgcmVxdWVzdEpTT05UZXh0Ow0KICAgIH0sDQoNCiAgICAvLw0KICAgIGludm9rZU1ldGhvZCA6IGZ1bmN0aW9uKGNsYXNzTmFtZSwgbWV0aG9kTmFtZSkgew0KICAgICAgICBpZiAoY2xhc3NOYW1lID09IG51bGwgfHwgbWV0aG9kTmFtZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aHJvdyAi5pyN5Yqh57G75ZKM5pa55rOV5ZCN56ew6YO95LiN6IO95Li656m644CCIjsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcmVxID0gbmV3IFJlcXVlc3QoKTsNCiAgICAgICAgcmVxLnNlcnZpY2VDbGFzc05hbWUgPSBjbGFzc05hbWU7DQogICAgICAgIHJlcS5tZXRob2ROYW1lID0gbWV0aG9kTmFtZTsNCiAgICAgICAgZm9yKHZhciBpID0gMjsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgcmVxLnBhcmFtc1tpIC0gMl0gPSBhcmd1bWVudHNbaV07DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMuaW52b2tlKHJlcSk7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOWPguaVsOS4reWtmOWcqOmZhOS7tueahOaDheWGtQ0KICAgICAqLw0KICAgIGludm9rZVdpdGhBdHRhY2htZW50cyA6IGZ1bmN0aW9uIChyZXF1ZXN0LCB1cGxvYWRlZEZpbGVzLCByZXNQcm9jZXNzKSB7DQogICAgICAgIHZhciBhamF4VXBsb2FkID0gbnVsbDsgIC8vIOesrOS4gOS4quaWh+S7tuS9nOS4uuaPkOS6pOeUqOeahOaOp+S7tg0KICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdXBsb2FkZWRGaWxlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGFqYXhVcGxvYWQgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGFqYXhVcGxvYWQgPSB1cGxvYWRlZEZpbGVzW2ldLmFqYXhVcGxvYWQ7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGFqYXhVcGxvYWQuYXBwZW5kKHVwbG9hZGVkRmlsZXNbaV0uYWpheFVwbG9hZCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8g5ZCI5bm25aSa5LiqQWpheFVwbG9hZGVyDQogICAgICAgIHZhciBqc29uVmFsdWUgPSBTZXJ2aWNlSW52b2tlci5jcmVhdGVVUkwoJycsIHJlcXVlc3QpOw0KICAgICAgICBhamF4VXBsb2FkLnNldERhdGEoew0KICAgICAgICAgICAgJ2pzb25WYWx1ZSc6IGpzb25WYWx1ZQ0KICAgICAgICB9KTsNCiAgICAgICAgYWpheFVwbG9hZC5zZXRPcHRpb24oJ3Jlc3BvbnNlVHlwZScsICdqc29uJyk7DQogICAgICAgIHZhciBwcm9jZXNzUmVzcG9uc2UgPSB0aGlzLnByb2Nlc3NSZXNwb25zZTsNCiAgICAgICAgVXRpbHMucnVuKGZ1bmN0aW9uKCkgew0KDQogICAgICAgICAgICAvLyBNZXNzYWdlQm94LmRlYnVnKCdyZXF1ZXN0LnNlcnZpY2VPYmplY3QnLCByZXF1ZXN0LnNlcnZpY2VPYmplY3Qub25Db21wbGV0ZSk7DQogICAgICAgICAgICBpZiAocmVxdWVzdC5zZXJ2aWNlT2JqZWN0Lm9uQ29tcGxldGUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHZhciBfb25Db21wbGV0ZSA9IHJlcXVlc3Quc2VydmljZU9iamVjdC5vbkNvbXBsZXRlOw0KICAgICAgICAgICAgICAgIGFqYXhVcGxvYWQuc2V0T25Db21wbGV0ZShmdW5jdGlvbiAoZmlsZSwgcmVzcG9uc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygncmVzcG9uc2U9JyArIHJlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHJldFZhbHVlID0gcHJvY2Vzc1Jlc3BvbnNlKHJlcXVlc3QsIHJlc3BvbnNlLCByZXNQcm9jZXNzKTsgIC8vIOWFiOWkhOeQhue7k+aenA0KICAgICAgICAgICAgICAgICAgICAvLyBNZXNzYWdlQm94LmRlYnVnKCJyZXRWYWx1ZT0iLCByZXRWYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIF9vbkNvbXBsZXRlKHJldFZhbHVlKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYWpheFVwbG9hZC5zdWJtaXQoKTsNCg0KICAgICAgICAgICAgLy8g5o+Q5Lqk57uT5p2f5ZCO6ZyA6KaB5bCG5LiK5Lyg5paH5Lu25riF55CG5LiA5LiLDQogICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCB1cGxvYWRlZEZpbGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGFqYXhVcGxvYWQgIT0gdXBsb2FkZWRGaWxlc1tpXSkgew0KICAgICAgICAgICAgICAgICAgICB1cGxvYWRlZEZpbGVzW2ldLnJlc2V0KCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYWpheFVwbG9hZC5yZXNldFZhbHVlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsgIC8vIGVuZCBvZiBVdGlscy5ydW4NCiAgICAvL3RoaXMub25Db21wbGV0ZSA9IG51bGw7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOebtOaOpeS9v+eUqOS4iuS8oOW3suWumuS5ieeahEZvcm3moIfnrb7kuIrkvKANCiAgICAgKiBAZGVwcmVjaWF0ZWQNCiAgICAgKi8NCiAgICBzdWJtaXRGaWxlcyA6IGZ1bmN0aW9uIChmb3JtLCBzZXJ2aWNlQ2xhc3NOYW1lLCBtZXRob2ROYW1lLCBwYXJhbXMpIHsNCiAgICAgICAgaWYgKGZvcm0gPT0gbnVsbCB8fCBfY3JlYXRlSlF1ZXJ5KGZvcm0pLmxlbmd0aCA9PSAwKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBhcmFtZXRlciBmb3JtKDEpIGNhbiBub3QgYmUgbnVsbC4iKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2VydmljZUNsYXNzTmFtZSA9PSBudWxsIHx8IG1ldGhvZE5hbWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQYXJhbWV0ZXJzIHNlcnZpY2VDbGFzc05hbWUoMikgYW5kIG1ldGhvZE5hbWUoMykgY2FuIG5vdCBiZSBudWxsLiIpOw0KICAgICAgICB9DQogICAgICAgIHZhciBfZm9ybSA9ICBfY3JlYXRlSlF1ZXJ5KGZvcm0pOw0KDQogICAgICAgIC8vIOajgOafpeS4gOS4i+e8lueggeexu+Wei++8jOayoeacieeahOivneWwhuWFtuiHquWKqOihpeWFhQ0KICAgICAgICB2YXIgZW5jdHlwZSA9IF9mb3JtLmF0dHIoJ2VuY3R5cGUnKTsNCiAgICAgICAgaWYgKGVuY3R5cGUgPT0gbnVsbCB8fCBlbmN0eXBlID09ICcnIC8qfHwgJ211bHRpcGFydC9mb3JtLWRhdGEnICE9IGZvcm0uYXR0cignZW5jdHlwZScpLnRvTG93ZXJDYXNlKCkqLykgew0KICAgICAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCJmb3JtIGF0dHJpYnV0ZSAiKTsNCiAgICAgICAgICAgIF9mb3JtLmF0dHIoJ2VuY3R5cGUnLCAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScpOw0KICAgICAgICB9DQoNCiAgICAgICAgX2Zvcm0uYXR0cignYWN0aW9uJywgdGhpcy5hY3Rpb24pOw0KICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KCk7DQogICAgICAgIHJlcXVlc3Quc2VydmljZUNsYXNzTmFtZSA9IENsYXNzTG9hZGVyLmdldEZ1bGxOYW1lKHNlcnZpY2VDbGFzc05hbWUpOw0KICAgICAgICByZXF1ZXN0Lm1ldGhvZE5hbWUgICAgICAgPSBtZXRob2ROYW1lOw0KICAgICAgICByZXF1ZXN0LnBhcmFtcyAgICAgICAgICAgPSBwYXJhbXMgfHwgW107DQogICAgICAgIHZhciBqc29uVmFsdWUgPSB0aGlzLmNyZWF0ZVVSTCgnJywgcmVxdWVzdCk7DQogICAgICAgIC8vIOimgeWIpOaWreS4gOS4i+i/meS4quiKgueCueaYr+WQpuW3sue7j+WtmOWcqA0KICAgICAgICBqUXVlcnkoIjxpbnB1dCB0eXBlPSdoaWRkZW4nIG5hbWU9J2pzb25WYWx1ZScgLz4iKS5hcHBlbmRUbyhfZm9ybSkudmFsKGpzb25WYWx1ZSk7DQogICAgICAgIF9mb3JtLnN1Ym1pdCgpOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDliKTmlq3kuIDkuKror7fmsYLkuK3mmK/lkKbmnInpmYTku7bvvIjkuIrkvKDmlofku7bvvInjgIINCiAgICAgKi8NCiAgICBfaGFzQXR0YWNobWVudCA6IGZ1bmN0aW9uIChvYmosIHVwbG9hZGVkRmlsZXMpIHsNCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgVXBsb2FkZWRGaWxlKSB7DQogICAgICAgICAgICB1cGxvYWRlZEZpbGVzLnB1c2gob2JqKTsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIEFycmF5KSB7DQogICAgICAgICAgICB2YXIgZmxhZyA9IGZhbHNlOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gdGhpcy5faGFzQXR0YWNobWVudChvYmpbaV0sIHVwbG9hZGVkRmlsZXMpOw0KICAgICAgICAgICAgICAgIGZsYWcgPSBmbGFnIHx8IHJldDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmbGFnOw0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmogPT09ICdvYmplY3QnKSB7DQogICAgICAgICAgICAvLyDph4fnlKjpgJLlvZLmn6Xmib7mlrnlvI8oVE9ETzog6ZyA6KaB5pyJ6YCS5b2S5qyh5pWw6ZmQ5Yi2KQ0KICAgICAgICAgICAgdmFyIF9mbGFnID0gZmFsc2U7DQogICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIG9iaikgew0KICAgICAgICAgICAgICAgIHZhciBfcmV0ID0gdGhpcy5faGFzQXR0YWNobWVudChvYmpbcHJvcF0sIHVwbG9hZGVkRmlsZXMpOw0KICAgICAgICAgICAgICAgIF9mbGFnID0gZmxhZyB8fCBfcmV0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIF9mbGFnOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5bCG6K+35rGC6L+b6KGM5pWw5o2u57uT5p6E55qE6L2s5o2i77yI5a6i5oi356uvLS0+5pyN5Yqh5Zmo77yJ44CCDQogICAgICogVE9ETzrmraTpgJLlvZLpnIDopoHmnInpgJLlvZLlsYLmrKHpmZDliLbvvIzpgb/lhY3lvJXotbfmrbvlvqrnjq/jgIINCiAgICAgKi8NCiAgICByZXF1ZXN0Q29udmVydCA6IGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgaWYgKG9iaiA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICAvLyDln7rmnKznsbvlnovml6DpobvovazmjaINCiAgICAgICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnKSB7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8g5pWw57uE57G75Z6L6KaB6YCQ5LiA6L2s5o2iDQogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBBcnJheSkgew0KICAgICAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIHZhciBuZXdBcnJheSA9IFtdOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IG9ialtpXTsNCiAgICAgICAgICAgICAgICBuZXdBcnJheVtpXSA9IHRoaXMucmVxdWVzdENvbnZlcnQoZWxlbSk7DQogICAgICAgICAgICAgICAgY2hhbmdlZCA9IGNoYW5nZWQgfHwgKG5ld0FycmF5W2ldID09PSBlbGVtKTsgIC8vIOWIpOaWreS4gOS4i+aYr+WQpuecn+ato+aUueWPmA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gcmV0dXJuIChjaGFuZ2VkID8gbmV3QXJyYXkgOiBvYmopOw0KICAgICAgICAgICAgcmV0dXJuIG5ld0FycmF5Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29iakNvbnZlcnQob2JqKTsNCiAgICAgICAgfQ0KICAgIH0sDQoNCiAgICBfb2JqQ29udmVydCA6IGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIERhdGUpIHsNCiAgICAgICAgICAgIHJldHVybiAiIiArIG9iai5nZXRUaW1lKCk7DQogICAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgVXBsb2FkZWRGaWxlKSB7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIHByb3BlcnR5TmFtZSA6IG9iai5wcm9wZXJ0eU5hbWUsDQogICAgICAgICAgICAgICAgZmlsZU5hbWUgOiBvYmouaW5wdXQudmFsKCkNCiAgICAgICAgICAgIH07DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB2YXIgY29udmVydGVkT2JqID0gbmV3IE9iamVjdCgpOw0KICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBvYmopIHsNCiAgICAgICAgICAgICAgICB2YXIgY29udmVydGVkUHJvcCA9IHRoaXMucmVxdWVzdENvbnZlcnQob2JqW3Byb3BdKTsNCiAgICAgICAgICAgICAgICBjb252ZXJ0ZWRPYmpbcHJvcF0gPSBjb252ZXJ0ZWRQcm9wOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGNvbnZlcnRlZE9iajsNCiAgICAgICAgfQ0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDlsIblk43lupTov5vooYzovazmjaLvvIjmnI3liqHlmagtLT7lrqLmiLfnq6/vvInnmoTmlbDmja7nu5PmnoTnmoTovazmjaINCiAgICAgKi8NCiAgICByZXNwb25zZUNvbnZlcnQgOiBmdW5jdGlvbiAob2JqKSB7DQogICAgICAgIC8vIOWfuuacrOexu+Wei+aXoOmhu+i9rOaNog0KICAgICAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcpIHsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgIH0NCiAgICAgICAgLy8g5pWw57uE57G75Z6L6KaB6YCQ5LiA6L2s5o2iDQogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBBcnJheSkgew0KICAgICAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIHZhciBuZXdBcnJheSA9IFtdOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvYmoubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IG9ialtpXTsNCiAgICAgICAgICAgICAgICBuZXdBcnJheVtpXSA9IHRoaXMucmVzcG9uc2VDb252ZXJ0KGVsZW0pOw0KICAgICAgICAgICAgICAgIGNoYW5nZWQgPSBjaGFuZ2VkIHx8IChuZXdBcnJheVtpXSA9PT0gZWxlbSk7ICAvLyDliKTmlq3kuIDkuIvmmK/lkKbnnJ/mraPmlLnlj5gNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIHJldHVybiAoY2hhbmdlZCA/IG5ld0FycmF5IDogb2JqKTsNCiAgICAgICAgICAgIHJldHVybiBuZXdBcnJheTsNCiAgICAgICAgfSBlbHNlIGlmIChvYmpbJ19fY2xhc3NOYW1lJ10gIT0gbnVsbCl7DQogICAgICAgICAgICAvLyDooajnpLrov5nmmK/kuIDkuKrnuq/nsrnnmoQgSmF2YSDnsbsNCiAgICAgICAgICAgIHZhciBfX2NsYXNzTmFtZSA9IG9ialsnX19jbGFzc05hbWUnXTsNCiAgICAgICAgICAgIC8vIOaJvuWIsOi9rOaNouWHveaVsO+8jOazqOaEj++8muWPquacieeJueWumueahOexu+Wei+mcgOimgei9rOaNou+8iOWNs+azqOWGjOS6hueahOexu+Wei++8iQ0KICAgICAgICAgICAgdmFyIGNvbnZlcnRlciA9IENvbnZlcnRlckZhY3RvcnkuZ2V0Q29udmVydGVyKF9fY2xhc3NOYW1lKTsNCiAgICAgICAgICAgIGlmIChjb252ZXJ0ZXIgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBjb252ZXJ0ZXIuY29udmVydChvYmopOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydDAob2JqKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0MChvYmopOw0KICAgICAgICB9DQogICAgfSwNCg0KICAgIF9jb252ZXJ0MCA6IGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgdmFyIF9jaGFuZ2VkID0gZmFsc2U7DQogICAgICAgIHZhciBjb252ZXJ0ZWRPYmogPSBuZXcgT2JqZWN0KCk7DQogICAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqKSB7DQogICAgICAgICAgICB2YXIgY29udmVydGVkUHJvcCA9IHRoaXMucmVzcG9uc2VDb252ZXJ0KG9ialtwcm9wXSk7DQogICAgICAgICAgICBfY2hhbmdlZCA9IF9jaGFuZ2VkIHx8IChjb252ZXJ0ZWRQcm9wID09PSBvYmpbcHJvcF0pOyAgLy8g5Yik5pat5LiA5LiL5piv5ZCm55yf5q2j5pS55Y+YDQogICAgICAgICAgICBjb252ZXJ0ZWRPYmpbcHJvcF0gPSBjb252ZXJ0ZWRQcm9wOw0KICAgICAgICB9DQogICAgICAgIC8vIHJldHVybiAoX2NoYW5nZWQgPyBjb252ZXJ0ZWRPYmogOiBvYmopOw0KICAgICAgICByZXR1cm4gY29udmVydGVkT2JqOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDliKTmlq3kuIDkuKror7fmsYLmmK/kuI3mmK/kuIvovb3lh73mlbDjgILliKTmlq3nmoTop4TliJnmmK/vvIzlpoLmnpzkuIDkuKrmlrnms5XnmoTov5Tlm57lgLzmmK/vvJpJbnB1dFN0cmVhbSDlj4rlhbblrZDnsbvvvIjnlKjmiLflj6/oh6rooYzlrprkuYnvvInvvIwNCiAgICAgKiDliJnorqTkuLrmraTmlrnms5XkuLrov5Tlm57kuIDkuKrkuIvovb3mtYHjgIINCiAgICAgKi8NCiAgICBpc0Rvd25sb2FkIDogZnVuY3Rpb24gKHJlcXVlc3QpIHsNCiAgICAgICAgaWYgKHJlcXVlc3QgPT0gbnVsbCB8fCByZXF1ZXN0LnNlcnZpY2VDbGFzc05hbWUgPT0gbnVsbCB8fCByZXF1ZXN0Lm1ldGhvZE5hbWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIHZhciBtZXRob2REZXNjID0gQ2xhc3NMb2FkZXIuZ2V0TWV0aG9kKHJlcXVlc3Quc2VydmljZUNsYXNzTmFtZSwgcmVxdWVzdC5tZXRob2ROYW1lLCB0cnVlKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtVHlwZXNbbWV0aG9kRGVzYy5yZXR1cm5UeXBlXTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5L2/55So5byC5q2l5pa55byP5LiL6L295paH5Lu244CCDQogICAgICovDQogICAgZG93bmxvYWQgOiBmdW5jdGlvbiAocmVxdWVzdCwgcmVzUHJvY2Vzcykgew0KICAgICAgICB2YXIgcmVxdWVzdEpTT05UZXh0ID0gSlNPTi5zdHJpbmdpZnkocmVxdWVzdCwgdGhpcy5jb252ZXJ0ZXIpOw0KICAgICAgICB2YXIgaWZyYW1lID0gdGhpcy5fY3JlYXRlSWZyYW1lKCk7DQogICAgICAgIHZhciBwcm9jZXNzID0gdGhpcy5wcm9jZXNzUmVzcG9uc2U7DQogICAgICAgIGpRdWVyeShpZnJhbWUpLmJpbmQoJ2xvYWQnLCBmdW5jdGlvbiAoKXsNCiAgICAgICAgICAgIHZhciByZXRWYWx1ZSA9IHRoaXMuY29udGVudERvY3VtZW50LmJvZHkudGV4dENvbnRlbnQNCiAgICAgICAgICAgIHx8IHRoaXMuY29udGVudERvY3VtZW50LmJvZHkub3V0ZXJUZXh0Ow0KICAgICAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygnZG93bmxvYWQgcmV0VmFsdWU9JywgcmV0VmFsdWUpOw0KICAgICAgICAgICAgLy8gVE9ETzog5bqU6K+l5LuU57uG6ICD6JmR5aaC5p6c6L+U5Zue55qE5LiN5piv5ZCI5rOV55qEIEpTT04g5a2X56ym5LiyDQogICAgICAgICAgICAvLyDlr7nlk43lupTku6PnoIHov5vooYzliKTmlq0NCiAgICAgICAgICAgIFV0aWxzLnJ1bihmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBudWxsOw0KICAgICAgICAgICAgICAgIGlmIChyZXRWYWx1ZSAhPT0gdW5kZWZpbmVkDQogICAgICAgICAgICAgICAgICAgICYmIHJldFZhbHVlICE9PSAnJyAmJiByZXRWYWx1ZS5zdGFydHNXaXRoKCJ7IikpIHsNCiAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IEpTT04ucGFyc2UocmV0VmFsdWUpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZihyZXRWYWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IG5ldyBFcnJvcignVGhlIHJldHVybiB2YWx1ZSBkbyBub3QgZGVmaW5lLicpOw0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5kZXNjcmlwdGlvbiA9IHJldFZhbHVlOw0KICAgICAgICAgICAgICAgIH0NCgkJLy8g5q2j5bi45pe25rKh5pyJ6L+U5Zue57uT5p6c77yM5Y+q5pyJ5pyN5Yqh5Zmo56uv5Y+R55Sf5byC5bi45pe26L+U5Zue57uT5p6c77yM5omN6ZyA6KaB5L2/55So5aSE55CG5Ye95pWwDQoJCWlmIChyZXNwb25zZSkgew0KICAgICAgICAgICAgICAgICAgICBwcm9jZXNzKHJlcXVlc3QsIHJlc3BvbnNlLCByZXNQcm9jZXNzKTsNCgkJfQ0KICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoaWZyYW1lKTsNCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIC8vIEZJWE1FOiDmmK/lkKblh7rplJnpg73opoHnp7vpmaTmraRGcmFtZT8h5LiN56e76Zmk55qE6K+d5piv5ZCm5Lya5Lqn55Sf5YaF5a2Y5rOE5ryPDQogICAgICAgICAgICAgICAgLy8gYWxlcnQoJ2ZpbmFsbHkuLjU1NTU1NTU1NS4uLi4uLicpDQogICAgICAgICAgICAgICAgLy8gZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChpZnJhbWUpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgZm9ybSA9IHRoaXMuX2NyZWF0ZUZvcm0oaWZyYW1lLCB0aGlzLmFjdGlvbik7DQogICAgICAgIC8vIOW/hemhu+S7pei/meenjeaWueW8j+S8oOmAkuWPguaVsO+8n++8ge+8jOWQpuWImeWcqOacjeWKoeWZqOerr+ivu+WPluS4jeWIsA0KICAgICAgICBqUXVlcnkoIjxpbnB1dCB0eXBlPSdoaWRkZW4nIG5hbWU9J2pzb25WYWx1ZScgLz4iKS5hcHBlbmRUbyhmb3JtKS52YWwocmVxdWVzdEpTT05UZXh0KTsNCiAgICAgICAgZm9ybS5zdWJtaXQoKTsNCiAgICB9LA0KDQogICAgLyoqDQoJICogQ3JlYXRlcyBpZnJhbWUgd2l0aCB1bmlxdWUgbmFtZQ0KCSAqLw0KICAgIF9jcmVhdGVJZnJhbWUgOiBmdW5jdGlvbigpew0KICAgICAgICB2YXIgaWQgPSAnX2lmcmFtZV8nICsgSWRHZW5lcmF0b3IuZ2V0SWQoKTsNCg0KICAgICAgICB2YXIgaWZyYW1lID0galF1ZXJ5KCc8aWZyYW1lIHNyYz0iamF2YXNjcmlwdDpmYWxzZSIgbmFtZT0iJyArIGlkICsgJyIgLz4nKTsNCg0KICAgICAgICBpZnJhbWUuYXR0cignaWQnLCBpZCk7DQogICAgICAgIGlmcmFtZS5jc3MoImRpc3BsYXkiLCJub25lIik7DQogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaWZyYW1lWzBdKTsNCiAgICAgICAgcmV0dXJuIGlmcmFtZVswXTsNCiAgICB9LA0KDQogICAgLyoqDQoJICogQ3JlYXRlcyBmb3JtLCB0aGF0IHdpbGwgYmUgc3VibWl0dGVkIHRvIGlmcmFtZQ0KCSAqLw0KICAgIF9jcmVhdGVGb3JtIDogZnVuY3Rpb24oaWZyYW1lLCBhY3Rpb24pew0KICAgICAgICB2YXIgZm9ybSA9IGpRdWVyeSgnPGZvcm0gbWV0aG9kPSJwb3N0IiBlbmN0eXBlPSJtdWx0aXBhcnQvZm9ybS1kYXRhIj48L2Zvcm0+Jyk7DQogICAgICAgIC8vZm9ybS5jc3MoImRpc3BsYXkiLCJub25lIik7DQogICAgICAgIGZvcm0uYXR0cignYWN0aW9uJywgYWN0aW9uKTsNCiAgICAgICAgZm9ybS5hdHRyKCd0YXJnZXQnLCBpZnJhbWUubmFtZSk7DQogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZm9ybVswXSk7DQogICAgICAgIHJldHVybiBmb3JtOw0KICAgIH0NCn0NCg0KLyoqDQogKiDmnI3liqHlmajlvILluLjvvIznlKjkuo7ljIXoo4XmnInmnI3liqHlmajnq6/lj5Hlh7rnmoTlvILluLjkv6Hmga/vvIzpgJrluLjpg73mmK/kuIDkuKrlvILluLjloIbmoIjjgIINCiAqIEBkZXByZWNpYXRlZA0KICovDQpmdW5jdGlvbiBTZXJ2ZXJFcnJvcihtc2csIHN0YWNrVHJhY2UpIHsNCiAgICB0aGlzLm1zZyAgICAgICAgPSBtc2c7ICAvLyDlvILluLjkv6Hmga8NCiAgICB0aGlzLnN0YWNrVHJhY2UgPSBzdGFja1RyYWNlOyAgLy8g5byC5bi45aCG5qCIDQp9DQoNCnZhciBJbWFnZUhlbHBlciA9IHsNCiAgICAvKioNCiAgICAgKiDlnKjmjIflrprnmoTmjqfku7bkuIrmmL7npLrlm77niYfjgIINCiAgICAgKiDms6jmhI/vvJrmraTlh73mlbDlj6rmmK/mnoTlu7rkuobkuIDkuKpVUkzvvIzlm6DmraTljbPkvb/mnI3liqHnq6/lj5HnlJ/kuobplJnor6/vvIzlnKjliY3lj7DkuZ/mmK/kuI3og73mmL7npLrnmoTjgIINCiAgICAgKi8NCiAgICBzaG93UGljdHVyZSA6IGZ1bmN0aW9uIChwaWN0dXJlSWQsIHNlcnZpY2VDbGFzc05hbWUsIG1ldGhvZE5hbWUsIHBhcmFtcykgew0KICAgICAgICBpZiAocGljdHVyZUlkID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigi5Zu+54mHSUTkuI3og73kuLrnqbrjgIIiKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcGljdHVyZSA9IF9jcmVhdGVKUXVlcnkocGljdHVyZUlkKTsNCg0KICAgICAgICB2YXIgX3VybCA9IHRoaXMuZ2V0SW1hZ2VVcmwoc2VydmljZUNsYXNzTmFtZSwgbWV0aG9kTmFtZSwgcGFyYW1zKTsNCiAgICAgICAgcGljdHVyZS5hdHRyKCdzcmMnLCBfdXJsKTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5p6E5bu65LiA5Liq55So5LqO6K+75Y+W5Zu+54mH55qEIFVSTA0KICAgICAqLw0KICAgIGdldEltYWdlVXJsIDogZnVuY3Rpb24gKHNlcnZpY2VDbGFzc05hbWUsIG1ldGhvZE5hbWUsIHBhcmFtcykgew0KICAgICAgICBpZiAoc2VydmljZUNsYXNzTmFtZSA9PSBudWxsIHx8IG1ldGhvZE5hbWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCLmnI3liqHnsbvlkozmlrnms5XlkI3np7Dpg73kuI3og73kuLrnqbrjgIIiKTsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlIHNlcnZpY2UgY2xhc3MgYW5kIG1ldGhvZCBuYW1lIGNhbiBub3QgYmUgbnVsbC4iKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KCk7DQogICAgICAgIHJlcXVlc3Quc2VydmljZUNsYXNzTmFtZSA9IENsYXNzTG9hZGVyLmdldEZ1bGxOYW1lKHNlcnZpY2VDbGFzc05hbWUpOw0KICAgICAgICByZXF1ZXN0Lm1ldGhvZE5hbWUgPSBtZXRob2ROYW1lOw0KICAgICAgICByZXF1ZXN0LnBhcmFtcyAgICAgPSBwYXJhbXMgfHwgW107DQogICAgICAgIHZhciBfdXJsID0gU2VydmljZUludm9rZXIuY3JlYXRlVVJMKG51bGwsIHJlcXVlc3QpOw0KICAgICAgICByZXR1cm4gX3VybDsNCiAgICB9DQoNCn0NCg0KLyoqDQogKiDlkozlj5blvpfmoIfms6jnm7jlhbPnmoTliqnmiYvnsbsNCiAqLw0KdmFyIEFubm90YXRpb25IZWxwZXIgPSB7DQogICAgZ2V0QW5ub3RhdGlvbiA6IGZ1bmN0aW9uIChkZWNsYXJlZE9iaiwgYW5ub05hbWUpIHsNCiAgICAgICAgaWYgKGRlY2xhcmVkT2JqID09IG51bGwgfHwgYW5ub05hbWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3ICLmoIfms6jmj4/ov7DlkozlvoXmn6Xmib7nmoTmoIfms6jlkI3np7Dpg73kuI3og73kuLrnqbrjgIIiOw0KICAgICAgICB9DQogICAgICAgIHZhciBhbm5vcyA9IGRlY2xhcmVkT2JqLmFubm90YXRpb25zOw0KICAgICAgICBpZiAoYW5ub3MgPT0gbnVsbCB8fCBhbm5vcy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCEoYW5ub3MgaW5zdGFuY2VvZiBBcnJheSkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyAi5qCH5rOo5b+F6aG75piv5pWw57uE57G75Z6L44CCIjsNCiAgICAgICAgfQ0KICAgICAgICBmb3IgKHZhciBpID0wOyBpIDwgYW5ub3MubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBhbm5vID0gYW5ub3NbaV07DQogICAgICAgICAgICBpZiAoYW5ubyAhPSBudWxsICYmIGFubm8ubmFtZSAhPSBudWxsICYmIGFubm8ubmFtZS5pbmRleE9mKGFubm9OYW1lKSA+PTApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYW5ubzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5LuO5LiA5Liq57G755qE5oyH5a6a5Z+f5LiK5Y+W5b6X5oyH5a6a55qE5qCH5rOo44CCDQogICAgICogQF9jbGF6eiDmjIflrprnmoTnsbvvvIzkuI3og73kuLrnqbrjgIINCiAgICAgKiBAX25hbWUgIOWfn+eahOWQjeensO+8jOS4jeiDveS4uuepuuOAgg0KICAgICAqLw0KICAgIGdldEZpZWxkQW5ub3RhdGlvbnMgOiBmdW5jdGlvbiAoX2NsYXp6LCBfbmFtZSkgew0KICAgICAgICBpZiAoX2NsYXp6ID09IG51bGwgfHwgX25hbWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgcGFyYW1ldGVycyBjYW4gbm90IGJlIG51bGwuIik7DQogICAgICAgIH0NCg0KICAgICAgICAvLyDmib7liLDmjIflrprnmoTln5/vvIzmnKrmib7liLDliJnmipvlh7rlvILluLgNCiAgICAgICAgdmFyIGZpZWxkID0gbnVsbDsNCiAgICAgICAgaWYgKF9jbGF6ei5maWVsZHMgIT0gbnVsbCkgew0KICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IF9jbGF6ei5maWVsZHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBpZiAoX25hbWUgPT09IF9jbGF6ei5maWVsZHNbaV0ubmFtZSkgew0KICAgICAgICAgICAgICAgICAgICBmaWVsZCA9IF9jbGF6ei5maWVsZHNbaV07DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yICgnQ2FuIG5vdCBmaW5kIHRoZSBmaWVsZCBuYW1lZCBbJyArIF9uYW1lICsgJ10gaW4gY2xhc3MgWycgKyBfY2xhenogKyAnXScpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAoZmllbGQuYW5ub3RhdGlvbnMgfHwgW10pOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDku47kuIDkuKrnsbvnmoTmjIflrprln5/kuIrlj5blvpfmjIflrprnmoTmoIfms6gNCiAgICAgKi8NCiAgICBnZXRGaWVsZEFubm90YXRpb24gOiBmdW5jdGlvbiAoX2NsYXNzLCBfbmFtZSwgYW5ub3RhdGlvbk5hbWUpIHsNCiAgICAgICAgdmFyIGFubm8gPSBudWxsOw0KICAgICAgICB2YXIgYW5ub3MgPSB0aGlzLmdldEZpZWxkQW5ub3RhdGlvbnMoX2NsYXNzLCBfbmFtZSk7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYW5ub3MubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBfYW5ubyA9IGFubm9zW2ldOw0KICAgICAgICAgICAgaWYgKF9hbm5vICE9IG51bGwgJiYgX2Fubm8ubmFtZSAhPSBudWxsICYmIF9hbm5vLm5hbWUuaW5kZXhPZihhbm5vdGF0aW9uTmFtZSkgPj0wKSB7DQogICAgICAgICAgICAgICAgYW5ubyA9IF9hbm5vOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhbm5vOw0KICAgIH0NCg0KfQ0KDQovKioNCiAqIOWumuS5ieaJgOacieWtl+WFuOeahOacjeWKoeOAgg0KICovDQp2YXIgRGljdGlvbmFyeVNlcnZpY2UgPSB7DQoNCiAgICAvLyDov5znqIvlrZflhbjmnI3liqHnmoTlkI3np7ANCiAgICBzZXJ2aWNlTmFtZSA6ICdjb20ueHQuY29yZS51dGlscy5kaWMuUmVtb3RlRGljdGlvbmFyeVNlcnZpY2UnLA0KDQogICAgLy8g6KOF572u5a2X5YW45pyN5Yqh55qE5pa55rOV5ZCN56ewDQogICAgbWV0aG9kTmFtZSA6ICdnZXREaWN0aW9uYXJ5JywNCg0KICAgIC8vIOe8k+WtmOWtl+WFuOacjeWKoeeahOaxoA0KICAgIHBvb2wgOiB7fSwNCg0KCS8qKg0KCSAgKiDmoLnmja7mjIflrprnmoTlrZflhbjlkI3np7Dov5Tlm57kuIDkuKrlrZflhbjvvIzlpoLmnpzlrZflhbjkuI3lrZjlnKjvvIzns7vnu5/lsIbmipvlh7rlvILluLjjgIINCgkgICovDQogICAgZ2V0RGljdGlvbmFyeSA6IGZ1bmN0aW9uIChkaWN0aW9uYXJ5TmFtZSkgew0KICAgICAgICBpZiAoZGljdGlvbmFyeU5hbWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQYXJhbWV0ZXIgZGljdGlvbmFyeU5hbWUoMSkgY2FuIG5vdCBiZSBudWxsLiIpOw0KICAgICAgICB9DQogICAgICAgIHZhciBkaWMgPSB0aGlzLnBvb2xbZGljdGlvbmFyeU5hbWVdOw0KICAgICAgICBpZiAoZGljID09IG51bGwpIHsNCiAgICAgICAgICAgIC8vIOijhei9veWtl+WFuA0KICAgICAgICAgICAgZGljID0gU2VydmljZUludm9rZXIuaW52b2tlTWV0aG9kKHRoaXMuc2VydmljZU5hbWUsIHRoaXMubWV0aG9kTmFtZSwgZGljdGlvbmFyeU5hbWUpOw0KICAgICAgICAgICAgdGhpcy5wb29sW2RpY3Rpb25hcnlOYW1lXSA9IGRpYzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZGljOw0KICAgIH0sDQoNCgkvKioNCgkgICog5rOo5YaM5LiA5Liq5a2X5YW46Ieq5a6a5LmJ55qE5a2X5YW477yM57O757uf5LiN5a+55a2X5YW45piv5ZCm6YeN5aSN6L+b6KGM5qCh6aqM77yM5aaC5p6c5ZCM5ZCN77yM5ZCO5rOo5YaM5bCG6KaG55uW5paw5rOo5YaM55qE5a2X5YW444CCDQoJICAqIEBwYXJhbSAgZGljTmFtZSDlrZflhbjlkI3np7ANCgkgICogQHBhcmFtICBpdGVtcyAgICAg5a2X5YW46aG55pWw57uEDQoJICAqLw0KICAgIHJlZ2lzdGVyIDogZnVuY3Rpb24gKGRpY05hbWUsIGl0ZW1zKSB7DQoJICAgIGlmIChkaWNOYW1lID09IG51bGwgfHwgaXRlbXMgPT0gbnVsbCkgew0KCQkgICAgTWVzc2FnZUJveC5zaHdvRXJyb3IoJ+Wtl+WFuOWQjeensOWPiuWFtuWtl+WFuOmhueWdh+S4jeiDveS4uuepuuOAgicpOw0KCQkgICAgcmV0dXJuOw0KCQl9DQoJCXZhciBkaWMgPSB7J2l0ZW1zJyA6IGl0ZW1zfTsNCgkJdGhpcy5wb29sW2RpY05hbWVdID0gZGljOw0KICAgIH0NCg0KfQ0KDQovKioNCiAgKiDlrZflhbjluK7liqnnsbvvvIznlKjkuo7moLnmja7lrZflhbjmnoTlu7rkuIvmi4nliJfooajmoYbjgIHlpI3pgInmoYbjgIHljZXpgInmjInpkq7nrYnmjqfku7bjgIINCiAgKiAgVE9ETzog6LCD5pW05Y+C5pWw55qE5b2i5byP77yM55Soe33ku6Pmm7/nm67liY3nmoTlpJrlj4LmlbDjgIINCiAgKi8NCnZhciBEaWNVdGlscyA9IHsNCg0KICAgIGRlY29yYXRlIDogZnVuY3Rpb24gKGlkLCBkaWNOYW1lLCBudWxsYWJsZSwgbnVsbFZhbHVlLCBudWxsVGl0bGUsIGNvbnRybFN0cikgew0KICAgICAgICBpZiAoaWQgPT0gbnVsbCB8fCBkaWNOYW1lID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUGFyYW1ldGVycyBpZCgxKSBhbmQgZGljTmFtZSgyKSBjYW4gbm90IGJlIG51bGwuICIpOw0KICAgICAgICB9DQogICAgICAgIC8vIOa4hemZpOaJgOacieWtkOiKgueCuQ0KICAgICAgICB2YXIgY29tcCA9IF9jcmVhdGVKUXVlcnkoaWQpOw0KDQogICAgICAgIGNvbXAuZW1wdHkoKTsNCg0KICAgICAgICAvLyDlpITnkIbigJznqbrigJ3oioLngrkNCiAgICAgICAgaWYgKG51bGxhYmxlKSB7DQogICAgICAgICAgICBudWxsVmFsdWUgPSBudWxsVmFsdWUgPT0gbnVsbCA/ICcnIDogbnVsbFZhbHVlOw0KICAgICAgICAgICAgbnVsbFRpdGxlID0gbnVsbFRpdGxlID09IG51bGwgPyAnJyA6IG51bGxUaXRsZTsNCiAgICAgICAgICAgIHZhciBvdXRwdXQgPSBjb250cmxTdHIobnVsbFZhbHVlLCBudWxsVGl0bGUpOw0KICAgICAgICAgICAgY29tcC5hcHBlbmQoalF1ZXJ5KG91dHB1dCkpOw0KICAgICAgICB9DQogICAgICAgIHZhciBkaWMgPSBEaWN0aW9uYXJ5U2VydmljZS5nZXREaWN0aW9uYXJ5KGRpY05hbWUpOw0KICAgICAgICBpZiAoZGljID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGRpY3Rpb25hcnkgbmFtZWQgWycgKyBkaWNOYW1lICsgJ10gY2FuIG5vdCBiZSBmb3VuZC4nKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIOWtl+WFuOmhueS4uuepuuWImeebtOaOpei/lOWbng0KICAgICAgICBpZiAoZGljLml0ZW1zID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGljLml0ZW1zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgZGljSXRlbSA9IGRpYy5pdGVtc1tpXTsNCiAgICAgICAgICAgIG91dHB1dCA9IGNvbnRybFN0cihkaWNJdGVtWyJ2YWx1ZSJdLCBkaWNJdGVtWyJ0aXRsZSJdKTsNCiAgICAgICAgICAgIGNvbXAuYXBwZW5kKGpRdWVyeShvdXRwdXQpKTsNCiAgICAgICAgfQ0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgICAgICAgKiDkvb/nlKjigJzlrZflhbjigJ3kv67ppbDkuIvmi4nliJfooajmoYbvvIzljbPkvb/nlKjkuIvmi4nliJfooajmoYbmmL7npLrlrZflhbjnmoTlhoXlrrnjgIINCiAgICAgICAgICAqLw0KICAgIGRlY29yYXRlQ29tYm9Cb3ggOiBmdW5jdGlvbiAoY29tYm9Cb3hJZCwgZGljTmFtZSwgbnVsbGFibGUsIG51bGxWYWx1ZSwgbnVsbFRpdGxlKSB7DQogICAgICAgIHRoaXMuZGVjb3JhdGUoY29tYm9Cb3hJZCwgZGljTmFtZSwgbnVsbGFibGUsIG51bGxWYWx1ZSwgbnVsbFRpdGxlLCBmdW5jdGlvbiAodmFsdWUsIHRpdGxlKSB7DQogICAgICAgICAgICByZXR1cm4gIjxvcHRpb24gdmFsdWU9JyIgKyB2YWx1ZSArICInPiIgKyB0aXRsZSArICI8L29wdGlvbj4iOw0KICAgICAgICB9KTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5L2/55So4oCc5a2X5YW44oCd5L+u6aWw5YiX6KGo5qGG77yM5Y2z5L2/55So5YiX6KGo5qGG5pi+56S65a2X5YW455qE5YaF5a6544CC5aSE55CG5pa55byP5ZKMZGVjb3JhdGVDb21ib0JveOebuOWQjA0KICAgICAqLw0KICAgIGRlY29yYXRlTGlzdCA6IGZ1bmN0aW9uIChsaXN0SWQsIGRpY05hbWUpIHsNCiAgICAgICAgdGhpcy5kZWNvcmF0ZUNvbWJvQm94KGxpc3RJZCwgZGljTmFtZSwgZmFsc2UsIG51bGwsIG51bGwpOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDkvb/nlKjigJzlrZflhbjigJ3kv67ppbDliJfooajmoYbvvIzljbPkvb/nlKjliJfooajmoYbmmL7npLrlrZflhbjnmoTlhoXlrrnjgILlpITnkIbmlrnlvI/lkoxkZWNvcmF0ZUNvbWJvQm9455u45ZCMDQogICAgICovDQogICAgZGVjb3JhdGVDaGVja0JveGVzIDogZnVuY3Rpb24gKGRpdklkLCBkaWNOYW1lLCBuYW1lKSB7DQogICAgICAgIHRoaXMuZGVjb3JhdGUoZGl2SWQsIGRpY05hbWUsIGZhbHNlLCBudWxsLCBudWxsLCBmdW5jdGlvbiAodmFsdWUsIHRpdGxlKSB7DQogICAgICAgICAgICByZXR1cm4gIjxpbnB1dCBuYW1lPSciICsgbmFtZSArICInIHR5cGU9J2NoZWNrYm94JyB2YWx1ZT0nIiArIHZhbHVlICsgIic+IiArIHRpdGxlICsgIjwvaW5wdXQ+IjsNCiAgICAgICAgfSk7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOS9v+eUqOKAnOWtl+WFuOKAneS/rumlsOWIl+ihqOahhu+8jOWNs+S9v+eUqOWIl+ihqOahhuaYvuekuuWtl+WFuOeahOWGheWuueOAguWkhOeQhuaWueW8j+WSjGRlY29yYXRlQ29tYm9Cb3jnm7jlkIwNCiAgICAgKi8NCiAgICBkZWNvcmF0ZVJhZGlvZXMgOiBmdW5jdGlvbiAoZGl2SWQsIGRpY05hbWUsIG51bGxhYmxlLCBudWxsVmFsdWUsIG51bGxUaXRsZSwgbmFtZSkgew0KICAgICAgICB0aGlzLmRlY29yYXRlKGRpdklkLCBkaWNOYW1lLCBudWxsYWJsZSwgbnVsbFZhbHVlLCBudWxsVGl0bGUsIGZ1bmN0aW9uICh2YWx1ZSwgdGl0bGUpIHsNCiAgICAgICAgICAgIHJldHVybiAiPGlucHV0IG5hbWU9JyIgKyBuYW1lICsgIicgdHlwZT0ncmFkaW8nIHZhbHVlPSciICsgdmFsdWUgKyAiJz4iICsgdGl0bGUgKyAiPC9pbnB1dD4iOw0KICAgICAgICB9KTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5a2X5YW457G75Z6L55qE57uT5p6E5q+U6L6D5aSN5p2C77yM5Zug5q2k5o6o6I2Q5L2/55So5q2k5pa55byP6L+b6KGM5a2X5YW455qE6L2s5o2i44CCDQogICAgICovDQogICAgZ2V0VGl0bGUgOiBmdW5jdGlvbiAoZGljLCB2YWx1ZSkgew0KICAgICAgICBpZiAoZGljID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93ICLlrZflhbjkuI3og73kuLrnqbrjgIIiOw0KICAgICAgICB9DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IGRpYy5pdGVtcyA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gIiI7DQogICAgICAgIH0NCiAgICAgICAgLy8gYWxlcnQoJ2RpYz0nICsgZGljKTsNCiAgICAgICAgLy8gYWxlcnQoJ2RpYy5pdGVtcz0nICsgZGljLml0ZW1zKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkaWMuaXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBkaWMuaXRlbXNbaV0udmFsdWUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZGljLml0ZW1zW2ldLnRpdGxlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiB2YWx1ZTsgIC8vIOayoeacieaJvuWIsOWQiOmAgueahOWtl+WFuOmhueOAgg0KICAgIH0NCn0NCg0KLyoqDQogKiDlj6/nvJbovpHnmoTmjqfku7bmoIfnrb7nmoTlkI3np7ANCiAqLw0KdmFyIEVESVRBQkxFX0NPTlRST0xfVEFHID0gWydpbnB1dCcsICdzZWxlY3QnLCAndGV4dGFyZWEnXTsNCg0KLyoqDQogKiDlj6/nvJbovpHnmoTmjqfku7bmoIfnrb7nmoTlkI3np7ANCiAqLw0KdmFyIEVESVRBQkxFX0NPTlRST0xfVFlQRSA9IFsndGV4dCcsICdwYXNzd29yZCcsICdjaGVja2JveCcsICdyYWRpbyddOw0KDQp2YXIgQmluZFV0aWxzID0gew0KDQogICAgLyoqDQogICAgICog5bCG5b2T5YmN5YC85oyJ54Wn5ZCN56ew5LiO5omA5pyJ6KKr6YCJ5Lit55qE5o6n5Lu26L+b6KGM57uR5a6aDQogICAgICogQHBhcmFtIHNlbGVjdG9yIOmAieaLqeWZqO+8iOmcgOimgemBteW+qmpRdWVyeeeahOagh+WHhuaooeW8j++8ieOAgg0KICAgICAqIEBwYXJhbSBkYXRhIOW/hemhu+aYr+Wvueixoeexu+Weiw0KICAgICAqIEBwYXJhbSBwYXJhbXMg5Y+C5pWw77yM5YW25Lit5YyF5ous77yaDQogICAgICogICAgIHR5cGUgICAgIDog5pWw5o2u5a+55bqU55qE57G75Z6L77yI5rOo5oSP77yM5bqU6K+l5pivSmF2YeWumuS5ieeahOexu+Wei++8jOWboOS4uuatpOexu+Wei+WFs+ezu+WIsOagvOW8j+WMluWSjOWPjeagvOW8j+WMluWkhOeQhu+8iQ0KICAgICAqICAgICBjb252ZXJ0ZXIgOiDnlKjmiLfoh6rlrprkuYnovazmjaLmlrnlvI/nmoTlm57osIPlpITnkIbvvIzlpoLmnpzmnKrlrprkuYnvvIzkuJTkvKDlhaXkuoZ0eXBlIOWPguaVsO+8jOWwhumHh+eUqOezu+e7n+m7mOiupOeahOi9rOaNouaWueW8j+OAgg0KICAgICAqICAgICBmb3JtYXRlciAgOiDlr7nmlbDmja7ov5vooYzmoLzlvI/ljJblkozop6PmnpDnmoTlm57osIPlpITnkIbvvIzlpoLmnpzmnKrlrprkuYnvvIzkuJTkvKDlhaXkuoZ0eXBlIOWPguaVsO+8jOWwhumHh+eUqOezu+e7n+m7mOiupOeahOi9rOaNouaWueW8j+OAgg0KICAgICAqLw0KICAgIGJpbmQgOiBmdW5jdGlvbiAoc2VsZWN0b3IsIGRhdGEsIHBhcmFtcykgew0KICAgICAgICBpZiAoZGF0YSA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdmFyIF9wYXJhbXMgPSBwYXJhbXMgfHwge307DQogICAgICAgIC8vIOe7keWumuWvueixoeWvueW6lOeahEphdmHnsbvlnosNCiAgICAgICAgdmFyIHR5cGUgICAgICA9IF9wYXJhbXNbJ3R5cGUnXTsNCiAgICAgICAgdmFyIGNvbnZlcnRlciAgPSBfcGFyYW1zWydjb252ZXJ0ZXInXTsNCiAgICAgICAgdmFyIGZvcm1hdGVyICAgPSBfcGFyYW1zWydmb3JtYXRlciddOw0KICAgICAgICB2YXIgZXhjbHVzaW9ucyA9IF9wYXJhbXNbJ2V4Y2x1c2lvbnMnXSB8fCBbXTsgIC8vIOS4jeWkhOeQhueahOWtl+autQ0KDQoNCiAgICAgICAgdmFyIGNvbXBzID0gQ29udHJvbFV0aWxzLmdldE5hbWVkQ29tcChzZWxlY3Rvcik7DQogICAgICAgIHZhciBfY2xhenogPSBudWxsOw0KICAgICAgICBpZiAodHlwZSAhPSBudWxsKSB7DQogICAgICAgICAgICBfY2xhenogPSBDbGFzc0xvYWRlci5nZXRDbGFzcyh0eXBlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFRPRE86IOWvueaXpeacn++8jOWtl+WFuOWAvOWSjExvb2t1cOeahOiHquWKqOe7keWumg0KDQoNCiAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygnX2NsYXNzPScsIF9jbGF6eikNCiAgICAgICAgalF1ZXJ5LmVhY2goY29tcHMsIGZ1bmN0aW9uIChpbmRleCwgY29tcCkgew0KICAgICAgICAgICAgdmFyIF9uYW1lID0gY29tcC5uYW1lOyAgLy8g5o6n5Lu255qE5ZCN56ewDQogICAgICAgICAgICBpZiAoX25hbWUgIT0gbnVsbCAmJiBleGNsdXNpb25zLmluZGV4T2YoX25hbWUpIDwgMCkgew0KICAgICAgICAgICAgICAgIHZhciBfdmFsdWUgPSBudWxsOw0KICAgICAgICAgICAgICAgIGlmIChjb252ZXJ0ZXIgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBfdmFsdWUgPSBjb252ZXJ0ZXIuY29udmVydFRvKGNvbXAsIF9uYW1lLCBkYXRhLCBwYXJhbXMpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8vIOi/m+ihjOiHquWKqOi9rOaNog0KICAgICAgICAgICAgICAgICAgICBfdmFsdWUgPSBCaW5kVXRpbHMuY29udmVydChfY2xhenosIF9uYW1lLCBkYXRhW19uYW1lXSk7DQogICAgICAgICAgICAgICAgfQ0KCQkJCS8vIE1lc3NhZ2VCb3guZGVidWcoJ19uYW1lPScsIF9uYW1lKTsNCgkJCQkvLyBNZXNzYWdlQm94LmRlYnVnKCdfdmFsdWU9JywgX3ZhbHVlKTsNCg0KICAgICAgICAgICAgICAgIC8vIOWvueaVsOaNrui/m+ihjOagvOW8j+WMlg0KICAgICAgICAgICAgICAgIGlmIChmb3JtYXRlciAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIF92YWx1ZSA9IGZvcm1hdGVyLmZvcm1hdChjb21wLCBfbmFtZSwgZGF0YSwgcGFyYW1zKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAvLyDov5vooYzoh6rliqjmoLzlvI/ljJYNCiAgICAgICAgICAgICAgICAgICAgX3ZhbHVlID0gQmluZFV0aWxzLmZvcm1hdChfY2xhenosIF9uYW1lLCBkYXRhW19uYW1lXSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8g57uR5a6a5Yiw5o6n5Lu2DQogICAgICAgICAgICAgICAgalF1ZXJ5KGNvbXApLnZhbChfdmFsdWUgfHwgJycpOw0KDQogICAgICAgICAgICAgICAgLy8g5b2T5o6n5Lu25Y+R55Sf5Y+Y5YyW5pe277yM5L2/55So5q2k5pa55rOV5o6n5Lu255qE5YC85ZCM5q2l5Zue5a+56LGhDQogICAgICAgICAgICAgICAgY29tcC5vbmNoYW5nZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgX3ZhbHVlID0galF1ZXJ5KGNvbXApLnZhbCgpOw0KICAgICAgICAgICAgICAgICAgICAvLyDlr7nmlbDmja7ov5vooYzop6PmnpDvvIjlj43moLzlvI/ljJbvvInvvIjlsIbmmL7npLrlhoXlrrnlj5jkuLrlrp7pmYXlgLzvvIkNCiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm1hdGVyICE9IG51bGwgJiYgZm9ybWF0ZXIucGFyc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIF92YWx1ZSA9IGZvcm1hdGVyLnBhcnNlKGNvbXAsIF9uYW1lLCBfdmFsdWUsIHBhcmFtcyk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBfdmFsdWUgPSBCaW5kVXRpbHMucGFyc2UoX2NsYXp6LCBfbmFtZSwgX3ZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAvLyDlr7nmlbDmja7ov5vooYzlj43lkJHovazmjaLvvIjlsIbmmL7npLrlgLznvJbnoIHvvIkNCiAgICAgICAgICAgICAgICAgICAgZGF0YVtfbmFtZV0gPSBfdmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9LA0KDQogICAgY29udmVydCA6IGZ1bmN0aW9uIChfY2xhenosIG5hbWUsIHZhbHVlKSB7DQogICAgICAgIHZhciBmaWVsZCA9IEJpbmRVdGlscy5fZ2V0RmllbGQoX2NsYXp6LCBuYW1lKTsNCiAgICAgICAgLy8g5pyq5om+5Yiw5a+55bqU55qE5Z+fDQogICAgICAgIGlmIChmaWVsZCA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBNZXNzYWdlQm94LmRlYnVnKCdmaWVsZD0nLCBmaWVsZCk7DQogICAgICAgIC8vIOacquaJvuWIsOWvueW6lOeahOWfnw0KICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIHZhbHVlOw0KICAgICAgICB9DQogICAgICAgIHZhciBjb252ZXJ0ZXIgPSBDb252ZXJ0ZXJGYWN0b3J5LmdldENvbnZlcnRlcihmaWVsZC50eXBlKTsNCiAgICAgICAgaWYgKGNvbnZlcnRlciAhPSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gY29udmVydGVyLmNvbnZlcnQodmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICB9LA0KDQogICAgX2dldEZpZWxkIDogZnVuY3Rpb24gKF9jbGF6eiwgbmFtZSkgew0KICAgICAgICBpZiAoX2NsYXp6ID09IG51bGwgfHwgbmFtZSA9PSBudWxsIHx8IF9jbGF6ei5maWVsZHMgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgdmFyIGZpZWxkcyA9IF9jbGF6ei5maWVsZHM7DQogICAgICAgIHZhciBmaWVsZCA9IG51bGw7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoZmllbGRzW2ldLm5hbWUgPT0gbmFtZSkgew0KICAgICAgICAgICAgICAgIGZpZWxkID0gZmllbGRzW2ldOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmaWVsZDsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5qC55o2u5Y+C5pWw57G75Z6L5ZKM5qC85byP5YyW5qCH5rOo6Ieq5Yqo6L+b6KGM5qC85byP5YyW5bel5L2c44CCDQogICAgICovDQogICAgZm9ybWF0IDogZnVuY3Rpb24gKF9jbGF6eiwgbmFtZSwgdmFsdWUpIHsNCiAgICAgICAgdmFyIGZpZWxkID0gQmluZFV0aWxzLl9nZXRGaWVsZChfY2xhenosIG5hbWUpOw0KICAgICAgICAvLyDmnKrmib7liLDlr7nlupTnmoTln58NCiAgICAgICAgaWYgKGZpZWxkID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgZm9ybWF0ZXIgPSBGb3JtYXRlckZhY3RvcnkuZ2V0Rm9ybWF0ZXIoZmllbGQudHlwZSk7DQogICAgICAgIC8vIE1lc3NhZ2VCb3guZGVidWcoJ2Zvcm1hdGVyPScgKyBmb3JtYXRlcik7DQogICAgICAgIGlmIChmb3JtYXRlciAhPSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gZm9ybWF0ZXIuZm9ybWF0KF9jbGF6eiwgbmFtZSwgdmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5qC55o2u5Y+C5pWw57G75Z6L5ZKM5qC85byP5YyW5qCH5rOo6Ieq5Yqo6L+b6KGM5qC85byP5YyW5bel5L2c44CCDQogICAgICovDQogICAgcGFyc2UgOiBmdW5jdGlvbiAoX2NsYXp6LCBuYW1lLCB2YWx1ZSkgew0KICAgICAgICB2YXIgZmllbGQgPSBCaW5kVXRpbHMuX2dldEZpZWxkKF9jbGF6eiwgbmFtZSk7DQogICAgICAgIC8vIOacquaJvuWIsOWvueW6lOeahOWfnw0KICAgICAgICBpZiAoZmllbGQgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIHZhbHVlOw0KICAgICAgICB9DQogICAgICAgIHZhciBmb3JtYXRlciA9IEZvcm1hdGVyRmFjdG9yeS5nZXRGb3JtYXRlcihmaWVsZC50eXBlKTsNCiAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygnZm9ybWF0ZXI9JyArIGZvcm1hdGVyKTsNCiAgICAgICAgaWYgKGZvcm1hdGVyICE9IG51bGwgJiYgZm9ybWF0ZXIucGFyc2UpIHsNCiAgICAgICAgICAgIHJldHVybiBmb3JtYXRlci5wYXJzZShfY2xhenosIG5hbWUsIHZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgfQ0KfQ0KDQoNCi8qKg0KICog55So5LqO5qCh6aqM55qE5biu5Yqp57G744CCDQogKi8NCnZhciBWYWxpZGF0b3IgPSBmdW5jdGlvbiAoX3NldHRpbmdzKSB7DQogICAgdGhpcy5zZXR0aW5ncyA9IHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIOeUqOS6juijhei9veKAnFBP4oCd5a+56LGh55u45YWz5qCh6aqM55qE5pyN5Yqh57G744CCDQogICAgICAgICAqLw0KICAgICAgICB2YWxpZGF0b3JMb2FkZXJTZXJ2aWNlIDogImNvbS54dC5ndC5odG1sLnNlcnZpY2UuVmFsaWRhdG9yTG9hZGVyU2VydmljZSIsDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIOeUqOS6juijhei9veKAnFBP4oCd5a+56LGh55u45YWz5qCh6aqM55qE5pa55rOV5ZCN56ew44CCDQogICAgICAgICAqLw0KICAgICAgICBtZXRob2ROYW1lIDogImdldFZhbGlkYXRvcnMiDQogICAgfQ0KICAgIGpRdWVyeS5leHRlbmQodGhpcy5zZXR0aW5ncywgX3NldHRpbmdzKTsNCn0NCg0KLyoqDQogKiDnlKjkuo7nu4Tku7bmoKHpqoznmoTpnZnmgIHmlrnms5XjgIINCiAqIEBwYXJhbSBjb21wIOe7hOS7tuWunuS+iw0KICogQHBhcmFtIHZhbGlkYXRhYmxlcyDlj6/moKHpqozmjqXlj6MNCiAqLw0KVmFsaWRhdG9yLmNvbXBWYWxpZGF0ZSA9IGZ1bmN0aW9uIChjb21wLCB2YWxpZGF0YWJsZXMpIHsNCiAgICB2YXIgbXNncyA9IFtdOyAgIC8vIOmUmeivr+a2iOaBrw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsaWRhdGFibGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIHZhciB2YWxpZGF0YWJsZSA9IHZhbGlkYXRhYmxlc1tpXTsNCiAgICAgICAgaWYgKHZhbGlkYXRhYmxlID09IG51bGwpIHsNCiAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQogICAgICAgIHZhciBfdm1zID0gdmFsaWRhdGFibGUudmFsaWRhdGUoJChjb21wKS52YWwoKSk7DQogICAgICAgIGlmIChfdm1zICE9IG51bGwgJiYgX3Ztcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IF92bXMubGVuZ3RoOyBqKyspIHsNCiAgICAgICAgICAgICAgICBtc2dzLnB1c2goX3Ztc1tqXSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG1zZ3M7DQp9DQoNCnZhciBNZXNzYWdlRGlzcGxheSA9IHsNCiAgICAvKioNCiAgICAgKiDmmL7npLrmjIflrprmjqfku7bnm7jlhbPkv6Hmga/jgILpppblhYjmuIXpmaTkuI7mraTmjqfku7bnm7jlhbPnmoTmiYDmnInkv6Hmga/vvIznhLblkI7lnKjmjqfku7bnmoTlkI7pnaINCiAgICAgKiDlsIbkv6Hmga/mmL7npLrlh7rmnaXvvIjkvb/nlKjigJxzcGFu4oCd5o6n5Lu277yJ44CCDQogICAgICogQHBhcmFtIHNvdXJjZSDmupDmjqfku7bvvIzkuLrnqbrvvIzliJnkuI3ov5vooYzku7vkvZXlpITnkIbjgIINCiAgICAgKiBAcGFyYW0gdm1zIOagoemqjOS/oeaBr+eahOaVsOe7hOOAgg0KICAgICAqLw0KICAgIHNob3dNZXNzYWdlcyA6IGZ1bmN0aW9uKHNvdXJjZSwgdm1zKSB7DQogICAgICAgIC8vIOa4hemZpOW9k+WJjeaYvuekuueahOmUmeivr+S/oeaBrw0KICAgICAgICB0aGlzLmNsZWFyKHNvdXJjZSk7DQoNCiAgICAgICAgaWYgKHZtcyA9PSBudWxsIHx8IHZtcy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGlmIChzb3VyY2UgPT0gbnVsbCkgew0KICAgICAgICAgICAgLy8g5L2/55So5o+Q56S65qGG5pi+56S65raI5oGvDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICBqUXVlcnkoc291cmNlKS5hZnRlcignPHNwYW4gY2xhc3M9InZhbGlkYXRpb25fZmFpbCI+JyArIHZtc1swXS5tZXNzYWdlICsgIjwvc3Bhbj4iKTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5riF6Zmk5LiO5q2k5o6n5Lu255u45YWz55qE5omA5pyJ5L+h5oGv44CCDQogICAgICovDQogICAgY2xlYXIgOiBmdW5jdGlvbiAoc291cmNlKSB7DQogICAgICAgIGlmIChzb3VyY2UgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGpRdWVyeShzb3VyY2UpLnNpYmxpbmdzKCcudmFsaWRhdGlvbl9mYWlsJykucmVtb3ZlKCk7DQogICAgfQ0KfTsNCg0KalF1ZXJ5LmV4dGVuZChWYWxpZGF0b3IucHJvdG90eXBlLCB7DQogICAgLyoqDQogICAgICog5o6n5Lu25Y+K5YW25ZCN56ew55qE5qCh6aqM5pig5bCE6KGoLg0KICAgICAqLw0KICAgIGNvbXBWYWxpZGF0b3JzIDoge30sDQoNCiAgICAvKioNCiAgICAgKiDmtojmga/mmL7npLrlmags55So5LqO56Gu5a6a5YW35L2T55qE5raI5oGv5pi+56S65pa55byPLg0KICAgICAqLw0KICAgIGRpc3BsYXkgOiBNZXNzYWdlRGlzcGxheSwNCg0KICAgIC8qKg0KICAgICAqIOWwhuaMh+WumuWuueWZqOeahOagoemqjOS/oeaBr+WSjOexu+S/oeaBr+e7keWumuWIsOS4gOi1t+OAgg0KICAgICAqLw0KICAgIGJpbmRDb250YWluZXIgOiBmdW5jdGlvbiAoY29udGFpbmVySWQsIGNsYXNzTmFtZSwgZnVsbCkgew0KICAgICAgICB2YXIgZnVsbE5hbWUgPSBDbGFzc0xvYWRlci5nZXRGdWxsTmFtZShjbGFzc05hbWUsIGZ1bGwpOw0KICAgICAgICB2YXIgdmFsaWRhdG9ycyA9IFNlcnZpY2VJbnZva2VyLmludm9rZU1ldGhvZCh0aGlzLnNldHRpbmdzLnZhbGlkYXRvckxvYWRlclNlcnZpY2UsDQogICAgICAgICAgICB0aGlzLnNldHRpbmdzLm1ldGhvZE5hbWUsIGZ1bGxOYW1lKTsNCiAgICAgICAgdmFyIGNvbXBzID0gQ29udHJvbFV0aWxzLmdldE5hbWVkQ29tcChjb250YWluZXJJZCk7DQogICAgICAgIHZhciBfY29tcFZhbGlkYXRvcnMgPSB7fTsNCiAgICAgICAgdmFyIG9uVmFsaWRhdGUgPSB0aGlzLm9uVmFsaWRhdGU7DQogICAgICAgIHZhciBfY29udmVydCA9IHRoaXMuY29udmVydDsNCiAgICAgICAgdmFyIF9kaXNwbGF5ID0gdGhpcy5kaXNwbGF5Ow0KICAgICAgICBqUXVlcnkuZWFjaCh2YWxpZGF0b3JzLCBmdW5jdGlvbihuYW1lLCB2YWxpZGF0YWJsZXMpew0KICAgICAgICAgICAgaWYgKGNvbXBzW25hbWVdICE9IG51bGwgJiYgdmFsaWRhdGFibGVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAvLyDlsIbmnI3liqHnq6/moKHpqozovazmjaLkuLrlrqLmiLfnq6/moKHpqowNCiAgICAgICAgICAgICAgICB2YXIgX3ZhbGlkYXRhYmxlcyA9IF9jb252ZXJ0KHZhbGlkYXRhYmxlcyk7DQoNCiAgICAgICAgICAgICAgICAvLyDooqvmoKHpqoznmoTplJnor6/mjqfku7YNCiAgICAgICAgICAgICAgICB2YXIgY29tcCA9IGpRdWVyeShjb21wc1tuYW1lXSk7DQoNCiAgICAgICAgICAgICAgICAvLyDoh6rliqjkuqfnlJ/kuIDkuKppZA0KICAgICAgICAgICAgICAgIGlmIChjb21wLmF0dHIoJ2lkJykgPT0gbnVsbCB8fCBjb21wLmF0dHIoJ2lkJykgPT0gJycpIHsNCiAgICAgICAgICAgICAgICAgICAgY29tcC5hdHRyKCdpZCcsICdfdmFsXycgKyBJZEdlbmVyYXRvci5nZXRJZCgpKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyDlnKjkuovmg4XnhKbngrnlkozmlofmnKzlj5jljJbml7bov5vooYzmoKHpqowNCiAgICAgICAgICAgICAgICBjb21wLmJpbmQoJ2tleXVwJywgICB7DQogICAgICAgICAgICAgICAgICAgIHZhbGlkYXRhYmxlcyA6IF92YWxpZGF0YWJsZXMsDQogICAgICAgICAgICAgICAgICAgIGRpc3BsYXkgOiBfZGlzcGxheQ0KICAgICAgICAgICAgICAgIH0sIG9uVmFsaWRhdGUpOw0KICAgICAgICAgICAgICAgIGNvbXAuYmluZCgnY2hhbmdlJywgew0KICAgICAgICAgICAgICAgICAgICB2YWxpZGF0YWJsZXMgOiBfdmFsaWRhdGFibGVzLA0KICAgICAgICAgICAgICAgICAgICBkaXNwbGF5IDogX2Rpc3BsYXkNCiAgICAgICAgICAgICAgICB9LCBvblZhbGlkYXRlKTsNCiAgICAgICAgICAgICAgICBfY29tcFZhbGlkYXRvcnNbY29tcC5hdHRyKCdpZCcpXSA9IF92YWxpZGF0YWJsZXM7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBmb3IodmFyIGNvbXBJZCBpbiBfY29tcFZhbGlkYXRvcnMpIHsNCiAgICAgICAgICAgIC8vIOagoemqjOaWueW8j+imgee0r+iuoShUT0RPOiDmgI7moLfliZTpmaTph43lpI3nmoTmoKHpqoznsbvvvJ8pDQogICAgICAgICAgICB2YXIgX3ZhbGlkYXRvcnMgPSB0aGlzLmNvbXBWYWxpZGF0b3JzW2NvbXBJZF07DQogICAgICAgICAgICBpZiAoX3ZhbGlkYXRvcnMgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIF92YWxpZGF0b3JzID0gW107DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF9jb21wVmFsaWRhdG9yc1tjb21wSWRdLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgX3ZhbGlkYXRvcnMucHVzaChfY29tcFZhbGlkYXRvcnNbY29tcElkXVtpXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLmNvbXBWYWxpZGF0b3JzW2NvbXBJZF0gPSBfdmFsaWRhdG9yczsNCiAgICAgICAgfQ0KICAgIH0sDQoNCiAgICBvblZhbGlkYXRlIDogZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgdmFyIHZhbGlkYXRhYmxlcyA9IGV2ZW50LmRhdGEudmFsaWRhdGFibGVzOw0KICAgICAgICB2YXIgbXNncyA9IFZhbGlkYXRvci5jb21wVmFsaWRhdGUodGhpcywgdmFsaWRhdGFibGVzKTsNCiAgICAgICAgLy8NCiAgICAgICAgdmFyIGRpc3BsYXkgID0gZXZlbnQuZGF0YS5kaXNwbGF5Ow0KICAgICAgICBpZiAobXNncy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBkaXNwbGF5LnNob3dNZXNzYWdlcyh0aGlzLCBtc2dzKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGRpc3BsYXkuY2xlYXIodGhpcyk7DQogICAgICAgIH0NCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5Y246L295b2T5YmN5omA5pyJ5bey5rOo5YaM5o6n5Lu255qE5qCh6aqM5LqL5Lu255uR5ZCs5Zmo44CC5rOo5oSP77ya5Zug5Li65peg5rOV5Yy65YiG5pe26Ze055qE57G75Z6L77yM5omA5Lul5q2k5pON5L2c5bCG6Kej6ZmkDQogICAgICog5bey57uP5rOo5YaM55qE5omA5pyJ5o6n5Lu255qE4oCca2V5dXDigJ3vvIzigJxjaGFuZ2XigJ3kuovku7bjgILlpoLmnpzmnInpnZ7moKHpqoznlKjpgJTnmoTmraTnsbsNCiAgICAgKiDkuovku7bvvIzpnIDopoHph43mlrDms6jlhozkuIDmrKHjgIINCiAgICAgKi8NCiAgICB1bmJpbmQgOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIGlmICh0aGlzLmNvbXBWYWxpZGF0b3JzID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICAgIGpRdWVyeS5lYWNoKHRoaXMuY29tcFZhbGlkYXRvcnMsIGZ1bmN0aW9uKGNvbXBJZCwgdmFsaWRhdGFibGVzKSB7DQogICAgICAgICAgICB2YXIgX2NvbXAgPSBqUXVlcnkoJyMnICsgY29tcElkKTsNCiAgICAgICAgICAgIF9jb21wLnVuYmluZCgna2V5dXAnKTsNCiAgICAgICAgICAgIF9jb21wLnVuYmluZCgnY2hhbmdlJyk7DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmNvbXBWYWxpZGF0b3JzID0ge307DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOWwhuaMh+WumuaOp+S7tuWSjOWPr+agoemqjOaOpeWPo+e7keWumuWIsOS4gOi1t+OAgg0KICAgICAqLw0KICAgIGJpbmRDb21wb25lbnQgOiBmdW5jdGlvbiAoY29tcCwgdmFsaWRhdGFibGUpIHsNCiAgICAgICAgaWYgKGNvbXAgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY29tcG9uZW50IHRoYXQgYmUgYm91bmQgY2FuIG5vdCBiZSBudWxsLicpOw0KICAgICAgICB9DQogICAgICAgIGlmICh2YWxpZGF0YWJsZSA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdmFyIF9jb21wID0galF1ZXJ5KGNvbXApOw0KDQogICAgICAgIC8vIOiHquWKqOS6p+eUn+S4gOS4qmlkLCDnoa7kv53nu4Tku7bpg73mnIlJRA0KICAgICAgICB2YXIgaWQgPSBfY29tcC5hdHRyKCdpZCcpOw0KICAgICAgICBpZiAoaWQgPT0gbnVsbCB8fCBpZCA9PSAnJykgew0KICAgICAgICAgICAgaWQgPSAnX3ZhbF8nICsgSWRHZW5lcmF0b3IuZ2V0SWQoKTsNCiAgICAgICAgICAgIF9jb21wLmF0dHIoJ2lkJywgaWQpOw0KICAgICAgICB9DQogICAgICAgIHZhciB2YWxpZGF0YWJsZXMgPSB0aGlzLmNvbXBWYWxpZGF0b3JzW2lkXTsNCiAgICAgICAgaWYgKHZhbGlkYXRhYmxlcyA9PSBudWxsKSB7DQogICAgICAgICAgICB2YWxpZGF0YWJsZXMgPSBbXTsNCiAgICAgICAgfQ0KICAgICAgICB2YWxpZGF0YWJsZXMucHVzaCh2YWxpZGF0YWJsZSk7DQogICAgICAgIHRoaXMuY29tcFZhbGlkYXRvcnNbaWRdID0gdmFsaWRhdGFibGVzOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDmoKHpqozmiYDmnInnmoTlt7Lnu4/ms6jlhoznmoTmjqfku7bmmK/lkKblkIjms5UNCiAgICAgKi8NCiAgICB2YWxpZGF0ZSA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIHN1Y2Nlc3MgPSB0cnVlOw0KICAgICAgICAvLyBNZXNzYWdlQm94LmRlYnVnKCJ0aGlzLmNvbXBWYWxpZGF0b3JzPSIsIHRoaXMuY29tcFZhbGlkYXRvcnMpOw0KICAgICAgICBqUXVlcnkuZWFjaCh0aGlzLmNvbXBWYWxpZGF0b3JzLCBmdW5jdGlvbihjb21wSWQsIHZhbGlkYXRhYmxlcykgew0KICAgICAgICAgICAgdmFyIF9jb21wID0galF1ZXJ5KCcjJyArIGNvbXBJZCk7DQogICAgICAgICAgICBfY29tcC5jaGFuZ2UoKTsgIC8vIOinpuWPkeaOp+S7tueahOaUueWPmOS6i+S7tu+8jOaYvuekuumUmeivr+S/oeaBrw0KICAgICAgICAgICAgdmFyIG1zZ3MgPSBWYWxpZGF0b3IuY29tcFZhbGlkYXRlKF9jb21wLCB2YWxpZGF0YWJsZXMpOw0KICAgICAgICAgICAgaWYgKG1zZ3MgIT0gbnVsbCAmJiBtc2dzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBzdWNjZXNzID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIHJldHVybiBzdWNjZXNzOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDlsIbmnI3liqHlmajnq6/nmoTmoKHpqozlrprkuYnovazmjaLkuLrlrqLmiLfnq6/vvIhKU+W9ouW8j++8ieeahOagoemqjOWumuS5ieOAgg0KICAgICAqLw0KICAgIGNvbnZlcnQgOiBmdW5jdGlvbiAodmFsaWRhdGFibGVzKSB7DQogICAgICAgIHZhciBfdmFsaWRhdGFibGVzID0gW107DQogICAgICAgIGpRdWVyeS5lYWNoKHZhbGlkYXRhYmxlcywgZnVuY3Rpb24oaSwgdmFsaWRhdGFibGUpIHsNCiAgICAgICAgICAgIGlmICh2YWxpZGF0YWJsZSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgdmFyIF9jbGFzc05hbWUgPSB2YWxpZGF0YWJsZVsnX19jbGFzc05hbWUnXTsNCiAgICAgICAgICAgICAgICBpZiAoX2NsYXNzTmFtZSA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHByb3BlcnR5W19fY2xhc3NOYW1lXSBvZiB2YWxpZGF0YWJsZSBjYW4gbm90IGJlIG51bGwuJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHZhciBjb252ZXJ0ZXIgPSBWYWxpZGF0b3JDb252ZXJ0ZXJGYWN0b3J5LmdldENvbnZlcnRlcihfY2xhc3NOYW1lKTsNCiAgICAgICAgICAgICAgICB2YXIgdmFsaWRhdG9yID0gY29udmVydGVyLmdldFZhbGlkYXRvcih2YWxpZGF0YWJsZSk7DQogICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRvciA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHZhbGlkYXRhYmxlIG9mIHByb3BlcnR5WycgKyBfY2xhc3NOYW1lICsnXSBjYW4gbm90IGJlIGZvdW5kLicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBfdmFsaWRhdGFibGVzLnB1c2godmFsaWRhdG9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBfdmFsaWRhdGFibGVzOw0KICAgIH0NCn0pOw0KDQovKioNCiAqIOagoemqjOWFs+ezu+i9rOaNouWZqOW3peWOgu+8jOeUqOS6juWumuS5ieWuouaIt+err+WSjOacjeWKoeWZqOerr+agoemqjOWFs+ezu+eahOi9rOaNouaWueW8j+OAgg0KICovDQp2YXIgVmFsaWRhdG9yQ29udmVydGVyRmFjdG9yeSA9IHsNCg0KICAgIC8qKg0KICAgICAqIOi9rOaNouWZqOaYoOWwhOWFs+ezu++8jOS4u+mUruaYr++8muexu+WQje+8m+mUruWAvOaYr+i9rOaNouWZqOWunuS+i+OAgg0KICAgICAqLw0KICAgIF9jb252ZXJ0ZXJzIDogew0KICAgICAgICAiY29tLnh0Lmd0Lmh0bWwudmFsLlJlcXVpcmVkVmFsaWRhdG9yIiA6IG5ldyBSZXF1aXJlZFZhbGlkYXRvckNvbnZlcnRlcigpLA0KICAgICAgICAiY29tLnh0Lmd0Lmh0bWwudmFsLkxlbmd0aFZhbGlkYXRvciIgICA6IG5ldyBMZW5ndGhWYWxpZGF0b3JDb252ZXJ0ZXIoKSwNCiAgICAgICAgImNvbS54dC5ndC5odG1sLnZhbC5SYW5nZVZhbGlkYXRvciIgICAgOiBuZXcgUmFuZ2VWYWxpZGF0b3JDb252ZXJ0ZXIoKSwNCiAgICAgICAgImNvbS54dC5ndC5odG1sLnZhbC5FbWFpbFZhbGlkYXRvciIgICAgOiBuZXcgQ29tbW9uVmFsaWRhdG9yQ29udmVydGVyKCksDQogICAgICAgICJjb20ueHQuZ3QuaHRtbC52YWwuSFRUUFZhbGlkYXRvciIgICAgIDogbmV3IENvbW1vblZhbGlkYXRvckNvbnZlcnRlcigpLA0KICAgICAgICAiY29tLnh0Lmd0Lmh0bWwudmFsLlBob25lVmFsaWRhdG9yIiAgICA6IG5ldyBDb21tb25WYWxpZGF0b3JDb252ZXJ0ZXIoKSwNCiAgICAgICAgImNvbS54dC5ndC5odG1sLnZhbC5Nb2JpbGVWYWxpZGF0b3IiICAgOiBuZXcgQ29tbW9uVmFsaWRhdG9yQ29udmVydGVyKCksDQogICAgICAgICJjb20ueHQuZ3QuaHRtbC52YWwuU1NOVmFsaWRhdG9yIiAgICAgIDogbmV3IENvbW1vblZhbGlkYXRvckNvbnZlcnRlcigpLA0KICAgICAgICAiY29tLnh0Lmd0Lmh0bWwudmFsLkNoaW5lc2VWYWxpZGF0b3IiICA6IG5ldyBDb21tb25WYWxpZGF0b3JDb252ZXJ0ZXIoKSwNCiAgICAgICAgImNvbS54dC5ndC5odG1sLnZhbC5JbnRlZ2VyVmFsaWRhdG9yIiAgOiBuZXcgQ29tbW9uVmFsaWRhdG9yQ29udmVydGVyKCksDQogICAgICAgICJjb20ueHQuZ3QuaHRtbC52YWwuTG9uZ1ZhbGlkYXRvciIgIDogbmV3IENvbW1vblZhbGlkYXRvckNvbnZlcnRlcigpLA0KICAgICAgICAiY29tLnh0Lmd0Lmh0bWwudmFsLlBvc2l0aXZlSW50ZWdlclZhbGlkYXRvciIgOiBuZXcgQ29tbW9uVmFsaWRhdG9yQ29udmVydGVyKCksDQogICAgICAgICJjb20ueHQuZ3QuaHRtbC52YWwuRmxvYXRWYWxpZGF0b3IiICAgIDogbmV3IEZsb2F0VmFsaWRhdG9yQ29udmVydGVyKCksDQogICAgICAgICJjb20ueHQuZ3QuaHRtbC52YWwuRG91YmxlVmFsaWRhdG9yIiAgICA6IG5ldyBGbG9hdFZhbGlkYXRvckNvbnZlcnRlcigpDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOagueaNruexu+WQjeW+l+WIsOi9rOaNouWZqOOAgg0KICAgICAqLw0KICAgIGdldENvbnZlcnRlciA6IGZ1bmN0aW9uIChfY2xhc3NOYW1lKSB7DQogICAgICAgIHZhciBjb252ZXJ0ZXIgPSB0aGlzLl9jb252ZXJ0ZXJzW19jbGFzc05hbWVdOw0KICAgICAgICBpZiAoY29udmVydGVyID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGNvbnZlcnRlciBmb3IgY2xhc3NbJyArIF9jbGFzc05hbWUgKyAnXSBjYW4gbm90IGJlIGZvdW5kLicpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjb252ZXJ0ZXI7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIOazqOWGjOS4gOS4qui9rOaNouWZqOOAgg0KICAgICAqIEBwYXJhbSBfY2xhc3NOYW1lIOexu+WQjeensA0KICAgICAqIEBwYXJhbSBfY29udmVydGVyIOi9rOaNouWZqA0KICAgICAqLw0KICAgIHJlZ2lzdGVyIDogZnVuY3Rpb24gKF9jbGFzc05hbWUsIF9jb252ZXJ0ZXIpIHsNCiAgICAgICAgaWYgKF9jbGFzc05hbWUgPT0gbnVsbCB8fCBfY29udmVydGVyID09IG51bGwpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHBhcmFtZXRlcnMgY2FuIG5vdCBiZSBudWxsLicpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuX2NvbnZlcnRlcnNbX2NsYXNzTmFtZV0gPSBfY29udmVydGVyOw0KICAgIH0NCn0NCg0KLyoqDQogKiDmoKHpqozmtojmga/jgIINCiAqIEBwYXJhbSBtZXNzYWdlIOa2iOaBr+WGheWuuQ0KICogQHBhcmFtIGxldmVsICAgIOmUmeivr+eahOe6p+WIqywg6buY6K6k5Li6TGV2ZWwuRVJST1LjgIINCiAqIEBwYXJhbSB0aXAgICAgIOeUqOS6juWvuemUmeivr+aPkOS+m+WPi+WWhOeahOaPkOekuuS/oeaBr+OAgg0KICovDQpmdW5jdGlvbiBWYWxpZGF0ZU1lc3NhZ2UgKG1lc3NhZ2UsIGxldmVsLCB0aXApIHsNCiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOw0KICAgIHRoaXMubGV2ZWwgICA9IGxldmVsIHx8ICdMZXZlbC5FUlJPUic7DQogICAgdGhpcy50aXAgICAgID0gdGlwOw0KfQ0KDQpmdW5jdGlvbiBWYWxpZGF0YWJsZSAoKXsNCiAgICAvKioNCiAgICAgKiDlr7nlvZPliY3lgLzov5vooYzmoKHpqozvvIzlpoLmnpzlh7rnjrDplJnor6/vvIzlsIbplJnor6/kv6Hmga/ku6XigJxWYWxpZGF0ZU1lc3NhZ2XigJ3mlbDnu4TnmoTmlrnlvI/ov5Tlm57jgIINCiAgICAgKiDlkKbliJnvvIzov5Tlm57plb/luqbkuLogMCDnmoTmlbDnu4TjgIINCiAgICAgKi8NCiAgICB0aGlzLnByb3RvdHlwZS52YWxpZGF0ZSA9IGZ1bmN0aW9uICh2YWx1ZSkge30NCn0NCg0KLyoqDQogKiDkuI3og73kuLrnqbrmoKHpqozjgIINCiAqLw0KdmFyIFJlcXVpcmVkVmFsaWRhdG9yID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOw0KfQ0KDQpqUXVlcnkuZXh0ZW5kKFJlcXVpcmVkVmFsaWRhdG9yLnByb3RvdHlwZSwgew0KICAgIHZhbGlkYXRlIDogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgIHZhciB2bXMgPSBbXTsNCiAgICAgICAgdmFyIHZtID0gbmV3IFZhbGlkYXRlTWVzc2FnZSh0aGlzLm1lc3NhZ2UpOw0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgdm1zLnB1c2godm0pOw0KICAgICAgICB9DQogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlID09ICcnKSB7DQogICAgICAgICAgICB2bXMucHVzaCh2bSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCF2YWx1ZSkgew0KICAgICAgICAgICAgdm1zLnB1c2godm0pOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB2bXM7DQogICAgfQ0KfSk7DQoNCg0KZnVuY3Rpb24gUmVxdWlyZWRWYWxpZGF0b3JDb252ZXJ0ZXIoKSB7DQogICAgdGhpcy5nZXRWYWxpZGF0b3IgPSBmdW5jdGlvbihfdmFsaWRhdGFibGUpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBSZXF1aXJlZFZhbGlkYXRvcign5q2k6L6T5YWl5Z+f5Li65b+F5aGr6aG544CCJykNCiAgICB9DQp9DQoNCi8qKg0KICog5pyA5aSn6ZW/5bqm5qCh6aqM44CCDQogKi8NCnZhciBMZW5ndGhWYWxpZGF0b3IgPSBmdW5jdGlvbiAobGVuZ3RoLCBtc2cpIHsNCiAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDsNCiAgICB0aGlzLm1lc3NhZ2UgPSBtc2c7DQp9DQoNCmpRdWVyeS5leHRlbmQoTGVuZ3RoVmFsaWRhdG9yLnByb3RvdHlwZSwgew0KICAgIHZhbGlkYXRlIDogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgIHZhciB2bXMgPSBbXTsNCiAgICAgICAgdmFyIHZtID0gbmV3IFZhbGlkYXRlTWVzc2FnZSh0aGlzLm1lc3NhZ2UpOw0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIHZtczsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgdm1zLnB1c2godm0pOw0KICAgICAgICB9DQogICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiB0aGlzLmxlbmd0aCkgew0KICAgICAgICAgICAgdm1zLnB1c2godm0pOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB2bXM7DQogICAgfQ0KfSk7DQoNCmZ1bmN0aW9uIExlbmd0aFZhbGlkYXRvckNvbnZlcnRlcigpIHsNCiAgICB0aGlzLmdldFZhbGlkYXRvciA9IGZ1bmN0aW9uKF92YWxpZGF0YWJsZSkgew0KICAgICAgICB2YXIgdmFsaWRhdG9yID0gbmV3IExlbmd0aFZhbGlkYXRvcihfdmFsaWRhdGFibGUubGVuZ3RoLA0KICAgICAgICAgICAgJ+atpOi+k+WFpeWfn+eahOacgOWkp+mVv+W6puS4uicgKyBfdmFsaWRhdGFibGUubGVuZ3RoICsgJ+OAgicpOw0KICAgICAgICByZXR1cm4gdmFsaWRhdG9yOw0KICAgIH0NCn0NCg0KLyoqDQogKiDov5vooYzmnIDlpKflgLzlkozmnIDlsI/lgLzmoKHpqozvvIzooqvmoKHpqoznmoTlgLzopoHlpKfkuo7nrYnkuo7mnIDlsI/lgLzvvIzlsI/kuo7nrYnkuo7mnIDlpKflgLzjgIINCiAqLw0KdmFyIFJhbmdlVmFsaWRhdG9yID0gZnVuY3Rpb24obWluLCBtYXgsIG1zZykgew0KICAgIHRoaXMubWluID0gbWluOw0KICAgIHRoaXMubWF4ID0gbWF4Ow0KICAgIHRoaXMubWVzc2FnZSA9IG1zZzsNCn0NCg0KalF1ZXJ5LmV4dGVuZChSYW5nZVZhbGlkYXRvci5wcm90b3R5cGUsIHsNCiAgICB2YWxpZGF0ZSA6IGZ1bmN0aW9uICh2YWx1ZSkgew0KICAgICAgICB2YXIgdm1zID0gW107DQogICAgICAgIHZhciB2bSA9IG5ldyBWYWxpZGF0ZU1lc3NhZ2UodGhpcy5tZXNzYWdlKTsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiB2bXM7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgKHZhbHVlID4gdGhpcy5tYXggfHwgdmFsdWUgPCB0aGlzLm1pbikpIHsNCiAgICAgICAgICAgIHZtcy5wdXNoKHZtKTsNCiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIHZhciBfdmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKTsNCiAgICAgICAgICAgIGlmIChfdmFsdWUgPiB0aGlzLm1heCB8fCBfdmFsdWUgPCB0aGlzLm1pbikgew0KICAgICAgICAgICAgICAgIHZtcy5wdXNoKHZtKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdm1zOw0KICAgIH0NCn0pOw0KDQpmdW5jdGlvbiBSYW5nZVZhbGlkYXRvckNvbnZlcnRlcigpIHsNCiAgICB0aGlzLmdldFZhbGlkYXRvciA9IGZ1bmN0aW9uKF92YWxpZGF0YWJsZSkgew0KICAgICAgICByZXR1cm4gbmV3IFJhbmdlVmFsaWRhdG9yKF92YWxpZGF0YWJsZS5taW4sIF92YWxpZGF0YWJsZS5tYXgsDQogICAgICAgICAgICAn5q2k6L6T5YWl5Z+f55qE5pyA5aSn6ZW/5bqm5Li6WycgKyBfdmFsaWRhdGFibGUubWF4ICsgJ13jgIInKTsNCiAgICB9DQp9DQoNCi8qKg0KICog5q2j5YiZ6KGo6L6+5byP5qCh6aqM44CCDQogKi8NCnZhciBSZWdFeHBWYWxpZGF0b3IgPSBmdW5jdGlvbiAocmVnRXhwLCBtc2cpIHsNCiAgICB0aGlzLnJlZ0V4cCA9IHJlZ0V4cDsNCiAgICB0aGlzLm1lc3NhZ2UgPSBtc2c7DQp9DQoNCmpRdWVyeS5leHRlbmQoUmVnRXhwVmFsaWRhdG9yLnByb3RvdHlwZSwgew0KICAgIHZhbGlkYXRlIDogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgIHZhciB2bXMgPSBbXTsNCiAgICAgICAgdmFyIHZtID0gbmV3IFZhbGlkYXRlTWVzc2FnZSh0aGlzLm1lc3NhZ2UpOw0KICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIHZtczsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgdm1zLnB1c2godm0pOw0KICAgICAgICAgICAgcmV0dXJuIHZtczsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5yZWdFeHAgPT0gbnVsbCkgew0KICAgICAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCLnlKjkuo7moKHpqoznmoTmraPliJnooajovr7lvI/kuI3og73kuLrnqbrjgIIiKTsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB3aGljaCB3YXMgdXNlZCBvbiB2YWxpZGF0aW5nIGNhbiBub3QgYmUgbnVsbC4iKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgX3BhdHRlcm4gPSB0aGlzLnJlZ0V4cDsNCiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnJlZ0V4cCA9PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgX3BhdHRlcm4gPSBuZXcgUmVnRXhwKHRoaXMucmVnRXhwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIV9wYXR0ZXJuLnRlc3QodmFsdWUpKSB7DQogICAgICAgICAgICB2bXMucHVzaCh2bSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHZtczsNCiAgICB9DQp9KTsNCg0KLyoqDQogKiBlTWFpbCDmoKHpqozlmagsIOm7mOiupOagvOW8j+S4ujogXlxcdysoWy0rLl1cXHcrKSpAXFx3KyhbLS5dXFx3KykqLlxcdysoWy0uXVxcdyspKiTvvIwNCiAqIOWPr+mAmui/h+WPguaVsCB2YWxpZGF0aW9uLmVtYWlsIOi/m+ihjOmFjee9ruOAgg0KICovDQp2YXIgRW1haWxWYWxpZGF0b3IgPSBmdW5jdGlvbiAobXNnKSB7DQogICAgdGhpcy5tZXNzYWdlID0gbXNnIHx8ICfnlLXlrZDpgq7ku7bnmoTmoLzlvI/plJnor6/jgIInOw0KICAgIHZhciBleHAgPSBTeXN0ZW1Db25maWd1cmF0aW9uLnJlYWQoJ3ZhbGlkYXRpb24uZW1haWwnKQ0KICAgIHx8ICdeXFx3KyhbLSsuXVxcdyspKkBcXHcrKFstLl1cXHcrKSouXFx3KyhbLS5dXFx3KykqJCc7DQogICAgdGhpcy5yZWdFeHBWYWxpZGF0b3IgID0gbmV3IFJlZ0V4cFZhbGlkYXRvcihleHAsIG1zZyk7DQp9DQoNCmpRdWVyeS5leHRlbmQoRW1haWxWYWxpZGF0b3IucHJvdG90eXBlLCB7DQogICAgdmFsaWRhdGUgOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVnRXhwVmFsaWRhdG9yLnZhbGlkYXRlKHZhbHVlKTsNCiAgICB9DQp9KTsNCg0KLyoqDQogKiDpgJrnlKjnmoTmoKHpqozovazmjaLlmagsIOatpOi9rOaNouWZqOWuieijheagoemqjOexu+eahOWQjeensCjkuI3ljIXmi6zljIXlkI0pLCDliqDkuIoiVmFsaWRhdG9yIiDkvZzkuLrlrqLmiLfnq6/moKHpqoznsbvnmoTlkI3np7DvvIwNCiAqIOW5tuS4lO+8jOWPguaVsOWPquacieKAnG1lc3NhZ2XigJ3kuIDkuKrnmoTmg4XlhrXkuIvjgIINCiAqLw0KZnVuY3Rpb24gQ29tbW9uVmFsaWRhdG9yQ29udmVydGVyKCkgew0KICAgIHRoaXMuZ2V0VmFsaWRhdG9yID0gZnVuY3Rpb24oX3ZhbGlkYXRhYmxlKSB7DQogICAgICAgIHZhciBfY2xhc3NOYW1lID0gX3ZhbGlkYXRhYmxlWydfX2NsYXNzTmFtZSddOw0KDQogICAgICAgIC8vIE1lc3NhZ2VCb3guZGVidWcoJ0NvbW1vblZhbGlkYXRvckNvbnZlcnRlciBfY2xhc3NOYW1lPScsIF9jbGFzc05hbWUpOw0KICAgICAgICBpZiAoX2NsYXNzTmFtZSA9PSBudWxsIHx8IF9jbGFzc05hbWUgPT0gJycpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIG5hbWUgb2YgdmFsaWRhdG9yIGNhbiBub3QgYmUgbnVsbC4nKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgc2VncyA9IF9jbGFzc05hbWUuc3BsaXQoJy4nKTsNCiAgICAgICAgdmFyIG5hbWUgPSBzZWdzW3NlZ3MubGVuZ3RoIC0gMV07ICAvLyDlj5bnsbvnmoTlkI3np7ANCiAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygnQ29tbW9uVmFsaWRhdG9yQ29udmVydGVyIG5hbWU9JywgbmFtZSk7DQogICAgICAgIHZhciBleHAgPSAnbmV3ICcgKyBuYW1lICsgJyhcIicgKyBfdmFsaWRhdGFibGUubWVzc2FnZSArICdcIiknOw0KICAgICAgICByZXR1cm4gZXZhbChleHApOw0KICAgIH0NCn0NCg0KLyoqDQogKiBVUkwg5Zyw5Z2A5qCh6aqM5ZmoLCDpu5jorqTmoLzlvI/kuLo6IF5odHRwcz86Ly8oW1xcd1xcLV0rLikrW1xcd1xcLV0rKC9bXFx3XFwtXFwuLz8lJj1dKik/JO+8jA0KICog5Y+v6YCa6L+H5Y+C5pWwIHZhbGlkYXRpb24uaHR0cCDov5vooYzphY3nva7jgIINCiAqLw0KdmFyIEhUVFBWYWxpZGF0b3IgPSBmdW5jdGlvbiAobXNnKSB7DQogICAgdGhpcy5tZXNzYWdlID0gbXNnIHx8ICdIVFRQIOWcsOWdgOeahOagvOW8j+S4jeato+ehruOAgic7DQogICAgdmFyIGV4cCA9IFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgndmFsaWRhdGlvbi5odHRwJykNCiAgICB8fCAnXmh0dHBzPzovLyhbXFx3LV0rLikrW1xcdy1dKygvW1xcd1xcLVxcLi8/JSY9XSopPyQnOw0KICAgIHRoaXMucmVnRXhwVmFsaWRhdG9yICA9IG5ldyBSZWdFeHBWYWxpZGF0b3IoZXhwLCBtc2cpOw0KfQ0KDQpqUXVlcnkuZXh0ZW5kKEhUVFBWYWxpZGF0b3IucHJvdG90eXBlLCB7DQogICAgdmFsaWRhdGUgOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVnRXhwVmFsaWRhdG9yLnZhbGlkYXRlKHZhbHVlKTsNCiAgICB9DQp9KTsNCg0KDQovKioNCiAqIOeUteivneWPt+egge+8iOS4jeWMheaLrOaJi+acuu+8ieagoemqjOWZqCwg6buY6K6k5qC85byP5Li6OiBeKChcZHszLDR9KXxcZHszLDR9LSk/XGR7Nyw4fSTvvIwNCiAqIOWPr+mAmui/h+WPguaVsCB2YWxpZGF0aW9uLnBob25lIOi/m+ihjOmFjee9ruOAgg0KICovDQp2YXIgUGhvbmVWYWxpZGF0b3IgPSBmdW5jdGlvbiAobXNnKSB7DQogICAgdGhpcy5tZXNzYWdlID0gbXNnIHx8ICfnlLXor53lj7fnoIHnmoTmoLzlvI/kuI3mraPnoa7jgIInOw0KICAgIHZhciBleHAgPSBTeXN0ZW1Db25maWd1cmF0aW9uLnJlYWQoJ3ZhbGlkYXRpb24ucGhvbmUnKQ0KICAgIHx8ICdeKChcXGR7Myw0fSl8XFxkezMsNH0tKT9cXGR7Nyw4fSQnOw0KICAgIHRoaXMucmVnRXhwVmFsaWRhdG9yICA9IG5ldyBSZWdFeHBWYWxpZGF0b3IoZXhwLCBtc2cpOw0KfQ0KDQpqUXVlcnkuZXh0ZW5kKFBob25lVmFsaWRhdG9yLnByb3RvdHlwZSwgew0KICAgIHZhbGlkYXRlIDogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlZ0V4cFZhbGlkYXRvci52YWxpZGF0ZSh2YWx1ZSk7DQogICAgfQ0KfSk7DQoNCi8qKg0KICog56e75Yqo55S16K+d5Y+356CB5qCh6aqM5ZmoLCDpu5jorqTmoLzlvI/kuLo6IF4xXFxkezEyLDEyfSTvvIwNCiAqIOWPr+mAmui/h+WPguaVsCB2YWxpZGF0aW9uLm1vYmlsZSDov5vooYzphY3nva7jgIINCiAqLw0KdmFyIE1vYmlsZVZhbGlkYXRvciA9IGZ1bmN0aW9uIChtc2cpIHsNCiAgICB0aGlzLm1lc3NhZ2UgPSBtc2cgfHwgJ+enu+WKqOeUteivneeahOagvOW8j+S4jeato+ehruOAgic7DQogICAgdmFyIGV4cCA9IFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgndmFsaWRhdGlvbi5tb2JpbGUnKQ0KICAgIHx8ICdeMVxcZHsxMCwxMH0kJzsNCiAgICB0aGlzLnJlZ0V4cFZhbGlkYXRvciAgPSBuZXcgUmVnRXhwVmFsaWRhdG9yKGV4cCwgbXNnKTsNCn0NCg0KalF1ZXJ5LmV4dGVuZChNb2JpbGVWYWxpZGF0b3IucHJvdG90eXBlLCB7DQogICAgdmFsaWRhdGUgOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVnRXhwVmFsaWRhdG9yLnZhbGlkYXRlKHZhbHVlKTsNCiAgICB9DQp9KTsNCg0KDQovKioNCiAqIOi6q+S7veivgeagoemqjOWZqCwg6buY6K6k5qC85byP5Li6OiBeXFxkezE1fXxcXGR7MTh9JO+8jA0KICog5Y+v6YCa6L+H5Y+C5pWwIHZhbGlkYXRpb24uc3NuIOi/m+ihjOmFjee9ruOAgg0KICovDQp2YXIgU1NOVmFsaWRhdG9yID0gZnVuY3Rpb24gKG1zZykgew0KICAgIHRoaXMubWVzc2FnZSA9IG1zZyB8fCAn6Lqr5Lu96K+B5Y+356CB55qE5qC85byP5LiN5q2j56Gu44CCJzsNCiAgICB2YXIgZXhwID0gU3lzdGVtQ29uZmlndXJhdGlvbi5yZWFkKCd2YWxpZGF0aW9uLnNzbicpDQogICAgfHwgJ15cXGR7MTV9fFxcZHsxOH0kJzsNCiAgICB0aGlzLnJlZ0V4cFZhbGlkYXRvciAgPSBuZXcgUmVnRXhwVmFsaWRhdG9yKGV4cCwgbXNnKTsNCn0NCg0KalF1ZXJ5LmV4dGVuZChTU05WYWxpZGF0b3IucHJvdG90eXBlLCB7DQogICAgdmFsaWRhdGUgOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVnRXhwVmFsaWRhdG9yLnZhbGlkYXRlKHZhbHVlKTsNCiAgICB9DQp9KTsNCg0KLyoqDQogKiDkuK3mlofmoKHpqozlmagsIOm7mOiupOagvOW8j+S4ujogXltcdTRlMDAtXHU5ZmE1XSok77yMDQogKiDlj6/pgJrov4flj4LmlbAgdmFsaWRhdGlvbi5jaGluZXNlIOi/m+ihjOmFjee9ruOAgg0KICovDQp2YXIgQ2hpbmVzZVZhbGlkYXRvciA9IGZ1bmN0aW9uIChtc2cpIHsNCiAgICB0aGlzLm1lc3NhZ2UgPSBtc2cgfHwgJ+WPquWFgeiuuOi+k+WFpeS4reaWh+Wtl+espuOAgic7DQogICAgdmFyIGV4cCA9IFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgndmFsaWRhdGlvbi5jaGluZXNlJykNCiAgICB8fCAnXltcdTRlMDAtXHU5ZmE1XSokJzsNCiAgICB0aGlzLnJlZ0V4cFZhbGlkYXRvciAgPSBuZXcgUmVnRXhwVmFsaWRhdG9yKGV4cCwgbXNnKTsNCn0NCg0KalF1ZXJ5LmV4dGVuZChDaGluZXNlVmFsaWRhdG9yLnByb3RvdHlwZSwgew0KICAgIHZhbGlkYXRlIDogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlZ0V4cFZhbGlkYXRvci52YWxpZGF0ZSh2YWx1ZSk7DQogICAgfQ0KfSk7DQoNCi8qKg0KICog5pW05pWw57G75Z6L5qCh6aqM44CC5pyA5aSn5YC85Li6Ojk5OTk5OTk5OeOAgiDpu5jorqTmoLzlvI/kuLo6IF4oXFwrfFxcLSk/KFsxLTldXFxkezAsOH0pfDAk77yMDQogKiDlj6/pgJrov4flj4LmlbAgdmFsaWRhdGlvbi5pbnRlZ2VyIOi/m+ihjOmFjee9ruOAgg0KICovDQp2YXIgSW50ZWdlclZhbGlkYXRvciA9IGZ1bmN0aW9uIChtc2cpIHsNCiAgICB2YXIgZXhwID0gU3lzdGVtQ29uZmlndXJhdGlvbi5yZWFkKCd2YWxpZGF0aW9uLmludGVnZXInKQ0KICAgIHx8ICdeKChcXCt8XFwtKT8oWzEtOV1cXGR7MCw4fSl8MCkkJzsNCiAgICB0aGlzLnJlZ0V4cFZhbGlkYXRvciA9IG5ldyBSZWdFeHBWYWxpZGF0b3IoZXhwLCBtc2cpOw0KICAgIHRoaXMubWVzc2FnZSA9IG1zZyB8fCAn6L6T5YWl5YC85b+F6aG75Li65pW05pWw44CCJzsNCn0NCg0KalF1ZXJ5LmV4dGVuZChJbnRlZ2VyVmFsaWRhdG9yLnByb3RvdHlwZSwgew0KICAgIHZhbGlkYXRlIDogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlZ0V4cFZhbGlkYXRvci52YWxpZGF0ZSh2YWx1ZSk7DQogICAgfQ0KfSk7DQoNCi8qKg0KICog6ZW/5pW05pWw57G75Z6L5qCh6aqM44CC5pyA5aSn5YC85Li6Ojk5OTk5OTk5OTk5OTk5OTk5OeOAgiDpu5jorqTmoLzlvI/kuLo6IF4oXFwrfFxcLSk/KFsxLTldXFxkezAsMTd9KXwwJO+8jA0KICog5Y+v6YCa6L+H5Y+C5pWwIHZhbGlkYXRpb24ubG9uZyDov5vooYzphY3nva7jgIINCiAqLw0KdmFyIExvbmdWYWxpZGF0b3IgPSBmdW5jdGlvbiAobXNnKSB7DQogICAgdmFyIGV4cCA9IFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgndmFsaWRhdGlvbi5sb25nJykNCiAgICB8fCAnXigoXFwrfFxcLSk/KFsxLTldXFxkezAsMTd9KXwwKSQnOw0KICAgIHRoaXMucmVnRXhwVmFsaWRhdG9yID0gbmV3IFJlZ0V4cFZhbGlkYXRvcihleHAsIG1zZyk7DQogICAgdGhpcy5tZXNzYWdlID0gbXNnIHx8ICfovpPlhaXlgLzlv4XpobvkuLrplb/mlbTmlbDjgIInOw0KfQ0KDQpqUXVlcnkuZXh0ZW5kKExvbmdWYWxpZGF0b3IucHJvdG90eXBlLCB7DQogICAgdmFsaWRhdGUgOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVnRXhwVmFsaWRhdG9yLnZhbGlkYXRlKHZhbHVlKTsNCiAgICB9DQp9KTsNCg0KLyoqDQogKiDmraPmlbTmlbDnsbvlnovmoKHpqozjgILmnIDlpKflgLzkuLo6OTk5OTk5OTk5OTnjgILpu5jorqTmoLzlvI/kuLo6IF4oWzEtOV1cXGR7MCw4fSl8MCTvvIwNCiAqIOWPr+mAmui/h+WPguaVsCB2YWxpZGF0aW9uLnBvc2l0aXZlSW50ZWdlciDov5vooYzphY3nva7jgIINCiAqLw0KdmFyIFBvc2l0aXZlSW50ZWdlclZhbGlkYXRvciA9IGZ1bmN0aW9uIChtc2cpIHsNCiAgICB2YXIgZXhwID0gU3lzdGVtQ29uZmlndXJhdGlvbi5yZWFkKCd2YWxpZGF0aW9uLnBvc2l0aXZlSW50ZWdlcicpDQogICAgfHwgJ14oKFsxLTldXFxkezAsOX0pfDApJCc7DQogICAgdGhpcy5yZWdFeHBWYWxpZGF0b3IgPSBuZXcgUmVnRXhwVmFsaWRhdG9yKGV4cCwgbXNnKTsNCiAgICB0aGlzLm1lc3NhZ2UgPSBtc2cgfHwgJ+i+k+WFpeWAvOW/hemhu+S4uuato+aVtOaVsOOAgic7DQp9DQoNCmpRdWVyeS5leHRlbmQoUG9zaXRpdmVJbnRlZ2VyVmFsaWRhdG9yLnByb3RvdHlwZSwgew0KICAgIHZhbGlkYXRlIDogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlZ0V4cFZhbGlkYXRvci52YWxpZGF0ZSh2YWx1ZSk7DQogICAgfQ0KfSk7DQoNCi8qKg0KICog5rWu54K55pWw57G75Z6L5qCh6aqM44CC5pyA5aSn5YC85Li6Ojk5OTk5OTk5OTk5Ljk544CC6buY6K6k5qC85byP5Li6OiBeKFxcK3xcXC0pPygoWzEtOF1cXGR7MCw5fSl8MCkoXFwuXFxkXFxkezAsJHtzY2FsZX19KT8k77yMDQogKiDlj6/pgJrov4flj4LmlbAgdmFsaWRhdGlvbi5mbG9hdCDov5vooYzphY3nva7jgIINCiAqLw0KdmFyIEZsb2F0VmFsaWRhdG9yID0gZnVuY3Rpb24gKG1zZywgc2NhbGUpIHsNCiAgICB0aGlzLm1lc3NhZ2UgPSBtc2cgfHwgJ+i+k+WFpeWAvOW/hemhu+S4uuWQiOazleeahOWwj+aVsOOAgic7DQogICAgdGhpcy5zY2FsZSA9IHNjYWxlICB8fCAyOyAgLy8g5bCP5pWw54K55ZCO55qE5L2N5pWwDQogICAgdmFyIGV4cCA9IFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgndmFsaWRhdGlvbi5mbG9hdCcpDQogICAgfHwgJ14oXFwrfFxcLSk/KChbMS05XVxcZHswLDl9KXwwKShcXC5cXGRcXGR7MCwke3NjYWxlfX0pPyQnOw0KDQogICAgZXhwID0gZXhwLnJlcGxhY2UoL1wkXHtzY2FsZVx9LywgdGhpcy5zY2FsZSAtIDEpOyAgLy8g5pu/5o2i5Y+Y6YePDQogICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygnRmxvYXRWYWxpZGF0b3IgZXhwPScgKyBleHApOw0KICAgIHRoaXMucmVnRXhwVmFsaWRhdG9yID0gbmV3IFJlZ0V4cFZhbGlkYXRvcihleHAsIG1zZyk7DQp9DQoNCmpRdWVyeS5leHRlbmQoRmxvYXRWYWxpZGF0b3IucHJvdG90eXBlLCB7DQogICAgdmFsaWRhdGUgOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVnRXhwVmFsaWRhdG9yLnZhbGlkYXRlKHZhbHVlKTsNCiAgICB9DQp9KTsNCg0KZnVuY3Rpb24gRmxvYXRWYWxpZGF0b3JDb252ZXJ0ZXIoKSB7DQogICAgdGhpcy5nZXRWYWxpZGF0b3IgPSBmdW5jdGlvbihfdmFsaWRhdGFibGUpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBGbG9hdFZhbGlkYXRvcihfdmFsaWRhdGFibGUubWVzc2FnZSwgX3ZhbGlkYXRhYmxlLnNjYWxlKTsNCiAgICB9DQp9DQoNCi8qKg0KICog5Y+M57K+5bqm5bCP5pWw57G75Z6L5qCh6aqM44CC5pyA5aSn5YC85Li6Ojk5OTk5OTk5OTk5OTk5OTk5OTk5OTkuOTnjgIINCiAqIOm7mOiupOagvOW8j+S4ujogXihcXCt8XFwtKT8oKFsxLTE3XVxcZHswLDl9KXwwKShcXC5cXGRcXGR7MCwke3NjYWxlfX0pPyTvvIwNCiAqIOWPr+mAmui/h+WPguaVsCB2YWxpZGF0aW9uLmRvdWJsZSDov5vooYzphY3nva7jgIINCiAqLw0KdmFyIERvdWJsZVZhbGlkYXRvciA9IGZ1bmN0aW9uIChtc2csIHNjYWxlKSB7DQogICAgdGhpcy5tZXNzYWdlID0gbXNnIHx8ICfovpPlhaXlgLzlv4XpobvkuLrlkIjms5XnmoTlj4znsr7luqblsI/mlbDjgIInOw0KICAgIHRoaXMuc2NhbGUgPSBzY2FsZSAgfHwgMjsgIC8vIOWwj+aVsOeCueWQjueahOS9jeaVsA0KICAgIHZhciBleHAgPSBTeXN0ZW1Db25maWd1cmF0aW9uLnJlYWQoJ3ZhbGlkYXRpb24uZG91YmxlJykNCiAgICB8fCAnXihcXCt8XFwtKT8oKFsxLTldXFxkezAsMTd9KXwwKShcXC5cXGRcXGR7MCwke3NjYWxlfX0pPyQnOw0KDQogICAgZXhwID0gZXhwLnJlcGxhY2UoL1wkXHtzY2FsZVx9LywgdGhpcy5zY2FsZSAtIDEpOyAgLy8g5pu/5o2i5Y+Y6YePDQogICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygnRmxvYXRWYWxpZGF0b3IgZXhwPScgKyBleHApOw0KICAgIHRoaXMucmVnRXhwVmFsaWRhdG9yID0gbmV3IFJlZ0V4cFZhbGlkYXRvcihleHAsIG1zZyk7DQp9DQoNCmpRdWVyeS5leHRlbmQoRG91YmxlVmFsaWRhdG9yLnByb3RvdHlwZSwgew0KICAgIHZhbGlkYXRlIDogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlZ0V4cFZhbGlkYXRvci52YWxpZGF0ZSh2YWx1ZSk7DQogICAgfQ0KfSk7DQoNCmZ1bmN0aW9uIERvdWJsZVZhbGlkYXRvckNvbnZlcnRlcigpIHsNCiAgICB0aGlzLmdldFZhbGlkYXRvciA9IGZ1bmN0aW9uKF92YWxpZGF0YWJsZSkgew0KICAgICAgICByZXR1cm4gbmV3IERvdWJsZVZhbGlkYXRvcihfdmFsaWRhdGFibGUubWVzc2FnZSwgX3ZhbGlkYXRhYmxlLnNjYWxlKTsNCiAgICB9DQp9DQoNCi8qKg0KICog55So5LqO5Y+C5pWw57uE5bu65ZKM6Kej5p6Q55qE5Yqp5omL57G744CCVE9ETzog6ICD6JmRIFVSTCDkuK3lrZjlnKjigJwj4oCd55qE5oOF5Ya144CCDQogKi8NCnZhciBQYXJhbWV0ZXJIZWxwZXIgPSB7DQogICAgLyoqDQogICAgICog6KGo56S65LiA5Liq5YC85pivIEpTT04g6KGo6L6+5byP55qE5YmN57yA44CCDQogICAgICovDQogICAgSlNPTl9QUkVGSVggOiAnX19qc29uX186JywNCg0KICAgIC8qDQogICAgICogIOS7juW9k+WJjeaWh+aho+eahOi/nuaOpe+8iGhyZWbvvInkuK3or7vlj5bmiYDmnInlj4LmlbANCiAgICAgKiAgQHJldHVybiAg5Y+C5pWwIE1hcO+8jOWmguaenOWPguaVsOS4uuWkmuS4quWAvO+8jOWImei/lOWbnueahOaYr+aVsOe7hOOAgg0KICAgICAqLw0KICAgIHBhcnNlIDogZnVuY3Rpb24gKGhyZWYpIHsNCiAgICAgICAgaWYgKGhyZWYgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIHt9Ow0KICAgICAgICB9DQoNCiAgICAgICAgLy8g5Y675o6J5ZCO57yA77yII++8iQ0KICAgICAgICB2YXIgc2VncyA9IGhyZWYuc3BsaXQoJyMnKTsNCiAgICAgICAgdmFyIGNsZWFuSHJlZiA9IGhyZWY7DQogICAgICAgIGlmIChzZWdzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGNsZWFuSHJlZiA9IHNlZ3NbMF07DQogICAgICAgIH0NCg0KICAgICAgICAvLyBhbGVydCgnaHJlZj0nICsgaHJlZik7DQogICAgICAgIHZhciBhcmdzICA9IGNsZWFuSHJlZi5zcGxpdCgiPyIpOw0KICAgICAgICB2YXIgcmV0VmFsID0ge307DQoNCiAgICAgICAgLyrlj4LmlbDkuLrnqboqLw0KICAgICAgICBpZihhcmdzWzBdID09IGNsZWFuSHJlZikgew0KICAgICAgICAgICAgcmV0dXJuIHJldFZhbDsgLyrml6DpnIDlgZrku7vkvZXlpITnkIYqLw0KICAgICAgICB9DQogICAgICAgIHZhciBzdHIgPSBhcmdzWzFdOw0KICAgICAgICBhcmdzID0gc3RyLnNwbGl0KCImIik7DQogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSArKykgew0KICAgICAgICAgICAgc3RyID0gYXJnc1tpXTsNCiAgICAgICAgICAgIHZhciBhcmcgPSBzdHIuc3BsaXQoIj0iKTsNCiAgICAgICAgICAgIGlmKGFyZy5sZW5ndGggPD0gMSkgY29udGludWU7DQogICAgICAgICAgICB2YXIgbmFtZSAgPSBhcmdbMF07DQogICAgICAgICAgICAvLyBUT0RPOiDmraTlpITlrZjlnKjkuIDkuKrpmZDliLbvvIzmma7pgJrlj4LmlbDkuI3og73ku6XigJxfX2pzb25fXzrigJ3lvIDlpLQNCiAgICAgICAgICAgIHZhciBfdmFsID0gZGVjb2RlVVJJKGFyZ1sxXSk7DQogICAgICAgICAgICB2YXIgdmFsdWUgPSAobmV3IFJlZ0V4cCgnXicgKyBQYXJhbWV0ZXJIZWxwZXIuSlNPTl9QUkVGSVggKyAnLisnKSkudGVzdChfdmFsKSA/DQogICAgICAgICAgICBKU09OLnBhcnNlKF92YWwuc3Vic3RyaW5nKFBhcmFtZXRlckhlbHBlci5KU09OX1BSRUZJWC5sZW5ndGgpKQ0KICAgICAgICAgICAgOiBfdmFsOyAgLy8g5YC85Y+v6IO95piv5aSN5p2C55qE77yM5q+U5aaC77yaSlNPTiDooajovr7lvI8NCiAgICAgICAgICAgIC8vIE1lc3NhZ2VCb3guZGVidWcoJ25hbWU9JyArIG5hbWUgKyAnOyB2YWx1ZT0nICsgdmFsdWUpOw0KICAgICAgICAgICAgaWYgKHJldFZhbFtuYW1lXSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgLy8g5aSE55CG5aSa5YC8DQogICAgICAgICAgICAgICAgaWYgKHJldFZhbFtuYW1lXSBpbnN0YW5jZW9mIEFycmF5KSB7DQogICAgICAgICAgICAgICAgICAgIHJldFZhbFtuYW1lXS5wdXNoKHZhbHVlKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWVzID0gW107DQogICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHJldFZhbFtuYW1lXSwgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICByZXRWYWxbbmFtZV0gPSB2YWx1ZXM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXRWYWxbbmFtZV0gPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmV0VmFsOw0KICAgIH0sDQoNCiAgICBidWlsZCA6IGZ1bmN0aW9uIChwYXJhbXMpIHsNCiAgICAgICAgaWYgKHBhcmFtcyA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHBhcmFtc1N0ciA9ICcnOw0KICAgICAgICBqUXVlcnkuZWFjaChwYXJhbXMsIGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgew0KICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICB2YXIgX3ZhbHVlID0gdmFsdWU7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgICAgICAgICAgICAgX3ZhbHVlID0gUGFyYW1ldGVySGVscGVyLkpTT05fUFJFRklYICsgSlNPTi5zdHJpbmdpZnkodmFsdWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyDov5vooYznvJbnoIENCiAgICAgICAgICAgICAgICBwYXJhbXNTdHIgKz0gJyYnICsgZW5jb2RlVVJJKG5hbWUpICsgJz0nICsgZW5jb2RlVVJJKF92YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcGFyYW1zU3RyOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiDlnKjmjIflrprnmoQgVVJMIOWQjumdoue8gOS4iuWPguaVsOOAgg0KICAgICAqLw0KICAgIGFwcGVuZCA6IGZ1bmN0aW9uICh1cmwsIHBhcmFtcykgew0KICAgICAgICB2YXIgcmV0ID0gdXJsIHx8ICcnOw0KICAgICAgICBpZiAocmV0LmluZGV4T2YoJz8nKSA8IDApIHsNCiAgICAgICAgICAgIHJldCArPSAnP19udWxsXz0wJzsgIC8vIOWNoOS9jeespg0KICAgICAgICB9DQogICAgICAgIHJldHVybiAocmV0ICsgdGhpcy5idWlsZChwYXJhbXMpKTsNCiAgICB9DQoNCn0NCg0KDQovKioNCiAqIOaXpeacn+agvOW8j+WMluWHveaVsO+8jOeUqOS6juWwhuaXpeacn+exu+Wei+i9rOaNouS4uuaMh+WumuagvOW8j+OAguaMh+WumueahOKAnFBhdHRlcm7igJ3mmK/igJxqYXZhLnRleHQuU2ltcGxlRGF0ZUZvcm1hdOKAnQ0KICog55qE5LiA5Liq5a2Q6ZuG44CC5rOo5oSP77ya5pys566X5rOV5Y+q5piv6YeH55So566A5Y2V55qE5q2j5YiZ6KGo6L6+5byP5pu/5o2i77yM5Zug5q2k5Y+v6IO96YeN5aSN77yI6ZSZ6K+v77yJ55qE5oOF5Ya144CCDQogKiDnm67liY3vvIzmraTlh73mlbDlj6rmlK/mjIHmoLzlvI/ljJbvvIzkuI3mlK/mjIHop6PmnpDjgIINCiAqLw0KdmFyIERhdGVGb3JtYXQgPSB7DQogICAgcmVwbGFjZVNpbmdsZVF1b3RhdGlvbiA6IHRydWUsICAvLyDmmK/lkKbmm7/mjaLmjonmqKHmnb/kuK3nmoTljZXlvJXlj7cNCg0KICAgIG1vbnRocyA6IFsn5LiA5pyIJywgJ+S6jOaciCcsICfkuInmnIgnLCAn5Zub5pyIJywgJ+S6lOaciCcsICflha3mnIgnLCAn5LiD5pyIJywgJ+WFq+aciCcsICfkuZ3mnIgnLCAn5Y2B5pyIJywgJ+WNgeS4gOaciCcsICfljYHkuozmnIgnXSwNCg0KICAgIC8vIOazqOaEj++8mnBhdHRlcm5OYW1lcyDlkowgcGF0dGVybnMg6KaB5a6M5YWo5LiA6Ie0DQogICAgcGF0dGVybk5hbWVzIDogWyd5eXl5JywgICd5eScsICdNTU0nLCAgJ01NJywgJ00nLCAnZGQnLCAnZCcsDQogICAgJ0hIJywgJ0gnLCAnbW0nLCAnbScsICAnc3MnLCAncyddLA0KICAgIHBhdHRlcm5zIDogew0KICAgICAgICAneXl5eScgIDogJzE5NzAnLA0KICAgICAgICAneXknICAgIDogJzAxJywNCiAgICAgICAgJ01NTScgICA6ICfkuIDmnIgnLA0KICAgICAgICAnTU0nICAgIDogJzAxJywNCiAgICAgICAgJ00nICAgICA6ICcxJywNCiAgICAgICAgJ2RkJyAgICA6ICcwMScsDQogICAgICAgICdkJyAgICAgOiAnMScsDQogICAgICAgICdISCcgICAgOiAnMDAnLCAgLy8gMjQg5bCP5pe26L+b5Yi2DQogICAgICAgICdIJyAgICA6ICcwJywgICAgLy8NCiAgICAgICAgJ21tJyAgICA6ICcwMCcsDQogICAgICAgICdtJyAgICAgOiAnMCcsDQogICAgICAgICdzcycgICAgOiAnMDAnLA0KICAgICAgICAncycgICAgIDogJzAnDQogICAgfSwNCg0KICAgIGZvcm1hdCA6IGZ1bmN0aW9uKGRhdGUsIHBhdHRlcm5TdHIpIHsNCiAgICAgICAgaWYgKHBhdHRlcm5TdHIgPT0gbnVsbCB8fCBwYXR0ZXJuU3RyID09ICcnKSB7DQogICAgICAgICAgICAvLyDkvb/nlKjns7vnu5/pu5jorqTnmoTmqKHlvI8NCiAgICAgICAgICAgIHBhdHRlcm5TdHIgPSBTeXN0ZW1Db25maWd1cmF0aW9uLnJlYWQoJ2Zvcm1hdC5kYXRlJywgJ3l5eXktTU0tZGQnKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZGF0ZSA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIOWQjOatpeW9k+WJjeaXpeacnw0KICAgICAgICB0aGlzLnBhdHRlcm5zWyd5eXl5J10gPSBkYXRlLmdldEZ1bGxZZWFyKCk7DQogICAgICAgIHRoaXMucGF0dGVybnNbJ3l5J10gICA9IGRhdGUuZ2V0RnVsbFllYXIoKSAlIDEwMCA8IDEwID8gJzAnICsgZGF0ZS5nZXRGdWxsWWVhcigpICUgMTAwIDogZGF0ZS5nZXRGdWxsWWVhcigpICUgMTAwOw0KICAgICAgICB2YXIgbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxOw0KICAgICAgICB0aGlzLnBhdHRlcm5zWydNTU0nXSAgPSB0aGlzLm1vbnRoc1tkYXRlLmdldE1vbnRoKCldOw0KICAgICAgICB0aGlzLnBhdHRlcm5zWydNTSddICAgPSBtb250aCA8IDEwID8gJzAnICsgbW9udGggOiBtb250aDsNCiAgICAgICAgdGhpcy5wYXR0ZXJuc1snTSddICAgID0gbW9udGg7DQogICAgICAgIHRoaXMucGF0dGVybnNbJ2RkJ10gICA9IGRhdGUuZ2V0RGF0ZSgpIDwgMTAgPyAnMCcgKyBkYXRlLmdldERhdGUoKSA6IGRhdGUuZ2V0RGF0ZSgpOw0KICAgICAgICB0aGlzLnBhdHRlcm5zWydkJ10gICAgPSBkYXRlLmdldERhdGUoKTsNCiAgICAgICAgdGhpcy5wYXR0ZXJuc1snSEgnXSAgID0gZGF0ZS5nZXRIb3VycygpIDwgMTAgPyAnMCcgKyBkYXRlLmdldEhvdXJzKCkgOiBkYXRlLmdldEhvdXJzKCk7ICAgICAgICAvLyAyNCDlsI/ml7bov5vliLYNCiAgICAgICAgdGhpcy5wYXR0ZXJuc1snSCddICAgPSAgZGF0ZS5nZXRIb3VycygpIDsNCiAgICAgICAgdGhpcy5wYXR0ZXJuc1snbW0nXSAgID0gZGF0ZS5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyArIGRhdGUuZ2V0TWludXRlcygpIDogZGF0ZS5nZXRNaW51dGVzKCk7DQogICAgICAgIHRoaXMucGF0dGVybnNbJ20nXSAgICA9IGRhdGUuZ2V0TWludXRlcygpOw0KICAgICAgICB0aGlzLnBhdHRlcm5zWydzcyddICAgPSBkYXRlLmdldFNlY29uZHMoKSA8IDEwID8gJzAnICsgZGF0ZS5nZXRTZWNvbmRzKCkgOiBkYXRlLmdldFNlY29uZHMoKTsNCiAgICAgICAgdGhpcy5wYXR0ZXJuc1sncyddICAgID0gZGF0ZS5nZXRTZWNvbmRzKCk7DQoNCiAgICAgICAgdmFyIGZvcm1hdGVkU3RyID0gcGF0dGVyblN0cjsNCiAgICAgICAgdmFyIF9wYXR0ZXJucyA9IHRoaXMucGF0dGVybnM7DQogICAgICAgIGpRdWVyeS5lYWNoKHRoaXMucGF0dGVybk5hbWVzLCBmdW5jdGlvbihpbmRleCwgcmVnZXhwKXsNCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9wYXR0ZXJuc1tyZWdleHBdOw0KICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHZhbHVlIG9mIFBhdHRlcm5bIiArIHJlZ2V4cCArICJdLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZm9ybWF0ZWRTdHIgPSBmb3JtYXRlZFN0ci5yZXBsYWNlKHJlZ2V4cCwgdmFsdWUpOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvLyDmm7/mjaLljZXlvJXlj7fpg6jliIYNCiAgICAgICAgd2hpbGUgKHRoaXMucmVwbGFjZVNpbmdsZVF1b3RhdGlvbiAmJiAvWyddLy50ZXN0KGZvcm1hdGVkU3RyKSkgew0KICAgICAgICAgICAgZm9ybWF0ZWRTdHIgPSBmb3JtYXRlZFN0ci5yZXBsYWNlKCInIiwgIiIpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGZvcm1hdGVkU3RyOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiDmoLnmja7mjIflrprmqKHlvI/op6PmnpDlrZfnrKbkuLLjgIINCiAgICAgICAgICogQHBhcmFtIHZhbHVlIOiiq+ino+aekOeahOaVsOaNrg0KICAgICAgICAgKiBAcGFyYW0gcGF0dGVyblN0ciDmqKHlvI/lrZfnrKbkuLLvvIzlpoLmnpzkuLrnqbrvvIzliJnkvb/nlKjns7vnu5/pu5jorqTmqKHlvI8NCiAgICAgICAgICovDQogICAgICAgIHBhcnNlIDogZnVuY3Rpb24gKHZhbHVlLCBwYXR0ZXJuU3RyKSB7DQogICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCB2YWx1ZSA9PT0gJycpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChwYXR0ZXJuU3RyID09IG51bGwgfHwgcGF0dGVyblN0ciA9PSAnJykgew0KICAgICAgICAgICAgICAgIC8vIOS9v+eUqOezu+e7n+m7mOiupOeahOaooeW8jw0KICAgICAgICAgICAgICAgIHBhdHRlcm5TdHIgPSBTeXN0ZW1Db25maWd1cmF0aW9uLnJlYWQoJ2Zvcm1hdC5kYXRlJywgJ3l5eXktTU0tZGQnKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdmFyIHllYXIgPSAxOTcwOw0KICAgICAgICAgICAgdmFyIG1vbnRoID0gMTsNCiAgICAgICAgICAgIHZhciBkYXkgICA9IDE7DQogICAgICAgICAgICB2YXIgaG91ciAgPSAwOw0KICAgICAgICAgICAgdmFyIG1pbnV0ZSA9IDA7DQogICAgICAgICAgICB2YXIgc2Vjb25kID0gMDsNCiAgICAgICAgICAgIC8vIOaaguaXtuW/veeVpeavq+enkg0KDQogICAgICAgICAgICB2YXIgX3BhdHRlcm4gPSAnJzsNCiAgICAgICAgICAgIHZhciB2YWx1ZUluZGV4ID0gMDsgIC8vIOiiq+ino+aekOWAvOaJgOWcqOeahOS9jee9rg0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXR0ZXJuU3RyLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgdmFyIF9jaGFyICAgICA9IHBhdHRlcm5TdHIuY2hhckF0KGkpIHx8IHBhdHRlcm5TdHJbaV07ICAvLyDlvZPliY1jaGFyDQogICAgICAgICAgICAgICAgX3BhdHRlcm4gKz0gX2NoYXI7DQogICAgICAgICAgICAgICAgdmFyIF9sb25nUGF0dGVybiA9IF9wYXR0ZXJuOyAgLy8g5bC96YeP5L2/55So6ZW/5Yy56YWNDQogICAgICAgICAgICAgICAgaWYgKGkgPCBwYXR0ZXJuU3RyLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgICAgICAgICAgX2xvbmdQYXR0ZXJuICs9IChwYXR0ZXJuU3RyLmNoYXJBdChpICsgMSkgfHwgcGF0dGVyblN0cltpICsgMV0pOw0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1BhcnRNYXRjaGVkKF9sb25nUGF0dGVybikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOyAgLy8g57un57ut5Yy56YWNDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8g57uT5bC+5rKh5Yy56YWN5pe25pyJ54K56Zeu6aKYDQogICAgICAgICAgICAgICAgaWYgKHRoaXMucGF0dGVybnNbX3BhdHRlcm5dID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodGhpcy5yZXBsYWNlU2luZ2xlUXVvdGF0aW9uICYmIF9wYXR0ZXJuID09ICInIikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW9k+S9nOagvOW8j+WMluWtl+espuWkhOeQhg0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVJbmRleCArPSBfcGF0dGVybi5sZW5ndGg7IC8vIOWQkeWQjuenu+WKqOaMh+mSiA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIF9wYXR0ZXJuID0gJyc7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIOefreWMuemFjQ0KICAgICAgICAgICAgICAgIHZhciBzaG9ydE1hdGNoZWQgPSAoX3BhdHRlcm4ubGVuZ3RoIDwgMik7DQogICAgICAgICAgICAgICAgLy8g5Zyo55+t5qih5byP55qE5oOF5Ya15LiL77yIJ00nLCdkJywnSCcsJ20nLCAncyfvvInlj6/og73kuqfnlJ/lj5jplb/vvIzmraTml7bpnIDopoHnlKjmraTmoIforrDov5vooYzmjqfliLYNCiAgICAgICAgICAgICAgICB2YXIgc2hpZnQgPSAwOw0KICAgICAgICAgICAgICAgIGlmIChfcGF0dGVybiA9PT0gJ01NTScpIHsNCiAgICAgICAgICAgICAgICAgICAgc2hpZnQgPSB0aGlzLmdldE1vbnRoU2hpZnQodmFsdWUsIHZhbHVlSW5kZXgpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2hvcnRNYXRjaGVkICYmIHZhbHVlSW5kZXggPCB2YWx1ZS5sZW5ndGggLSAxKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIOS4gOiIrOaDheWGteS4i++8jOimgeaxguefreaooeW8j+W/hemhu+acieWIhumalOespu+8jOWQpuWImeWwhumAoOaIkOino+aekOmUmeivrw0KICAgICAgICAgICAgICAgICAgICBpZiAoL15cZCQvLnRlc3QodmFsdWUuY2hhckF0KHZhbHVlSW5kZXggKyAxKSB8fCB2YWx1ZVt2YWx1ZUluZGV4ICsgMV0pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzaGlmdCA9IDE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdmFyIGVuZEluZGV4ID0gdmFsdWVJbmRleCArIF9wYXR0ZXJuLmxlbmd0aCArIHNoaWZ0Ow0KICAgICAgICAgICAgICAgIC8vIE1lc3NhZ2VCb3guZGVidWcoJ2VuZEluZGV4PScgKyBlbmRJbmRleCArICI7IHZhbHVlSW5kZXg9IiArIHZhbHVlSW5kZXgpOw0KDQogICAgICAgICAgICAgICAgaWYgKGVuZEluZGV4ID49IHZhbHVlSW5kZXgubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcign5pel5pyf5qC85byP6Kej5p6Q6ZSZ6K+v44CCJyk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdmFyIF9tYXRjaGVkVmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcodmFsdWVJbmRleCwgZW5kSW5kZXgpOyAgLy8g5b2T5YmN5Yy56YWN55qE5YC8DQogICAgICAgICAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygnX21hdGNoZWRWYWx1ZT0nICsgX21hdGNoZWRWYWx1ZSArICI7IF9wYXR0ZXJuPSIgKyBfcGF0dGVybik7DQogICAgICAgICAgICAgICAgc3dpdGNoIChfcGF0dGVybikgew0KICAgICAgICAgICAgICAgICAgICBjYXNlICd5eXl5JzoNCiAgICAgICAgICAgICAgICAgICAgICAgIHllYXIgPSB0aGlzLmdldEludChfbWF0Y2hlZFZhbHVlLCBfcGF0dGVybiwgOTk5OSwgJ3llYXInKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICd5eSc6DQogICAgICAgICAgICAgICAgICAgICAgICB5ZWFyID0gMjAwMCArIHRoaXMuZ2V0SW50KF9tYXRjaGVkVmFsdWUsIF9wYXR0ZXJuLCA5OSwgJ3llYXInKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICdNTU0nOg0KICAgICAgICAgICAgICAgICAgICAgICAgbW9udGggPSB0aGlzLm1vbnRocy5pbmRleE9mKF9tYXRjaGVkVmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ01NJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoID0gdGhpcy5nZXRJbnQoX21hdGNoZWRWYWx1ZSwgX3BhdHRlcm4sIDEzLCAnbW9udGgnKSAtIDE7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTSc6DQogICAgICAgICAgICAgICAgICAgICAgICBtb250aCA9IHRoaXMuZ2V0SW50KF9tYXRjaGVkVmFsdWUsIF9wYXR0ZXJuLCAxMywgJ21vbnRoJykgLSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RkJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGRheSA9IHRoaXMuZ2V0SW50KF9tYXRjaGVkVmFsdWUsIF9wYXR0ZXJuLCAzMSwgJ2RheScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2QnOg0KICAgICAgICAgICAgICAgICAgICAgICAgZGF5ID0gdGhpcy5nZXRJbnQoX21hdGNoZWRWYWx1ZSwgX3BhdHRlcm4sIDMxLCAnZGF5Jyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnSEgnOg0KICAgICAgICAgICAgICAgICAgICAgICAgaG91ciA9IHRoaXMuZ2V0SW50KF9tYXRjaGVkVmFsdWUsIF9wYXR0ZXJuLCAyNCwgJ2hvdXInKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICdIJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIGhvdXIgPSB0aGlzLmdldEludChfbWF0Y2hlZFZhbHVlLCBfcGF0dGVybiwgMjQsICdob3VyJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbW0nOg0KICAgICAgICAgICAgICAgICAgICAgICAgbWludXRlID0gdGhpcy5nZXRJbnQoX21hdGNoZWRWYWx1ZSwgX3BhdHRlcm4sIDYwLCAnbWludXRlJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbSc6DQogICAgICAgICAgICAgICAgICAgICAgICBtaW51dGUgPSB0aGlzLmdldEludChfbWF0Y2hlZFZhbHVlLCBfcGF0dGVybiwgNjAsICdtaW51dGUnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICdzcyc6DQogICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmQgPSB0aGlzLmdldEludChfbWF0Y2hlZFZhbHVlLCBfcGF0dGVybiwgNjAsICdzZWNvbmQnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICdzJzoNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZCA9IHRoaXMuZ2V0SW50KF9tYXRjaGVkVmFsdWUsIF9wYXR0ZXJuLCA2MCwgJ3NlY29uZCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQgOg0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yICgnVGhlIHBhdHRlcm4gWycgKyBfcGF0dGVybiArICddIGNhbiBub3QgYmUgcGFyc2VkLicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB2YWx1ZUluZGV4ICs9IF9tYXRjaGVkVmFsdWUubGVuZ3RoOyAvLyDlkJHlkI7np7vliqjmjIfpkogNCiAgICAgICAgICAgICAgICBfcGF0dGVybiA9ICcnOw0KICAgICAgICAgICAgfSAgLy8gZW5kIG9mIGZvcg0KDQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoeWVhciwgbW9udGgsIGRheSwgaG91ciwgbWludXRlLCBzZWNvbmQpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiDov5Tlm57kuIDkuKrmlbTmlbDvvIzlpoLmnpzmraTmlbDpnZ7mlbTmlbDvvIzliJnov5Tlm57kuIDkuKrlvILluLgNCiAgICAgICAgICovDQogICAgICAgIGdldEludCA6IGZ1bmN0aW9uKF9pbnQsIHBhdHRlcm5OYW1lLCBtYXgsIGVycm9yTXNnKSB7DQogICAgICAgICAgICAvLyDljrvmjonliY3lr7zpm7YNCiAgICAgICAgICAgIGlmIChfaW50Lmxlbmd0aCA+IDAgJiYgX2ludC5zdWJzdHJpbmcoMCwgMSkgPT09ICcwJykgew0KICAgICAgICAgICAgICAgIF9pbnQgPSBfaW50LnN1YnN0cmluZygxKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChpc05hTihfaW50KSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNlZ21lbnRbJyArIF9pbnQgKyAnXSBjb3JyZXNwb25kaW5nIHRvIFsnDQogICAgICAgICAgICAgICAgICAgICsgcGF0dGVybk5hbWUgKyAnXSBtdXN0IGJlIGludGVnZXIuJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgdmFsID0gcGFyc2VJbnQoX2ludCk7DQogICAgICAgICAgICAvLyDpm4bkuK3moKHpqowNCiAgICAgICAgICAgIGlmICh2YWwgPj0gbWF4KSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgJyArIGVycm9yTXNnICsnIGlzIGJhZCwgaXQgbXVzdCBiZSBsZXNzIHRoYW4gJyArIG1heCArICcuJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdmFsOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiDorqHnrpfkuIDkuKrmqKHlvI/kuLLmmK/lkKbmmK/pg6jliIbljLnphY0NCiAgICAgICAgICovDQogICAgICAgIGlzUGFydE1hdGNoZWQgIDogZnVuY3Rpb24ocGF0dGVybikgew0KICAgICAgICAgICAgaWYgKHBhdHRlcm4gPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0aGlzLnBhdHRlcm5zW3BhdHRlcm5dICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wYXR0ZXJuTmFtZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5sZW5ndGggPCB0aGlzLnBhdHRlcm5OYW1lc1tpXS5sZW5ndGgNCiAgICAgICAgICAgICAgICAgICAgJiYgdGhpcy5wYXR0ZXJuTmFtZXNbaV0uc3Vic3RyaW5nKDAsIHBhdHRlcm4ubGVuZ3RoKSA9PT0gcGF0dGVybikgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIOi/lOWbnuS4reaWh+aciOS7veaJgOWNoOeahOWtl+iKguaVsOS4jiJNTU0i55qE5beu5YC8DQogICAgICAgICAqLw0KICAgICAgICBnZXRNb250aFNoaWZ0IDogZnVuY3Rpb24gKHZhbHVlLCB2YWx1ZUluZGV4KSB7DQogICAgICAgICAgICB2YXIgbW9udGggPSB2YWx1ZS5zdWJzdHJpbmcodmFsdWVJbmRleCwgdmFsdWVJbmRleCArIDIpOw0KICAgICAgICAgICAgaWYgKHRoaXMubW9udGhzLmluZGV4T2YgKG1vbnRoKSA+PSAwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5sZW5ndGggPiB2YWx1ZUluZGV4ICsgMikgew0KICAgICAgICAgICAgICAgIC8vIOWwneivlTPkuKrlrZfnrKbnmoTmg4XlhrUNCiAgICAgICAgICAgICAgICBtb250aCA9IHZhbHVlLnN1YnN0cmluZyh2YWx1ZUluZGV4LCB2YWx1ZUluZGV4ICsgMyk7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9udGhzLmluZGV4T2YgKG1vbnRoKSA+PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGZvcm1hdCBvZiBtb250aCBpcyBiYWQuJyk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAqIOaVsOWtl+agvOW8j+WMluWHveaVsOOAgueUqOS6juWwhuaVsOWAvOexu+Wei+i9rOaNouS4uuaMh+WumuagvOW8j+OAguaMh+WumueahOKAnFBhdHRlcm7igJ3mmK/igJxqYXZhLnRleHQuU2ltcGxlRGF0ZUZvcm1hdOKAnQ0KICog55qE5LiA5Liq5a2Q6ZuG44CC5rOo5oSP77ya5pys566X5rOV5Y+q5piv6YeH55So566A5Y2V55qE5q2j5YiZ6KGo6L6+5byP5pu/5o2i77yM5Zug5q2k5Y+v6IO96YeN5aSN77yI6ZSZ6K+v77yJ55qE5oOF5Ya144CCDQogKiDnm67liY3vvIzmraTlh73mlbDlj6rmlK/mjIHmoLzlvI/ljJbvvIzkuI3mlK/mjIHop6PmnpDjgIINCiAqLw0KICAgIHZhciBOdW1iZXJGb3JtYXQgPSB7DQogICAgICAgIHNlcCA6ICcsJywgIC8vIOWIhumalOespu+8jOeUqOS6juehruWumuaVtOaVsOmDqOWIhuaMieeFp+WkmuWwkeS9jei/m+ihjOWIhuWJsg0KICAgICAgICBleHAgOiAnLicsICAvLyDlrprkvY3nrKbvvIznlKjkuo7noa7lrprlsI/mlbDngrnlkI7pnaLkv53nlZnlh6DkvY3lsI/mlbANCg0KICAgICAgICBmb3JtYXQgOiBmdW5jdGlvbih2YWx1ZSwgcGF0dGVyblN0cikgew0KICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB2YWx1ZSA9IDA7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHZhbHVlID0gbmV3IE51bWJlcih2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocGF0dGVyblN0ciA9PSBudWxsIHx8IHBhdHRlcm5TdHIgPT0gJycpIHsNCiAgICAgICAgICAgICAgICAvLyDkvb/nlKjmoLnmja7mlbDlgLznmoTnsbvlnovoh6rliqjliKTmlq3moLzlvI/ljJbnmoTmqKHlvI/vvIjmlbTmlbDmiJbogIXmta7ngrnmlbDvvIkNCiAgICAgICAgICAgICAgICBwYXR0ZXJuU3RyID0gKHBhcnNlSW50KHZhbHVlLDEwKT09PXZhbHVlKSA/DQogICAgICAgICAgICAgICAgKFN5c3RlbUNvbmZpZ3VyYXRpb24ucmVhZCgnZm9ybWF0LmludCcpIHx8ICcjLCMjMCcpIDoNCiAgICAgICAgICAgICAgICAoU3lzdGVtQ29uZmlndXJhdGlvbi5yZWFkKCdmb3JtYXQuZmxvYXQnKSB8fCAnIywjIzAuMDAnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIOiuoeeul+WIhumalOespuWSjOWumuS9jeespueahOS9jee9rg0KICAgICAgICAgICAgdmFyIGV4cEluZGV4ID0gcGF0dGVyblN0ci5pbmRleE9mKHRoaXMuZXhwKTsNCiAgICAgICAgICAgIHZhciBzZXBJbmRleCA9IHBhdHRlcm5TdHIuaW5kZXhPZih0aGlzLnNlcCk7DQogICAgICAgICAgICBpZihzZXBJbmRleCA+IC0xICkgew0KICAgICAgICAgICAgICAgIGlmIChleHBJbmRleCA+IC0xKSB7DQogICAgICAgICAgICAgICAgICAgIHNlcEluZGV4ID0gZXhwSW5kZXggLSBzZXBJbmRleCAtIDE7ICAvLyDopoHlh4/ljrvlhbbmnKzouqvmiYDljaDnmoTkvY3nva4NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBzZXBJbmRleCA9IHBhdHRlcm5TdHIubGVuZ3RoIC0gc2VwSW5kZXggLSAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGV4cEluZGV4ID4gLTEpIHsNCiAgICAgICAgICAgICAgICBleHBJbmRleCA9IHBhdHRlcm5TdHIubGVuZ3RoIC0gZXhwSW5kZXggLSAxOyAgLy8g6KaB5YeP5Y675YW25pys6Lqr5omA5Y2g55qE5L2N572uDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciB2YWx1ZVNlZ3MgPSAoJycgKyB2YWx1ZSkuc3BsaXQodGhpcy5leHApOyAgLy8g5bCG5pW05pWw6L2s5o2i5Li65a2X56ym5Liy5b2i5byP5bm25YiH5YiG5Li677ya5pW05pWw6YOo5YiG5ZKM5bCP5pWw6YOo5YiGDQogICAgICAgICAgICB2YXIgaW50U2VnICAgICAgICA9IHZhbHVlU2Vnc1swXTsNCiAgICAgICAgICAgIHZhciByZXN1bHQgPSAnJzsNCiAgICAgICAgICAgIGlmIChzZXBJbmRleCA+IDApIHsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gaW50U2VnLmxlbmd0aCAtIDE7IGkgPj0wOyBpLS0pIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gTWVzc2FnZUJveC5kZWJ1ZygnY2hhckF0KGkpPScgKyBjaGFyQXQoaSkpOw0KICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSAoaW50U2VnLmNoYXJBdChpKSB8fCBpbnRTZWdbaV0pICsgcmVzdWx0OyAgIC8vIElFIOS9v+eUqGNoYXJBdCDmlrnms5UsIEZGIOS9v+eUqCLmlbDnu4TmlrnlvI8iOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDAgJiYgKGludFNlZy5sZW5ndGggLSBpKSAlIHNlcEluZGV4ID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuc2VwICsgcmVzdWx0Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyDml6DliIbnlYznrKbliJnljp/moLfovpPlh7oNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBpbnRTZWc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgZnJhY3Rpb25hbFNlZyA9ICcnOw0KICAgICAgICAgICAgaWYgKHZhbHVlU2Vncy5sZW5ndGggPiAxKSB7DQogICAgICAgICAgICAgICAgZnJhY3Rpb25hbFNlZyA9IHZhbHVlU2Vnc1sxXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChleHBJbmRleCA+IDApIHsNCiAgICAgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5leHA7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBleHBJbmRleDsgaisrKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChqIDwgZnJhY3Rpb25hbFNlZy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAoZnJhY3Rpb25hbFNlZy5jaGFyQXQoaikgfHwgZnJhY3Rpb25hbFNlZ1tqXSk7ICAvLyBJRSDkvb/nlKhjaGFyQXQg5pa55rOVLCBGRiDkvb/nlKgi5pWw57uE5pa55byPIjsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnMCc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiDmoLnmja7mqKHlvI/oh6rliqjliKTmlq3op6PmnpDnmoTmlrnms5XvvIzlpoLmnpzmqKHlvI/lrZfnrKbkuLLkuLrnqbrvvIzmiJbogIXlkKvmnInlsI/mlbDngrnigJwu4oCd77yMDQogICAgICAgICAqIOWImeS9v+eUqCBwYXJzZUZsb2F0IOi/m+ihjOino+aekO+8m+WQpuWImeS9v+eUqHBhcnNlSW506L+b6KGM6Kej5p6Q44CCDQogICAgICAgICAqIEBwYXJhbSB2YWx1ZSDooqvop6PmnpDnmoTlgLwNCiAgICAgICAgICogQHBhcmFtIHBhdHRlcm4g5Yy56YWN5qih5byPDQogICAgICAgICAqLw0KICAgICAgICBwYXJzZSA6IGZ1bmN0aW9uICh2YWx1ZSwgcGF0dGVybikgew0KICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwgfHwgdmFsdWUubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChwYXR0ZXJuID09IG51bGwgfHwgcGF0dGVybi5pbmRleE9mKCcuJykgPj0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlRmxvYXQodmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VJbnQodmFsdWUpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAqIOWwhuWAvOi9rOaNouS4uuaVtOaVsOWei+aVsOWAvO+8iOWMheaLrOmVv+aVtOWei++8ieOAgg0KICAgICAqLw0KICAgICAgICBwYXJzZUludCA6IGZ1bmN0aW9uICh2YWx1ZSkgew0KICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwgfHwgdmFsdWUgPT0gJycpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBfaW50VmFsdWUgPSAnJzsNCiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIC8vIOWJlOmZpOmdnuWtl+espg0KICAgICAgICAgICAgICAgIHZhciBfY2hhciA9IHZhbHVlW2ldIHx8IHZhbHVlLmNoYXJBdChpKTsNCiAgICAgICAgICAgICAgICBpZiAoX2NoYXIgPT09ICcuJykgew0KICAgICAgICAgICAgICAgICAgICAvLyDpgYfliLDlsI/mlbDngrnliJnmipvlvIPlkI7pnaLnmoTmlbDmja4NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgvWytcLVxkXS8udGVzdChfY2hhcikpIHsNCiAgICAgICAgICAgICAgICAgICAgX2ludFZhbHVlICs9IF9jaGFyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBwYXJzZUludChfaW50VmFsdWUpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAqIOWwhuWAvOi9rOaNouS4uua1rueCueWei+aVsOWAvO+8iOWMheaLrOWPjOeyvuW6pu+8ieOAgg0KICAgICAqLw0KICAgICAgICBwYXJzZUZsb2F0IDogZnVuY3Rpb24gKHZhbHVlLCBwYXR0ZXJTdHIpIHsNCiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IHZhbHVlID09ICcnKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgX2ludFZhbHVlID0gJyc7DQogICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAvLyDliZTpmaTpnZ7lrZfnrKYNCiAgICAgICAgICAgICAgICB2YXIgX2NoYXIgPSB2YWx1ZVtpXSB8fCB2YWx1ZS5jaGFyQXQoaSk7DQogICAgICAgICAgICAgICAgaWYgKC9bK1wtXGQuXS8udGVzdChfY2hhcikpIHsNCiAgICAgICAgICAgICAgICAgICAgX2ludFZhbHVlICs9IF9jaGFyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KF9pbnRWYWx1ZSk7DQoNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICogSUTnlJ/miJDlmajvvIznlKjkuo7kuqfnlJ/pobXpnaLllK/kuIDnmoRJROOAgg0KICovDQogICAgdmFyIElkR2VuZXJhdG9yID0gew0KICAgICAgICAvKioNCiAgICAgKiBJRCDnmoTlhoXpg6jnvJbnoIENCiAgICAgKi8NCiAgICAgICAgaWQgOiAwLA0KDQogICAgICAgIC8qKg0KICAgICAqIOi/lOWbnuS4gOS4qumhtemdouWUr+S4gOeahCBJROOAgg0KICAgICAqLw0KICAgICAgICBnZXRJZCA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuaWQgKz0gMTsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmlkOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgRXZlbnQgPSBmdW5jdGlvbiAoc291cmNlLCBuYW1lKSB7DQogICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOw0KICAgICAgICB0aGlzLm5hbWUgICA9IG5hbWU7ICAvLyDkuovku7bnmoTlkI3np7DvvIzov5nkuKrlkI3np7Dlvojph43opoHvvIzpnIDopoHmjInnhaflkI3np7DosIPnlKjnm7jlupTnmoTkuovku7bjgIINCiAgICB9DQoNCiAgICAvKioNCiAqIOeUqOS6juS6i+S7tuWkhOeQhueahOaOpeWPow0KICovDQogICAgT2JzZXJ2YWJsZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgfQ0KDQogICAgalF1ZXJ5LmV4dGVuZChPYnNlcnZhYmxlLnByb3RvdHlwZSwgew0KDQogICAgICAgIC8qKg0KICAgICAqIOazqOWGjOebkeWQrOWZqO+8m+WmguaenOazqOWGjOeahOebkeWQrOWZqOS4uuepuu+8jOWImeS4jei/m+ihjOWmguS9leWkhOeQhuOAgg0KICAgICAqLw0KICAgICAgICBhZGRMaXN0ZW5lciA6IGZ1bmN0aW9uKGxpc3RlbmVyKSB7DQogICAgICAgICAgICBpZiAodGhpcy5saXN0ZW5lcnMgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzID0gW107DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobGlzdGVuZXIgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAqIOWQjO+8mmFkZExpc3RlbmVy44CCDQogICAgICovDQogICAgICAgIG9uIDogdGhpcy5hZGRMaXN0ZW5lciwNCg0KICAgICAgICAvKioNCiAgICAgKiDnp7vpmaTnm5HlkKzlmajvvJvlpoLmnpzmjIflrprnmoTnm5HlkKzlmajkuLrnqbrvvIzliJnkuI3ov5vooYzlpoLkvZXlpITnkIbjgIINCiAgICAgKi8NCiAgICAgICAgcmVtb3ZlTGluc3RlbmVyIDogZnVuY3Rpb24obGlzdGVuZXIpIHsNCiAgICAgICAgICAgIGlmIChsaXN0ZW5lciA9PSBudWxsIHx8IHRoaXMubGlzdGVuZXJzID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgcmVtb3ZlZCA9IC0xOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxpc3RlbmVycy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lciA9PSB0aGlzLmxpc3RlbmVyc1tpXSkgew0KICAgICAgICAgICAgICAgICAgICByZW1vdmVkID0gaTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocmVtb3ZlZCA+IC0xKSB7DQogICAgICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnMuc3BsaWNlKHJlbW92ZWQsIDEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAqIOWQjO+8mnJlbW92ZUxpbnN0ZW5lcuOAgg0KICAgICAqLw0KICAgICAgICB1biA6IHRoaXMucmVtb3ZlTGluc3RlbmVyLA0KDQogICAgICAgIC8qKg0KICAgICAqIOinpuWPkeS4gOS4quS6i+S7tuOAgg0KICAgICAqLw0KICAgICAgICBmaXJlIDogZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICBpZiAodGhpcy5saXN0ZW5lcnMgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saXN0ZW5lcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSB0aGlzLmxpc3RlbmVyc1tpXTsNCiAgICAgICAgICAgICAgICB2YXIgbWV0aG9kID0gIm9uIiArIGV2ZW50Lm5hbWU7DQogICAgICAgICAgICAgICAgaWYgKGxpc3RlbmVyW21ldGhvZF0gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lclttZXRob2RdKGV2ZW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIC8qKg0KICAgICAgICB2YXIgX2V2ZW50ID0gZXZlbnQ7DQogICAgICAgIGpRdWVyeS5lYWNoKHRoaXMubGlzdGVuZXJzLCBmdW5jdGlvbihpLCBsaXN0ZW5lcikgew0KICAgICAgICAgICAgdmFyIG1ldGhvZCA9ICJvbiIgKyBfZXZlbnQubmFtZTsNCiAgICAgICAgICAgIGlmIChsaXN0ZW5lclttZXRob2RdICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBsaXN0ZW5lclttZXRob2RdKF9ldmVudCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOyovDQogICAgICAgIH0NCiAgICB9KTsNCg0KDQogICAgdmFyIENvbnRyb2xVdGlscyA9IHsNCiAgICAgICAgLyoqDQogICAgICog6L+U5Zue5oyH5a6a5a655Zmo5LiL5omA5pyJ55qE5bey57uP5ZG95ZCN55qE5Y+v57yW6L6R5o6n5Lu2DQogICAgICogQCBjb250YWluZXJJZCDlrrnlmajvvIjkuIDoiKzmmK8gZGl244CBZm9ybSDnrYnmjqfku7bvvInnmoRJRA0KICAgICAqLw0KICAgICAgICBnZXROYW1lZENvbXAgOiBmdW5jdGlvbiAoc2VsZWN0b3IpIHsNCiAgICAgICAgICAgIHZhciBjb21wcyA9IHt9Ow0KICAgICAgICAgICAgaWYgKHNlbGVjdG9yID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gY29tcHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gX2NyZWF0ZUpRdWVyeShzZWxlY3Rvcik7DQogICAgICAgICAgICBqUXVlcnkuZWFjaChFRElUQUJMRV9DT05UUk9MX1RBRywgZnVuY3Rpb24gKGluZGV4LCBjdHJsTmFtZSkgew0KICAgICAgICAgICAgICAgIGNvbnRhaW5lci5maW5kKGN0cmxOYW1lKS5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgX25hbWUgPSB0aGlzLm5hbWU7ICAvLyDmjqfku7bnmoTlkI3np7ANCiAgICAgICAgICAgICAgICAgICAgaWYgKF9uYW1lICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBzW19uYW1lXSA9IHRoaXM7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcmV0dXJuIGNvbXBzOw0KICAgICAgICB9LA0KDQoJCS8qKg0KCQkgICog5L2/55So5a+56LGh5pWw57uE5Lit5Yib5bu65LiL5ouJ5YiX6KGo5qGGDQoJCSAgKiBAcGFyYW0gaWQgICAgY29tYm9Cb3gg5a+56LGh55qESUQNCgkJICAqIEBwYXJhbSBvYmpzIOWvueixoeaVsOe7hA0KCQkgICogQHBhcmFtIHt9ICAgIOWFtuS7luebuOWFs+WPguaVsO+8jOWFtuS4re+8jOmcgOimgeWPr+WumuS5ieeahOWPguaVsOacie+8mg0KCQkgICogICAgICAgICAgICAgICAgICAgICAgIDEuIHZhbHVlLCDku47lr7nosaHkuK3lj5blgLznmoTlsZ7mgKflkI3vvIznlKjkvZzpgInpobnvvIjmiJbogIXlrZflhbjvvInnmoTlgLwNCgkJICAqICAgICAgICAgICAgICAgICAgICAgICAyLiB0aXRsZSwg5LuO5a+56LGh5Lit5Y+W5qCH6aKY55qE5bGe5oCn5ZCN77yM55So5L2c6YCJ6aG577yI5oiW6ICF5a2X5YW477yJ55qE5pi+56S65qCH6aKYDQoJCSAgKiAgICAgICAgICAgICAgICAgICAgICAgMy4gbnVsbGFibGUsIOaYr+WQpuWFgeiuuOS4uuepuu+8jOW4g+WwlOexu+Wei++8jOm7mOiupOS4uuKAnGZhbHNl4oCd44CCDQoJCSAgKiAgICAgICAgICAgICAgICAgICAgICAgNC4gbnVsbFRpdGxlLCDlhYHorrjkuLrnqbrml7bmmL7npLrnmoTmoIfpopjjgIINCgkJICAqICAgICAgICAgICAgICAgICAgICAgICA1LiBudWxsVmFsdWUsIOWFgeiuuOS4uuepuuaXtu+8jOepuumhueWvueW6lOeahOWAvOOAgg0KCQkgICovDQoJCWNyZWF0ZUNvbWJvQm94IDogZnVuY3Rpb24oaWQsIG9ianMsIHBhcmFtcykgew0KCQkgICAgaWYgKGlkID09IG51bGwgfHwgb2JqcyA9PSBudWxsIHx8IHBhcmFtcyA9PSBudWxsKSB7DQoJCQkgICAgTWVzc2FnZUJveC5zaG93RXJyb3IoJ+WIm+W7uuS4i+aLieWIl+ihqOahhueahOWPguaVsOWdh+S4jeiDveS4uuepuuOAgicpOw0KCQkJCXJldHVybjsNCgkJCX0NCgkJCXZhciBkaWNOYW1lID0gJ19kaWNOYW1lXycgKyBJZEdlbmVyYXRvci5nZXRJZCgpOyAgLy8g6Ieq5Yqo5Lqn55Sf5LiA5LiqIElEDQoNCgkJCS8vIOWwhuWvueixoei9rOaNouS4uuWtl+WFuOmhuQ0KCQkJdmFyIGl0ZW1zID0gW107DQoNCgkJCS8vIE1lc3NhZ2VCb3guZGVidWcoJ29ianM9JyArIG9ianMpOw0KCQkJZm9yKHZhciBpID0gMDsgaSA8IG9ianMubGVuZ3RoOyBpKyspIHsNCgkJCSAgICB2YXIgb2JqID0gb2Jqc1tpXTsNCgkJCSAgICB2YXIgaXRlbSA9IHtpbmRleCA6IGksIHZhbHVlIDogb2JqW3BhcmFtcy52YWx1ZV0sDQoJCQkJICAgdGl0bGUgOiBvYmpbcGFyYW1zLnRpdGxlXX07DQoJCQkJaXRlbXMucHVzaChpdGVtKTsNCgkJCX0NCgkJCS8vIE1lc3NhZ2VCb3guZGVidWcoJ2l0ZW1zPScsIGl0ZW1zKTsNCgkJICAgIERpY3Rpb25hcnlTZXJ2aWNlLnJlZ2lzdGVyKGRpY05hbWUsIGl0ZW1zKTsNCg0KCQkJLy9NZXNzYWdlQm94LmRlYnVnKCdwYXJhbXNbbnVsbGFibGVdPScgKyBwYXJhbXNbJ251bGxhYmxlJ10pOw0KCQkJLy8g5L2/55So5a2X5YW45pa55rOV5p6E5bu65LiL5ouJ5YiX6KGo5qGGDQoJCQlEaWNVdGlscy5kZWNvcmF0ZUNvbWJvQm94KGlkLCBkaWNOYW1lLA0KCQkJICAgIHBhcmFtc1snbnVsbGFibGUnXSB8fCBmYWxzZSwgcGFyYW1zWydudWxsVmFsdWUnXSwgcGFyYW1zWydudWxsVGl0bGUnXSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioqIExvb2t1cCjmn6Xmib4pIOebuOWFs+S7o+eggSAgKiovDQogICAgdmFyIExvb2t1cFV0aWxzID0gew0KDQogICAgICAgIC8qKg0KICAgICAqIOafpeivouihqOWvueivneahhueahOmhtemdou+8jOi/meS4qumhtemdouaPkOS+m+S6huS4gOS4quWfuuehgOahhu+8jOmcgOimgeeUqOadpeWhq+WGmemAieaLqeaVsOaNruOAgg0KICAgICAqLw0KICAgICAgICBsb29rdXBUYWJsZURsZyA6ICdsb29rdXBfZGlhbG9nLmh0bWwnLA0KDQogICAgICAgIC8qKg0KICAgICAqIOe7keWumuWNleS4gOaOp+S7tg0KICAgICAqIEBwYXJhbSBsb29rdXBCdG4g5p+l6K+i5oyJ6ZKu5a6e5L6L77yM5LiN6IO95Li656m644CC5aaC5p6c5piv5a2X56ym5Liy77yM5YiZ6K6k5Li65YW25piv4oCcSUTigJ3vvIzkuZ/lj6/ku6XmmK/lhbbku5blkIjms5XnmoRqUXVlcnnlr7nosaHjgIINCiAgICAgKiBAcGFyYW0gdXJsICAgICAgIOW1jOWFpeeahFVSTOWunuS+i++8jOS4jeiDveS4uuepuuOAgg0KICAgICAqIEBwYXJhbSBwYXJhbXMgICAg5Y+C5pWw6KGo5a6e5L6L77yM5Y+v6IO95Li656m644CCDQogICAgICovDQogICAgICAgIGJpbmRJbnB1dCA6IGZ1bmN0aW9uKGxvb2t1cEJ0biwgdXJsLCBwYXJhbXMpIHsNCiAgICAgICAgICAgIGlmIChsb29rdXBCdG4gPT0gbnVsbCB8fCBsb29rdXBCdG4gPT09ICcnIHx8IHVybCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQYXJhbWV0ZXJzIGxvb2t1cEJ0bigxKSBhbmQgdXJsKDIpIGNhbiBub3QgYmUgZW1wdHkuIik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIOeoi+W6j+WRmOWPr+S7peWcqOiHquWumuS5ieafpeaJvumhtemdoueahOaooeadv++8jOS5n+WPr+S7peS9v+eUqOm7mOiupOaooeadvw0KICAgICAgICAgICAgdmFyIF91cmwgPSBwYXJhbXNbJ2xvb2t1cFRlbXBsYXRlJ10gfHwgdGhpcy5sb29rdXBUYWJsZURsZzsNCg0KICAgICAgICAgICAgaWYgKF91cmwuaW5kZXhPZignPycpIDwgMCkgew0KICAgICAgICAgICAgICAgIF91cmwgKz0gJz9fX251bGxfXz0wJzsgIC8vIOafpeivouS4reayoeacieadoeS7tueahOivne+8jOWImeS9v+eUqOS4gOS4quWNoOS9jeespuOAgg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAocGFyYW1zID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICBwYXJhbXMgPSB7fTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIOi/veWKoCBMb29rdXAg5pWw5o2u6KOF6L295Y+C5pWw44CCDQogICAgICAgICAgICBwYXJhbXNbJ2xvb2t1cFVybCddID0gdXJsOw0KDQogICAgICAgICAgICB2YXIgcGFyYW1zU3RyID0gUGFyYW1ldGVySGVscGVyLmJ1aWxkKHBhcmFtcyk7DQoNCiAgICAgICAgICAgIF91cmwgKz0gcGFyYW1zU3RyOw0KICAgICAgICAgICAgdmFyIHdpZHRoICA9IHBhcmFtc1snd2lkdGgnXSAgIT0gbnVsbCA/IHBhcmFtc1snd2lkdGgnXSA6IDYwMDsgICAgIC8vIOm7mOiupOWuveW6puaYr++8mjYwMA0KICAgICAgICAgICAgdmFyIGhlaWdodCA9IHBhcmFtc1snaGVpZ2h0J10gIT0gbnVsbCA/IHBhcmFtc1snaGVpZ2h0J10gOiA0NTA7ICAgIC8vIOm7mOiupOmrmOW6puaYr++8mjQ1MA0KICAgICAgICAgICAgX2NyZWF0ZUpRdWVyeShsb29rdXBCdG4pLmJpbmQoImNsaWNrIiwgZnVuY3Rpb24oKXsNCiAgICAgICAgICAgICAgICBzaG93RGlhbG9nKF91cmwsIHRydWUsIHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgaW5pdCA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIOino+aekOWPguaVsA0KICAgICAgICAgICAgdmFyIGhyZWYgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmOw0KICAgICAgICAgICAgdmFyIHBhcmFtcyA9IFBhcmFtZXRlckhlbHBlci5wYXJzZShocmVmKTsNCg0KICAgICAgICAgICAgLy8g6KOF6L296aG16Z2iDQoNCiAgICAgICAgICAgIC8vIOazqOWFpeWPguaVsA0KICAgICAgICAgICAgaWYgKGxvb2t1cEluaXQpIHsNCiAgICAgICAgICAgICAgICBsb29rdXBJbml0KHBhcmFtcyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAqIOi/meaYr+S4gOS4queUqOWGhemDqOe6puWumuWIm+W7uueahGpRdWVyeeWvueixoeOAgg0KICog5aaC5p6c5Y+C5pWw5piv5a2X56ym5Liy77yM5YiZ6K6k5Li65YW25Li65o6n5Lu255qE4oCcSUTigJ3vvIzov5Tlm57mraTigJxJROKAneS7o+ihqOeahGpRdWVyeeWvueixoe+8m+WFtuS7luWImeebtOaOpeWwhuWFtuWMheijheS4umpRdWVyeeWvueixoeOAgg0KICovDQogICAgdmFyIF9jcmVhdGVKUXVlcnkgPSBmdW5jdGlvbiAocXVlcnlEb20pIHsNCiAgICAgICAgaWYocXVlcnlEb20gPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHR5cGVvZiBxdWVyeURvbSA9PT0gJ3N0cmluZycgJiYgcXVlcnlEb20uY2hhckF0KDApICE9ICcjJykgew0KICAgICAgICAgICAgcXVlcnlEb20gPSAnIycgKyBxdWVyeURvbTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4galF1ZXJ5KHF1ZXJ5RG9tKTsNCiAgICB9DQoNCg0KICAgIC8qKiogTG9va3VwKOafpeaJvikg55u45YWz5Luj56CBICAqKi8NCg0KICAgIGZ1bmN0aW9uIHNob3dEaWFsb2codXJsLCBtb2RlbCwgd2lkdGgsIGhlaWdodCkgew0KICAgICAgICBpZiAobW9kZWwgJiYgZmFsc2UgLyogalF1ZXJ5LmJyb3dzZXIubXNpZSAqLykgeyAvLyBJRSDkuIvov5jmnInngrnpl67popgNCiAgICAgICAgICAgIHZhciByZXR1cm5WYWx1ZXMgPSB3aW5kb3cuc2hvd01vZGFsRGlhbG9nKHVybCwgJ3BvcHVwJywgJ2RpcmVjdG9yaWVzPW5vLCBzY3JvbGxiYXJzPTEsIGxvY2F0aW9uPW5vLCAnDQogICAgICAgICAgICAgICAgKyAnbWVudWJhcj1ubywgc3RhdHVzPW5vLCB0b29sYmFyPW5vLCBjZW50ZXI9eWVzICBkaWFsb2dXaWR0aD0nICsgd2lkdGggKyAnLCBkaWFsb2dIZWlnaHQ9Jw0KICAgICAgICAgICAgICAgICsgaGVpZ2h0ICsgJywgZGlhbG9nVG9wPTIwMCwgZGlhbG9nTGVmdD0yMDAnKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGRpYWxvZyA9IHdpbmRvdy5vcGVuKHVybCwgJ3BvcHVwJywgJ2RpcmVjdG9yaWVzPW5vLCBzY3JvbGxiYXJzPTEsIGxvY2F0aW9uPW5vLCcNCiAgICAgICAgICAgICAgICArICdtZW51YmFyPW5vLCBzdGF0dXM9bm8sIHRvb2xiYXI9bm8sIHdpZHRoPScNCiAgICAgICAgICAgICAgICArIHdpZHRoICsgJywgaGVpZ2h0PScgKyBoZWlnaHQgKyAnLCB0b3A9MjAwLCBsZWZ0PTIwMCcpOw0KICAgICAgICAgICAgZGlhbG9nLmZvY3VzKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAqIOWtmOaUvuS4gOS4quWQkeWvvOmhteeahOebuOWFs+S/oeaBr+OAgg0KICogQHBhcmFtIG5hbWUg5ZCR5a+86aG155qE5ZCN56ew77yM5b+F6aG75ZSv5LiA44CCDQogKiBAcGFyYW0gdXJsIOWQkeWvvOmhteeahOWcsOWdgO+8jOWmguaenOaYr+aMh+WumueahOmhtemdouWGheeahOafkOS4quWMuuWfn++8jOW/hemhu+S7peKAnCPigJ3lvIDlpLTjgIINCiAqIEBwYXJhbSBwYXJhbXMg5Y+C5pWw6KGo44CCDQogKi8NCiAgICBmdW5jdGlvbiBXaXphcmRQYWdlKG5hbWUsIHVybCwgcGFyYW1zKSB7DQogICAgICAgIHRoaXMubmFtZSAgID0gbmFtZTsNCiAgICAgICAgdGhpcy51cmwgICAgPSB1cmw7DQogICAgICAgIHRoaXMucGFyYW1zID0gcGFyYW1zOw0KICAgIH0NCg0KICAgIC8qKg0KICog5Yib5bu65ZCR5a+855qE55u45YWz57G744CCDQogKi8NCiAgICB2YXIgV2l6YXJkID0gZnVuY3Rpb24oKSB7DQoNCiAgICB9DQoNCiAgICBXaXphcmQucHJvdG90eXBlICA9IHsNCg0KICAgICAgICAvKioNCiAgICAgKiDmmL7npLrljLrln5/nmoTnvJbnoIENCiAgICAgKi8NCiAgICAgICAgZGlzcGxheUFyZWFOYW1lIDogJ19fd2l6YXJkQXJlYScsDQoNCiAgICAgICAgLyoqDQogICAgICog5ZCR5a+855qE5qih5p2/5paH5Lu2DQogICAgICovDQogICAgICAgIHdpemFyZFRlbXBsYXRlIDogX19jb250ZXh0UGF0aF9fICsgJ2d0X2Jhc2Uvd2l6YXJkX2ZybS5odG1sJywNCg0KICAgICAgICBwYWdlcyA6IFtdLA0KDQogICAgICAgIC8qKg0KICAgICAqIOW9k+WJjeaYvuekuueahOmhtemdog0KICAgICAqLw0KICAgICAgICBjdXJyZW50UGFnZSA6IG51bGwsDQoNCiAgICAgICAgLyoqDQogICAgICog5aKe5Yqg5Yqg5YWl5LiA5Liq5ZCR5a+86aG16Z2iDQogICAgICogQHBhcmFtIG5hbWUg5ZCR5a+86aG155qE5ZCN56ewDQogICAgICogQHBhcmFtIHVybCAg5ZCR5a+86aG155qE6ZO+5o6l5Zyw5Z2A77yI5oiW6ICFIGRpdiDnmoRpZO+8ieOAgg0KICAgICAqIEBwYXJhbSBwYXJhbXMgIOmhtemdouWPguaVsOOAgg0KICAgICAqLw0KICAgICAgICBhZGRQYWdlIDogZnVuY3Rpb24gKG5hbWUsIHVybCwgcGFyYW1zKSB7DQogICAgICAgICAgICBpZiAobmFtZSA9PSBudWxsIHx8IHVybCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQYXJhbWV0ZXJzIG5hbWUoMSkgYW5kIHVybCgyKSBjYW4gbm90IGJlIGVtcHR5LiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5wYWdlcy5wdXNoKG5ldyBXaXphcmRQYWdlKG5hbWUsIHVybCwgcGFyYW1zKSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICog5Yik5pat5oyH5a6a6aG15LmL5ZCO5piv5ZCm6L+Y5pyJ5LiL5LiA6aG15pWw5o2u6ZyA6KaB5aGr5YaZDQogICAgICovDQogICAgICAgIGhhc05leHRQYWdlIDogZnVuY3Rpb24obmFtZSkgew0KDQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICog5Yik5pat5oyH5a6a6aG15LmL5YmN5piv5ZCm5a2Y5Zyo5LiK5LiA6aG15L+h5oGv44CCDQogICAgICovDQogICAgICAgIGhhc1ByZXZQYWdlIDogZnVuY3Rpb24obmFtZSkgew0KDQogICAgICAgIH0sDQoNCiAgICAgICAgbmV4dFBhZ2UgOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBpZiAodGhpcy5wYWdlcyA9PSBudWxsIHx8IHRoaXMucGFnZXMubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldpemFyZCBuZWVkIHNvbWUgcGFnZXMuIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UGFnZSA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IHRoaXMucGFnZXNbMF07DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wYWdlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UGFnZVsnbmFtZSddID09IHRoaXMucGFnZXNbaV1bJ25hbWUnXQ0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgaSA8ICh0aGlzLnBhZ2VzLmxlbmd0aCAtIDEpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gdGhpcy5wYWdlc1tpICsgMV07DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQYWdlOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAqIOWQkeWvvOWIneWni+WMluaTjeS9nA0KICAgICAqLw0KICAgICAgICBpbml0IDogZnVuY3Rpb24oY29udGFpbmVySWQpIHsNCiAgICAgICAgICAgIHZhciBfcGFnZXMgPSB0aGlzLnBhZ2VzOw0KICAgICAgICAgICAgdmFyIF9jcCA9ICB0aGlzLmN1cnJlbnRQYWdlOw0KICAgICAgICAgICAgalF1ZXJ5KGNvbnRhaW5lcklkKS5sb2FkKHRoaXMud2l6YXJkVGVtcGxhdGUsIHt9LCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgLy9XaXphcmQucGFnZXMgPSBfcGFnZXM7ICAvLyDms6jmhI/vvJrmraTlpITopoHph43mlrDotYvlgLwNCiAgICAgICAgICAgICAgICAvL1dpemFyZC5jdXJyZW50UGFnZSA9IF9jcDsNCiAgICAgICAgICAgICAgICBuZXh0UGFnZSgpOyAgLy8g6LCD55Sod2l6YXJkLmh0bWzpobXpnaLnmoRuZXh0UGFnZSgp5pa55rOVDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSwNCg0KICAgICAgICBwcmV2UGFnZSA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLnBhZ2VzID09IG51bGwgfHwgdGhpcy5wYWdlcy5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiV2l6YXJkIG5lZWQgc29tZSBwYWdlcy4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRQYWdlID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlID0gbnVsbDsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBhZ2VzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRQYWdlWyduYW1lJ10gPT0gdGhpcy5wYWdlc1tpXVsnbmFtZSddDQogICAgICAgICAgICAgICAgICAgICAgICAmJiBpID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZSA9IHRoaXMucGFnZXNbaSAtIDFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGFnZTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICog5biu5Yqp57G7DQogKi8NCiAgICB2YXIgVXRpbHMgID0gew0KDQogICAgICAgIC8qKg0KICAgICAqIOWwhua6kOWvueixoeeahOaJgOacieWxnuaAp+WAvOaLt+i0neWIsOebruagh+WvueixoeS4re+8jOWPquaLt+i0neWxnuaAp+WAvO+8jOS4jeaLt+i0neWKn+iDveOAgg0KICAgICAqIEBwYXJhbSBzb3VyY2Ug5rqQ5a+56LGh77yM5aaC5p6c5Li656m677yM5LiN6L+b6KGM5Lu75L2V5aSE55CGDQogICAgICogQHBhcmFtIGRlc3QgICDnm67moIflr7nosaHvvIzlpoLmnpzkuLrnqbrvvIzkuI3ov5vooYzku7vkvZXlpITnkIYNCiAgICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lcyAg5bGe5oCn6ZuG5ZCI77yM5oyH5a6a5aSN5Yi255qE5bGe5oCn5ZCN56ew77yM5rOo5oSP77yM5Zug5Li65aSN5Yi25piv6YCS5b2S55qE77yM5omA5Lul5a+55a2Q5a+56LGh5Lqm55Sf5pWI44CCDQogICAgICovDQogICAgICAgIHZhbHVlQ29weSA6IGZ1bmN0aW9uIChzb3VyY2UsIGRlc3QsIHByb3BlcnR5TmFtZXMpIHsNCiAgICAgICAgICAgIGlmIChzb3VyY2UgPT0gbnVsbCB8fCBkZXN0ID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkgew0KICAgICAgICAgICAgICAgIHZhciB0eXBlID0gdHlwZW9mIHNvdXJjZVtwcm9wXTsNCiAgICAgICAgICAgICAgICAvL01lc3NhZ2VCb3guZGVidWcoJ3Byb3A9JyArIHByb3AgKyAiO3R5cGU9IiArIHR5cGUgKyAiO2Rlc3RbcHJvcF09IiArIGRlc3RbcHJvcF0gKyAiO3NvdXJjZVtwcm9wXT0iICsgc291cmNlW3Byb3BdKTsNCiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2Z1bmN0aW9uJw0KICAgICAgICAgICAgICAgICAgICB8fCAocHJvcGVydHlOYW1lcyAhPSBudWxsICYmIGpRdWVyeS5pbkFycmF5KHByb3AsIHByb3BlcnR5TmFtZXMpKSkgew0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdvYmplY3QnKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChkZXN0W3Byb3BdICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgVXRpbHMudmFsdWVDb3B5KHNvdXJjZVtwcm9wXSwgZGVzdFtwcm9wXSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0W3Byb3BdID0gc291cmNlW3Byb3BdOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdFtwcm9wXSA9IHNvdXJjZVtwcm9wXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICog5Yik5pat5b2T5YmN6byg5qCH55qE5L2N572u5piv5ZCm5Zyo5oyH5a6a55qE5o6n5Lu25LmL5LiKDQogICAgICovDQogICAgICAgIGlzTW91c2VPdmVyIDogZnVuY3Rpb24gKG1vdXNlRXZlbnQsIGVsZW0pIHsNCiAgICAgICAgICAgIGlmKG1vdXNlRXZlbnQgPT0gbnVsbCB8fCBlbGVtID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgcG9zaSA9IGpRdWVyeShlbGVtKS5wb3NpdGlvbigpOw0KICAgICAgICAgICAgdmFyIHdpZHRoID0galF1ZXJ5KGVsZW0pLndpZHRoKCk7DQogICAgICAgICAgICB2YXIgaGVpZ2h0ID0galF1ZXJ5KGVsZW0pLmhlaWdodCgpOw0KICAgICAgICAgICAgaWYgKHdpZHRoID09IDAgfHwgaGVpZ2h0ID09IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiAobW91c2VFdmVudC5jbGllbnRYID49IHBvc2kubGVmdCAmJiBtb3VzZUV2ZW50LmNsaWVudFggPD0gcG9zaS5sZWZ0ICsgd2lkdGgNCiAgICAgICAgICAgICAgICAmJiBtb3VzZUV2ZW50LmNsaWVudFkgPj0gcG9zaS50b3AgJiYgbW91c2VFdmVudC5jbGllbnRZIDw9IHBvc2kudG9wICsgaGVpZ2h0KTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgKiDnlKjkuo7ov5DooYzlupTnlKjnmoTku6PnoIEsIOeUqOatpOi/kOihjOS7o+eggeeahOWlveWkhOaYrzoNCiAgICAgKiAgICAgMS4g6Ieq5Yqo6L+b6KGM5LqG5paH5qGj5YeG5aSH5aSE55CGKGpRdWVyeS5yZWFkeSkNCiAgICAgKiAgICAgMi4g6Ieq5Yqo5o2V6I635bm25pi+56S65byC5bi4DQogICAgICovDQogICAgICAgIHJ1biA6IGZ1bmN0aW9uIChydW5uYWJsZSwgb25GaW5hbGx5KSB7DQogICAgICAgICAgICBpZiAocnVubmFibGUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghalF1ZXJ5LmlzRnVuY3Rpb24ocnVubmFibGUpIHx8IChvbkZpbmFsbHkgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKG9uRmluYWxseSkpKSB7DQogICAgICAgICAgICAgICAgTWVzc2FnZUJveC5zaG93RXJyb3IoJ+ezu+e7n+mUmeivrycsICflj4LmlbDlv4XpobvmmK/lh73mlbDjgIInKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgalF1ZXJ5KCkucmVhZHkoZnVuY3Rpb24oKXsgIC8vIFRPRE86IOWcqOW8ueWHuuWvueivneahhuaXtuaciemXrumimCwg5LiN6IO95omn6KGM6K+l5pa55rOVDQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgcnVubmFibGUoKTsNCiAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFlLmNvbnN1bWVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc01zZyA9IGUuZGVzY3JpcHRpb247DQogICAgICAgICAgICAgICAgICAgICAgICAvL01lc3NhZ2VCb3guZGVidWcoInNNc2c9Iiwgc01zZyk7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiDov5npg6jliIbku6PnoIHlkowgYm9vdC5qcyDph4znmoTpg6jliIbku6PnoIHmnInph43lj6ANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzTXNnICE9IG51bGwgJiYgc01zZy5zdGFydHNXaXRoKEVycm9yTWFuYWdlci5wcmVmaXgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9lcnJvciA9IEVycm9yTWFuYWdlci5lcnJvcnNbc01zZ107DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1zZyA9IHNNc2c7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRldGFpbCA9IG51bGw7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9lcnJvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2ZlID0gRXJyb3JVdGlscy5maW5kRnJpZW5kbHlFeGNlcHRpb24oX2Vycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gX2ZlLm1lc3NhZ2U7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbCA9IF9mZS5zdGFja1RyYWNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlQm94LnNob3dFcnJvcihtc2csIGRldGFpbCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VCb3guc2hvd0Vycm9yKHNNc2csIGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gdGhyb3cgZTsg6ZSZ6K+v5LiN5YaN57un57ut5aSE55CGDQogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9uRmluYWxseSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgb25GaW5hbGx5KCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgKiDliJvlu7pVUkwgLCDlnKjovpPlhaXnmoR1cmzkuIrliqDkuIrnu53lr7not6/lvoTjgIINCiAgICAgKi8NCiAgICAgICAgY3JlYXRlVXJsIDogZnVuY3Rpb24gKHVybCkgew0KICAgICAgICAgICAgdmFyIGNwID0gQ29udGV4dFBhdGguZ2V0UGF0aCgpOw0KICAgICAgICAgICAgcmV0dXJuIGNwID8gY3AgKyB1cmwgOiB1cmw7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICB2YXIgVXBsb2FkZWRGaWxlID0gZnVuY3Rpb24gKF9pbnB1dCkgew0KICAgICAgICB0aGlzLl9fY2xhc3NOYW1lID0gJ1VwbG9hZGVkRmlsZSc7IC8vIOWbuuWumueahOexu+WQjeensA0KICAgICAgICBpZiAoX2lucHV0ID09IG51bGwpIHsNCiAgICAgICAgICAgIC8vIHRocm93IG5ldyBFcnJvcigi5paH5Lu26L6T5YWl5o6n5Lu25LiN6IO95Li656m644CCIik7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklucHV0IGZpbGUgY29udHJvbCBjYW4gbm90IGJlIG51bGwuIik7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5pbnB1dCA9IF9pbnB1dCA9IF9jcmVhdGVKUXVlcnkoX2lucHV0KTsNCg0KICAgICAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHRoaXMuaW5wdXQuYXR0cignbmFtZScpOw0KICAgICAgICBpZiAodGhpcy5wcm9wZXJ0eU5hbWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgbmFtZSBvZiB1cGxvYWRlZCBmaWxlIGNvbnRyb2wgY2FuIG5vdCBiZSBudWxsLiIpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuYWpheFVwbG9hZCA9IG5ldyBBamF4VXBsb2FkKHRoaXMuaW5wdXQsIHsNCiAgICAgICAgICAgIGFjdGlvbjogU2VydmljZUludm9rZXIuYWN0aW9uLA0KICAgICAgICAgICAgYXV0b1N1Ym1pdDogZmFsc2UsDQogICAgICAgICAgICBuYW1lIDogdGhpcy5wcm9wZXJ0eU5hbWUsDQogICAgICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywNCiAgICAgICAgICAgIG9uQ2hhbmdlIDogZnVuY3Rpb24oZmlsZSwgZXh0ZW5zaW9uKXsNCiAgICAgICAgICAgICAgICBfaW5wdXQudmFsKGZpbGUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIH0pOw0KDQogICAgICAgIC8qKg0KICAgICAqIOmHjeaWsOiuvue9rueKtuaAgQ0KICAgICAqLw0KICAgICAgICB0aGlzLnJlc2V0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdGhpcy5pbnB1dC52YWwoJycpOw0KICAgICAgICAgICAgdGhpcy5hamF4VXBsb2FkLnJlc2V0KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgKiDmuIXnqbrlvZPliY3ovpPlhaXln5/nmoTlgLwNCiAgICAgKi8NCiAgICAgICAgdGhpcy5yZXNldFZhbHVlID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB0aGlzLmlucHV0LnZhbCgnJyk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICB2YXIgTWVzc2FnZUJveCA9IHsNCiAgICAgICAgX2Vycm9yRGlhbG9nICAgOiBudWxsLCAgLy8g6ZSZ6K+v5raI5oGv5a+56K+d5qGGDQogICAgICAgIF9tc2dDdHJsICAgICAgIDogbnVsbCwgIC8vIOmUmeivr+a2iOaBr+aOp+S7tg0KICAgICAgICBfZGV0YWlsTXNnQ3RybCA6IG51bGwsICAvLyDor6bnu4bkv6Hmga/mjqfku7YNCg0KICAgICAgICBkZWJ1ZyA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciByZXQgPSAnJzsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgdmFyIGFyZyA9IGFyZ3VtZW50c1tpXTsNCiAgICAgICAgICAgICAgICByZXQgKz0gdGhpcy5fc3RyaW5naWZ5KGFyZyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBhbGVydChyZXQpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAqIOi/meS4quaWueazleWwhuS9v+eUqOmAkuW9kuaWueW8j++8jOi+k+WHuuWvueixoeWPiuWFtuaJgOacieWxnuaAp+eahOWtl+espuS4suihqOekuuOAguWmguaenOaYr+WOn+eUn+Wvueixoe+8iOmdnm9iamVjdO+8ie+8jOWImeebtOaOpei+k+WHuuWFtuWAvO+8mw0KICAgICAqIOWmguaenOaYr+aVsOe7hO+8jOWImeS7peKAnFtd4oCd5b2i5byP6L6T5Ye65YW25YC877yb5aaC5p6c5piv5a+56LGh77yM5Lul4oCce33igJ3lvaLlvI/ovpPlh7rlhbblgLzjgIINCiAgICAgKi8NCiAgICAgICAgX3N0cmluZ2lmeSA6IGZ1bmN0aW9uIChvYmopIHsNCiAgICAgICAgICAgIHZhciByZXQgPSAnJzsNCiAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldCA9ICdudWxsJzsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9iaiA9PSAnb2JqZWN0Jykgew0KICAgICAgICAgICAgICAgIHJldCArPSAneycNCiAgICAgICAgICAgICAgICBmb3IodmFyIHByb3AgaW4gb2JqKSB7DQogICAgICAgICAgICAgICAgICAgIHJldCArPSAnJyArIHByb3AgKyAnOicgKyBNZXNzYWdlQm94Ll9zdHJpbmdpZnkob2JqW3Byb3BdKSArICc7JzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0ICs9ICd9Jw0KICAgICAgICAgICAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBBcnJheSkgew0KICAgICAgICAgICAgICAgIHJldCArPSAnWycNCiAgICAgICAgICAgICAgICBmb3IocHJvcCBpbiBvYmopIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0ICs9IE1lc3NhZ2VCb3guX3N0cmluZ2lmeShvYmpbcHJvcF0pICsgJywnOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXQgKz0gJ10nDQogICAgICAgICAgICB9ZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0ICs9IG9iajsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICog6ZyA6KaB55So5oi36L+b6KGM56Gu6K6k55qE5L+h5oGv44CCDQogICAgICogQHJldHVybiDnoa7orqTov5Tlm550cnVl77yM5ZCm5YiZ6L+U5ZueZmFsc2XjgIINCiAgICAgKi8NCiAgICAgICAgY29uZmlybSA6IGZ1bmN0aW9uIChtZXNzYWdlKSB7DQogICAgICAgICAgICByZXR1cm4gY29uZmlybShtZXNzYWdlKTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgKiDnu5nnlKjmiLfmmL7npLrkuIDkuKrmj5DnpLrmgKfnmoTkv6Hmga/vvIzkuIDoiKznlKjkuo7mmL7npLrkuI3mmK/nibnliKvph43opoHnmoTpgJrnn6XvvIzlpoLvvJrkv53lrZjmiJDlip/nrYnmg4XlhrXvvIwNCiAgICAgKiDku6XkuI3lvbHlk43nlKjmiLfnu6fnu63mk43kvZzkuLrlrpzjgIINCiAgICAgKi8NCiAgICAgICAgaW5mb3JtIDogZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICAgICAgICAgIGFsZXJ0IChtZXNzYWdlKTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgKiDmj5DnpLrnu5nnlKjmiLfnmoTorablkYrkv6Hmga/vvIzkuIDoiKzpnIDopoHnlKjmiLfnoa7orqTmiY3og73nu6fnu63lpITnkIbjgIINCiAgICAgKi8NCiAgICAgICAgYWxlcnQgOiBmdW5jdGlvbiAobWVzc2FnZSkgew0KICAgICAgICAgICAgYWxlcnQobWVzc2FnZSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICog5pi+56S66ZSZ6K+v5L+h5oGvDQogICAgICovDQogICAgICAgIHNob3dFcnJvciA6IGZ1bmN0aW9uIChtc2csIGRldGFpbE1zZykgew0KICAgICAgICAgICAgaWYgKGpRdWVyeSkgew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLl9lcnJvckRpYWxvZyA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Vycm9yRGlhbG9nID0gdGhpcy5fY3JlYXRlRGlhbG9nKCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXJyb3JEaWFsb2cuZGlhbG9nKCAnb3BlbicgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgbXNnICAgICAgID0gJycgKyBtc2c7ICAgICAgLy8g6ZyA6KaB6L2s5o2i5Li65a2X56ym5LiyDQogICAgICAgICAgICAgICAgZGV0YWlsTXNnID0gJycgKyBkZXRhaWxNc2c7DQogICAgICAgICAgICAgICAgdGhpcy5fbXNnQ3RybC50ZXh0KG1zZyk7DQogICAgICAgICAgICAgICAgdGhpcy5fZGV0YWlsTXNnQ3RybC50ZXh0KGRldGFpbE1zZyk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHZhciBfbXNnID0gJ+ezu+e7n+WPkeeUn+W8guW4uDogXG4nICsgbXNnOw0KICAgICAgICAgICAgICAgIGlmIChkZXRhaWxNc2cgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBfbXNnICs9ICdcbiDor6bnu4bkv6Hmga86JyArIGRldGFpbE1zZzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gX21zZyArPSAnXG4gVVJMOicgKyBzVXJsICsgJ1xubGluZU51bWJlcjonICsgc0xpbmU7DQogICAgICAgICAgICAgICAgYWxlcnQoX21zZyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgX2NyZWF0ZURpYWxvZyA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBfZGlhbG9nID0galF1ZXJ5KCI8ZGl2IHN0eWxlPSd3aWR0aDo4MDBweDsgaGVpZ2h0OjQwMHB4OycgPiA8L2Rpdj4iKTsNCiAgICAgICAgICAgIF9kaWFsb2cuYXR0cigndGl0bGUnLCAn5byC5bi45L+h5oGvJyk7DQoNCg0KICAgICAgICAgICAgdGhpcy5fbXNnSWQgPSAnX21zZ18nICsgSWRHZW5lcmF0b3IuZ2V0SWQoKTsNCiAgICAgICAgICAgIC8vIOaPkOekuuS/oeaBrw0KICAgICAgICAgICAgdmFyIG1zZ0RpdiA9IGpRdWVyeSgiPGRpdj48cD7plJnor6/kv6Hmga/lpoLkuIvvvJo8L3A+IiArDQogICAgICAgICAgICAgICAgLy8gJzxwPiDlnLDlnYA6JyArIHNVcmwgKyAnIOihjOWPtzonICsgc0xpbmUgKyAiPC9wPiIgKw0KICAgICAgICAgICAgICAgICI8L2Rpdj4iKTsNCiAgICAgICAgICAgIHRoaXMuX21zZ0N0cmwgPSBqUXVlcnkoIjxwIGlkPSciICsgdGhpcy5fbXNnSWQgKyAiJz48L3A+Iik7DQogICAgICAgICAgICB0aGlzLl9tc2dDdHJsLmFwcGVuZFRvKG1zZ0Rpdik7DQogICAgICAgICAgICBfZGlhbG9nLmFwcGVuZChtc2dEaXYpOw0KDQogICAgICAgICAgICB0aGlzLl9kZXRhaWxNc2dJZCA9ICdfZGV0YWlsTXNnXycgKyBJZEdlbmVyYXRvci5nZXRJZCgpOw0KICAgICAgICAgICAgdmFyIGlkID0gJ19kaWFsb2dfZXJyb3JfJyArIElkR2VuZXJhdG9yLmdldElkKCk7DQogICAgICAgICAgICB2YXIgZGV0YWlsID0galF1ZXJ5KCI8ZGl2PiAiICsNCiAgICAgICAgICAgICAgICAiPGEgaHJlZj0nIycgb25jbGljaz1cImpRdWVyeSgnIyIgKyBpZCArICInKS50b2dnbGUoJ2JsaW5kJyx7fSw1MDApO1wiIiArDQogICAgICAgICAgICAgICAgIic+6K+m57uG5L+h5oGvPC9hPiIgKw0KICAgICAgICAgICAgICAgICI8L2Rpdj4iKTsNCiAgICAgICAgICAgIHRoaXMuX2RldGFpbE1zZ0N0cmwgPSBqUXVlcnkoIjxkaXYgaWQ9JyIgKyBpZCArICInIHN0eWxlPSdvdmVyZmxvdzpzY3JvbGw7IHdpZHRoOjEwMCU7IGhlaWdodDozMDBweDtkaXNwbGF5Om5vbmUnPjwvZGl2PiIgKTsNCiAgICAgICAgICAgIHRoaXMuX2RldGFpbE1zZ0N0cmwuYXBwZW5kVG8oZGV0YWlsKTsNCiAgICAgICAgICAgIGRldGFpbC5pbnNlcnRBZnRlcihtc2dEaXYpOw0KDQogICAgICAgICAgICBfZGlhbG9nLmRpYWxvZyh7DQogICAgICAgICAgICAgICAgbW9kYWwgOiB0cnVlLA0KICAgICAgICAgICAgICAgIHdpZHRoOiA1MDAsDQogICAgICAgICAgICAgICAgaGVpZ2h0IDogMjgwLA0KDQogICAgICAgICAgICAgICAgYnV0dG9uczogew0KICAgICAgICAgICAgICAgICAgICBPazogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmRpYWxvZygnY2xvc2UnKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcmV0dXJuIF9kaWFsb2c7DQogICAgICAgIH0NCg0KICAgIH0NCg0KICAgIC8qKg0KICogQm9vbGVhbiDnsbvlnovnmoTovazmjaLlmajjgIINCiAqLw0KICAgIHZhciBCb29sZWFuQ29udmVydGVyID0gew0KICAgICAgICBjb252ZXJ0IDogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIOW+heajgOafpQ0KICAgICAgICAgICAgaWYgKHZhbHVlWydfX2NsYXNzTmFtZSddID09ICdqYXZhLmxhbmcuQm9vbGVhbicgKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICd0cnVlJyA9PSB2YWx1ZTsgLy8NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAhIXZhbHVlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogKiDml6XmnJ/nsbvlnovnmoTljIXoo4XlmajvvIzkuLvopoHmmK/lsIZKYXZh55qE5pel5pyf57G75Z6L77yIamF2YS5zcWwuRGF0ZSxqYXZhLnV0aWwuRGF0ZSxqYXZhLnV0aWwudGltZXN0YW1wLGphdmEudXRpbC5DYWxlbmRhcu+8iQ0KICog6L2s5o2i5Li65a+55bqU55qE5pel5pyf57G75Z6L44CCDQogKi8NCiAgICB2YXIgRGF0ZUNvbnZlcnRlciA9IHsNCiAgICAgICAgLyoqDQogICAgICog5qC55o2u5b2T5YmN5YC877yM6L+U5Zue5YW25Y+v6L2s5o2i55qEIOaXpeacn+exu+Wei+eahOWAvO+8jOWmguaenOWPguaVsOS4uuepuu+8jOWImei/lOWbnuepuuOAgg0KICAgICAqIOWmguaenOS8oOWFpeeahOWPguaVsOexu+Wei+S4jeiDveivhuWIq++8jOWImeaKm+WHuuKAnOS4jeiDveivhuWIq+KAneeahOexu+Wei+W8guW4uOOAgg0KICAgICAqLw0KICAgICAgICBjb252ZXJ0IDogZnVuY3Rpb24gKHZhbHVlKSB7DQogICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8g5b6F5qOA5p+lDQogICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7DQogICAgICAgICAgICB2YXIgX19jbGFzc05hbWUgPSB2YWx1ZVsnX19jbGFzc05hbWUnXTsNCiAgICAgICAgICAgIGlmIChfX2NsYXNzTmFtZSA9PT0gJ2phdmEudXRpbC5EYXRlJyB8fCBfX2NsYXNzTmFtZSA9PT0gJ2phdmEuc3FsLkRhdGUnDQogICAgICAgICAgICAgICAgfHwgX19jbGFzc05hbWUgPT09ICdqYXZhLnNxbC5UaW1lc3RhbXAnKSB7DQogICAgICAgICAgICAgICAgZGF0ZS5zZXRUaW1lKHBhcnNlSW50KHZhbHVlWyd0aW1lJ10pKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoX19jbGFzc05hbWUgPT09ICdqYXZhLnV0aWwuQ2FsZW5kYXInKSB7DQogICAgICAgICAgICAgICAgZGF0ZS5zZXRUaW1lKHZhbHVlKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzTmFOKHZhbHVlKSl7DQogICAgICAgICAgICAgICAgLy8g5piv5pWw5YC855qE6K+d77yM5YiZ6K6k5Li65YW25piv5pe26Ze05YC8DQogICAgICAgICAgICAgICAgZGF0ZS5zZXRUaW1lKG5ldyBOdW1iZXIodmFsdWUpKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgLy9UT0RPOiDlsJ3or5XnlKjml6XmnJ/moLzlvI/ov5vooYzop6PmnpANCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGUgdHlwZVsiICsgdmFsdWUgKyAiXSBjYW4gbm90IGJlIGNvbnZlcnRlZCB0byBkYXRlLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGRhdGU7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAqIOaVsOWAvOexu+Wei+eahOi9rOaNouWZqO+8jOS4u+imgeaYr+WwhkphdmHljIXoo4XnsbvovazmjaLkuLrlr7nlupTnmoRKYXZhU2NyaXB055qETnVtYmVy57G75Z6L44CCDQogKi8NCiAgICB2YXIgTnVtYmVyQ29udmVydGVyID0gew0KDQogICAgICAgIC8qKg0KICAgICAqIOagueaNruW9k+WJjeWAvO+8jOi/lOWbnuWFtuWPr+i9rOaNoueahCDml6XmnJ/nsbvlnovnmoTlgLzvvIzlpoLmnpzlj4LmlbDkuLrnqbrvvIzliJnov5Tlm57nqbrjgIINCiAgICAgKiDlpoLmnpzkvKDlhaXnmoTlj4LmlbDnsbvlnovkuI3og73or4bliKvvvIzliJnmipvlh7rigJzkuI3og73or4bliKvigJ3nmoTnsbvlnovlvILluLjjgIINCiAgICAgKi8NCiAgICAgICAgY29udmVydCA6IGZ1bmN0aW9uICh2YWx1ZSkgew0KICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIOW+heajgOafpQ0KICAgICAgICAgICAgdmFyIHJldCA9IDA7DQogICAgICAgICAgICB2YXIgX19jbGFzc05hbWUgPSB2YWx1ZVsnX19jbGFzc05hbWUnXTsNCiAgICAgICAgICAgIGlmIChfX2NsYXNzTmFtZSA9PT0gJ2phdmEubGFuZy5JbnRlZ2VyJyB8fCBfX2NsYXNzTmFtZSA9PT0gJ2phdmEubGFuZy5Mb25nJw0KICAgICAgICAgICAgICAgIHx8IF9fY2xhc3NOYW1lID09PSAnamF2YS5sYW5nLlNob3J0JyB8fCBfX2NsYXNzTmFtZSA9PT0gJ2phdmEubWF0aC5CaWdJbnRlZ2VyJykgew0KICAgICAgICAgICAgICAgIHJldCA9IHBhcnNlSW50KHZhbHVlWyd2YWx1ZSddKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoX19jbGFzc05hbWUgPT09ICdqYXZhLmxhbmcuRmxvYXQnIHx8IF9fY2xhc3NOYW1lID09PSAnamF2YS5sYW5nLkRvdWJsZScNCiAgICAgICAgICAgICAgICB8fCBfX2NsYXNzTmFtZSA9PT0gJ2phdmEudXRpbC5CaWdEZWNpbWFsJykgew0KICAgICAgICAgICAgICAgIHJldCA9IHBhcnNlRmxvYXQodmFsdWVbJ3ZhbHVlJ10pOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbiBub3Qga25vdyB0aGUgdHlwZSB0byBkYXRlLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHZhciBDb252ZXJ0ZXJGYWN0b3J5ID0gew0KICAgICAgICAvKioNCiAgICAgKiDlt7Lms6jlhoznmoTmiYDmnInovazmjaLlmagNCiAgICAgKi8NCiAgICAgICAgY29udmVydGVycyA6IHsNCiAgICAgICAgICAgICdqYXZhLmxhbmcuQm9vbGVhbicgIDogIEJvb2xlYW5Db252ZXJ0ZXIsDQogICAgICAgICAgICAnamF2YS51dGlsLkRhdGUnICAgICA6ICBEYXRlQ29udmVydGVyLA0KICAgICAgICAgICAgJ2phdmEuc3FsLkRhdGUnICAgICAgOiAgRGF0ZUNvbnZlcnRlciwNCiAgICAgICAgICAgICdqYXZhLnNxbC5UaW1lc3RhbXAnIDogIERhdGVDb252ZXJ0ZXIsDQogICAgICAgICAgICAnamF2YS51dGlsLkNhbGVuZGFyJyA6ICBEYXRlQ29udmVydGVyLA0KICAgICAgICAgICAgJ2phdmEubGFuZy5Mb25nJyAgICAgOiAgTnVtYmVyQ29udmVydGVyLA0KICAgICAgICAgICAgJ2phdmEubGFuZy5JbnRlZ2VyJyAgOiAgTnVtYmVyQ29udmVydGVyLA0KICAgICAgICAgICAgJ2phdmEubGFuZy5TaG9ydCcgICAgOiAgTnVtYmVyQ29udmVydGVyLA0KICAgICAgICAgICAgJ2phdmEubWF0aC5CaWdJbnRlZ2VyJyA6ICBOdW1iZXJDb252ZXJ0ZXIsDQogICAgICAgICAgICAnamF2YS5sYW5nLkZsb2F0JyAgICAgIDogIE51bWJlckNvbnZlcnRlciwNCiAgICAgICAgICAgICdqYXZhLmxhbmcuRG91YmxlJyAgICAgOiAgTnVtYmVyQ29udmVydGVyLA0KICAgICAgICAgICAgJ2phdmEudXRpbC5CaWdEZWNpbWFsJyA6ICBOdW1iZXJDb252ZXJ0ZXINCiAgICAgICAgfSwNCg0KICAgICAgICBnZXRDb252ZXJ0ZXIgOiBmdW5jdGlvbiAodHlwZSkgew0KICAgICAgICAgICAgaWYgKHR5cGUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydGVyc1t0eXBlXTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgKiDms6jlhozkuIDkuKrnsbvlnovovazmjaLlmagNCiAgICAgKi8NCiAgICAgICAgcmVnaXN0ZXIgOiBmdW5jdGlvbiAodHlwZSwgY29udmVydGVyKSB7DQogICAgICAgICAgICBpZiAodHlwZSA9PSBudWxsIHx8IGNvbnZlcnRlciA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJQYXJhbWV0ZXJzIHR5cGVbMV0gYW5kIGNvbnZlcnRlclsyXSBjYW4gbm90IGJlIG51bGwuIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLmNvbnZlcnRlcnNbdHlwZV0gPSBjb252ZXJ0ZXI7DQogICAgICAgIH0NCiAgICB9DQoNCg0KDQogICAgLyoqDQogKiDmoLzlvI/ljJbmjqXlj6PvvIznlKjkuo7lpITnkIbmlbDmja7mmL7npLrml7bnmoTmoLzlvI/ljJbjgILmraTmjqXlj6Plv4Xpobvlrp7njrDkuKTkuKrmlrnms5XvvJoNCiAqIGZvcm1hdChfY2xhc3MsIG5hbWUsIHZhbHVlKSA6IOWwhuWunumZheWAvOi9rOaNouS4uuWvueW6lOeahOaYvuekuuWAvO+8jOi/lOWbnuWAvOS4uuaYvuekuuaVsOaNruOAgg0KICogcGFyc2UoX2NsYXNzLCBuYW1lLCB2YWx1ZSkgIDog5bCG5pi+56S65YC86L2s5o2i5Li655u45bqU55qE5a6e6ZmF5YC877yM5pi+56S65YC85Li65a6e6ZmF5pWw5o2u44CCDQogKi8NCiAgICBmdW5jdGlvbiBGb3JtYXRlciAoKSB7DQogICAgfQ0KDQogICAgRm9ybWF0ZXIucHJvdG90eXBlLmZvcm1hdCA9IGZ1bmN0aW9uICh2YWx1ZSkge30NCg0KICAgIEZvcm1hdGVyLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uICh2YWx1ZSkge30NCg0KDQogICAgdmFyIEZvcm1hdGVyVXRpbHMgPSB7DQogICAgICAgIGdldEFubm90YXRpb24gOiBmdW5jdGlvbiAoX2NsYXNzLCBfbmFtZSkgew0KICAgICAgICAgICAgdmFyIGZvcm1hdEFubm8gPSBudWxsOw0KICAgICAgICAgICAgaWYgKF9jbGFzcyAhPSBudWxsICYmICBfbmFtZSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgZm9ybWF0QW5ubyA9IEFubm90YXRpb25IZWxwZXIuZ2V0RmllbGRBbm5vdGF0aW9uKF9jbGFzcywgX25hbWUsICdGb3JtYXRlcicpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHBhdHRlcm5TdHIgPSBudWxsOw0KICAgICAgICAgICAgaWYgKGZvcm1hdEFubm8gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHBhdHRlcm5TdHIgPSBmb3JtYXRBbm5vLnZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHBhdHRlcm5TdHI7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogKiDlr7nml6XmnJ/nsbvlnovov5vooYzmoLzlvI/ljJbjgIINCiAqIEBwYXJhbSBfY2xhc3MgSmF2YSDnsbvlnovvvIjov5nkuKrnsbvlnovkuIrlj6/og73lrprkuYnkuobmoIfms6jvvIkNCiAqIEBwYXJhbSBfbmFtZSAg5q2k5YC85a+55bqU55qE5bGe5oCn5ZCN56ewDQogKi8NCiAgICB2YXIgRGF0ZUZvcm1hdGVyID0gew0KICAgICAgICAvKioNCiAgICAgKiDlr7nlgLzov5vooYzmoLzlvI/ljJYNCiAgICAgKi8NCiAgICAgICAgZm9ybWF0IDogZnVuY3Rpb24gKF9jbGFzcywgX25hbWUsIHZhbHVlKSB7DQogICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHJldCA9IG51bGw7DQogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgIHJldCA9IHZhbHVlOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB2YXIgcGF0dGVyblN0ciA9IEZvcm1hdGVyVXRpbHMuZ2V0QW5ub3RhdGlvbihfY2xhc3MsIF9uYW1lKTsNCiAgICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7DQogICAgICAgICAgICAgICAgICAgIHJldCA9IERhdGVGb3JtYXQuZm9ybWF0KHZhbHVlLCBwYXR0ZXJuU3RyKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFpc05hTih2YWx1ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gbmV3IERhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0LnNldFRpbWUodmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICByZXQgPSBEYXRlRm9ybWF0LmZvcm1hdCh2YWx1ZSwgcGF0dGVyblN0cik7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgdHlwZSBvZiB2YWx1ZSBtdXN0IGJlIERhdGUsIHN0cmluZyBvciBudW1iZXIuJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHJldDsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgKiDlr7nlgLzov5vooYzop6PmnpANCiAgICAgKi8NCiAgICAgICAgcGFyc2UgOiBmdW5jdGlvbiAoX2NsYXNzLCBfbmFtZSwgdmFsdWUpIHsNCiAgICAgICAgICAgIC8vIE1lc3NhZ2VCb3guZGVidWcoJ3BhcnNlIHZhbHVlJywgdmFsdWUpDQogICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHJldCA9IG51bGw7DQogICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7DQogICAgICAgICAgICAgICAgcmV0ID0gdmFsdWU7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICB2YXIgcGF0dGVyblN0ciA9IEZvcm1hdGVyVXRpbHMuZ2V0QW5ub3RhdGlvbihfY2xhc3MsIF9uYW1lKTsNCiAgICAgICAgICAgICAgICByZXQgPSBEYXRlRm9ybWF0LnBhcnNlKHZhbHVlLCBwYXR0ZXJuU3RyKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzTmFOKHZhbHVlKSkgew0KICAgICAgICAgICAgICAgIHJldCA9IG5ldyBEYXRlKCk7DQogICAgICAgICAgICAgICAgcmV0LnNldFRpbWUodmFsdWUpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSB0eXBlIG9mIHZhbHVlIG11c3QgYmUgRGF0ZSwgc3RyaW5nIG9yIG51bWJlci4nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAqIOWvueaVsOWtl+exu+Wei+i/m+ihjOagvOW8j+WMluOAgg0KICogQHBhcmFtIF9jbGFzcyBKYXZhIOexu+Wei++8iOi/meS4quexu+Wei+S4iuWPr+iDveWumuS5ieS6huagh+azqO+8iQ0KICogQHBhcmFtIF9uYW1lICDmraTlgLzlr7nlupTnmoTlsZ7mgKflkI3np7ANCiAqLw0KICAgIHZhciBOdW1iZXJGb3JtYXRlciAvKiBpbXBsZW1lbnRzIEZvcm1hdGVyICovID0gew0KICAgICAgICBmb3JtYXQgOiBmdW5jdGlvbiAoX2NsYXNzLCBfbmFtZSwgdmFsdWUpIHsNCiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgcmV0ID0gbnVsbDsNCiAgICAgICAgICAgIGlmICghaXNOYU4odmFsdWUpKSB7DQogICAgICAgICAgICAgICAgcmV0ID0gdmFsdWU7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICB2YXIgcGF0dGVyblN0ciA9IEZvcm1hdGVyVXRpbHMuZ2V0QW5ub3RhdGlvbihfY2xhc3MsIF9uYW1lKTsNCiAgICAgICAgICAgICAgICBOdW1iZXJGb3JtYXQucGFyc2UodmFsdWUsIHBhdHRlcm5TdHIpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSB0eXBlIG9mIHZhbHVlIG11c3QgYmUgc3RyaW5nIG9yIG51bWJlci4nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXQ7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAqIOagvOW8j+WMlui9rOaNouWZqOW3peWOgu+8jOagueaNruW3peWOgueahOexu+Wei+WvueaVsOaNrui/m+ihjOagvOW8j+WMluWkhOeQhuOAgg0KICovDQogICAgdmFyIEZvcm1hdGVyRmFjdG9yeSA9IHsNCg0KICAgICAgICAvKioNCiAgICAgKiDlt7Lms6jlhoznmoTmiYDmnInovazmjaLlmagNCiAgICAgKi8NCiAgICAgICAgZm9ybWF0ZXJzIDogew0KICAgICAgICAgICAgLy8gJ2phdmEubGFuZy5Cb29sZWFuJyAgOiAgQm9vbGVhbkNvbnZlcnRlciwNCiAgICAgICAgICAgICdqYXZhLnV0aWwuRGF0ZScgICAgICAgOiAgRGF0ZUZvcm1hdGVyLA0KICAgICAgICAgICAgJ2phdmEuc3FsLkRhdGUnICAgICAgICA6ICBEYXRlRm9ybWF0ZXIsDQogICAgICAgICAgICAnamF2YS5zcWwuVGltZXN0YW1wJyAgIDogIERhdGVGb3JtYXRlciwNCiAgICAgICAgICAgICdqYXZhLnV0aWwuQ2FsZW5kYXInICAgOiAgRGF0ZUZvcm1hdGVyLA0KICAgICAgICAgICAgJ2phdmEubGFuZy5Mb25nJyAgICAgICA6ICBEYXRlRm9ybWF0ZXIsDQogICAgICAgICAgICAnamF2YS5sYW5nLkludGVnZXInICAgIDogIERhdGVGb3JtYXRlciwNCiAgICAgICAgICAgICdqYXZhLmxhbmcuU2hvcnQnICAgICAgOiAgTnVtYmVyQ29udmVydGVyLA0KICAgICAgICAgICAgJ2phdmEubWF0aC5CaWdJbnRlZ2VyJyA6ICBOdW1iZXJDb252ZXJ0ZXIsDQogICAgICAgICAgICAnamF2YS5sYW5nLkZsb2F0JyAgICAgIDogIE51bWJlckNvbnZlcnRlciwNCiAgICAgICAgICAgICdqYXZhLmxhbmcuRG91YmxlJyAgICAgOiAgTnVtYmVyQ29udmVydGVyLA0KICAgICAgICAgICAgJ2phdmEudXRpbC5CaWdEZWNpbWFsJyA6ICBOdW1iZXJDb252ZXJ0ZXINCiAgICAgICAgfSwNCg0KICAgICAgICBnZXRGb3JtYXRlciA6IGZ1bmN0aW9uICh0eXBlKSB7DQogICAgICAgICAgICBpZiAodHlwZSA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRlcnNbdHlwZV07DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICog5rOo5YaM5LiA5Liq57G75Z6L6L2s5o2i5ZmoDQogICAgICovDQogICAgICAgIHJlZ2lzdGVyIDogZnVuY3Rpb24gKHR5cGUsIGZvcm1hdGVyKSB7DQogICAgICAgICAgICBpZiAodHlwZSA9PSBudWxsIHx8IGZvcm1hdGVyID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlBhcmFtZXRlcnMgdHlwZVsxXSBhbmQgZm9ybWF0ZXJbMl0gY2FuIG5vdCBiZSBudWxsIGJvdGguIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLmZvcm1hdGVyc1t0eXBlXSA9IGZvcm1hdGVyOw0KICAgICAgICB9DQogICAgfQ0KDQovKioNCiAqIOagueaNrue7meWumueahOaemuS4vuexu+Wei+WQjeensO+8jOaooeaLn+S4gOS4quWtl+WFuOWvueixoeOAgu+8iOazqOaEj++8muaemuS4vuWQjeensOW/hemhu+WSjEphdmHnsbvlrprkuYnnmoTkuIDoh7TvvIzkvYbmmK/lj6/ph4fnlKjnvKnlhpnvvInjgIINCiAqLw0KdmFyIEVudW1GYWN0b3J5ID0gew0KICAgIC8qKg0KICAgICAqIOagueaNrue7meWumueahOaemuS4vuexu+Wei+WQjeensO+8jOWIm+W7uuS4gOS4quWtl+WFuOWvueixoeOAgg0KICAgICAqIEBwYXJhbSBlbnVtTmFtZSDmnprkuL7lkI3np7DvvIzkuI3og73kuLrnqbrvvIzlv4XpobvlkoxKYXZh57G75a6a5LmJ55qE5LiA6Ie077yM5L2G5piv5Y+v6YeH55So57yp5YaZ5pa55byPDQogICAgICovDQogICAgY3JlYXRlIDogZnVuY3Rpb24gKGVudW1OYW1lKSB7DQogICAgICAgIGlmIChlbnVtTmFtZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IgKCJUaGUgbmFtZSBvZiBlbnVtIGNhbiBub3QgYmUgbnVsbC4iKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgZGljID0gRGljdGlvbmFyeVNlcnZpY2UuZ2V0RGljdGlvbmFyeShlbnVtTmFtZSk7DQogICAgICAgIGlmIChkaWMgPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yICgiRW51bSBbIiArIGVudW1OYW1lICsgIl0gY2FuIG5vdCBiZSBmb3VuZC4iKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgaXRlbXMgPSBkaWMuaXRlbXM7DQogICAgICAgIHZhciBfZW51bSA9IHsnX19jbGFzc05hbWUnOidqYXZhLmxhbmcuRW51bScsICdjbGFzc05hbWUnIDogZGljLm5hbWV9Ow0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zW2ldOw0KCQkJdmFyIF9pdGVtID0geydfX2NsYXNzTmFtZSc6J2phdmEubGFuZy5FbnVtJywgJ2NsYXNzTmFtZScgOiBkaWMubmFtZX0NCgkJCV9pdGVtLm5hbWUgID0gaXRlbS52YWx1ZTsgIC8vIOS4uuS6huWSjOacjeWKoeWZqOS8oOeahOWAvOS/neaMgeS4gOiHtA0KCQkJX2l0ZW0udGl0bGUgPSBpdGVtLnRpdGxlOw0KICAgICAgICAgICAgX2VudW1baXRlbS52YWx1ZV0gPSBfaXRlbTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gX2VudW07DQogICAgfSwNCg0KCS8qKg0KCSAgICog5Yik5pat5Lik5Liq5p6a5Li+57G75Z6L5piv5ZCm55u4562JDQoJICAgKi8NCgllcXVhbHMgOiBmdW5jdGlvbiAoZW51bTEsIGVudW0yKSB7DQoJICAgIGlmKGVudW0xID09IG51bGwgfHwgZW51bTEubmFtZSA9PSBudWxsDQogICAgCQl8fCBlbnVtMiA9PSBudWxsKSB7DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCgkJcmV0dXJuIGVudW0xLm5hbWUgPT09IGVudW0yLm5hbWU7DQoJfQ0KfQ0KDQovKioNCiAqIOacjeWKoeWZqOerr+i/lOWbnueahOW8guW4uOWghuagiO+8mg0KICogdGhyb3dhYmxlPXsibWVzc2FnZSI6ImFzZGxhZCIsImNhdXNlIjp7Im1lc3NhZ2UiOiJzZmFzbCIsIl9fY2xhc3NOYW1lIjoiY29tLnh0Lmd0Lmh0bWwuRXhjZXB0aW9uV3JhcHBlciIsImNhdXNlIjp7Il9fY2xhc3NOYW1lIjoiY29tLnh0Lmd0Lmh0bWwuRXhjZXB0aW9uV3JhcHBlciIsImNsYXNzTmFtZSI6ImphdmEubGFuZy5OdWxsUG9pbnRlckV4Y2VwdGlvbiJ9LCJjbGFzc05hbWUiOiJjb20ueHQuY29yZS5leGNlcHRpb24uUE9FeGNlcHRpb24ifSwiX19jbGFzc05hbWUiOiJjb20ueHQuZ3QuaHRtbC5FeGNlcHRpb25XcmFwcGVyIiwiY2xhc3NOYW1lIjoiY29tLnh0LmNvcmUuZXhjZXB0aW9uLlN5c3RlbUV4Y2VwdGlvbiJ9DQogKi8NCnZhciBFcnJvclV0aWxzID0gew0KICAgIC8qKg0KICAgICAqIOWvueS6jueUqOaIt+adpeivtO+8jOS8mOWFiOe6p+eahOaOkuW6jw0KICAgICAqLw0KICAgIGZyaWVuZGx5RXhjZXB0aW9ucyA6IFsnQnVzaW5lc3NFeGNlcHRpb24nICwgJ1NlcnZpY2VFeGNlcHRpb24nICwgJ1BPRXhjZXB0aW9uJywgJ1N5c3RlbUV4Y2VwdGlvbicsICdFeGNlcHRpb24nLCAnVGhyb3dhYmxlJ10sDQoNCiAgICBnZXRGcmllbmRseU1lc3NhZ2UgOiBmdW5jdGlvbiAoX2Vycm9yKSB7DQogICAgICAgIGlmIChfZXJyb3IgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgdmFyIGZlID0gdGhpcy5maW5kRnJpZW5kbHlFeGNlcHRpb24oX2Vycm9yKTsNCiAgICAgICAgaWYgKGZlICE9IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBmZS5tZXNzYWdlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAiIjsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICog5om+5Yiw55So5oi35q+U6L6D5Y+L5aW955qE5byC5bi444CCDQogICAgICovDQogICAgZmluZEZyaWVuZGx5RXhjZXB0aW9uIDogZnVuY3Rpb24gKF9lcnJvcikgew0KICAgICAgICBpZiAoX2Vycm9yID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLmZyaWVuZGx5RXhjZXB0aW9ucy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdmFyIGZlTmFtZSA9IHRoaXMuZnJpZW5kbHlFeGNlcHRpb25zW2ldOw0KICAgICAgICAgICAgdmFyIGV3ID0gX2Vycm9yOw0KICAgICAgICAgICAgd2hpbGUgKGV3KSB7DQogICAgICAgICAgICAgICAgLy8g5Lul57uZ5a6a55qE57G75ZCN57uT5bC+DQogICAgICAgICAgICAgICAgdmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAoIl4uKiIgKyBmZU5hbWUgKyAiJCIpOw0KICAgICAgICAgICAgICAgIGlmIChyZWdleHAudGVzdChldy5jbGFzc05hbWUpKSB7DQogICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGV3ID0gZXcuY2F1c2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIF9lcnJvcjsNCiAgICB9DQp9DQoNCi8qKg0KICog55So5LqO566h55CG5b2T5YmN55qE5byC5bi45L+h5oGv44CCDQogKi8NCnZhciBFcnJvck1hbmFnZXIgPSB7DQoNCiAgICAvKioNCiAgICAgKiDplJnor6/nvJbnoIHnmoTliY3nvIDvvIznlKjkuo7ljLrliIbkuIDoiKzplJnor6/lkoznvJbnoIHplJnor68NCiAgICAgKi8NCiAgICBwcmVmaXggOiAnXyRfJywNCg0KICAgIC8qKg0KICAgICAqIOaJgOacieeahOW8guW4uOe8lueggeOAgg0KICAgICAqLw0KICAgIGVycm9ycyA6IHt9LA0KDQogICAgLyoqDQogICAgICog5rOo5YaM5LiA5Liq5byC5bi45L+h5oGvDQogICAgICovDQogICAgcmVnaXN0ZXIgOiBmdW5jdGlvbihjb2RlLCBtc2cpIHsNCiAgICAgICAgaWYgKGNvZGUgIT0gbnVsbCAmJiBtc2cgIT0gbnVsbCkgew0KICAgICAgICAgICAgdGhpcy5lcnJvcnNbY29kZV0gPSBtc2c7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvL2dldEVycm9yIDogZnVuY3Rpb24NCn0=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>